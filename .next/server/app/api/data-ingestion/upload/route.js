(()=>{var e={};e.id=1431,e.ids=[1431],e.modules={36966:e=>{function i(e){return Promise.resolve().then(()=>{var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i})}i.keys=()=>[],i.resolve=i,i.id=36966,e.exports=i},11185:e=>{"use strict";e.exports=require("mongoose")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},9714:e=>{"use strict";e.exports=require("constants")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},49002:(e,i,r)=>{"use strict";r.r(i),r.d(i,{originalPathname:()=>F,patchFetch:()=>B,requestAsyncStorage:()=>L,routeModule:()=>P,serverHooks:()=>O,staticGenerationAsyncStorage:()=>N});var s={};r.r(s),r.d(s,{POST:()=>R,runtime:()=>D});var n=r(73278),a=r(45002),o=r(54877),l=r(13534),h=r(51104),d=r(1035),c=r(21899),u=r(23392),p=r.n(u);class f extends Error{constructor(e,i,r,...s){for(let n of(Array.isArray(i)&&(i=i.join(" ").trim()),super(i),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,f),this.code=e,s))for(let e in n){let i=n[e];this[e]=Buffer.isBuffer(i)?i.toString(r.encoding):null==i?i:JSON.parse(JSON.stringify(i))}}}let g=function(e){let i=[];for(let r=0,s=e.length;r<s;r++){let s=e[r];if(null==s||!1===s)i[r]={disabled:!0};else if("string"==typeof s)i[r]={name:s};else{if("object"!=typeof s||null===s||Array.isArray(s))throw new f("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(s)} at position ${r}`]);if("string"!=typeof s.name)throw new f("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${r}`,"when column is an object literal"]);i[r]=s}}return i};class m{constructor(e=100){this.size=e,this.length=0,this.buf=Buffer.allocUnsafe(e)}prepend(e){if(Buffer.isBuffer(e)){let i=this.length+e.length;if(i>=this.size&&(this.resize(),i>=this.size))throw Error("INVALID_BUFFER_STATE");let r=this.buf;this.buf=Buffer.allocUnsafe(this.size),e.copy(this.buf,0),r.copy(this.buf,e.length),this.length+=e.length}else{let i=this.length++;i===this.size&&this.resize();let r=this.clone();this.buf[0]=e,r.copy(this.buf,1,0,i)}}append(e){let i=this.length++;i===this.size&&this.resize(),this.buf[i]=e}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){let e=this.length;this.size=2*this.size;let i=Buffer.allocUnsafe(this.size);this.buf.copy(i,0,0,e),this.buf=i}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}let b=function(e){let i={};for(let r in e)i[r.replace(/([A-Z])/g,function(e,i){return"_"+i.toLowerCase()})]=e[r];if(void 0===i.encoding||!0===i.encoding)i.encoding="utf8";else if(null===i.encoding||!1===i.encoding)i.encoding=null;else if("string"!=typeof i.encoding&&null!==i.encoding)throw new f("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(i.encoding)}`],i);if(void 0===i.bom||null===i.bom||!1===i.bom)i.bom=!1;else if(!0!==i.bom)throw new f("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(i.bom)}`],i);if(i.cast_function=null,void 0===i.cast||null===i.cast||!1===i.cast||""===i.cast)i.cast=void 0;else if("function"==typeof i.cast)i.cast_function=i.cast,i.cast=!0;else if(!0!==i.cast)throw new f("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(i.cast)}`],i);if(void 0===i.cast_date||null===i.cast_date||!1===i.cast_date||""===i.cast_date)i.cast_date=!1;else if(!0===i.cast_date)i.cast_date=function(e){let i=Date.parse(e);return isNaN(i)?e:new Date(i)};else if("function"!=typeof i.cast_date)throw new f("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(i.cast_date)}`],i);if(i.cast_first_line_to_header=void 0,!0===i.columns)i.cast_first_line_to_header=void 0;else if("function"==typeof i.columns)i.cast_first_line_to_header=i.columns,i.columns=!0;else if(Array.isArray(i.columns))i.columns=g(i.columns);else if(void 0===i.columns||null===i.columns||!1===i.columns)i.columns=!1;else throw new f("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(i.columns)}`],i);if(void 0===i.group_columns_by_name||null===i.group_columns_by_name||!1===i.group_columns_by_name)i.group_columns_by_name=!1;else if(!0!==i.group_columns_by_name)throw new f("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(i.group_columns_by_name)}`],i);else if(!1===i.columns)throw new f("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],i);if(void 0===i.comment||null===i.comment||!1===i.comment||""===i.comment)i.comment=null;else if("string"==typeof i.comment&&(i.comment=Buffer.from(i.comment,i.encoding)),!Buffer.isBuffer(i.comment))throw new f("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(i.comment)}`],i);if(void 0===i.comment_no_infix||null===i.comment_no_infix||!1===i.comment_no_infix)i.comment_no_infix=!1;else if(!0!==i.comment_no_infix)throw new f("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(i.comment_no_infix)}`],i);let r=JSON.stringify(i.delimiter);if(Array.isArray(i.delimiter)||(i.delimiter=[i.delimiter]),0===i.delimiter.length)throw new f("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${r}`],i);if(i.delimiter=i.delimiter.map(function(e){if(null==e||!1===e)return Buffer.from(",",i.encoding);if("string"==typeof e&&(e=Buffer.from(e,i.encoding)),!Buffer.isBuffer(e)||0===e.length)throw new f("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${r}`],i);return e}),void 0===i.escape||!0===i.escape?i.escape=Buffer.from('"',i.encoding):"string"==typeof i.escape?i.escape=Buffer.from(i.escape,i.encoding):(null===i.escape||!1===i.escape)&&(i.escape=null),null!==i.escape&&!Buffer.isBuffer(i.escape))throw Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(i.escape)}`);if(void 0===i.from||null===i.from)i.from=1;else if("string"==typeof i.from&&/\d+/.test(i.from)&&(i.from=parseInt(i.from)),Number.isInteger(i.from)){if(i.from<0)throw Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(e.from)}`)}else throw Error(`Invalid Option: from must be an integer, got ${JSON.stringify(i.from)}`);if(void 0===i.from_line||null===i.from_line)i.from_line=1;else if("string"==typeof i.from_line&&/\d+/.test(i.from_line)&&(i.from_line=parseInt(i.from_line)),Number.isInteger(i.from_line)){if(i.from_line<=0)throw Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(e.from_line)}`)}else throw Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(e.from_line)}`);if(void 0===i.ignore_last_delimiters||null===i.ignore_last_delimiters)i.ignore_last_delimiters=!1;else if("number"==typeof i.ignore_last_delimiters)i.ignore_last_delimiters=Math.floor(i.ignore_last_delimiters),0===i.ignore_last_delimiters&&(i.ignore_last_delimiters=!1);else if("boolean"!=typeof i.ignore_last_delimiters)throw new f("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(i.ignore_last_delimiters)}`],i);if(!0===i.ignore_last_delimiters&&!1===i.columns)throw new f("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],i);if(void 0===i.info||null===i.info||!1===i.info)i.info=!1;else if(!0!==i.info)throw Error(`Invalid Option: info must be true, got ${JSON.stringify(i.info)}`);if(void 0===i.max_record_size||null===i.max_record_size||!1===i.max_record_size)i.max_record_size=0;else if(Number.isInteger(i.max_record_size)&&i.max_record_size>=0);else if("string"==typeof i.max_record_size&&/\d+/.test(i.max_record_size))i.max_record_size=parseInt(i.max_record_size);else throw Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(i.max_record_size)}`);if(void 0===i.objname||null===i.objname||!1===i.objname)i.objname=void 0;else if(Buffer.isBuffer(i.objname)){if(0===i.objname.length)throw Error("Invalid Option: objname must be a non empty buffer");null===i.encoding||(i.objname=i.objname.toString(i.encoding))}else if("string"==typeof i.objname){if(0===i.objname.length)throw Error("Invalid Option: objname must be a non empty string")}else if("number"==typeof i.objname);else throw Error(`Invalid Option: objname must be a string or a buffer, got ${i.objname}`);if(void 0!==i.objname){if("number"==typeof i.objname){if(!1!==i.columns)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(!1===i.columns)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(void 0===i.on_record||null===i.on_record)i.on_record=void 0;else if("function"!=typeof i.on_record)throw new f("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(i.on_record)}`],i);if(void 0!==i.on_skip&&null!==i.on_skip&&"function"!=typeof i.on_skip)throw Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(i.on_skip)}`);if(null===i.quote||!1===i.quote||""===i.quote)i.quote=null;else if(void 0===i.quote||!0===i.quote?i.quote=Buffer.from('"',i.encoding):"string"==typeof i.quote&&(i.quote=Buffer.from(i.quote,i.encoding)),!Buffer.isBuffer(i.quote))throw Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(i.quote)}`);if(void 0===i.raw||null===i.raw||!1===i.raw)i.raw=!1;else if(!0!==i.raw)throw Error(`Invalid Option: raw must be true, got ${JSON.stringify(i.raw)}`);if(void 0===i.record_delimiter)i.record_delimiter=[];else if("string"==typeof i.record_delimiter||Buffer.isBuffer(i.record_delimiter)){if(0===i.record_delimiter.length)throw new f("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(i.record_delimiter)}`],i);i.record_delimiter=[i.record_delimiter]}else if(!Array.isArray(i.record_delimiter))throw new f("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(i.record_delimiter)}`],i);if(i.record_delimiter=i.record_delimiter.map(function(e,r){if("string"==typeof e||Buffer.isBuffer(e)){if(0===e.length)throw new f("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${r},`,`got ${JSON.stringify(e)}`],i)}else throw new f("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${r},`,`got ${JSON.stringify(e)}`],i);return"string"==typeof e&&(e=Buffer.from(e,i.encoding)),e}),"boolean"==typeof i.relax_column_count);else if(void 0===i.relax_column_count||null===i.relax_column_count)i.relax_column_count=!1;else throw Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(i.relax_column_count)}`);if("boolean"==typeof i.relax_column_count_less);else if(void 0===i.relax_column_count_less||null===i.relax_column_count_less)i.relax_column_count_less=!1;else throw Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(i.relax_column_count_less)}`);if("boolean"==typeof i.relax_column_count_more);else if(void 0===i.relax_column_count_more||null===i.relax_column_count_more)i.relax_column_count_more=!1;else throw Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(i.relax_column_count_more)}`);if("boolean"==typeof i.relax_quotes);else if(void 0===i.relax_quotes||null===i.relax_quotes)i.relax_quotes=!1;else throw Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(i.relax_quotes)}`);if("boolean"==typeof i.skip_empty_lines);else if(void 0===i.skip_empty_lines||null===i.skip_empty_lines)i.skip_empty_lines=!1;else throw Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(i.skip_empty_lines)}`);if("boolean"==typeof i.skip_records_with_empty_values);else if(void 0===i.skip_records_with_empty_values||null===i.skip_records_with_empty_values)i.skip_records_with_empty_values=!1;else throw Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(i.skip_records_with_empty_values)}`);if("boolean"==typeof i.skip_records_with_error);else if(void 0===i.skip_records_with_error||null===i.skip_records_with_error)i.skip_records_with_error=!1;else throw Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(i.skip_records_with_error)}`);if(void 0===i.rtrim||null===i.rtrim||!1===i.rtrim)i.rtrim=!1;else if(!0!==i.rtrim)throw Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(i.rtrim)}`);if(void 0===i.ltrim||null===i.ltrim||!1===i.ltrim)i.ltrim=!1;else if(!0!==i.ltrim)throw Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(i.ltrim)}`);if(void 0===i.trim||null===i.trim||!1===i.trim)i.trim=!1;else if(!0!==i.trim)throw Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(i.trim)}`);if(!0===i.trim&&!1!==e.ltrim?i.ltrim=!0:!0!==i.ltrim&&(i.ltrim=!1),!0===i.trim&&!1!==e.rtrim?i.rtrim=!0:!0!==i.rtrim&&(i.rtrim=!1),void 0===i.to||null===i.to)i.to=-1;else if(-1!==i.to){if("string"==typeof i.to&&/\d+/.test(i.to)&&(i.to=parseInt(i.to)),Number.isInteger(i.to)){if(i.to<=0)throw Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(e.to)}`)}else throw Error(`Invalid Option: to must be an integer, got ${JSON.stringify(e.to)}`)}if(void 0===i.to_line||null===i.to_line)i.to_line=-1;else if(-1!==i.to_line){if("string"==typeof i.to_line&&/\d+/.test(i.to_line)&&(i.to_line=parseInt(i.to_line)),Number.isInteger(i.to_line)){if(i.to_line<=0)throw Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(e.to_line)}`)}else throw Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(e.to_line)}`)}return i},v=function(e){return e.every(e=>null==e||e.toString&&""===e.toString().trim())},y={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},_=function(e={}){let i=b(e);return{info:{bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},original_options:e,options:i,state:{bomSkipped:!1,bufBytesStart:0,castField:i.cast_function,commenting:!1,error:void 0,enabled:1===i.from_line,escaping:!1,escapeIsQuote:Buffer.isBuffer(i.escape)&&Buffer.isBuffer(i.quote)&&0===Buffer.compare(i.escape,i.quote),expectedRecordLength:Array.isArray(i.columns)?i.columns.length:void 0,field:new m(20),firstLineToHeaders:i.cast_first_line_to_header,needMoreDataSize:Math.max(null!==i.comment?i.comment.length:0,...i.delimiter.map(e=>e.length),null!==i.quote?i.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new m(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:0===i.record_delimiter.length?0:Math.max(...i.record_delimiter.map(e=>e.length)),trimChars:[Buffer.from(" ",i.encoding)[0],Buffer.from("	",i.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([13],"utf8").toString(),i.encoding),Buffer.from(Buffer.from([10],"utf8").toString(),i.encoding),Buffer.from(Buffer.from([12],"utf8").toString(),i.encoding),Buffer.from(Buffer.from([32],"utf8").toString(),i.encoding),Buffer.from(Buffer.from([9],"utf8").toString(),i.encoding)]},__needMoreData:function(e,i,r){if(r)return!1;let{encoding:s,escape:n,quote:a}=this.options,{quoting:o,needMoreDataSize:l,recordDelimiterMaxLength:h}=this.state;return i-e-1<Math.max(l,0===h?Buffer.from("\r\n",s).length:h,o?(null===n?0:n.length)+a.length:0,o?a.length+h:0)},parse:function(e,i,r,s){let n,a;let{bom:o,comment_no_infix:l,encoding:h,from_line:d,ltrim:c,max_record_size:u,raw:p,relax_quotes:g,rtrim:m,skip_empty_lines:v,to:_,to_line:w}=this.options,{comment:A,escape:x,quote:S,record_delimiter:E}=this.options,{bomSkipped:C,previousBuf:T,rawBuffer:M,escapeIsQuote:k}=this.state;if(void 0===T){if(void 0===e){s();return}n=e}else n=void 0!==T&&void 0===e?T:Buffer.concat([T,e]);if(!1===C){if(!1===o)this.state.bomSkipped=!0;else if(n.length<3){if(!1===i){this.state.previousBuf=n;return}}else{for(let e in y)if(0===y[e].compare(n,0,y[e].length)){let i=y[e].length;this.state.bufBytesStart+=i,n=n.slice(i);let r=b({...this.original_options,encoding:e});for(let e in r)this.options[e]=r[e];({comment:A,escape:x,quote:S}=this.options);break}this.state.bomSkipped=!0}}let I=n.length;for(a=0;a<I&&!this.__needMoreData(a,I,i);a++){if(!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1),-1!==w&&this.info.lines>w){this.state.stop=!0,s();return}!1===this.state.quoting&&0===E.length&&this.__autoDiscoverRecordDelimiter(n,a)&&(E=this.options.record_delimiter);let e=n[a];if(!0===p&&M.append(e),(13===e||10===e)&&!1===this.state.wasRowDelimiter&&(this.state.wasRowDelimiter=!0),!0===this.state.escaping)this.state.escaping=!1;else{if(null!==x&&!0===this.state.quoting&&this.__isEscape(n,a,e)&&a+x.length<I){if(k){if(this.__isQuote(n,a+x.length)){this.state.escaping=!0,a+=x.length-1;continue}}else{this.state.escaping=!0,a+=x.length-1;continue}}if(!1===this.state.commenting&&this.__isQuote(n,a)){if(!0===this.state.quoting){let i=n[a+S.length],r=m&&this.__isCharTrimable(n,a+S.length),s=null!==A&&this.__compareBytes(A,n,a+S.length,i),o=this.__isDelimiter(n,a+S.length,i),l=0===E.length?this.__autoDiscoverRecordDelimiter(n,a+S.length):this.__isRecordDelimiter(i,n,a+S.length);if(null!==x&&this.__isEscape(n,a,e)&&this.__isQuote(n,a+x.length))a+=x.length-1;else if(!i||o||l||s||r){this.state.quoting=!1,this.state.wasQuoting=!0,a+=S.length-1;continue}else if(!1===g){let e=this.__error(new f("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(i)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(void 0!==e)return e}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(S),a+=S.length-1}else if(0!==this.state.field.length){if(!1===g){let e=this.__infoField(),i=Object.keys(y).map(e=>!!y[e].equals(this.state.field.toString())&&e).filter(Boolean)[0],r=this.__error(new f("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(e.column)} at line ${e.lines}, value is ${JSON.stringify(this.state.field.toString(h))}`,i?`(${i} bom)`:void 0],this.options,e,{field:this.state.field}));if(void 0!==r)return r}}else{this.state.quoting=!0,a+=S.length-1;continue}}if(!1===this.state.quoting){let i=this.__isRecordDelimiter(e,n,a);if(0!==i){if(this.state.commenting&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length)this.info.comment_lines++;else{if(!1===this.state.enabled&&this.info.lines+(!0===this.state.wasRowDelimiter?1:0)>=d){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),a+=i-1;continue}if(!0===v&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length){this.info.empty_lines++,a+=i-1;continue}this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;this.info.bytes=this.state.bufBytesStart+a+i;let n=this.__onRecord(r);if(void 0!==n)return n;if(-1!==_&&this.info.records>=_){this.state.stop=!0,s();return}}this.state.commenting=!1,a+=i-1;continue}if(this.state.commenting)continue;if(null!==A&&(!1===l||0===this.state.record.length&&0===this.state.field.length)&&0!==this.__compareBytes(A,n,a,e)){this.state.commenting=!0;continue}let o=this.__isDelimiter(n,a,e);if(0!==o){this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;a+=o-1;continue}}}if(!1===this.state.commenting&&0!==u&&this.state.record_length+this.state.field.length>u)return this.__error(new f("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${u}`,`at line ${this.info.lines}`],this.options,this.__infoField()));let i=!1===c||!0===this.state.quoting||0!==this.state.field.length||!this.__isCharTrimable(n,a),o=!1===m||!1===this.state.wasQuoting;if(!0===i&&!0===o)this.state.field.append(e);else{if(!0===m&&!this.__isCharTrimable(n,a))return this.__error(new f("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));!1===i&&(a+=this.__isCharTrimable(n,a)-1);continue}}if(!0===i){if(!0===this.state.quoting){let e=this.__error(new f("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(void 0!==e)return e}else if(!0===this.state.wasQuoting||0!==this.state.record.length||0!==this.state.field.length){this.info.bytes=this.state.bufBytesStart+a;let e=this.__onField();if(void 0!==e)return e;let i=this.__onRecord(r);if(void 0!==i)return i}else!0===this.state.wasRowDelimiter?this.info.empty_lines++:!0===this.state.commenting&&this.info.comment_lines++}else this.state.bufBytesStart+=a,this.state.previousBuf=n.slice(a);!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(e){let{columns:i,group_columns_by_name:r,encoding:s,info:n,from:a,relax_column_count:o,relax_column_count_less:l,relax_column_count_more:h,raw:d,skip_records_with_empty_values:c}=this.options,{enabled:u,record:p}=this.state;if(!1===u)return this.__resetRecord();let g=p.length;if(!0===i){if(!0===c&&v(p)){this.__resetRecord();return}return this.__firstLineToColumns(p)}if(!1===i&&0===this.info.records&&(this.state.expectedRecordLength=g),g!==this.state.expectedRecordLength){let e=!1===i?new f("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${g} on line ${this.info.lines}`],this.options,this.__infoField(),{record:p}):new f("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${g} on line ${this.info.lines}`],this.options,this.__infoField(),{record:p});if(!0===o||!0===l&&g<this.state.expectedRecordLength||!0===h&&g>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=e;else{let i=this.__error(e);if(i)return i}}if(!0===c&&v(p)){this.__resetRecord();return}if(!0===this.state.recordHasError){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,1===a||this.info.records>=a){let{objname:a}=this.options;if(!1!==i){let o={};for(let e=0,s=p.length;e<s;e++)void 0===i[e]||i[e].disabled||(!0===r&&void 0!==o[i[e].name]?Array.isArray(o[i[e].name])?o[i[e].name]=o[i[e].name].concat(p[e]):o[i[e].name]=[o[i[e].name],p[e]]:o[i[e].name]=p[e]);if(!0===d||!0===n){let i=Object.assign({record:o},!0===d?{raw:this.state.rawBuffer.toString(s)}:{},!0===n?{info:this.__infoRecord()}:{}),r=this.__push(void 0===a?i:[o[a],i],e);if(r)return r}else{let i=this.__push(void 0===a?o:[o[a],o],e);if(i)return i}}else if(!0===d||!0===n){let i=Object.assign({record:p},!0===d?{raw:this.state.rawBuffer.toString(s)}:{},!0===n?{info:this.__infoRecord()}:{}),r=this.__push(void 0===a?i:[p[a],i],e);if(r)return r}else{let i=this.__push(void 0===a?p:[p[a],p],e);if(i)return i}}this.__resetRecord()},__firstLineToColumns:function(e){let{firstLineToHeaders:i}=this.state;try{let r=void 0===i?e:i.call(null,e);if(!Array.isArray(r))return this.__error(new f("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(r)}`],this.options,this.__infoField(),{headers:r}));let s=g(r);this.state.expectedRecordLength=s.length,this.options.columns=s,this.__resetRecord();return}catch(e){return e}},__resetRecord:function(){!0===this.options.raw&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){let{cast:e,encoding:i,rtrim:r,max_record_size:s}=this.options,{enabled:n,wasQuoting:a}=this.state;if(!1===n)return this.__resetField();let o=this.state.field.toString(i);if(!0===r&&!1===a&&(o=o.trimRight()),!0===e){let[e,i]=this.__cast(o);if(void 0!==e)return e;o=i}this.state.record.push(o),0!==s&&"string"==typeof o&&(this.state.record_length+=o.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(e,i){let{on_record:r}=this.options;if(void 0!==r){let i=this.__infoRecord();try{e=r.call(null,e,i)}catch(e){return e}if(null==e)return}i(e)},__cast:function(e){let{columns:i,relax_column_count:r}=this.options;if(!0===Array.isArray(i)&&r&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(null!==this.state.castField)try{let i=this.__infoField();return[void 0,this.state.castField.call(null,e,i)]}catch(e){return[e]}if(this.__isFloat(e))return[void 0,parseFloat(e)];if(!1!==this.options.cast_date){let i=this.__infoField();return[void 0,this.options.cast_date.call(null,e,i)]}return[void 0,e]},__isCharTrimable:function(e,i){return((e,i)=>{let{timchars:r}=this.state;t:for(let s=0;s<r.length;s++){let n=r[s];for(let r=0;r<n.length;r++)if(n[r]!==e[i+r])continue t;return n.length}return 0})(e,i)},__isFloat:function(e){return e-parseFloat(e)+1>=0},__compareBytes:function(e,i,r,s){if(e[0]!==s)return 0;let n=e.length;for(let s=1;s<n;s++)if(e[s]!==i[r+s])return 0;return n},__isDelimiter:function(e,i,r){let{delimiter:s,ignore_last_delimiters:n}=this.options;if(!0===n&&this.state.record.length===this.options.columns.length-1||!1!==n&&"number"==typeof n&&this.state.record.length===n-1)return 0;t:for(let n=0;n<s.length;n++){let a=s[n];if(a[0]===r){for(let r=1;r<a.length;r++)if(a[r]!==e[i+r])continue t;return a.length}}return 0},__isRecordDelimiter:function(e,i,r){let{record_delimiter:s}=this.options,n=s.length;t:for(let a=0;a<n;a++){let n=s[a],o=n.length;if(n[0]===e){for(let e=1;e<o;e++)if(n[e]!==i[r+e])continue t;return n.length}}return 0},__isEscape:function(e,i,r){let{escape:s}=this.options;if(null===s)return!1;let n=s.length;if(s[0]===r){for(let r=0;r<n;r++)if(s[r]!==e[i+r])return!1;return!0}return!1},__isQuote:function(e,i){let{quote:r}=this.options;if(null===r)return!1;let s=r.length;for(let n=0;n<s;n++)if(r[n]!==e[i+n])return!1;return!0},__autoDiscoverRecordDelimiter:function(e,i){let{encoding:r}=this.options,s=[Buffer.from("\r\n",r),Buffer.from("\n",r),Buffer.from("\r",r)];e:for(let r=0;r<s.length;r++){let n=s[r].length;for(let a=0;a<n;a++)if(s[r][a]!==e[i+a])continue e;return this.options.record_delimiter.push(s[r]),this.state.recordDelimiterMaxLength=s[r].length,s[r].length}return 0},__error:function(e){let{encoding:i,raw:r,skip_records_with_error:s}=this.options,n="string"==typeof e?Error(e):e;if(!s)return n;if(this.state.recordHasError=!0,void 0!==this.options.on_skip)try{this.options.on_skip(n,r?this.state.rawBuffer.toString(i):void 0)}catch(e){return e}},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){let{columns:e,raw:i,encoding:r}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:!0===e,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(r):void 0}},__infoField:function(){let{columns:e}=this.options,i=Array.isArray(e);return{...this.__infoRecord(),column:!0===i?e.length>this.state.record.length?e[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},w=function(e,i={}){"string"==typeof e&&(e=Buffer.from(e));let r=i&&i.objname?{}:[],s=_(i),n=s.parse(e,!0,e=>{void 0===s.options.objname?r.push(e):r[e[0]]=e[1]},()=>{});if(void 0!==n)throw n;return r},A=r(68006);async function x(e){let i=new(p()).Workbook;await i.xlsx.load(e);let r=i.worksheets[0];if(!r)throw Error("Excel file has no worksheets");let s=[],n=[];r.getRow(1).eachCell((e,i)=>{n[i-1]=String(e.value||"").trim()});for(let e=2;e<=r.rowCount;e++){let i=r.getRow(e),a={},o=!1;n.forEach((e,r)=>{let s=i.getCell(r+1),n=null;null!==s.value&&void 0!==s.value&&(o=!0,n=s.value instanceof Date?s.value:"number"==typeof s.value?s.value:String(s.value).trim()),a[e]=n}),o&&s.push(a)}return s}async function S(e){return w(e.toString("utf-8"),{columns:!0,skip_empty_lines:!0,trim:!0,cast:(e,i)=>i.column&&!isNaN(Number(e))&&""!==e?Number(e):e})}async function E(e){let i=(await A(e)).text.split("\n").filter(e=>e.trim().length>0),r=[];for(let e of i){let i=e.split(/\s{2,}|\t/).filter(e=>e.trim().length>0);if(i.length>=2){let e={};i.forEach((i,r)=>{e[`column_${r+1}`]=i.trim()}),r.push(e)}}return r}async function C(e,i){let r=function(e,i){let r=e.toLowerCase().split(".").pop();switch(r){case"xlsx":case"xls":return"excel";case"csv":return"csv";case"pdf":return"pdf";default:throw Error(`Unsupported file format: ${r}`)}}(i,0);switch(r){case"excel":return x(e);case"csv":return S(e);case"pdf":return E(e);default:throw Error(`Unsupported file format: ${r}`)}}function T(e){if(null==e||""===e)return null;if("number"==typeof e)return e;if("string"==typeof e){let i=e.trim();return""===i||"null"===i.toLowerCase()||"n/a"===i.toLowerCase()?null:i}if(e instanceof Date)return e;if("string"==typeof e){let i=new Date(e);if(!isNaN(i.getTime()))return i}return String(e)}function M(e){for(let i of["badgeId","badge_id","badge","officerBadgeId","officer_badge_id","officer_id","id","Badge ID","BadgeID"]){let r=e[i];if(r){let e=String(r).trim().toUpperCase();if(e.length>0)return e}}return null}async function k(e){let i=await c.pB.findOne({badgeId:e.officerBadgeId});switch(i||(i=await c.pB.create({badgeId:e.officerBadgeId,name:e.officerName||`Officer ${e.officerBadgeId}`,department:e.department||"Unknown",designation:"Officer",district:e.district,caseClosed:0,cyberResolved:0,feedbackScore:0,awarenessPrograms:0,emergencyResponses:0,totalScore:0})),e.module){case"SpecialDrives":e.casesHandled&&(i.caseClosed=(i.caseClosed||0)+e.casesHandled);break;case"Convictions":i.caseClosed=(i.caseClosed||0)+1;break;case"Detections":e.crimeCategory?.toLowerCase().includes("cyber")&&(i.cyberResolved=(i.cyberResolved||0)+1)}e.officerName&&!i.name.includes("Officer")&&(i.name=e.officerName),e.department&&(i.department=e.department),e.district&&(i.district=e.district),i.lastUpdated=new Date,await i.save()}async function I(e,i,r,s,n){await (0,d.Q)();let a=await c.GU.create({filename:i,source:r,status:"processing",uploadedBy:n,totalRecords:0,processedRecords:0,failedRecords:0,errors:[]});try{let r=await C(e,i);a.totalRecords=r.length;let n=[],o=0,l=0;for(let e=0;e<r.length;e++){let i;let h=r[e];switch(s){case"SpecialDrives":i=function(e,i){let r=M(e);if(!r)return{success:!1,error:`Row ${i+1}: Missing badge ID`};let s=T(e.driveName||e["Drive Name"]||e.drive_name),n=T(e.driveDate||e["Drive Date"]||e.drive_date),a=T(e.casesHandled||e["Cases Handled"]||e.cases_handled);return{success:!0,data:{module:"SpecialDrives",officerBadgeId:r,officerName:T(e.officerName||e["Officer Name"]||e.officer_name),department:T(e.department||e.Department||e.department),district:T(e.district||e.District||e.district),driveName:"string"==typeof s?s:null,driveDate:n instanceof Date?n:null,casesHandled:"number"==typeof a?a:"string"==typeof a&&parseInt(a)||0,rawData:e}}}(h,e);break;case"Convictions":i=function(e,i){let r=M(e);if(!r)return{success:!1,error:`Row ${i+1}: Missing badge ID`};let s=T(e.caseNumber||e["Case Number"]||e.case_number),n=T(e.convictionDate||e["Conviction Date"]||e.conviction_date),a=T(e.crimeType||e["Crime Type"]||e.crime_type);return{success:!0,data:{module:"Convictions",officerBadgeId:r,officerName:T(e.officerName||e["Officer Name"]||e.officer_name),department:T(e.department||e.Department||e.department),district:T(e.district||e.District||e.district),caseNumber:"string"==typeof s?s:null,convictionDate:n instanceof Date?n:null,crimeType:"string"==typeof a?a:null,courtName:T(e.courtName||e["Court Name"]||e.court_name),rawData:e}}}(h,e);break;case"Detections":i=function(e,i){let r=M(e);if(!r)return{success:!1,error:`Row ${i+1}: Missing badge ID`};let s=T(e.detectionDate||e["Detection Date"]||e.detection_date),n=T(e.crimeCategory||e["Crime Category"]||e.crime_category),a=T(e.valueRecovered||e["Value Recovered"]||e.value_recovered);return{success:!0,data:{module:"Detections",officerBadgeId:r,officerName:T(e.officerName||e["Officer Name"]||e.officer_name),department:T(e.department||e.Department||e.department),district:T(e.district||e.District||e.district),detectionDate:s instanceof Date?s:null,crimeCategory:"string"==typeof n?n:null,valueRecovered:"number"==typeof a?a:"string"==typeof a&&parseFloat(a)||0,rawData:e}}}(h,e);break;default:i={success:!1,error:`Unknown module: ${s}`}}if(i.success&&i.data)try{let e=await c.f3.create({...i.data,importLogId:a._id});await k(e),o++}catch(i){l++,n.push({row:e+1,field:"general",message:i instanceof Error?i.message:String(i)})}else l++,n.push({row:e+1,field:"transformation",message:i.error||"Transformation failed"})}return a.status=l===r.length?"failed":"completed",a.processedRecords=o,a.failedRecords=l,a.errors=n,await a.save(),{success:"completed"===a.status,importLogId:a._id.toString(),totalRecords:r.length,processedRecords:o,failedRecords:l,errors:n}}catch(e){throw a.status="failed",a.errors=[{row:0,field:"file_parsing",message:e instanceof Error?e.message:String(e)}],await a.save(),e}}let D="nodejs";async function R(e){let i=(0,l.M)(e,["Admin","SuperAdmin"]);if(!("role"in i))return i;try{let r=await e.formData(),s=r.get("file"),n=r.get("source"),a=r.get("module");if(!s)return(0,h.yw)("No file provided");if(!n||!a)return(0,h.yw)("Source and module are required");let o=["SpecialDrives","Convictions","Detections"];if(!o.includes(a))return(0,h.yw)(`Invalid module. Must be one of: ${o.join(", ")}`);let l=["CCTNS_SpecialDrives","CCTNS_Convictions","CCTNS_Detections","Manual","Excel","CSV","PDF"];if(!l.includes(n))return(0,h.yw)(`Invalid source. Must be one of: ${l.join(", ")}`);let d=await s.arrayBuffer(),c=Buffer.from(d),u=await I(c,s.name,n,a,i.username);return(0,h.ok)(u)}catch(e){return console.error("Upload error:",e),(0,h.I3)("Failed to process file upload",e)}}let P=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/data-ingestion/upload/route",pathname:"/api/data-ingestion/upload",filename:"route",bundlePath:"app/api/data-ingestion/upload/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\data-ingestion\\upload\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:L,staticGenerationAsyncStorage:N,serverHooks:O}=P,F="/api/data-ingestion/upload/route";function B(){return(0,o.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:N})}},16910:(e,i,r)=>{"use strict";r.d(i,{$v:()=>f,I2:()=>g,Md:()=>d,Oe:()=>u,c_:()=>c,w5:()=>m,z:()=>p});var s=r(63506),n=r.n(s),a=r(67390),o=r.n(a),l=r(52845),h=r(56377);let d="police-dashboard-token";function c(e){return n().hash(e,10)}function u(e,i){return n().compare(e,i)}function p(e){let i=h.O.JWT_SECRET,r=h.O.JWT_EXPIRES_IN||"7d";return o().sign(e,i,{expiresIn:r})}function f(e){let i=h.O.JWT_SECRET;return o().verify(e,i)}function g(){(0,l.cookies)().delete(d)}function m(){return l.cookies().get(d)?.value??null}},51104:(e,i,r)=>{"use strict";r.d(i,{Hs:()=>l,I3:()=>c,ID:()=>h,i2:()=>a,ok:()=>n,v6:()=>d,yw:()=>o});var s=r(71309);function n(e,i){return s.NextResponse.json({success:!0,data:e},{status:200,...i})}function a(e){return s.NextResponse.json({success:!0,data:e},{status:201})}function o(e,i){return s.NextResponse.json({success:!1,message:e,details:i},{status:400})}function l(e="Unauthorized"){return s.NextResponse.json({success:!1,message:e},{status:401})}function h(e="Forbidden"){return s.NextResponse.json({success:!1,message:e},{status:403})}function d(e="Not found"){return s.NextResponse.json({success:!1,message:e},{status:404})}function c(e="Internal server error",i){return console.error(e,i),s.NextResponse.json({success:!1,message:e},{status:500})}},13534:(e,i,r)=>{"use strict";r.d(i,{M:()=>o,m:()=>a});var s=r(16910),n=r(51104);function a(e){let i=e.cookies.get(s.Md)?.value;if(!i)return(0,n.Hs)();try{return(0,s.$v)(i)}catch(e){return console.warn("Auth verification failed",e),(0,n.Hs)()}}function o(e,i){let r=a(e);return"role"in r&&!i.includes(r.role)?(0,n.ID)():r}},68006:(e,i,r)=>{"use strict";let s,n;var a,o,l,h,d,c,u,p,f,g,m,b,v,y,_=e=>{throw TypeError(e)},w=(e,i,r)=>i.has(e)||_("Cannot "+r),A=(e,i,r)=>(w(e,i,"read from private field"),r?r.call(e):i.get(e)),x=(e,i,r)=>i.has(e)?_("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,r),S=(e,i,r,s)=>(w(e,i,"write to private field"),s?s.call(e,r):i.set(e,r),r),E=(e,i,r)=>(w(e,i,"access private method"),r);Object.defineProperty(i,Symbol.toStringTag,{value:"Module"});var C="undefined"!=typeof document?document.currentScript:null,T={34:(e,i,r)=>{var s=r(4901);e.exports=function(e){return"object"==typeof e?null!==e:s(e)}},81:(e,i,r)=>{var s=r(9565),n=r(9306),a=r(8551),o=r(6823),l=r(851),h=TypeError;e.exports=function(e,i){var r=arguments.length<2?l(e):i;if(n(r))return a(s(r,e));throw new h(o(e)+" is not iterable")}},116:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(2652),o=r(9306),l=r(8551),h=r(1767),d=r(9539),c=r(4549)("find",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:c},{find:function(e){l(this);try{o(e)}catch(e){d(this,"throw",e)}if(c)return n(c,this,e);var i=h(this),r=0;return a(i,function(i,s){if(e(i,r++))return s(i)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:(e,i,r)=>{var s=r(9504),n=r(9039),a=r(4901),o=r(9297),l=r(3724),h=r(350).CONFIGURABLE,d=r(3706),c=r(1181),u=c.enforce,p=c.get,f=String,g=Object.defineProperty,m=s("".slice),b=s("".replace),v=s([].join),y=l&&!n(function(){return 8!==g(function(){},"length",{value:8}).length}),_=String(String).split("String"),w=e.exports=function(e,i,r){"Symbol("===m(f(i),0,7)&&(i="["+b(f(i),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(i="get "+i),r&&r.setter&&(i="set "+i),(!o(e,"name")||h&&e.name!==i)&&(l?g(e,"name",{value:i,configurable:!0}):e.name=i),y&&r&&o(r,"arity")&&e.length!==r.arity&&g(e,"length",{value:r.arity});try{r&&o(r,"constructor")&&r.constructor?l&&g(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var s=u(e);return o(s,"source")||(s.source=v(_,"string"==typeof i?i:"")),e};Function.prototype.toString=w(function(){return a(this)&&p(this).source||d(this)},"toString")},350:(e,i,r)=>{var s=r(3724),n=r(9297),a=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,l=n(a,"name"),h=l&&(!s||s&&o(a,"name").configurable);e.exports={EXISTS:l,PROPER:l&&"something"===(function(){}).name,CONFIGURABLE:h}},397:(e,i,r)=>{var s=r(7751);e.exports=s("document","documentElement")},421:e=>{e.exports={}},456:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(9504),o=r(4154),l=r(5169),h=a(1.1.toString),d=n.Uint8Array,c=!d||!d.prototype.toHex||!function(){try{return"ffffffffffffffff"===new d([255,255,255,255,255,255,255,255]).toHex()}catch(e){return!1}}();d&&s({target:"Uint8Array",proto:!0,forced:c},{toHex:function(){o(this),l(this.buffer);for(var e="",i=0,r=this.length;i<r;i++){var s=h(this[i],16);e+=1===s.length?"0"+s:s}return e}})},507:(e,i,r)=>{var s=r(9565);e.exports=function(e,i,r){for(var n,a,o=r?e:e.iterator,l=e.next;!(n=s(l,o)).done;)if(void 0!==(a=i(n.value)))return a}},531:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(9306),o=r(8551),l=r(1767),h=r(8646),d=r(9462),c=r(9539),u=r(6395),p=r(684),f=r(4549),g=!u&&!p("flatMap",function(){}),m=!u&&!g&&f("flatMap",TypeError),b=u||g||m,v=d(function(){for(var e,i,r=this.iterator,s=this.mapper;;){if(i=this.inner)try{if(!(e=o(n(i.next,i.iterator))).done)return e.value;this.inner=null}catch(e){c(r,"throw",e)}if(e=o(n(this.next,r)),this.done=!!e.done)return;try{this.inner=h(s(e.value,this.counter++),!1)}catch(e){c(r,"throw",e)}}});s({target:"Iterator",proto:!0,real:!0,forced:b},{flatMap:function(e){o(this);try{a(e)}catch(e){c(this,"throw",e)}return m?n(m,this,e):new v(l(this),{mapper:e,inner:null})}})},616:(e,i,r)=>{var s=r(9039);e.exports=!s(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},655:(e,i,r)=>{var s=r(6955),n=String;e.exports=function(e){if("Symbol"===s(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},679:(e,i,r)=>{var s=r(1625),n=TypeError;e.exports=function(e,i){if(s(i,e))return e;throw new n("Incorrect invocation")}},684:e=>{e.exports=function(e,i){var r="function"==typeof Iterator&&Iterator.prototype[e];if(r)try{r.call({next:null},i).next()}catch(e){return!0}}},741:e=>{var i=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var s=+e;return(s>0?r:i)(s)}},757:(e,i,r)=>{var s=r(7751),n=r(4901),a=r(1625),o=r(7040),l=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var i=s("Symbol");return n(i)&&a(i.prototype,l(e))}},851:(e,i,r)=>{var s=r(6955),n=r(5966),a=r(4117),o=r(6269),l=r(8227)("iterator");e.exports=function(e){if(!a(e))return n(e,l)||n(e,"@@iterator")||o[s(e)]}},944:e=>{var i=TypeError;e.exports=function(e){var r=e&&e.alphabet;if(void 0===r||"base64"===r||"base64url"===r)return r||"base64";throw new i("Incorrect `alphabet` option")}},1072:(e,i,r)=>{var s=r(1828),n=r(8727);e.exports=Object.keys||function(e){return s(e,n)}},1103:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},1108:(e,i,r)=>{var s=r(6955);e.exports=function(e){var i=s(e);return"BigInt64Array"===i||"BigUint64Array"===i}},1148:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(2652),o=r(9306),l=r(8551),h=r(1767),d=r(9539),c=r(4549)("every",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:c},{every:function(e){l(this);try{o(e)}catch(e){d(this,"throw",e)}if(c)return n(c,this,e);var i=h(this),r=0;return!a(i,function(i,s){if(!e(i,r++))return s()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(e,i,r)=>{var s,n,a,o=r(8622),l=r(4576),h=r(34),d=r(6699),c=r(9297),u=r(7629),p=r(6119),f=r(421),g="Object already initialized",m=l.TypeError,b=l.WeakMap;if(o||u.state){var v=u.state||(u.state=new b);v.get=v.get,v.has=v.has,v.set=v.set,s=function(e,i){if(v.has(e))throw new m(g);return i.facade=e,v.set(e,i),i},n=function(e){return v.get(e)||{}},a=function(e){return v.has(e)}}else{var y=p("state");f[y]=!0,s=function(e,i){if(c(e,y))throw new m(g);return i.facade=e,d(e,y,i),i},n=function(e){return c(e,y)?e[y]:{}},a=function(e){return c(e,y)}}e.exports={set:s,get:n,has:a,enforce:function(e){return a(e)?n(e):s(e,{})},getterFor:function(e){return function(i){var r;if(!h(i)||(r=n(i)).type!==e)throw new m("Incompatible receiver, "+e+" required");return r}}}},1291:(e,i,r)=>{var s=r(741);e.exports=function(e){var i=+e;return i!=i||0===i?0:s(i)}},1385:(e,i,r)=>{var s=r(9539);e.exports=function(e,i,r){for(var n=e.length-1;n>=0;n--)if(void 0!==e[n])try{r=s(e[n].iterator,i,r)}catch(e){i="throw",r=e}if("throw"===i)throw r;return r}},1548:(e,i,r)=>{var s=r(4576),n=r(9039),a=r(9519),o=r(4215),l=s.structuredClone;e.exports=!!l&&!n(function(){if("DENO"===o&&a>92||"NODE"===o&&a>94||"BROWSER"===o&&a>97)return!1;var e=new ArrayBuffer(8),i=l(e,{transfer:[e]});return 0!==e.byteLength||8!==i.byteLength})},1549:(e,i,r)=>{r(6632)},1625:(e,i,r)=>{var s=r(9504);e.exports=s({}.isPrototypeOf)},1689:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(8745),o=r(7680),l=r(6043),h=r(9306),d=r(1103),c=n.Promise,u=!1;s({target:"Promise",stat:!0,forced:!c||!c.try||d(function(){c.try(function(e){u=8===e},8)}).error||!u},{try:function(e){var i=arguments.length>1?o(arguments,1):[],r=l.f(this),s=d(function(){return a(h(e),void 0,i)});return(s.error?r.reject:r.resolve)(s.value),r.promise}})},1698:(e,i,r)=>{var s=r(6518),n=r(4204),a=r(9835);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("union")||!a("union")},{union:n})},1701:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(9306),o=r(8551),l=r(1767),h=r(9462),d=r(6319),c=r(9539),u=r(684),p=r(4549),f=r(6395),g=!f&&!u("map",function(){}),m=!f&&!g&&p("map",TypeError),b=f||g||m,v=h(function(){var e=this.iterator,i=o(n(this.next,e));if(!(this.done=!!i.done))return d(e,this.mapper,[i.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:b},{map:function(e){o(this);try{a(e)}catch(e){c(this,"throw",e)}return m?n(m,this,e):new v(l(this),{mapper:e})}})},1767:e=>{e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1828:(e,i,r)=>{var s=r(9504),n=r(9297),a=r(5397),o=r(9617).indexOf,l=r(421),h=s([].push);e.exports=function(e,i){var r,s=a(e),d=0,c=[];for(r in s)!n(l,r)&&n(s,r)&&h(c,r);for(;i.length>d;)n(s,r=i[d++])&&(~o(c,r)||h(c,r));return c}},2106:(e,i,r)=>{var s=r(283),n=r(4913);e.exports=function(e,i,r){return r.get&&s(r.get,i,{getter:!0}),r.set&&s(r.set,i,{setter:!0}),n.f(e,i,r)}},2140:(e,i,r)=>{var s={};s[r(8227)("toStringTag")]="z",e.exports="[object z]"===String(s)},2195:(e,i,r)=>{var s=r(9504),n=s({}.toString),a=s("".slice);e.exports=function(e){return a(n(e),8,-1)}},2211:(e,i,r)=>{var s=r(9039);e.exports=!s(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},2303:(e,i,r)=>{var s=r(4576),n=r(9504),a=s.Uint8Array,o=s.SyntaxError,l=s.parseInt,h=Math.min,d=/[^\da-f]/i,c=n(d.exec),u=n("".slice);e.exports=function(e,i){var r=e.length;if(r%2!=0)throw new o("String should be an even number of characters");for(var s=i?h(i.length,r/2):r/2,n=i||new a(s),p=0,f=0;f<s;){var g=u(e,p,p+=2);if(c(d,g))throw new o("String should only contain hex characters");n[f++]=l(g,16)}return{bytes:n,read:p}}},2360:(e,i,r)=>{var s,n=r(8551),a=r(6801),o=r(8727),l=r(421),h=r(397),d=r(4055),c=r(6119),u="prototype",p="script",f=c("IE_PROTO"),g=function(){},m=function(e){return"<"+p+">"+e+"</"+p+">"},b=function(e){e.write(m("")),e.close();var i=e.parentWindow.Object;return e=null,i},v=function(){try{s=new ActiveXObject("htmlfile")}catch(e){}v="undefined"!=typeof document?document.domain&&s?b(s):(i=d("iframe"),r="java"+p+":",i.style.display="none",h.appendChild(i),i.src=String(r),(e=i.contentWindow.document).open(),e.write(m("document.F=Object")),e.close(),e.F):b(s);for(var e,i,r,n=o.length;n--;)delete v[u][o[n]];return v()};l[f]=!0,e.exports=Object.create||function(e,i){var r;return null!==e?(g[u]=n(e),r=new g,g[u]=null,r[f]=e):r=v(),void 0===i?r:a.f(r,i)}},2475:(e,i,r)=>{var s=r(6518),n=r(8527);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("isSupersetOf",function(e){return!e})},{isSupersetOf:n})},2489:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(9306),o=r(8551),l=r(1767),h=r(9462),d=r(6319),c=r(6395),u=r(9539),p=r(684),f=r(4549),g=!c&&!p("filter",function(){}),m=!c&&!g&&f("filter",TypeError),b=c||g||m,v=h(function(){for(var e,i,r=this.iterator,s=this.predicate,a=this.next;;){if(e=o(n(a,r)),this.done=!!e.done)return;if(d(r,s,[i=e.value,this.counter++],!0))return i}});s({target:"Iterator",proto:!0,real:!0,forced:b},{filter:function(e){o(this);try{a(e)}catch(e){u(this,"throw",e)}return m?n(m,this,e):new v(l(this),{predicate:e})}})},2529:e=>{e.exports=function(e,i){return{value:e,done:i}}},2603:(e,i,r)=>{var s=r(655);e.exports=function(e,i){return void 0===e?arguments.length<2?"":i:s(e)}},2652:(e,i,r)=>{var s=r(6080),n=r(9565),a=r(8551),o=r(6823),l=r(4209),h=r(6198),d=r(1625),c=r(81),u=r(851),p=r(9539),f=TypeError,g=function(e,i){this.stopped=e,this.result=i},m=g.prototype;e.exports=function(e,i,r){var b,v,y,_,w,A,x,S=r&&r.that,E=!(!r||!r.AS_ENTRIES),C=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),M=!(!r||!r.INTERRUPTED),k=s(i,S),I=function(e){return b&&p(b,"normal"),new g(!0,e)},D=function(e){return E?(a(e),M?k(e[0],e[1],I):k(e[0],e[1])):M?k(e,I):k(e)};if(C)b=e.iterator;else if(T)b=e;else{if(!(v=u(e)))throw new f(o(e)+" is not iterable");if(l(v)){for(y=0,_=h(e);_>y;y++)if((w=D(e[y]))&&d(m,w))return w;return new g(!1)}b=c(e,v)}for(A=C?e.next:b.next;!(x=n(A,b)).done;){try{w=D(x.value)}catch(e){p(b,"throw",e)}if("object"==typeof w&&w&&d(m,w))return w}return new g(!1)}},2777:(e,i,r)=>{var s=r(9565),n=r(34),a=r(757),o=r(5966),l=r(4270),h=r(8227),d=TypeError,c=h("toPrimitive");e.exports=function(e,i){if(!n(e)||a(e))return e;var r,h=o(e,c);if(h){if(void 0===i&&(i="default"),!n(r=s(h,e,i))||a(r))return r;throw new d("Can't convert object to primitive value")}return void 0===i&&(i="number"),l(e,i)}},2787:(e,i,r)=>{var s=r(9297),n=r(4901),a=r(8981),o=r(6119),l=r(2211),h=o("IE_PROTO"),d=Object,c=d.prototype;e.exports=l?d.getPrototypeOf:function(e){var i=a(e);if(s(i,h))return i[h];var r=i.constructor;return n(r)&&i instanceof r?r.prototype:i instanceof d?c:null}},2796:(e,i,r)=>{var s=r(9039),n=r(4901),a=/#|\.prototype\./,o=function(e,i){var r=h[l(e)];return r===c||r!==d&&(n(i)?s(i):!!i)},l=o.normalize=function(e){return String(e).replace(a,".").toLowerCase()},h=o.data={},d=o.NATIVE="N",c=o.POLYFILL="P";e.exports=o},2804:e=>{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i+"+/",s=i+"-_",n=function(e){for(var i={},r=0;r<64;r++)i[e.charAt(r)]=r;return i};e.exports={i2c:r,c2i:n(r),i2cUrl:s,c2iUrl:n(s)}},2812:e=>{var i=TypeError;e.exports=function(e,r){if(e<r)throw new i("Not enough arguments");return e}},2839:(e,i,r)=>{var s=r(4576).navigator,n=s&&s.userAgent;e.exports=n?String(n):""},2967:(e,i,r)=>{var s=r(6706),n=r(34),a=r(7750),o=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,i=!1,r={};try{(e=s(Object.prototype,"__proto__","set"))(r,[]),i=r instanceof Array}catch(e){}return function(r,s){return a(r),o(s),n(r)&&(i?e(r,s):r.__proto__=s),r}}():void 0)},3068:(e,i,r)=>{var s=r(6518),n=r(9504),a=r(2652),o=RangeError,l=TypeError,h=1/0,d=Math.abs,c=Math.pow,u=n([].push),p=c(2,1023),f=c(2,53)-1,g=Number.MAX_VALUE,m=c(2,971),b={},v={},y={},_={},w={},A=function(e,i){var r=e+i;return{hi:r,lo:i-(r-e)}};s({target:"Math",stat:!0},{sumPrecise:function(e){var i=[],r=0,s=_;switch(a(e,function(e){if(++r>=f)throw new o("Maximum allowed index exceeded");if("number"!=typeof e)throw new l("Value is not a number");s!==b&&(e!=e?s=b:e===h?s=s===v?b:y:e===-1/0?s=s===y?b:v:0===e&&1/e!==h||s!==_&&s!==w||(s=w,u(i,e)))}),s){case b:return NaN;case v:return-1/0;case y:return h;case _:return -0}for(var n,c,x,S,E,C,T=[],M=0,k=0;k<i.length;k++){n=i[k];for(var I=0,D=0;D<T.length;D++){if(c=T[D],d(n)<d(c)&&(C=n,n=c,c=C),S=(x=A(n,c)).hi,E=x.lo,d(S)===h){var R=S===h?1:-1;M+=R,d(n=n-R*p-R*p)<d(c)&&(C=n,n=c,c=C),S=(x=A(n,c)).hi,E=x.lo}0!==E&&(T[I++]=E),n=S}T.length=I,0!==n&&u(T,n)}var P=T.length-1;if(S=0,E=0,0!==M){var L=P>=0?T[P]:0;if(P--,d(M)>1||M>0&&L>0||M<0&&L<0)return M>0?h:-1/0;if(S=(x=A(M*p,L/2)).hi,E=2*x.lo,d(2*S)===h)return S>0?S===p&&E===-m/2&&P>=0&&T[P]<0?g:h:S===-p&&E===m/2&&P>=0&&T[P]>0?-g:-1/0;0!==E&&(T[++P]=E,E=0),S*=2}for(;P>=0&&(S=(x=A(S,T[P--])).hi,0===(E=x.lo)););return P>=0&&(E<0&&T[P]<0||E>0&&T[P]>0)&&(c=2*E)==(n=S+c)-S&&(S=n),S}})},3167:(e,i,r)=>{var s=r(4901),n=r(34),a=r(2967);e.exports=function(e,i,r){var o,l;return a&&s(o=i.constructor)&&o!==r&&n(l=o.prototype)&&l!==r.prototype&&a(e,l),e}},3238:(e,i,r)=>{var s=r(4576),n=r(7811),a=r(7394),o=s.DataView;e.exports=function(e){if(!n||0!==a(e))return!1;try{return new o(e),!1}catch(e){return!0}}},3392:(e,i,r)=>{var s=r(9504),n=0,a=Math.random(),o=s(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++n+a,36)}},3440:(e,i,r)=>{var s=r(7080),n=r(4402),a=r(9286),o=r(5170),l=r(3789),h=r(8469),d=r(507),c=n.has,u=n.remove;e.exports=function(e){var i=s(this),r=l(e),n=a(i);return o(i)<=r.size?h(i,function(e){r.includes(e)&&u(n,e)}):d(r.getIterator(),function(e){c(n,e)&&u(n,e)}),n}},3463:e=>{var i=TypeError;e.exports=function(e){if("string"==typeof e)return e;throw new i("Argument is not a string")}},3506:(e,i,r)=>{var s=r(3925),n=String,a=TypeError;e.exports=function(e){if(s(e))return e;throw new a("Can't set "+n(e)+" as a prototype")}},3579:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(2652),o=r(9306),l=r(8551),h=r(1767),d=r(9539),c=r(4549)("some",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:c},{some:function(e){l(this);try{o(e)}catch(e){d(this,"throw",e)}if(c)return n(c,this,e);var i=h(this),r=0;return a(i,function(i,s){if(e(i,r++))return s()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(e,i,r)=>{var s=r(7080),n=r(4402),a=r(9286),o=r(3789),l=r(507),h=n.add,d=n.has,c=n.remove;e.exports=function(e){var i=s(this),r=o(e).getIterator(),n=a(i);return l(r,function(e){d(i,e)?c(n,e):h(n,e)}),n}},3706:(e,i,r)=>{var s=r(9504),n=r(4901),a=r(7629),o=s(Function.toString);n(a.inspectSource)||(a.inspectSource=function(e){return o(e)}),e.exports=a.inspectSource},3717:(e,i)=>{i.f=Object.getOwnPropertySymbols},3724:(e,i,r)=>{var s=r(9039);e.exports=!s(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3789:(e,i,r)=>{var s=r(9306),n=r(8551),a=r(9565),o=r(1291),l=r(1767),h="Invalid size",d=RangeError,c=TypeError,u=Math.max,p=function(e,i){this.set=e,this.size=u(i,0),this.has=s(e.has),this.keys=s(e.keys)};p.prototype={getIterator:function(){return l(n(a(this.keys,this.set)))},includes:function(e){return a(this.has,this.set,e)}},e.exports=function(e){n(e);var i=+e.size;if(i!=i)throw new c(h);var r=o(i);if(r<0)throw new d(h);return new p(e,r)}},3838:(e,i,r)=>{var s=r(7080),n=r(5170),a=r(8469),o=r(3789);e.exports=function(e){var i=s(this),r=o(e);return!(n(i)>r.size)&&!1!==a(i,function(e){if(!r.includes(e))return!1},!0)}},3853:(e,i,r)=>{var s=r(6518),n=r(4449);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("isDisjointFrom",function(e){return!e})},{isDisjointFrom:n})},3925:(e,i,r)=>{var s=r(34);e.exports=function(e){return s(e)||null===e}},3972:(e,i,r)=>{var s=r(34),n=String,a=TypeError;e.exports=function(e){if(void 0===e||s(e))return e;throw new a(n(e)+" is not an object or undefined")}},4055:(e,i,r)=>{var s=r(4576),n=r(34),a=s.document,o=n(a)&&n(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},4114:(e,i,r)=>{var s=r(6518),n=r(8981),a=r(6198),o=r(4527),l=r(6837);s({target:"Array",proto:!0,arity:1,forced:r(9039)(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var i=n(this),r=a(i),s=arguments.length;l(r+s);for(var h=0;h<s;h++)i[r]=arguments[h],r++;return o(i,r),r}})},4117:e=>{e.exports=function(e){return null==e}},4149:e=>{var i=RangeError;e.exports=function(e){if(e==e)return e;throw new i("NaN is not allowed")}},4154:(e,i,r)=>{var s=r(6955),n=TypeError;e.exports=function(e){if("Uint8Array"===s(e))return e;throw new n("Argument is not an Uint8Array")}},4204:(e,i,r)=>{var s=r(7080),n=r(4402).add,a=r(9286),o=r(3789),l=r(507);e.exports=function(e){var i=s(this),r=o(e).getIterator(),h=a(i);return l(r,function(e){n(h,e)}),h}},4209:(e,i,r)=>{var s=r(8227),n=r(6269),a=s("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[a]===e)}},4215:(e,i,r)=>{var s=r(4576),n=r(2839),a=r(2195),o=function(e){return n.slice(0,e.length)===e};e.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":s.Bun&&"string"==typeof Bun.version?"BUN":s.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(s.process)?"NODE":s.window&&s.document?"BROWSER":"REST"},4226:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(3463),o=r(4154),l=r(5169),h=r(2303);n.Uint8Array&&s({target:"Uint8Array",proto:!0},{setFromHex:function(e){o(this),a(e),l(this.buffer);var i=h(e,this).read;return{read:i,written:i/2}}})},4235:(e,i,r)=>{r(3068)},4270:(e,i,r)=>{var s=r(9565),n=r(4901),a=r(34),o=TypeError;e.exports=function(e,i){var r,l;if("string"===i&&n(r=e.toString)&&!a(l=s(r,e))||n(r=e.valueOf)&&!a(l=s(r,e))||"string"!==i&&n(r=e.toString)&&!a(l=s(r,e)))return l;throw new o("Can't convert object to primitive value")}},4376:(e,i,r)=>{var s=r(2195);e.exports=Array.isArray||function(e){return"Array"===s(e)}},4402:(e,i,r)=>{var s=r(9504),n=Set.prototype;e.exports={Set:Set,add:s(n.add),has:s(n.has),remove:s(n.delete),proto:n}},4449:(e,i,r)=>{var s=r(7080),n=r(4402).has,a=r(5170),o=r(3789),l=r(8469),h=r(507),d=r(9539);e.exports=function(e){var i=s(this),r=o(e);if(a(i)<=r.size)return!1!==l(i,function(e){if(r.includes(e))return!1},!0);var c=r.getIterator();return!1!==h(c,function(e){if(n(i,e))return d(c,"normal",!1)})}},4483:(e,i,r)=>{var s,n,a,o,l=r(4576),h=r(9429),d=r(1548),c=l.structuredClone,u=l.ArrayBuffer,p=l.MessageChannel,f=!1;if(d)f=function(e){c(e,{transfer:[e]})};else if(u)try{p||(s=h("worker_threads"))&&(p=s.MessageChannel),p&&(n=new p,a=new u(2),o=function(e){n.port1.postMessage(null,[e])},2===a.byteLength&&(o(a),0===a.byteLength&&(f=o)))}catch(e){}e.exports=f},4495:(e,i,r)=>{var s=r(9519),n=r(9039),a=r(4576).String;e.exports=!!Object.getOwnPropertySymbols&&!n(function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&s&&s<41})},4527:(e,i,r)=>{var s=r(3724),n=r(4376),a=TypeError,o=Object.getOwnPropertyDescriptor,l=s&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=l?function(e,i){if(n(e)&&!o(e,"length").writable)throw new a("Cannot set read only .length");return e.length=i}:function(e,i){return e.length=i}},4549:(e,i,r)=>{var s=r(4576);e.exports=function(e,i){var r=s.Iterator,n=r&&r.prototype,a=n&&n[e],o=!1;if(a)try{a.call({next:function(){return{done:!0}},return:function(){o=!0}},-1)}catch(e){e instanceof i||(o=!1)}if(!o)return a}},4576:function(e){var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4603:(e,i,r)=>{var s=r(6840),n=r(9504),a=r(655),o=r(2812),l=URLSearchParams,h=l.prototype,d=n(h.append),c=n(h.delete),u=n(h.forEach),p=n([].push),f=new l("a=1&a=2&b=3");f.delete("a",1),f.delete("b",void 0),f+""!="a=2"&&s(h,"delete",function(e){var i=arguments.length,r=i<2?void 0:arguments[1];if(i&&void 0===r)return c(this,e);var s=[];u(this,function(e,i){p(s,{key:i,value:e})}),o(i,1);for(var n,l=a(e),h=a(r),f=0,g=0,m=!1,b=s.length;f<b;)n=s[f++],m||n.key===l?(m=!0,c(this,n.key)):g++;for(;g<b;)(n=s[g++]).key===l&&n.value===h||d(this,n.key,n.value)},{enumerable:!0,unsafe:!0})},4628:(e,i,r)=>{var s=r(6518),n=r(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var e=n.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})},4644:(e,i,r)=>{var s,n,a,o=r(7811),l=r(3724),h=r(4576),d=r(4901),c=r(34),u=r(9297),p=r(6955),f=r(6823),g=r(6699),m=r(6840),b=r(2106),v=r(1625),y=r(2787),_=r(2967),w=r(8227),A=r(3392),x=r(1181),S=x.enforce,E=x.get,C=h.Int8Array,T=C&&C.prototype,M=h.Uint8ClampedArray,k=M&&M.prototype,I=C&&y(C),D=T&&y(T),R=Object.prototype,P=h.TypeError,L=w("toStringTag"),N=A("TYPED_ARRAY_TAG"),O="TypedArrayConstructor",F=o&&!!_&&"Opera"!==p(h.opera),B=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},j={BigInt64Array:8,BigUint64Array:8},$=function(e){var i=y(e);if(c(i)){var r=E(i);return r&&u(r,O)?r[O]:$(i)}},H=function(e){if(!c(e))return!1;var i=p(e);return u(U,i)||u(j,i)};for(s in U)(a=(n=h[s])&&n.prototype)?S(a)[O]=n:F=!1;for(s in j)(a=(n=h[s])&&n.prototype)&&(S(a)[O]=n);if((!F||!d(I)||I===Function.prototype)&&(I=function(){throw new P("Incorrect invocation")},F))for(s in U)h[s]&&_(h[s],I);if((!F||!D||D===R)&&(D=I.prototype,F))for(s in U)h[s]&&_(h[s].prototype,D);if(F&&y(k)!==D&&_(k,D),l&&!u(D,L))for(s in B=!0,b(D,L,{configurable:!0,get:function(){return c(this)?this[N]:void 0}}),U)h[s]&&g(h[s],N,s);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:F,TYPED_ARRAY_TAG:B&&N,aTypedArray:function(e){if(H(e))return e;throw new P("Target is not a typed array")},aTypedArrayConstructor:function(e){if(d(e)&&(!_||v(I,e)))return e;throw new P(f(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,i,r,s){if(l){if(r)for(var n in U){var a=h[n];if(a&&u(a.prototype,e))try{delete a.prototype[e]}catch(r){try{a.prototype[e]=i}catch(e){}}}D[e]&&!r||m(D,e,r?i:F&&T[e]||i,s)}},exportTypedArrayStaticMethod:function(e,i,r){var s,n;if(l){if(_){if(r){for(s in U)if((n=h[s])&&u(n,e))try{delete n[e]}catch(e){}}if(I[e]&&!r)return;try{return m(I,e,r?i:F&&I[e]||i)}catch(e){}}for(s in U)(n=h[s])&&(!n[e]||r)&&m(n,e,i)}},getTypedArrayConstructor:$,isView:function(e){if(!c(e))return!1;var i=p(e);return"DataView"===i||u(U,i)||u(j,i)},isTypedArray:H,TypedArray:I,TypedArrayPrototype:D}},4659:(e,i,r)=>{var s=r(3724),n=r(4913),a=r(6980);e.exports=function(e,i,r){s?n.f(e,i,a(0,r)):e[i]=r}},4901:e=>{var i="object"==typeof document&&document.all;e.exports=void 0===i&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},4913:(e,i,r)=>{var s=r(3724),n=r(5917),a=r(8686),o=r(8551),l=r(6969),h=TypeError,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u="enumerable",p="configurable",f="writable";i.f=s?a?function(e,i,r){if(o(e),i=l(i),o(r),"function"==typeof e&&"prototype"===i&&"value"in r&&f in r&&!r[f]){var s=c(e,i);s&&s[f]&&(e[i]=r.value,r={configurable:p in r?r[p]:s[p],enumerable:u in r?r[u]:s[u],writable:!1})}return d(e,i,r)}:d:function(e,i,r){if(o(e),i=l(i),o(r),n)try{return d(e,i,r)}catch(e){}if("get"in r||"set"in r)throw new h("Accessors not supported");return"value"in r&&(e[i]=r.value),e}},4916:(e,i,r)=>{var s=r(7751),n=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},a=function(e){return{size:e,has:function(){return!0},keys:function(){throw Error("e")}}};e.exports=function(e,i){var r=s("Set");try{(new r)[e](n(0));try{return(new r)[e](n(-1)),!1}catch(s){if(!i)return!0;try{return(new r)[e](a(-1/0)),!1}catch(s){var o=new r;return o.add(1),o.add(2),i(o[e](a(1/0)))}}}catch(e){return!1}}},4972:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(8551),o=r(1767),l=r(4149),h=r(9590),d=r(9462),c=r(9539),u=r(4549),p=r(6395),f=!p&&u("take",RangeError),g=d(function(){var e=this.iterator;if(!this.remaining--)return this.done=!0,c(e,"normal",void 0);var i=a(n(this.next,e));return(this.done=!!i.done)?void 0:i.value});s({target:"Iterator",proto:!0,real:!0,forced:p||f},{take:function(e){var i;a(this);try{i=h(l(+e))}catch(e){c(this,"throw",e)}return f?n(f,this,i):new g(o(this),{remaining:i})}})},4979:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(7751),o=r(6980),l=r(4913).f,h=r(9297),d=r(679),c=r(3167),u=r(2603),p=r(5002),f=r(8574),g=r(3724),m=r(6395),b="DOMException",v=a("Error"),y=a(b),_=function(){d(this,w);var e=arguments.length,i=u(e<1?void 0:arguments[0]),r=u(e<2?void 0:arguments[1],"Error"),s=new y(i,r),n=new v(i);return n.name=b,l(s,"stack",o(1,f(n.stack,1))),c(s,this,_),s},w=_.prototype=y.prototype,A="stack"in new v(b),x="stack"in new y(1,2),S=y&&g&&Object.getOwnPropertyDescriptor(n,b),E=!(!S||S.writable&&S.configurable),C=A&&!E&&!x;s({global:!0,constructor:!0,forced:m||C},{DOMException:C?_:y});var T=a(b),M=T.prototype;if(M.constructor!==T){for(var k in m||l(M,"constructor",o(1,T)),p)if(h(p,k)){var I=p[k],D=I.s;h(T,D)||l(T,D,o(6,I.c))}}},5002:e=>{e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(e,i,r)=>{var s=r(6518),n=r(3650),a=r(9835);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("symmetricDifference")||!a("symmetricDifference")},{symmetricDifference:n})},5031:(e,i,r)=>{var s=r(7751),n=r(9504),a=r(8480),o=r(3717),l=r(8551),h=n([].concat);e.exports=s("Reflect","ownKeys")||function(e){var i=a.f(l(e)),r=o.f;return r?h(i,r(e)):i}},5169:(e,i,r)=>{var s=r(3238),n=TypeError;e.exports=function(e){if(s(e))throw new n("ArrayBuffer is detached");return e}},5170:(e,i,r)=>{var s=r(6706),n=r(4402);e.exports=s(n.proto,"size","get")||function(e){return e.size}},5213:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(5370),o=r(9143),l=n.Uint8Array,h=!l||!l.fromBase64||!function(){try{return void l.fromBase64("a")}catch(e){}try{l.fromBase64("",null)}catch(e){return!0}}();l&&s({target:"Uint8Array",stat:!0,forced:h},{fromBase64:function(e){var i=o(e,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return a(l,i.bytes)}})},5370:(e,i,r)=>{var s=r(6198);e.exports=function(e,i,r){for(var n=0,a=arguments.length>2?r:s(i),o=new e(a);a>n;)o[n]=i[n++];return o}},5397:(e,i,r)=>{var s=r(7055),n=r(7750);e.exports=function(e){return s(n(e))}},5610:(e,i,r)=>{var s=r(1291),n=Math.max,a=Math.min;e.exports=function(e,i){var r=s(e);return r<0?n(r+i,0):a(r,i)}},5623:(e,i,r)=>{r(456)},5636:(e,i,r)=>{var s=r(4576),n=r(9504),a=r(6706),o=r(7696),l=r(5169),h=r(7394),d=r(4483),c=r(1548),u=s.structuredClone,p=s.ArrayBuffer,f=s.DataView,g=Math.min,m=p.prototype,b=f.prototype,v=n(m.slice),y=a(m,"resizable","get"),_=a(m,"maxByteLength","get"),w=n(b.getInt8),A=n(b.setInt8);e.exports=(c||d)&&function(e,i,r){var s,n=h(e),a=void 0===i?n:o(i),m=!y||!y(e);if(l(e),c&&(e=u(e,{transfer:[e]}),n===a&&(r||m)))return e;if(n>=a&&(!r||m))s=v(e,0,a);else{s=new p(a,r&&!m&&_?{maxByteLength:_(e)}:void 0);for(var b=new f(e),x=new f(s),S=g(a,n),E=0;E<S;E++)A(x,E,w(b,E))}return c||d(e),s}},5745:(e,i,r)=>{var s=r(7629);e.exports=function(e,i){return s[e]||(s[e]=i||{})}},5781:(e,i,r)=>{var s=r(6518),n=r(7751),a=r(2812),o=r(655),l=r(7416),h=n("URL");s({target:"URL",stat:!0,forced:!l},{parse:function(e){var i=a(arguments.length,1),r=o(e),s=i<2||void 0===arguments[1]?void 0:o(arguments[1]);try{return new h(r,s)}catch(e){return null}}})},5854:(e,i,r)=>{var s=r(2777),n=TypeError;e.exports=function(e){var i=s(e,"number");if("number"==typeof i)throw new n("Can't convert number to bigint");return BigInt(i)}},5876:(e,i,r)=>{var s=r(6518),n=r(3838);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("isSubsetOf",function(e){return e})},{isSubsetOf:n})},5917:(e,i,r)=>{var s=r(3724),n=r(9039),a=r(4055);e.exports=!s&&!n(function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a})},5966:(e,i,r)=>{var s=r(9306),n=r(4117);e.exports=function(e,i){var r=e[i];return n(r)?void 0:s(r)}},6043:(e,i,r)=>{var s=r(9306),n=TypeError,a=function(e){var i,r;this.promise=new e(function(e,s){if(void 0!==i||void 0!==r)throw new n("Bad Promise constructor");i=e,r=s}),this.resolve=s(i),this.reject=s(r)};e.exports.f=function(e){return new a(e)}},6080:(e,i,r)=>{var s=r(7476),n=r(9306),a=r(616),o=s(s.bind);e.exports=function(e,i){return n(e),void 0===i?e:a?o(e,i):function(){return e.apply(i,arguments)}}},6119:(e,i,r)=>{var s=r(5745),n=r(3392),a=s("keys");e.exports=function(e){return a[e]||(a[e]=n(e))}},6193:(e,i,r)=>{var s=r(4215);e.exports="NODE"===s},6198:(e,i,r)=>{var s=r(8014);e.exports=function(e){return s(e.length)}},6269:e=>{e.exports={}},6279:(e,i,r)=>{var s=r(6840);e.exports=function(e,i,r){for(var n in i)s(e,n,i[n],r);return e}},6319:(e,i,r)=>{var s=r(8551),n=r(9539);e.exports=function(e,i,r,a){try{return a?i(s(r)[0],r[1]):i(r)}catch(i){n(e,"throw",i)}}},6395:e=>{e.exports=!1},6518:(e,i,r)=>{var s=r(4576),n=r(7347).f,a=r(6699),o=r(6840),l=r(9433),h=r(7740),d=r(2796);e.exports=function(e,i){var r,c,u,p,f,g=e.target,m=e.global,b=e.stat;if(r=m?s:b?s[g]||l(g,{}):s[g]&&s[g].prototype)for(c in i){if(p=i[c],u=e.dontCallGetSet?(f=n(r,c))&&f.value:r[c],!d(m?c:g+(b?".":"#")+c,e.forced)&&void 0!==u){if(typeof p==typeof u)continue;h(p,u)}(e.sham||u&&u.sham)&&a(p,"sham",!0),o(r,c,p,e)}}},6573:(e,i,r)=>{var s=r(3724),n=r(2106),a=r(3238),o=ArrayBuffer.prototype;!s||"detached"in o||n(o,"detached",{configurable:!0,get:function(){return a(this)}})},6632:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(9143),o=r(4154),l=n.Uint8Array,h=!l||!l.prototype.setFromBase64||!function(){var e=new l([255,255,255,255,255]);try{return void e.setFromBase64("",null)}catch(e){}try{return void e.setFromBase64("a")}catch(e){}try{e.setFromBase64("MjYyZg===")}catch(i){return 50===e[0]&&54===e[1]&&50===e[2]&&255===e[3]&&255===e[4]}}();l&&s({target:"Uint8Array",proto:!0,forced:h},{setFromBase64:function(e){o(this);var i=a(e,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:i.read,written:i.written}}})},6699:(e,i,r)=>{var s=r(3724),n=r(4913),a=r(6980);e.exports=s?function(e,i,r){return n.f(e,i,a(1,r))}:function(e,i,r){return e[i]=r,e}},6706:(e,i,r)=>{var s=r(9504),n=r(9306);e.exports=function(e,i,r){try{return s(n(Object.getOwnPropertyDescriptor(e,i)[r]))}catch(e){}}},6801:(e,i,r)=>{var s=r(3724),n=r(8686),a=r(4913),o=r(8551),l=r(5397),h=r(1072);i.f=s&&!n?Object.defineProperties:function(e,i){o(e);for(var r,s=l(i),n=h(i),d=n.length,c=0;d>c;)a.f(e,r=n[c++],s[r]);return e}},6823:e=>{var i=String;e.exports=function(e){try{return i(e)}catch(e){return"Object"}}},6837:e=>{var i=TypeError;e.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}},6840:(e,i,r)=>{var s=r(4901),n=r(4913),a=r(283),o=r(9433);e.exports=function(e,i,r,l){l||(l={});var h=l.enumerable,d=void 0!==l.name?l.name:i;if(s(r)&&a(r,d,l),l.global)h?e[i]=r:o(i,r);else{try{l.unsafe?e[i]&&(h=!0):delete e[i]}catch(e){}h?e[i]=r:n.f(e,i,{value:r,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return e}},6955:(e,i,r)=>{var s=r(2140),n=r(4901),a=r(2195),o=r(8227)("toStringTag"),l=Object,h="Arguments"===a(function(){return arguments}());e.exports=s?a:function(e){var i,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,i){try{return e[i]}catch(e){}}(i=l(e),o))?r:h?a(i):"Object"===(s=a(i))&&n(i.callee)?"Arguments":s}},6969:(e,i,r)=>{var s=r(2777),n=r(757);e.exports=function(e){var i=s(e,"string");return n(i)?i:i+""}},6980:e=>{e.exports=function(e,i){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:i}}},7040:(e,i,r)=>{var s=r(4495);e.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:(e,i,r)=>{var s=r(9504),n=r(9039),a=r(2195),o=Object,l=s("".split);e.exports=n(function(){return!o("z").propertyIsEnumerable(0)})?function(e){return"String"===a(e)?l(e,""):o(e)}:o},7080:(e,i,r)=>{var s=r(4402).has;e.exports=function(e){return s(e),e}},7347:(e,i,r)=>{var s=r(3724),n=r(9565),a=r(8773),o=r(6980),l=r(5397),h=r(6969),d=r(9297),c=r(5917),u=Object.getOwnPropertyDescriptor;i.f=s?u:function(e,i){if(e=l(e),i=h(i),c)try{return u(e,i)}catch(e){}if(d(e,i))return o(!n(a.f,e,i),e[i])}},7394:(e,i,r)=>{var s=r(4576),n=r(6706),a=r(2195),o=s.ArrayBuffer,l=s.TypeError;e.exports=o&&n(o.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==a(e))throw new l("ArrayBuffer expected");return e.byteLength}},7416:(e,i,r)=>{var s=r(9039),n=r(8227),a=r(3724),o=r(6395),l=n("iterator");e.exports=!s(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),i=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),s="";return e.pathname="c%20d",i.forEach(function(e,r){i.delete("b"),s+=r+e}),r.delete("a",2),r.delete("b",void 0),o&&(!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b"))||!i.size&&(o||!a)||!i.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==i.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!i[l]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==s||"x"!==new URL("https://x",void 0).host})},7476:(e,i,r)=>{var s=r(2195),n=r(9504);e.exports=function(e){if("Function"===s(e))return n(e)}},7566:(e,i,r)=>{var s=r(6840),n=r(9504),a=r(655),o=r(2812),l=URLSearchParams,h=l.prototype,d=n(h.getAll),c=n(h.has),u=new l("a=1");!u.has("a",2)&&u.has("a",void 0)||s(h,"has",function(e){var i=arguments.length,r=i<2?void 0:arguments[1];if(i&&void 0===r)return c(this,e);var s=d(this,e);o(i,1);for(var n=a(r),l=0;l<s.length;)if(s[l++]===n)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(2652),o=r(9306),l=r(8551),h=r(1767),d=r(9539),c=r(4549)("forEach",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:c},{forEach:function(e){l(this);try{o(e)}catch(e){d(this,"throw",e)}if(c)return n(c,this,e);var i=h(this),r=0;a(i,function(i){e(i,r++)},{IS_RECORD:!0})}})},7629:(e,i,r)=>{var s=r(6395),n=r(4576),a=r(9433),o="__core-js_shared__",l=e.exports=n[o]||a(o,{});(l.versions||(l.versions=[])).push({version:"3.45.1",mode:s?"pure":"global",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(e,i,r)=>{var s=r(6518),n=r(3440),a=r(9039);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("difference",function(e){return 0===e.size})||a(function(){var e=new Set([1,2,3,4]);return 3!==e.difference({size:1,has:function(){return!0},keys:function(){var i=0;return{next:function(){var r=i++>1;return e.has(1)&&e.clear(),{done:r,value:2}}}}}).size})},{difference:n})},7657:(e,i,r)=>{var s,n,a,o=r(9039),l=r(4901),h=r(34),d=r(2360),c=r(2787),u=r(6840),p=r(8227),f=r(6395),g=p("iterator"),m=!1;[].keys&&("next"in(a=[].keys())?(n=c(c(a)))!==Object.prototype&&(s=n):m=!0),!h(s)||o(function(){var e={};return s[g].call(e)!==e})?s={}:f&&(s=d(s)),l(s[g])||u(s,g,function(){return this}),e.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:m}},7680:(e,i,r)=>{var s=r(9504);e.exports=s([].slice)},7696:(e,i,r)=>{var s=r(1291),n=r(8014),a=RangeError;e.exports=function(e){if(void 0===e)return 0;var i=s(e),r=n(i);if(i!==r)throw new a("Wrong length or index");return r}},7740:(e,i,r)=>{var s=r(9297),n=r(5031),a=r(7347),o=r(4913);e.exports=function(e,i,r){for(var l=n(i),h=o.f,d=a.f,c=0;c<l.length;c++){var u=l[c];s(e,u)||r&&s(r,u)||h(e,u,d(i,u))}}},7750:(e,i,r)=>{var s=r(4117),n=TypeError;e.exports=function(e){if(s(e))throw new n("Can't call method on "+e);return e}},7751:(e,i,r)=>{var s=r(4576),n=r(4901);e.exports=function(e,i){var r;return arguments.length<2?n(r=s[e])?r:void 0:s[e]&&s[e][i]}},7811:e=>{e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7936:(e,i,r)=>{var s=r(6518),n=r(5636);n&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return n(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(e,i,r)=>{var s=r(6518),n=r(9039),a=r(8750);s({target:"Set",proto:!0,real:!0,forced:!r(4916)("intersection",function(e){return 2===e.size&&e.has(1)&&e.has(2)})||n(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))})},{intersection:a})},8014:(e,i,r)=>{var s=r(1291),n=Math.min;e.exports=function(e){var i=s(e);return i>0?n(i,9007199254740991):0}},8100:(e,i,r)=>{var s=r(6518),n=r(5636);n&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return n(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(679),o=r(8551),l=r(4901),h=r(2787),d=r(2106),c=r(4659),u=r(9039),p=r(9297),f=r(8227),g=r(7657).IteratorPrototype,m=r(3724),b=r(6395),v="constructor",y="Iterator",_=f("toStringTag"),w=TypeError,A=n[y],x=b||!l(A)||A.prototype!==g||!u(function(){A({})}),S=function(){if(a(this,g),h(this)===g)throw new w("Abstract class Iterator not directly constructable")},E=function(e,i){m?d(g,e,{configurable:!0,get:function(){return i},set:function(i){if(o(this),this===g)throw new w("You can't redefine this property");p(this,e)?this[e]=i:c(this,e,i)}}):g[e]=i};p(g,_)||E(_,y),!x&&p(g,v)&&g[v]!==Object||E(v,S),S.prototype=g,s({global:!0,constructor:!0,forced:x},{Iterator:S})},8227:(e,i,r)=>{var s=r(4576),n=r(5745),a=r(9297),o=r(3392),l=r(4495),h=r(7040),d=s.Symbol,c=n("wks"),u=h?d.for||d:d&&d.withoutSetter||o;e.exports=function(e){return a(c,e)||(c[e]=l&&a(d,e)?d[e]:u("Symbol."+e)),c[e]}},8235:(e,i,r)=>{var s=r(9504),n=r(9297),a=SyntaxError,o=parseInt,l=String.fromCharCode,h=s("".charAt),d=s("".slice),c=s(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"	"},p=/^[\da-f]{4}$/i,f=/^[\u0000-\u001F]$/;e.exports=function(e,i){for(var r=!0,s="";i<e.length;){var g=h(e,i);if("\\"===g){var m=d(e,i,i+2);if(n(u,m))s+=u[m],i+=2;else{if("\\u"!==m)throw new a('Unknown escape sequence: "'+m+'"');var b=d(e,i+=2,i+4);if(!c(p,b))throw new a("Bad Unicode escape at: "+i);s+=l(o(b,16)),i+=4}}else{if('"'===g){r=!1,i++;break}if(c(f,g))throw new a("Bad control character in string literal at: "+i);s+=g,i++}}if(r)throw new a("Unterminated string at: "+i);return{value:s,end:i}}},8237:(e,i,r)=>{var s=r(6518),n=r(2652),a=r(9306),o=r(8551),l=r(1767),h=r(9539),d=r(4549),c=r(8745),u=r(9039),p=TypeError,f=u(function(){[].keys().reduce(function(){},void 0)}),g=!f&&d("reduce",p);s({target:"Iterator",proto:!0,real:!0,forced:f||g},{reduce:function(e){o(this);try{a(e)}catch(e){h(this,"throw",e)}var i=arguments.length<2,r=i?void 0:arguments[1];if(g)return c(g,this,i?[e]:[e,r]);var s=l(this),d=0;if(n(s,function(s){i?(i=!1,r=s):r=e(r,s,d),d++},{IS_RECORD:!0}),i)throw new p("Reduce of empty iterator with no initial value");return r}})},8335:(e,i,r)=>{var s=r(6518),n=r(3724),a=r(4576),o=r(7751),l=r(9504),h=r(9565),d=r(4901),c=r(34),u=r(4376),p=r(9297),f=r(655),g=r(6198),m=r(4659),b=r(9039),v=r(8235),y=r(4495),_=a.JSON,w=a.Number,A=a.SyntaxError,x=_&&_.parse,S=o("Object","keys"),E=Object.getOwnPropertyDescriptor,C=l("".charAt),T=l("".slice),M=l(/./.exec),k=l([].push),I=/^\d$/,D=/^[1-9]$/,R=/^[\d-]$/,P=/^[\t\n\r ]$/,L=function(e,i,r,s){var n,a,o,l,d,f=e[i],m=s&&f===s.value,b=m&&"string"==typeof s.source?{source:s.source}:{};if(c(f)){var v=u(f),y=m?s.nodes:v?[]:{};if(v)for(n=y.length,o=g(f),l=0;l<o;l++)N(f,l,L(f,""+l,r,l<n?y[l]:void 0));else for(o=g(a=S(f)),l=0;l<o;l++)N(f,d=a[l],L(f,d,r,p(y,d)?y[d]:void 0))}return h(r,e,i,f,b)},N=function(e,i,r){if(n){var s=E(e,i);if(s&&!s.configurable)return}void 0===r?delete e[i]:m(e,i,r)},O=function(e,i,r,s){this.value=e,this.end=i,this.source=r,this.nodes=s},F=function(e,i){this.source=e,this.index=i};F.prototype={fork:function(e){return new F(this.source,e)},parse:function(){var e=this.source,i=this.skip(P,this.index),r=this.fork(i),s=C(e,i);if(M(R,s))return r.number();switch(s){case"{":return r.object();case"[":return r.array();case'"':return r.string();case"t":return r.keyword(!0);case"f":return r.keyword(!1);case"n":return r.keyword(null)}throw new A('Unexpected character: "'+s+'" at: '+i)},node:function(e,i,r,s,n){return new O(i,s,e?null:T(this.source,r,s),n)},object:function(){for(var e=this.source,i=this.index+1,r=!1,s={},n={};i<e.length;){if("}"===C(e,i=this.until(['"',"}"],i))&&!r){i++;break}var a=this.fork(i).string(),o=a.value;i=a.end,i=this.until([":"],i)+1,i=this.skip(P,i),m(n,o,a=this.fork(i).parse()),m(s,o,a.value);var l=C(e,i=this.until([",","}"],a.end));if(","===l)r=!0,i++;else if("}"===l){i++;break}}return this.node(1,s,this.index,i,n)},array:function(){for(var e=this.source,i=this.index+1,r=!1,s=[],n=[];i<e.length;){if("]"===C(e,i=this.skip(P,i))&&!r){i++;break}var a=this.fork(i).parse();if(k(n,a),k(s,a.value),","===C(e,i=this.until([",","]"],a.end)))r=!0,i++;else if("]"===C(e,i)){i++;break}}return this.node(1,s,this.index,i,n)},string:function(){var e=this.index,i=v(this.source,this.index+1);return this.node(0,i.value,e,i.end)},number:function(){var e=this.source,i=this.index,r=i;if("-"===C(e,r)&&r++,"0"===C(e,r))r++;else{if(!M(D,C(e,r)))throw new A("Failed to parse number at: "+r);r=this.skip(I,r+1)}if("."===C(e,r)&&(r=this.skip(I,r+1)),("e"===C(e,r)||"E"===C(e,r))&&("+"!==C(e,++r)&&"-"!==C(e,r)||r++,r===(r=this.skip(I,r))))throw new A("Failed to parse number's exponent value at: "+r);return this.node(0,w(T(e,i,r)),i,r)},keyword:function(e){var i=""+e,r=this.index,s=r+i.length;if(T(this.source,r,s)!==i)throw new A("Failed to parse value at: "+r);return this.node(0,e,r,s)},skip:function(e,i){for(var r=this.source;i<r.length&&M(e,C(r,i));i++);return i},until:function(e,i){i=this.skip(P,i);for(var r=C(this.source,i),s=0;s<e.length;s++)if(e[s]===r)return i;throw new A('Unexpected character: "'+r+'" at: '+i)}};var B=b(function(){var e,i="9007199254740993";return x(i,function(i,r,s){e=s.source}),e!==i}),U=y&&!b(function(){return 1/x("-0 	")!=-1/0});s({target:"JSON",stat:!0,forced:B},{parse:function(e,i){return U&&!d(i)?x(e):function(e,i){var r=new F(e=f(e),0),s=r.parse(),n=s.value,a=r.skip(P,s.end);if(a<e.length)throw new A('Unexpected extra character: "'+C(e,a)+'" after the parsed data at: '+a);return d(i)?L({"":n},"",i,s):n}(e,i)}})},8469:(e,i,r)=>{var s=r(9504),n=r(507),a=r(4402),o=a.Set,l=a.proto,h=s(l.forEach),d=s(l.keys),c=d(new o).next;e.exports=function(e,i,r){return r?n({iterator:d(e),next:c},i):h(e,i)}},8480:(e,i,r)=>{var s=r(1828),n=r(8727).concat("length","prototype");i.f=Object.getOwnPropertyNames||function(e){return s(e,n)}},8527:(e,i,r)=>{var s=r(7080),n=r(4402).has,a=r(5170),o=r(3789),l=r(507),h=r(9539);e.exports=function(e){var i=s(this),r=o(e);if(a(i)<r.size)return!1;var d=r.getIterator();return!1!==l(d,function(e){if(!n(i,e))return h(d,"normal",!1)})}},8551:(e,i,r)=>{var s=r(34),n=String,a=TypeError;e.exports=function(e){if(s(e))return e;throw new a(n(e)+" is not an object")}},8574:(e,i,r)=>{var s=r(9504),n=Error,a=s("".replace),o=String(new n("zxcasd").stack),l=/\n\s*at [^:]*:[^\n]*/,h=l.test(o);e.exports=function(e,i){if(h&&"string"==typeof e&&!n.prepareStackTrace)for(;i--;)e=a(e,l,"");return e}},8622:(e,i,r)=>{var s=r(4576),n=r(4901),a=s.WeakMap;e.exports=n(a)&&/native code/.test(String(a))},8646:(e,i,r)=>{var s=r(9565),n=r(8551),a=r(1767),o=r(851);e.exports=function(e,i){i&&"string"==typeof e||n(e);var r=o(e);return a(n(void 0!==r?s(r,e):e))}},8686:(e,i,r)=>{var s=r(3724),n=r(9039);e.exports=s&&n(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8721:(e,i,r)=>{var s=r(3724),n=r(9504),a=r(2106),o=URLSearchParams.prototype,l=n(o.forEach);!s||"size"in o||a(o,"size",{get:function(){var e=0;return l(this,function(){e++}),e},configurable:!0,enumerable:!0})},8727:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(e,i,r)=>{var s=r(616),n=Function.prototype,a=n.apply,o=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(s?o.bind(a):function(){return o.apply(a,arguments)})},8750:(e,i,r)=>{var s=r(7080),n=r(4402),a=r(5170),o=r(3789),l=r(8469),h=r(507),d=n.Set,c=n.add,u=n.has;e.exports=function(e){var i=s(this),r=o(e),n=new d;return a(i)>r.size?h(r.getIterator(),function(e){u(i,e)&&c(n,e)}):l(i,function(e){r.includes(e)&&c(n,e)}),n}},8773:(e,i)=>{var r={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,n=s&&!r.call({1:2},1);i.f=n?function(e){var i=s(this,e);return!!i&&i.enumerable}:r},8981:(e,i,r)=>{var s=r(7750),n=Object;e.exports=function(e){return n(s(e))}},9039:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},9143:(e,i,r)=>{var s=r(4576),n=r(9504),a=r(3972),o=r(3463),l=r(9297),h=r(2804),d=r(944),c=r(5169),u=h.c2i,p=h.c2iUrl,f=s.SyntaxError,g=s.TypeError,m=n("".charAt),b=function(e,i){for(var r=e.length;i<r;i++){var s=m(e,i);if(" "!==s&&"	"!==s&&"\n"!==s&&"\f"!==s&&"\r"!==s)break}return i},v=function(e,i,r){var s=e.length;s<4&&(e+=2===s?"AA":"A");var n=(i[m(e,0)]<<18)+(i[m(e,1)]<<12)+(i[m(e,2)]<<6)+i[m(e,3)],a=[n>>16&255,n>>8&255,255&n];if(2===s){if(r&&0!==a[1])throw new f("Extra bits");return[a[0]]}if(3===s){if(r&&0!==a[2])throw new f("Extra bits");return[a[0],a[1]]}return a},y=function(e,i,r){for(var s=i.length,n=0;n<s;n++)e[r+n]=i[n];return r+s};e.exports=function(e,i,r,s){o(e),a(i);var n="base64"===d(i)?u:p,h=i?i.lastChunkHandling:void 0;if(void 0===h&&(h="loose"),"loose"!==h&&"strict"!==h&&"stop-before-partial"!==h)throw new g("Incorrect `lastChunkHandling` option");r&&c(r.buffer);var _=e.length,w=r||[],A=0,x=0,S="",E=0;if(s)for(;;){if((E=b(e,E))===_){if(S.length>0){if("stop-before-partial"===h)break;if("loose"!==h)throw new f("Missing padding");if(1===S.length)throw new f("Malformed padding: exactly one additional character");A=y(w,v(S,n,!1),A)}x=_;break}var C=m(e,E);if(++E,"="===C){if(S.length<2)throw new f("Padding is too early");if(E=b(e,E),2===S.length){if(E===_){if("stop-before-partial"===h)break;throw new f("Malformed padding: only one =")}"="===m(e,E)&&(E=b(e,++E))}if(E<_)throw new f("Unexpected character after padding");A=y(w,v(S,n,"strict"===h),A),x=_;break}if(!l(n,C))throw new f("Unexpected character");var T=s-A;if(1===T&&2===S.length||2===T&&3===S.length||4===(S+=C).length&&(A=y(w,v(S,n,!1),A),S="",x=E,A===s))break}return{bytes:w,read:x,written:A}}},9286:(e,i,r)=>{var s=r(4402),n=r(8469),a=s.Set,o=s.add;e.exports=function(e){var i=new a;return n(e,function(e){o(i,e)}),i}},9297:(e,i,r)=>{var s=r(9504),n=r(8981),a=s({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,i){return a(n(e),i)}},9306:(e,i,r)=>{var s=r(4901),n=r(6823),a=TypeError;e.exports=function(e){if(s(e))return e;throw new a(n(e)+" is not a function")}},9314:(e,i,r)=>{var s=r(6518),n=r(9565),a=r(8551),o=r(1767),l=r(4149),h=r(9590),d=r(9539),c=r(9462),u=r(684),p=r(4549),f=r(6395),g=!f&&!u("drop",0),m=!f&&!g&&p("drop",RangeError),b=f||g||m,v=c(function(){for(var e,i=this.iterator,r=this.next;this.remaining;)if(this.remaining--,e=a(n(r,i)),this.done=!!e.done)return;if(e=a(n(r,i)),!(this.done=!!e.done))return e.value});s({target:"Iterator",proto:!0,real:!0,forced:b},{drop:function(e){var i;a(this);try{i=h(l(+e))}catch(e){d(this,"throw",e)}return m?n(m,this,i):new v(o(this),{remaining:i})}})},9429:(e,i,r)=>{var s=r(4576),n=r(6193);e.exports=function(e){if(n){try{return s.process.getBuiltinModule(e)}catch(e){}try{return Function('return require("'+e+'")')()}catch(e){}}}},9432:(e,i,r)=>{r(5213)},9433:(e,i,r)=>{var s=r(4576),n=Object.defineProperty;e.exports=function(e,i){try{n(s,e,{value:i,configurable:!0,writable:!0})}catch(r){s[e]=i}return i}},9462:(e,i,r)=>{var s=r(9565),n=r(2360),a=r(6699),o=r(6279),l=r(8227),h=r(1181),d=r(5966),c=r(7657).IteratorPrototype,u=r(2529),p=r(9539),f=r(1385),g=l("toStringTag"),m="IteratorHelper",b="WrapForValidIterator",v="normal",y="throw",_=h.set,w=function(e){var i=h.getterFor(e?b:m);return o(n(c),{next:function(){var r=i(this);if(e)return r.nextHandler();if(r.done)return u(void 0,!0);try{var s=r.nextHandler();return r.returnHandlerResult?s:u(s,r.done)}catch(e){throw r.done=!0,e}},return:function(){var r=i(this),n=r.iterator;if(r.done=!0,e){var a=d(n,"return");return a?s(a,n):u(void 0,!0)}if(r.inner)try{p(r.inner.iterator,v)}catch(e){return p(n,y,e)}if(r.openIters)try{f(r.openIters,v)}catch(e){return p(n,y,e)}return n&&p(n,v),u(void 0,!0)}})},A=w(!0),x=w(!1);a(x,g,"Iterator Helper"),e.exports=function(e,i,r){var s=function(s,n){n?(n.iterator=s.iterator,n.next=s.next):n=s,n.type=i?b:m,n.returnHandlerResult=!!r,n.nextHandler=e,n.counter=0,n.done=!1,_(this,n)};return s.prototype=i?A:x,s}},9486:(e,i,r)=>{var s=r(6518),n=r(4576),a=r(9504),o=r(3972),l=r(4154),h=r(5169),d=r(2804),c=r(944),u=d.i2c,p=d.i2cUrl,f=a("".charAt),g=n.Uint8Array,m=!g||!g.prototype.toBase64||!function(){try{(new g).toBase64(null)}catch(e){return!0}}();g&&s({target:"Uint8Array",proto:!0,forced:m},{toBase64:function(){var e=l(this),i=arguments.length?o(arguments[0]):void 0,r="base64"===c(i)?u:p,s=!!i&&!!i.omitPadding;h(this.buffer);for(var n,a="",d=0,g=e.length,m=function(e){return f(r,n>>6*e&63)};d+2<g;d+=3)n=(e[d]<<16)+(e[d+1]<<8)+e[d+2],a+=m(3)+m(2)+m(1)+m(0);return d+2===g?(n=(e[d]<<16)+(e[d+1]<<8),a+=m(3)+m(2)+m(1)+(s?"":"=")):d+1===g&&(n=e[d]<<16,a+=m(3)+m(2)+(s?"":"==")),a}})},9504:(e,i,r)=>{var s=r(616),n=Function.prototype,a=n.call,o=s&&n.bind.bind(a,a);e.exports=s?o:function(e){return function(){return a.apply(e,arguments)}}},9519:(e,i,r)=>{var s,n,a=r(4576),o=r(2839),l=a.process,h=a.Deno,d=l&&l.versions||h&&h.version,c=d&&d.v8;c&&(n=(s=c.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!n&&o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(n=+s[1]),e.exports=n},9539:(e,i,r)=>{var s=r(9565),n=r(8551),a=r(5966);e.exports=function(e,i,r){var o,l;n(e);try{if(!(o=a(e,"return"))){if("throw"===i)throw r;return r}o=s(o,e)}catch(e){l=!0,o=e}if("throw"===i)throw r;if(l)throw o;return n(o),r}},9565:(e,i,r)=>{var s=r(616),n=Function.prototype.call;e.exports=s?n.bind(n):function(){return n.apply(n,arguments)}},9577:(e,i,r)=>{var s=r(9928),n=r(4644),a=r(1108),o=r(1291),l=r(5854),h=n.aTypedArray,d=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,u=function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}(),p=u&&function(){try{new Int8Array(1).with(-.5,1)}catch(e){return!0}}();c("with",{with:function(e,i){var r=h(this),n=o(e),c=a(r)?l(i):+i;return s(r,d(r),n,c)}}.with,!u||p)},9590:(e,i,r)=>{var s=r(1291),n=RangeError;e.exports=function(e){var i=s(e);if(i<0)throw new n("The argument can't be less than 0");return i}},9617:(e,i,r)=>{var s=r(5397),n=r(5610),a=r(6198),o=function(e){return function(i,r,o){var l=s(i),h=a(l);if(0===h)return!e&&-1;var d,c=n(o,h);if(e&&r!=r){for(;h>c;)if((d=l[c++])!=d)return!0}else for(;h>c;c++)if((e||c in l)&&l[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},9631:(e,i,r)=>{r(9486)},9797:(e,i,r)=>{r(4226)},9835:e=>{e.exports=function(e){try{var i=new Set,r=i[e]({size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return i.clear(),i.add(4),function(){return{done:!0}}}})}});return 1===r.size&&4===r.values().next().value}catch(e){return!1}}},9928:(e,i,r)=>{var s=r(6198),n=r(1291),a=RangeError;e.exports=function(e,i,r,o){var l=s(e),h=n(r),d=h<0?l+h:h;if(d>=l||d<0)throw new a("Incorrect index");for(var c=new i(l),u=0;u<l;u++)c[u]=u===d?o:e[u];return c}}},M={};function k(e){var i=M[e];if(void 0!==i)return i.exports;var r=M[e]={exports:{}};return T[e].call(r.exports,r,r.exports,k),r.exports}k.d=(e,i)=>{for(var r in i)k.o(i,r)&&!k.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},k.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),k(4114),k(6573),k(8100),k(7936),k(8111),k(8237),k(1689),k(9577),k(4235),k(9432),k(1549),k(9797),k(9631),k(5623),k(4979),k(5781);let I=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),D=[.001,0,0,.001,0,0],R={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},P="pdfjs_internal_editor_",L={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},N={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},O={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},F={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},B={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},U={ERRORS:0,WARNINGS:1,INFOS:5},j={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},$={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},H=U.WARNINGS;function z(e){H>=U.INFOS&&console.info(`Info: ${e}`)}function V(e){H>=U.WARNINGS&&console.warn(`Warning: ${e}`)}function G(e){throw Error(e)}function W(e,i){e||G(i)}function q(e,i=null,r=null){if(!e)return null;if(r&&"string"==typeof e){if(r.addDefaultProtocol&&e.startsWith("www.")){let i=e.match(/\./g);i?.length>=2&&(e=`http://${e}`)}if(r.tryConvertEncoding)try{e=decodeURIComponent(escape(e))}catch{}}let s=i?URL.parse(e,i):URL.parse(e);return!function(e){switch(e?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(s)?null:s}function X(e,i,r=!1){let s=URL.parse(e);return s?(s.hash=i,s.href):r&&q(e,"http://example.com")?e.split("#",1)[0]+""+(i?`#${i}`:""):""}function Y(e,i,r,s=!1){return Object.defineProperty(e,i,{value:r,enumerable:!s,configurable:!0,writable:!1}),r}let J=function(){function e(e,i){this.message=e,this.name=i}return e.prototype=Error(),e.constructor=e,e}(),K=class extends J{constructor(e,i){super(e,"PasswordException"),this.code=i}},Q=class extends J{constructor(e,i){super(e,"UnknownErrorException"),this.details=i}},Z=class extends J{constructor(e){super(e,"InvalidPDFException")}},tt=class extends J{constructor(e,i,r){super(e,"ResponseException"),this.status=i,this.missing=r}},te=class extends J{constructor(e){super(e,"FormatError")}},ti=class extends J{constructor(e){super(e,"AbortException")}};function tr(e){"object"==typeof e&&void 0!==e?.length||G("Invalid argument for bytesToString");let i=e.length;if(i<8192)return String.fromCharCode.apply(null,e);let r=[];for(let s=0;s<i;s+=8192){let n=Math.min(s+8192,i),a=e.subarray(s,n);r.push(String.fromCharCode.apply(null,a))}return r.join("")}function ts(e){"string"!=typeof e&&G("Invalid argument for stringToBytes");let i=e.length,r=new Uint8Array(i);for(let s=0;s<i;++s)r[s]=255&e.charCodeAt(s);return r}class tn{static get isLittleEndian(){return Y(this,"isLittleEndian",function(){let e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return Y(this,"isEvalSupported",function(){try{return Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return Y(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get isImageDecoderSupported(){return Y(this,"isImageDecoderSupported","undefined"!=typeof ImageDecoder)}static get platform(){let{platform:e,userAgent:i}=navigator;return Y(this,"platform",{isAndroid:i.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:i.includes("Firefox")})}static get isCSSRoundSupported(){return Y(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}let ta=Array.from(Array(256).keys(),e=>e.toString(16).padStart(2,"0"));class to{static makeHexColor(e,i,r){return`#${ta[e]}${ta[i]}${ta[r]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,i){let r;e[0]?(e[0]<0&&(r=i[0],i[0]=i[2],i[2]=r),i[0]*=e[0],i[2]*=e[0],e[3]<0&&(r=i[1],i[1]=i[3],i[3]=r),i[1]*=e[3],i[3]*=e[3]):(r=i[0],i[0]=i[1],i[1]=r,r=i[2],i[2]=i[3],i[3]=r,e[1]<0&&(r=i[1],i[1]=i[3],i[3]=r),i[1]*=e[1],i[3]*=e[1],e[2]<0&&(r=i[0],i[0]=i[2],i[2]=r),i[0]*=e[2],i[2]*=e[2]),i[0]+=e[4],i[1]+=e[5],i[2]+=e[4],i[3]+=e[5]}static transform(e,i){return[e[0]*i[0]+e[2]*i[1],e[1]*i[0]+e[3]*i[1],e[0]*i[2]+e[2]*i[3],e[1]*i[2]+e[3]*i[3],e[0]*i[4]+e[2]*i[5]+e[4],e[1]*i[4]+e[3]*i[5]+e[5]]}static multiplyByDOMMatrix(e,i){return[e[0]*i.a+e[2]*i.b,e[1]*i.a+e[3]*i.b,e[0]*i.c+e[2]*i.d,e[1]*i.c+e[3]*i.d,e[0]*i.e+e[2]*i.f+e[4],e[1]*i.e+e[3]*i.f+e[5]]}static applyTransform(e,i,r=0){let s=e[r],n=e[r+1];e[r]=s*i[0]+n*i[2]+i[4],e[r+1]=s*i[1]+n*i[3]+i[5]}static applyTransformToBezier(e,i,r=0){let s=i[0],n=i[1],a=i[2],o=i[3],l=i[4],h=i[5];for(let i=0;i<6;i+=2){let d=e[r+i],c=e[r+i+1];e[r+i]=d*s+c*a+l,e[r+i+1]=d*n+c*o+h}}static applyInverseTransform(e,i){let r=e[0],s=e[1],n=i[0]*i[3]-i[1]*i[2];e[0]=(r*i[3]-s*i[2]+i[2]*i[5]-i[4]*i[3])/n,e[1]=(-r*i[1]+s*i[0]+i[4]*i[1]-i[5]*i[0])/n}static axialAlignedBoundingBox(e,i,r){let s=i[0],n=i[1],a=i[2],o=i[3],l=i[4],h=i[5],d=e[0],c=e[1],u=e[2],p=e[3],f=s*d+l,g=f,m=s*u+l,b=m,v=o*c+h,y=v,_=o*p+h,w=_;if(0!==n||0!==a){let e=n*d,i=n*u,r=a*c,s=a*p;f+=r,b+=r,m+=s,g+=s,v+=e,w+=e,_+=i,y+=i}r[0]=Math.min(r[0],f,m,g,b),r[1]=Math.min(r[1],v,_,y,w),r[2]=Math.max(r[2],f,m,g,b),r[3]=Math.max(r[3],v,_,y,w)}static inverseTransform(e){let i=e[0]*e[3]-e[1]*e[2];return[e[3]/i,-e[1]/i,-e[2]/i,e[0]/i,(e[2]*e[5]-e[4]*e[3])/i,(e[4]*e[1]-e[5]*e[0])/i]}static singularValueDecompose2dScale(e,i){let r=e[0],s=e[1],n=e[2],a=e[3],o=r**2+s**2,l=n**2+a**2,h=(o+l)/2,d=Math.sqrt(h**2-(o*l-(r*n+s*a)**2));i[0]=Math.sqrt(h+d||1),i[1]=Math.sqrt(h-d||1)}static normalizeRect(e){let i=e.slice(0);return e[0]>e[2]&&(i[0]=e[2],i[2]=e[0]),e[1]>e[3]&&(i[1]=e[3],i[3]=e[1]),i}static intersect(e,i){let r=Math.max(Math.min(e[0],e[2]),Math.min(i[0],i[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(i[0],i[2]));if(r>s)return null;let n=Math.max(Math.min(e[1],e[3]),Math.min(i[1],i[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(i[1],i[3]));return n>a?null:[r,n,s,a]}static pointBoundingBox(e,i,r){r[0]=Math.min(r[0],e),r[1]=Math.min(r[1],i),r[2]=Math.max(r[2],e),r[3]=Math.max(r[3],i)}static rectBoundingBox(e,i,r,s,n){n[0]=Math.min(n[0],e,r),n[1]=Math.min(n[1],i,s),n[2]=Math.max(n[2],e,r),n[3]=Math.max(n[3],i,s)}static #t(e,i,r,s,n,a,o,l,h,d){if(h<=0||h>=1)return;let c=1-h,u=h*h,p=u*h,f=c*(c*(c*e+3*h*i)+3*u*r)+p*s,g=c*(c*(c*n+3*h*a)+3*u*o)+p*l;d[0]=Math.min(d[0],f),d[1]=Math.min(d[1],g),d[2]=Math.max(d[2],f),d[3]=Math.max(d[3],g)}static #e(e,i,r,s,n,a,o,l,h,d,c,u){if(1e-12>Math.abs(h))return void(Math.abs(d)>=1e-12&&this.#t(e,i,r,s,n,a,o,l,-c/d,u));let p=d**2-4*c*h;if(p<0)return;let f=Math.sqrt(p),g=2*h;this.#t(e,i,r,s,n,a,o,l,(-d+f)/g,u),this.#t(e,i,r,s,n,a,o,l,(-d-f)/g,u)}static bezierBoundingBox(e,i,r,s,n,a,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],i,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],i,l),this.#e(e,r,n,o,i,s,a,l,3*(3*(r-n)-e+o),6*(e-2*r+n),3*(r-e),h),this.#e(e,r,n,o,i,s,a,l,3*(3*(s-a)-i+l),6*(i-2*s+a),3*(s-i),h)}}let tl=null,th=null;function td(e){return tl||(tl=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,th=new Map([["","t"]])),e.replaceAll(tl,(e,i,r)=>i?i.normalize("NFKC"):th.get(r))}function tc(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();let e=new Uint8Array(32);return crypto.getRandomValues(e),tr(e)}let tu="pdfjs_internal_id_";function tp(e,i,r){return Math.min(Math.max(e,i),r)}function tf(e){return Uint8Array.prototype.toBase64?e.toBase64():btoa(tr(e))}"function"!=typeof Math.sumPrecise&&(Math.sumPrecise=function(e){return e.reduce((e,i)=>e+i,0)}),"function"!=typeof AbortSignal.any&&(AbortSignal.any=function(e){let i=new AbortController,{signal:r}=i;for(let s of e)if(s.aborted)return i.abort(s.reason),r;for(let s of e)s.addEventListener("abort",()=>{i.abort(s.reason)},{signal:r});return r}),k(1701),k(4603),k(7566),k(8721);class tg{static textContent(e){let i=[],r={items:i,styles:Object.create(null)};return function e(r){if(!r)return;let s=null,n=r.name;if("#text"===n)s=r.value;else{if(!tg.shouldBuildText(n))return;r?.attributes?.textContent?s=r.attributes.textContent:r.value&&(s=r.value)}if(null!==s&&i.push({str:s}),r.children)for(let i of r.children)e(i)}(e),r}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}class tm{static setupStorage(e,i,r,s,n){let a=s.getValue(i,{value:null});switch(r.name){case"textarea":if(null!==a.value&&(e.textContent=a.value),"print"===n)break;e.addEventListener("input",e=>{s.setValue(i,{value:e.target.value})});break;case"input":if("radio"===r.attributes.type||"checkbox"===r.attributes.type){if(a.value===r.attributes.xfaOn?e.setAttribute("checked",!0):a.value===r.attributes.xfaOff&&e.removeAttribute("checked"),"print"===n)break;e.addEventListener("change",e=>{s.setValue(i,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})})}else{if(null!==a.value&&e.setAttribute("value",a.value),"print"===n)break;e.addEventListener("input",e=>{s.setValue(i,{value:e.target.value})})}break;case"select":if(null!==a.value)for(let i of(e.setAttribute("value",a.value),r.children))i.attributes.value===a.value?i.attributes.selected=!0:i.attributes.hasOwnProperty("selected")&&delete i.attributes.selected;e.addEventListener("input",e=>{let r=e.target.options,n=-1===r.selectedIndex?"":r[r.selectedIndex].value;s.setValue(i,{value:n})})}}static setAttributes({html:e,element:i,storage:r=null,intent:s,linkService:n}){let{attributes:a}=i,o=e instanceof HTMLAnchorElement;for(let[i,r]of("radio"===a.type&&(a.name=`${a.name}-${s}`),Object.entries(a)))if(null!=r)switch(i){case"class":r.length&&e.setAttribute(i,r.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",r);break;case"style":Object.assign(e.style,r);break;case"textContent":e.textContent=r;break;default:o&&("href"===i||"newWindow"===i)||e.setAttribute(i,r)}o&&n.addLinkAttributes(e,a.href,a.newWindow),r&&a.dataId&&this.setupStorage(e,a.dataId,i,r)}static render(e){let i=e.annotationStorage,r=e.linkService,s=e.xfaHtml,n=e.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:r});let o="richText"!==n,l=e.div;if(l.append(a),e.viewport){let i=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=i}o&&l.setAttribute("class","xfaLayer xfaFont");let h=[];if(0===s.children.length){if(s.value){let e=document.createTextNode(s.value);a.append(e),o&&tg.shouldBuildText(s.name)&&h.push(e)}return{textDivs:h}}let d=[[s,-1,a]];for(;d.length>0;){let[e,s,a]=d.at(-1);if(s+1===e.children.length){d.pop();continue}let l=e.children[++d.at(-1)[1]];if(null===l)continue;let{name:c}=l;if("#text"===c){let e=document.createTextNode(l.value);h.push(e),a.append(e);continue}let u=l?.attributes?.xmlns?document.createElementNS(l.attributes.xmlns,c):document.createElement(c);if(a.append(u),l.attributes&&this.setAttributes({html:u,element:l,storage:i,intent:n,linkService:r}),l.children?.length>0)d.push([l,-1,u]);else if(l.value){let e=document.createTextNode(l.value);o&&tg.shouldBuildText(c)&&h.push(e),u.append(e)}}for(let e of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){let i=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=i,e.div.hidden=!1}}let tb="http://www.w3.org/2000/svg";class tv{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function ty(e,i="text"){if(tT(e,document.baseURI)){let r=await fetch(e);if(!r.ok)throw Error(r.statusText);switch(i){case"arraybuffer":return r.arrayBuffer();case"blob":return r.blob();case"json":return r.json()}return r.text()}return new Promise((r,s)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=i,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(200!==n.status&&0!==n.status)s(Error(n.statusText));else{switch(i){case"arraybuffer":case"blob":case"json":return void r(n.response)}r(n.responseText)}}},n.send(null)})}class t_{constructor({viewBox:e,userUnit:i,scale:r,rotation:s,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){let l,h,d,c,u,p,f,g;this.viewBox=e,this.userUnit=i,this.scale=r,this.rotation=s,this.offsetX=n,this.offsetY=a,r*=i;let m=(e[2]+e[0])/2,b=(e[3]+e[1])/2;switch((s%=360)<0&&(s+=360),s){case 180:l=-1,h=0,d=0,c=1;break;case 90:l=0,h=1,d=1,c=0;break;case 270:l=0,h=-1,d=-1,c=0;break;case 0:l=1,h=0,d=0,c=-1;break;default:throw Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(d=-d,c=-c),0===l?(u=Math.abs(b-e[1])*r+n,p=Math.abs(m-e[0])*r+a,f=(e[3]-e[1])*r,g=(e[2]-e[0])*r):(u=Math.abs(m-e[0])*r+n,p=Math.abs(b-e[1])*r+a,f=(e[2]-e[0])*r,g=(e[3]-e[1])*r),this.transform=[l*r,h*r,d*r,c*r,u-l*r*m-d*r*b,p-h*r*m-c*r*b],this.width=f,this.height=g}get rawDims(){let e=this.viewBox;return Y(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:i=this.rotation,offsetX:r=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new t_({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:i,offsetX:r,offsetY:s,dontFlip:n})}convertToViewportPoint(e,i){let r=[e,i];return to.applyTransform(r,this.transform),r}convertToViewportRectangle(e){let i=[e[0],e[1]];to.applyTransform(i,this.transform);let r=[e[2],e[3]];return to.applyTransform(r,this.transform),[i[0],i[1],r[0],r[1]]}convertToPdfPoint(e,i){let r=[e,i];return to.applyInverseTransform(r,this.transform),r}}class tw extends J{constructor(e,i=0){super(e,"RenderingCancelledException"),this.extraDelay=i}}function tA(e){let i=e.length,r=0;for(;r<i&&""===e[r].trim();)r++;return"data:"===e.substring(r,r+5).toLowerCase()}function tx(e){return"string"==typeof e&&/\.pdf$/i.test(e)}function tS(e){return[e]=e.split(/[#?]/,1),e.substring(e.lastIndexOf("/")+1)}function tE(e,i="document.pdf"){if("string"!=typeof e)return i;if(tA(e))return V('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),i;let r=(e=>{try{return new URL(e)}catch{try{return new URL(decodeURIComponent(e))}catch{try{return new URL(e,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(e),"https://foo.bar")}catch{return null}}}}})(e);if(!r)return i;let s=e=>{try{let i=decodeURIComponent(e);return i.includes("/")?(i=i.split("/").at(-1)).test(/^\.pdf$/i)?i:e:i}catch{return e}},n=/\.pdf$/i,a=r.pathname.split("/").at(-1);if(n.test(a))return s(a);if(r.searchParams.size>0){for(let e of Array.from(r.searchParams.values()).reverse())if(n.test(e))return s(e);for(let e of Array.from(r.searchParams.keys()).reverse())if(n.test(e))return s(e)}if(r.hash){let e=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(r.hash);if(e)return s(e[0])}return i}class tC{started=Object.create(null);times=[];time(e){e in this.started&&V(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||V(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],i=0;for(let{name:e}of this.times)i=Math.max(e.length,i);for(let{name:r,start:s,end:n}of this.times)e.push(`${r.padEnd(i)} ${n-s}ms
`);return e.join("")}}function tT(e,i){let r=i?URL.parse(e,i):URL.parse(e);return"http:"===r?.protocol||"https:"===r?.protocol}function tM(e){e.preventDefault()}function tk(e){e.preventDefault(),e.stopPropagation()}class tI{static #i;static toDateObject(e){if(e instanceof Date)return e;if(!e||"string"!=typeof e)return null;this.#i||=RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let i=this.#i.exec(e);if(!i)return null;let r=parseInt(i[1],10),s=parseInt(i[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(i[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(i[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(i[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(i[6],10);l=l>=0&&l<=59?l:0;let h=i[7]||"Z",d=parseInt(i[8],10);d=d>=0&&d<=23?d:0;let c=parseInt(i[9],10)||0;return c=c>=0&&c<=59?c:0,"-"===h?(a+=d,o+=c):"+"===h&&(a-=d,o-=c),new Date(Date.UTC(r,s,n,a,o,l))}}function tD(e,{scale:i=1,rotation:r=0}){let{width:s,height:n}=e.attributes.style;return new t_({viewBox:[0,0,parseInt(s),parseInt(n)],userUnit:1,scale:i,rotation:r})}function tR(e){if(e.startsWith("#")){let i=parseInt(e.slice(1),16);return[(16711680&i)>>16,(65280&i)>>8,255&i]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map(e=>parseInt(e)):e.startsWith("rgba(")?e.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(V(`Not a valid color format: "${e}"`),[0,0,0])}function tP(e){let{a:i,b:r,c:s,d:n,e:a,f:o}=e.getTransform();return[i,r,s,n,a,o]}function tL(e){let{a:i,b:r,c:s,d:n,e:a,f:o}=e.getTransform().invertSelf();return[i,r,s,n,a,o]}function tN(e,i,r=!1,s=!0){if(i instanceof t_){let{pageWidth:s,pageHeight:n}=i.rawDims,{style:a}=e,o=tn.isCSSRoundSupported,l=`var(--total-scale-factor) * ${s}px`,h=`var(--total-scale-factor) * ${n}px`,d=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,c=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;r&&i.rotation%180!=0?(a.width=c,a.height=d):(a.width=d,a.height=c)}s&&e.setAttribute("data-main-rotation",i.rotation)}class tO{constructor(){let{pixelRatio:e}=tO;this.sx=e,this.sy=e}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(e,i,r,s,n=-1){let a=1/0,o=1/0,l=1/0;(r=tO.capPixels(r,n))>0&&(a=Math.sqrt(r/(e*i))),-1!==s&&(o=s/e,l=s/i);let h=Math.min(a,o,l);return(this.sx>h||this.sy>h)&&(this.sx=h,this.sy=h,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,i){if(i>=0){let r=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+i/100));return e>0?Math.min(e,r):r}return e}}let tF=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class tB{static get isDarkMode(){return Y(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class tU{static get commentForegroundColor(){let e=document.createElement("span");e.classList.add("comment","sidebar");let{style:i}=e;i.width=i.height="0",i.display="none",i.color="var(--comment-fg-color)",document.body.append(e);let{color:r}=window.getComputedStyle(e);return e.remove(),Y(this,"commentForegroundColor",tR(r))}}function tj(e,i,r,s){let n=255*(1-(s=Math.min(Math.max(s??1,0),1)));return[e=Math.round(e*s+n),i=Math.round(i*s+n),r=Math.round(r*s+n)]}function t$(e,i){let r=e[0]/255,s=e[1]/255,n=e[2]/255,a=Math.max(r,s,n),o=Math.min(r,s,n),l=(a+o)/2;if(a===o)i[0]=i[1]=0;else{let e=a-o;switch(i[1]=l<.5?e/(a+o):e/(2-a-o),a){case r:i[0]=60*((s-n)/e+(s<n?6:0));break;case s:i[0]=60*((n-r)/e+2);break;case n:i[0]=60*((r-s)/e+4)}}i[2]=l}function tH(e,i){let r=e[0],s=e[1],n=e[2],a=(1-Math.abs(2*n-1))*s,o=a*(1-Math.abs(r/60%2-1)),l=n-a/2;switch(Math.floor(r/60)){case 0:i[0]=a+l,i[1]=o+l,i[2]=l;break;case 1:i[0]=o+l,i[1]=a+l,i[2]=l;break;case 2:i[0]=l,i[1]=a+l,i[2]=o+l;break;case 3:i[0]=l,i[1]=o+l,i[2]=a+l;break;case 4:i[0]=o+l,i[1]=l,i[2]=a+l;break;case 5:case 6:i[0]=a+l,i[1]=l,i[2]=o+l}}function tz(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function tV(e,i,r){tH(e,r),r.map(tz);let s=.2126*r[0]+.7152*r[1]+.0722*r[2];tH(i,r),r.map(tz);let n=.2126*r[0]+.7152*r[1]+.0722*r[2];return s>n?(s+.05)/(n+.05):(n+.05)/(s+.05)}let tG=new Map;function tW(e,i){let r=e[0]+256*e[1]+65536*e[2]+16777216*i[0]+4294967296*i[1]+1099511627776*i[2],s=tG.get(r);if(s)return s;let n=new Float32Array(9),a=n.subarray(0,3),o=n.subarray(3,6);t$(e,o);let l=n.subarray(6,9);t$(i,l);let h=l[2]<.5,d=h?12:4.5;if(o[2]=h?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),tV(o,l,a)<d){let e,i;for(h?(e=o[2],i=1):(e=0,i=o[2]);i-e>.005;){let r=o[2]=(e+i)/2;h===tV(o,l,a)<d?e=r:i=r}o[2]=h?i:e}return tH(o,a),s=to.makeHexColor(Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])),tG.set(r,s),s}function tq({html:e,dir:i,className:r},s){let n=document.createDocumentFragment();if("string"==typeof e){let r=document.createElement("p");r.dir=i||"auto";let s=e.split(/(?:\r\n?|\n)/);for(let e=0,i=s.length;e<i;++e){let n=s[e];r.append(document.createTextNode(n)),e<i-1&&r.append(document.createElement("br"))}n.append(r)}else tm.render({xfaHtml:e,div:n,intent:"richText"});n.firstChild.classList.add("richText",r),s.append(n)}k(4972),k(4628),k(7642),k(8004),k(3853),k(5876),k(2475),k(5024),k(1698),k(9314),k(1148),k(3579),k(8335);class tX{#r=null;#s=null;#n;#a=null;#o=null;#l=null;#h=null;#d=null;static #c=null;constructor(e){this.#n=e,tX.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){let e=this.#r=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let i=this.#n._uiManager._signal;i instanceof AbortSignal&&!i.aborted&&(e.addEventListener("contextmenu",tM,{signal:i}),e.addEventListener("pointerdown",tX.#u,{signal:i}));let r=this.#a=document.createElement("div");r.className="buttons",e.append(r);let s=this.#n.toolbarPosition;if(s){let{style:i}=e,r="ltr"===this.#n._uiManager.direction?1-s[0]:s[0];i.insetInlineEnd=100*r+"%",i.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#r}static #u(e){e.stopPropagation()}#p(e){this.#n._focusEventsAllowed=!1,tk(e)}#f(e){this.#n._focusEventsAllowed=!0,tk(e)}#g(e){let i=this.#n._uiManager._signal;return i instanceof AbortSignal&&!i.aborted&&(e.addEventListener("focusin",this.#p.bind(this),{capture:!0,signal:i}),e.addEventListener("focusout",this.#f.bind(this),{capture:!0,signal:i}),e.addEventListener("contextmenu",tM,{signal:i}),!0)}hide(){this.#r.classList.add("hidden"),this.#s?.hideDropdown()}show(){this.#r.classList.remove("hidden"),this.#o?.shown(),this.#l?.shown()}addDeleteButton(){let{editorType:e,_uiManager:i}=this.#n,r=document.createElement("button");r.classList.add("basic","deleteButton"),r.tabIndex=0,r.setAttribute("data-l10n-id",tX.#c[e]),this.#g(r)&&r.addEventListener("click",e=>{i.delete()},{signal:i._signal}),this.#a.append(r)}get #m(){let e=document.createElement("div");return e.className="divider",e}async addAltText(e){let i=await e.render();this.#g(i),this.#a.append(i,this.#m),this.#o=e}addComment(e,i=null){if(this.#l)return;let r=e.renderForToolbar();if(!r)return;this.#g(r);let s=this.#h=this.#m;i?(this.#a.insertBefore(r,i),this.#a.insertBefore(s,i)):this.#a.append(r,s),this.#l=e,e.toolbar=this}addColorPicker(e){if(this.#s)return;this.#s=e;let i=e.renderButton();this.#g(i),this.#a.append(i,this.#m)}async addEditSignatureButton(e){let i=this.#d=await e.renderEditButton(this.#n);this.#g(i),this.#a.append(i,this.#m)}removeButton(e){"comment"===e&&(this.#l?.removeToolbarCommentButton(),this.#l=null,this.#h?.remove(),this.#h=null)}async addButton(e,i){switch(e){case"colorPicker":this.addColorPicker(i);break;case"altText":await this.addAltText(i);break;case"editSignature":await this.addEditSignatureButton(i);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(i)}}async addButtonBefore(e,i,r){let s=this.#a.querySelector(r);s&&"comment"===e&&this.addComment(i,s)}updateEditSignatureButton(e){this.#d&&(this.#d.title=e)}remove(){this.#r.remove(),this.#s?.destroy(),this.#s=null}}class tY{#a=null;#r=null;#b;constructor(e){this.#b=e}#v(){let e=this.#r=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");let i=this.#b._signal;i instanceof AbortSignal&&!i.aborted&&e.addEventListener("contextmenu",tM,{signal:i});let r=this.#a=document.createElement("div");return r.className="buttons",e.append(r),this.#b.hasCommentManager()&&this.#y("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#b.commentSelection("floating_button")}),this.#y("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#b.highlightSelection("floating_button")}),e}#_(e,i){let r=0,s=0;for(let n of e){let e=n.y+n.height;if(e<r)continue;let a=n.x+(i?n.width:0);e>r?(s=a,r=e):i?a>s&&(s=a):a<s&&(s=a)}return[i?1-s:s,r]}show(e,i,r){let[s,n]=this.#_(i,r),{style:a}=this.#r||=this.#v();e.append(this.#r),a.insetInlineEnd=100*s+"%",a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#r.remove()}#y(e,i,r,s){let n=document.createElement("button");n.classList.add("basic",e),n.tabIndex=0,n.setAttribute("data-l10n-id",i);let a=document.createElement("span");n.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",r);let o=this.#b._signal;o instanceof AbortSignal&&!o.aborted&&(n.addEventListener("contextmenu",tM,{signal:o}),n.addEventListener("click",s,{signal:o})),this.#a.append(n)}}function tJ(e,i,r){for(let s of r)i.addEventListener(s,e[s].bind(e))}class tK{#w=0;get id(){return`${P}${this.#w++}`}}class tQ{#A=tc();#w=0;#x=null;static get _isSVGFittingCanvas(){let e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;return i.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Y(this,"_isSVGFittingCanvas",i.decode().then(()=>(e.drawImage(i,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0])))}async #S(e,i){this.#x||=new Map;let r=this.#x.get(e);if(null===r)return null;if(r?.bitmap)return r.refCounter+=1,r;try{let e;if(r||={bitmap:null,id:`image_${this.#A}_${this.#w++}`,refCounter:0,isSvg:!1},"string"==typeof i?(r.url=i,e=await ty(i,"blob")):i instanceof File?e=r.file=i:i instanceof Blob&&(e=i),"image/svg+xml"===e.type){let i=tQ._isSVGFittingCanvas,s=new FileReader,n=new Image,a=new Promise((e,a)=>{n.onload=()=>{r.bitmap=n,r.isSvg=!0,e()},s.onload=async()=>{let e=r.svgUrl=s.result;n.src=await i?`${e}#svgView(preserveAspectRatio(none))`:e},n.onerror=s.onerror=a});s.readAsDataURL(e),await a}else r.bitmap=await createImageBitmap(e);r.refCounter=1}catch(e){V(e),r=null}return this.#x.set(e,r),r&&this.#x.set(r.id,r),r}async getFromFile(e){let{lastModified:i,name:r,size:s,type:n}=e;return this.#S(`${i}_${r}_${s}_${n}`,e)}async getFromUrl(e){return this.#S(e,e)}async getFromBlob(e,i){let r=await i;return this.#S(e,r)}async getFromId(e){this.#x||=new Map;let i=this.#x.get(e);if(!i)return null;if(i.bitmap)return i.refCounter+=1,i;if(i.file)return this.getFromFile(i.file);if(i.blobPromise){let{blobPromise:e}=i;return delete i.blobPromise,this.getFromBlob(i.id,e)}return this.getFromUrl(i.url)}getFromCanvas(e,i){this.#x||=new Map;let r=this.#x.get(e);if(r?.bitmap)return r.refCounter+=1,r;let s=new OffscreenCanvas(i.width,i.height);return s.getContext("2d").drawImage(i,0,0),r={bitmap:s.transferToImageBitmap(),id:`image_${this.#A}_${this.#w++}`,refCounter:1,isSvg:!1},this.#x.set(e,r),this.#x.set(r.id,r),r}getSvgUrl(e){let i=this.#x.get(e);return i?.isSvg?i.svgUrl:null}deleteId(e){this.#x||=new Map;let i=this.#x.get(e);if(!i||(i.refCounter-=1,0!==i.refCounter))return;let{bitmap:r}=i;if(!i.url&&!i.file){let e=new OffscreenCanvas(r.width,r.height);e.getContext("bitmaprenderer").transferFromImageBitmap(r),i.blobPromise=e.convertToBlob()}r.close?.(),i.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#A}_`)}}class tZ{#E=[];#C=!1;#T;#M=-1;constructor(e=128){this.#T=e}add({cmd:e,undo:i,post:r,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(s&&e(),this.#C)return;let l={cmd:e,undo:i,post:r,type:n};if(-1===this.#M)return this.#E.length>0&&(this.#E.length=0),this.#M=0,void this.#E.push(l);if(a&&this.#E[this.#M].type===n)return o&&(l.undo=this.#E[this.#M].undo),void(this.#E[this.#M]=l);let h=this.#M+1;h===this.#T?this.#E.splice(0,1):(this.#M=h,h<this.#E.length&&this.#E.splice(h)),this.#E.push(l)}undo(){if(-1===this.#M)return;this.#C=!0;let{undo:e,post:i}=this.#E[this.#M];e(),i?.(),this.#C=!1,this.#M-=1}redo(){if(this.#M<this.#E.length-1){this.#M+=1,this.#C=!0;let{cmd:e,post:i}=this.#E[this.#M];e(),i?.(),this.#C=!1}}hasSomethingToUndo(){return -1!==this.#M}hasSomethingToRedo(){return this.#M<this.#E.length-1}cleanType(e){if(-1!==this.#M){for(let i=this.#M;i>=0;i--)if(this.#E[i].type!==e)return this.#E.splice(i+1,this.#M-i),void(this.#M=i);this.#E.length=0,this.#M=-1}}destroy(){this.#E=null}}class t0{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:i}=tn.platform;for(let[r,s,n={}]of e)for(let e of r){let r=e.startsWith("mac+");i&&r?(this.callbacks.set(e.slice(4),{callback:s,options:n}),this.allKeys.add(e.split("+").at(-1))):i||r||(this.callbacks.set(e,{callback:s,options:n}),this.allKeys.add(e.split("+").at(-1)))}}#k(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let i=this.buffer.join("+");return this.buffer.length=0,i}exec(e,i){if(!this.allKeys.has(i.key))return;let r=this.callbacks.get(this.#k(i));if(!r)return;let{callback:s,options:{bubbles:n=!1,args:a=[],checker:o=null}}=r;o&&!o(e,i)||(s.bind(e,...a,i)(),n||tk(i))}}class t1{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return function(e){let i=document.createElement("span");for(let r of(i.style.visibility="hidden",i.style.colorScheme="only light",document.body.append(i),e.keys())){i.style.color=r;let s=window.getComputedStyle(i).color;e.set(r,tR(s))}i.remove()}(e),Y(this,"_colors",e)}convert(e){let i=tR(e);if(!window.matchMedia("(forced-colors: active)").matches)return i;for(let[e,r]of this._colors)if(r.every((e,r)=>e===i[r]))return t1._colorsMapping.get(e);return i}getHexCode(e){let i=this._colors.get(e);return i?to.makeHexColor(...i):e}}class t2{#I=new AbortController;#D=null;#R=null;#P=new Map;#L=new Map;#N=null;#O=null;#F=null;#B=new tZ;#U=null;#j=null;#$=null;#H=0;#z=new Set;#V=null;#G=null;#W=new Set;_editorUndoBar=null;#q=!1;#X=!1;#Y=!1;#J=null;#K=null;#Q=null;#Z=null;#tt=!1;#te=null;#ti=new tK;#tr=!1;#ts=!1;#tn=!1;#ta=null;#to=null;#tl=null;#th=null;#td=null;#tc=L.NONE;#tu=new Set;#tp=null;#tf=null;#tg=null;#tm=null;#tb=null;#tv={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#ty=[0,0];#t_=null;#tw=null;#tA=null;#tx=null;#tS=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let e=t2.prototype,i=e=>e.#tw.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&e.hasSomethingToControl(),r=(e,{target:i})=>{if(i instanceof HTMLInputElement){let{type:e}=i;return"text"!==e&&"number"!==e}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return Y(this,"_keyboardManager",new t0([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:r}],[["ctrl+z","mac+meta+z"],e.undo,{checker:r}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:r}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:r}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(e,{target:i})=>!(i instanceof HTMLButtonElement)&&e.#tw.contains(i)&&!e.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(e,{target:i})=>!(i instanceof HTMLButtonElement)&&e.#tw.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:i}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:i}]]))}constructor(e,i,r,s,n,a,o,l,h,d,c,u,p,f,g,m){let b=this._signal=this.#I.signal;this.#tw=e,this.#tA=i,this.#tx=r,this.#N=s,this.#U=n,this.#tf=a,this.#tb=l,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:b}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),o._on("setpreference",this.onSetPreference.bind(this),{signal:b}),o._on("switchannotationeditorparams",e=>this.updateParams(e.type,e.value),{signal:b}),window.addEventListener("pointerdown",()=>{this.#ts=!0},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{this.#ts=!1},{capture:!0,signal:b}),this.#tE(),this.#tC(),this.#tT(),this.#O=l.annotationStorage,this.#J=l.filterFactory,this.#tg=h,this.#Z=d||null,this.#q=c,this.#X=u,this.#Y=p,this.#td=f||null,this.viewParameters={realScale:tv.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=!1!==m,n?.setSidebarUiManager(this)}destroy(){for(let e of(this.#tS?.resolve(),this.#tS=null,this.#I?.abort(),this.#I=null,this._signal=null,this.#L.values()))e.destroy();this.#L.clear(),this.#P.clear(),this.#W.clear(),this.#th?.clear(),this.#D=null,this.#tu.clear(),this.#B.destroy(),this.#N?.destroy(),this.#U?.destroy(),this.#tf?.destroy(),this.#te?.hide(),this.#te=null,this.#tl?.destroy(),this.#tl=null,this.#R=null,this.#K&&(clearTimeout(this.#K),this.#K=null),this.#t_&&(clearTimeout(this.#t_),this.#t_=null),this._editorUndoBar?.destroy(),this.#tb=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#td}get useNewAltTextFlow(){return this.#X}get useNewAltTextWhenAddingImage(){return this.#Y}get hcmFilter(){return Y(this,"hcmFilter",this.#tg?this.#J.addHCMFilter(this.#tg.foreground,this.#tg.background):"none")}get direction(){return Y(this,"direction",getComputedStyle(this.#tw).direction)}get _highlightColors(){return Y(this,"_highlightColors",this.#Z?new Map(this.#Z.split(",").map(e=>((e=e.split("=").map(e=>e.trim()))[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){let{_highlightColors:e}=this;if(!e)return Y(this,"highlightColors",null);let i=new Map,r=!!this.#tg;for(let[s,n]of e){let e=s.endsWith("_HCM");r&&e?i.set(s.replace("_HCM",""),n):r||e||i.set(s,n)}return Y(this,"highlightColors",i)}get highlightColorNames(){return Y(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;let i=this.highlightColorNames.get(e);return this._highlightColors.get(i)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#$=e}setMainHighlightColorPicker(e){this.#tl=e}editAltText(e,i=!1){this.#N?.editAltText(this,e,i)}hasCommentManager(){return!!this.#U}editComment(e,i,r,s){this.#U?.showDialog(this,e,i,r,s)}selectComment(e,i){let r=this.#L.get(e),s=r?.getEditorByUID(i);s?.toggleComment(!0,!0)}updateComment(e){this.#U?.updateComment(e.getData())}updatePopupColor(e){this.#U?.updatePopupColor(e)}removeComment(e){this.#U?.removeComments([e.uid])}toggleComment(e,i,r){this.#U?.toggleCommentPopup(e,i,r)}makeCommentColor(e,i){return e&&this.#U?.makeCommentColor(e,i)||null}getCommentDialogElement(){return this.#U?.dialogElement||null}async waitForEditorsRendered(e){if(this.#L.has(e-1))return;let{resolve:i,promise:r}=Promise.withResolvers(),s=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",s),i())};this._eventBus.on("editorsrendered",s),await r}getSignature(e){this.#tf?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#tf}switchToMode(e,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,i){this._eventBus.dispatch("setpreference",{source:this,name:e,value:i})}onSetPreference({name:e,value:i}){"enableNewAltTextWhenAddingImage"===e&&(this.#Y=i)}onPageChanging({pageNumber:e}){this.#H=e-1}focusMainContainer(){this.#tw.focus()}findParent(e,i){for(let r of this.#L.values()){let{x:s,y:n,width:a,height:o}=r.div.getBoundingClientRect();if(e>=s&&e<=s+a&&i>=n&&i<=n+o)return r}return null}disableUserSelect(e=!1){this.#tA.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#W.add(e)}removeShouldRescale(e){this.#W.delete(e)}onScaleChanging({scale:e}){for(let i of(this.commitOrRemove(),this.viewParameters.realScale=e*tv.PDF_TO_CSS_UNITS,this.#W))i.onScaleChanging();this.#$?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#tM({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#tk(e){let{currentLayer:i}=this;if(i.hasTextLayer(e))return i;for(let i of this.#L.values())if(i.hasTextLayer(e))return i;return null}highlightSelection(e="",i=!1){let r=document.getSelection();if(!r||r.isCollapsed)return;let{anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o}=r,l=r.toString(),h=this.#tM(r).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;r.empty();let c=this.#tk(h),u=this.#tc===L.NONE,p=()=>{let r=c?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o,text:l});u&&this.showAllEditors("highlight",!0,!0),i&&r?.editComment()};u?this.switchToMode(L.HIGHLIGHT,p):p()}commentSelection(e=""){this.highlightSelection(e,!0)}#tI(){let e=document.getSelection();if(!e||e.isCollapsed)return;let i=this.#tM(e).closest(".textLayer"),r=this.getSelectionBoxes(i);r&&(this.#te||=new tY(this),this.#te.show(i,r,"ltr"===this.direction))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#O)return null;let i=`${P}${e}`,r=this.#O.getRawValue(i);return r&&this.#O.remove(i),r}addToAnnotationStorage(e){e.isEmpty()||!this.#O||this.#O.has(e.id)||this.#O.setValue(e.id,e)}a11yAlert(e,i=null){let r=this.#tx;r&&(r.setAttribute("data-l10n-id",e),i?r.setAttribute("data-l10n-args",JSON.stringify(i)):r.removeAttribute("data-l10n-args"))}#tD(){let e=document.getSelection();if(!e||e.isCollapsed)return void(this.#tp&&(this.#te?.hide(),this.#tp=null,this.#tR({hasSelectedText:!1})));let{anchorNode:i}=e;if(i===this.#tp)return;let r=this.#tM(e).closest(".textLayer");if(r){if(this.#te?.hide(),this.#tp=i,this.#tR({hasSelectedText:!0}),(this.#tc===L.HIGHLIGHT||this.#tc===L.NONE)&&(this.#tc===L.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#tt=this.isShiftKeyDown,!this.isShiftKeyDown)){let e=this.#tc===L.HIGHLIGHT?this.#tk(r):null;if(e?.toggleDrawing(),this.#ts){let i=new AbortController,r=this.combinedSignal(i),s=r=>{"pointerup"===r.type&&0!==r.button||(i.abort(),e?.toggleDrawing(!0),"pointerup"===r.type&&this.#tP("main_toolbar"))};window.addEventListener("pointerup",s,{signal:r}),window.addEventListener("blur",s,{signal:r})}else e?.toggleDrawing(!0),this.#tP("main_toolbar")}}else this.#tp&&(this.#te?.hide(),this.#tp=null,this.#tR({hasSelectedText:!1}))}#tP(e=""){this.#tc===L.HIGHLIGHT?this.highlightSelection(e):this.#q&&this.#tI()}#tE(){document.addEventListener("selectionchange",this.#tD.bind(this),{signal:this._signal})}#tL(){if(this.#Q)return;this.#Q=new AbortController;let e=this.combinedSignal(this.#Q);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#tN(){this.#Q?.abort(),this.#Q=null}blur(){if(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#tP("main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let i of this.#tu)if(i.div.contains(e)){this.#to=[i,e],i._focusEventsAllowed=!1;break}}focus(){if(!this.#to)return;let[e,i]=this.#to;this.#to=null,i.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#tT(){if(this.#ta)return;this.#ta=new AbortController;let e=this.combinedSignal(this.#ta);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#tO(){this.#ta?.abort(),this.#ta=null}#tF(){if(this.#j)return;this.#j=new AbortController;let e=this.combinedSignal(this.#j);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#tB(){this.#j?.abort(),this.#j=null}#tC(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#tT(),this.#tF()}removeEditListeners(){this.#tO(),this.#tB()}dragOver(e){for(let{type:i}of e.dataTransfer.items)for(let r of this.#G)if(r.isHandlingMimeForPasting(i))return e.dataTransfer.dropEffect="copy",void e.preventDefault()}drop(e){for(let i of e.dataTransfer.items)for(let r of this.#G)if(r.isHandlingMimeForPasting(i.type))return r.paste(i,this.currentLayer),void e.preventDefault()}copy(e){if(e.preventDefault(),this.#D?.commitOrRemove(),!this.hasSelection)return;let i=[];for(let e of this.#tu){let r=e.serialize(!0);r&&i.push(r)}0!==i.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:i}=e;for(let e of i.items)for(let i of this.#G)if(i.isHandlingMimeForPasting(e.type))return void i.paste(e,this.currentLayer);let r=i.getData("application/pdfjs");if(!r)return;try{r=JSON.parse(r)}catch(e){return void V(`paste: "${e.message}".`)}if(!Array.isArray(r))return;this.unselectAll();let s=this.currentLayer;try{let e=[];for(let i of r){let r=await s.deserialize(i);if(!r)return;e.push(r)}this.addCommands({cmd:()=>{for(let i of e)this.#tU(i);this.#tj(e)},undo:()=>{for(let i of e)i.remove()},mustExec:!0})}catch(e){V(`paste: "${e.message}".`)}}keydown(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),this.#tc===L.NONE||this.isEditorHandlingKeyboard||t2._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&"Shift"===e.key&&(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#tP("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu")}}#tR(e){Object.entries(e).some(([e,i])=>this.#tv[e]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#tv,e)}),this.#tc===L.HIGHLIGHT&&!1===e.hasSelectedEditor&&this.#t$([[N.HIGHLIGHT_FREE,!0]]))}#t$(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#tL(),this.#tF(),this.#tR({isEditing:this.#tc!==L.NONE,isEmpty:this.#tH(),hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:this.#B.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#tN(),this.#tB(),this.#tR({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#G)for(let i of(this.#G=e,this.#G))this.#t$(i.defaultPropertiesToUpdate)}getId(){return this.#ti.id}get currentLayer(){return this.#L.get(this.#H)}getLayer(e){return this.#L.get(e)}get currentPageIndex(){return this.#H}addLayer(e){this.#L.set(e.pageIndex,e),this.#tr?e.enable():e.disable()}removeLayer(e){this.#L.delete(e.pageIndex)}async updateMode(e,i=null,r=!1,s=!1,n=!1){if(this.#tc!==e&&(!this.#tS||(await this.#tS.promise,this.#tS))){if(this.#tS=Promise.withResolvers(),this.#$?.commitOrRemove(),this.#tc===L.POPUP&&this.#U?.hideSidebar(),this.#U?.destroyPopup(),this.#tc=e,e===L.NONE){for(let e of(this.setEditingState(!1),this.#tz(),this.#P.values()))e.hideStandaloneCommentButton();return this._editorUndoBar?.hide(),this.toggleComment(null),void this.#tS.resolve()}for(let e of this.#P.values())e.addStandaloneCommentButton();for(let i of(e===L.SIGNATURE&&await this.#tf?.loadSignatures(),this.setEditingState(!0),await this.#tV(),this.unselectAll(),this.#L.values()))i.updateMode(e);if(e===L.POPUP){this.#R||=await this.#tb.getAnnotationsByType(new Set(this.#G.map(e=>e._editorType)));let e=new Set,i=[];for(let r of this.#P.values()){let{annotationElementId:s,hasComment:n,deleted:a}=r;s&&e.add(s),n&&!a&&i.push(r.getData())}for(let r of this.#R){let{id:s,popupRef:n,contentsObj:a}=r;n&&a?.str&&!e.has(s)&&!this.#z.has(s)&&i.push(r)}this.#U?.showSidebar(i)}if(!i)return r&&this.addNewEditorFromKeyboard(),void this.#tS.resolve();for(let e of this.#P.values())e.uid===i?(this.setSelected(e),n?e.editComment():s?e.enterInEditMode():e.focus()):e.unselect();this.#tS.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#tc&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,i){if(this.#G){switch(e){case N.CREATE:return void this.currentLayer.addNewEditor(i);case N.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#tm||=new Map).set(e,i),this.showAllEditors("highlight",i)}if(this.hasSelection)for(let r of this.#tu)r.updateParams(e,i);else for(let r of this.#G)r.updateDefaultParams(e,i)}}showAllEditors(e,i,r=!1){for(let r of this.#P.values())r.editorType===e&&r.show(i);(this.#tm?.get(N.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#t$([[N.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(e=!1){if(this.#tn!==e)for(let i of(this.#tn=e,this.#L.values()))e?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",e)}async #tV(){if(!this.#tr){this.#tr=!0;let e=[];for(let i of this.#L.values())e.push(i.enable());for(let i of(await Promise.all(e),this.#P.values()))i.enable()}}#tz(){if(this.unselectAll(),this.#tr){for(let e of(this.#tr=!1,this.#L.values()))e.disable();for(let e of this.#P.values())e.disable()}}*getEditors(e){for(let i of this.#P.values())i.pageIndex===e&&(yield i)}getEditor(e){return this.#P.get(e)}addEditor(e){this.#P.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#K&&clearTimeout(this.#K),this.#K=setTimeout(()=>{this.focusMainContainer(),this.#K=null},0)),this.#P.delete(e.id),e.annotationElementId&&this.#th?.delete(e.annotationElementId),this.unselect(e),e.annotationElementId&&this.#z.has(e.annotationElementId)||this.#O?.remove(e.id)}addDeletedAnnotationElement(e){this.#z.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#z.has(e)}removeDeletedAnnotationElement(e){this.#z.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#tU(e){let i=this.#L.get(e.pageIndex);i?i.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#D!==e&&(this.#D=e,e&&this.#t$(e.propertiesToUpdate))}get #tG(){let e=null;for(e of this.#tu);return e}updateUI(e){this.#tG===e&&this.#t$(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#t$(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#tu.has(e))return this.#tu.delete(e),e.unselect(),void this.#tR({hasSelectedEditor:this.hasSelection});this.#tu.add(e),e.select(),this.#t$(e.propertiesToUpdate),this.#tR({hasSelectedEditor:!0})}setSelected(e){for(let i of(this.updateToolbar({mode:e.mode,editId:e.id}),this.#$?.commitOrRemove(),this.#tu))i!==e&&i.unselect();this.#tu.clear(),this.#tu.add(e),e.select(),this.#t$(e.propertiesToUpdate),this.#tR({hasSelectedEditor:!0})}isSelected(e){return this.#tu.has(e)}get firstSelectedEditor(){return this.#tu.values().next().value}unselect(e){e.unselect(),this.#tu.delete(e),this.#tR({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#tu.size}get isEnterHandled(){return 1===this.#tu.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#B.undo(),this.#tR({hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#tH()}),this._editorUndoBar?.hide()}redo(){this.#B.redo(),this.#tR({hasSomethingToUndo:!0,hasSomethingToRedo:this.#B.hasSomethingToRedo(),isEmpty:this.#tH()})}addCommands(e){this.#B.add(e),this.#tR({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#tH()})}cleanUndoStack(e){this.#B.cleanType(e)}#tH(){if(0===this.#P.size)return!0;if(1===this.#P.size)for(let e of this.#P.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let i=e?[e]:[...this.#tu],r=()=>{for(let e of i)this.#tU(e)};this.addCommands({cmd:()=>{for(let e of(this._editorUndoBar?.show(r,1===i.length?i[0].editorType:i.length),i))e.remove()},undo:r,mustExec:!0})}commitOrRemove(){this.#D?.commitOrRemove()}hasSomethingToControl(){return this.#D||this.hasSelection}#tj(e){for(let e of this.#tu)e.unselect();for(let i of(this.#tu.clear(),e))i.isEmpty()||(this.#tu.add(i),i.select());this.#tR({hasSelectedEditor:this.hasSelection})}selectAll(){for(let e of this.#tu)e.commit();this.#tj(this.#P.values())}unselectAll(){if((!this.#D||(this.#D.commitOrRemove(),this.#tc===L.NONE))&&!this.#$?.commitOrRemove()&&this.hasSelection){for(let e of this.#tu)e.unselect();this.#tu.clear(),this.#tR({hasSelectedEditor:!1})}}translateSelectedEditors(e,i,r=!1){if(r||this.commitOrRemove(),!this.hasSelection)return;this.#ty[0]+=e,this.#ty[1]+=i;let[s,n]=this.#ty,a=[...this.#tu];for(let r of(this.#t_&&clearTimeout(this.#t_),this.#t_=setTimeout(()=>{this.#t_=null,this.#ty[0]=this.#ty[1]=0,this.addCommands({cmd:()=>{for(let e of a)this.#P.has(e.id)&&(e.translateInPage(s,n),e.translationDone())},undo:()=>{for(let e of a)this.#P.has(e.id)&&(e.translateInPage(-s,-n),e.translationDone())},mustExec:!1})},1e3),a))r.translateInPage(e,i),r.translationDone()}setUpDragSession(){if(this.hasSelection)for(let e of(this.disableUserSelect(!0),this.#V=new Map,this.#tu))this.#V.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}endDragSession(){if(!this.#V)return!1;this.disableUserSelect(!1);let e=this.#V;this.#V=null;let i=!1;for(let[{x:r,y:s,pageIndex:n},a]of e)a.newX=r,a.newY=s,a.newPageIndex=n,i||=r!==a.savedX||s!==a.savedY||n!==a.savedPageIndex;if(!i)return!1;let r=(e,i,r,s)=>{if(this.#P.has(e.id)){let n=this.#L.get(s);n?e._setParentAndPosition(n,i,r):(e.pageIndex=s,e.x=i,e.y=r)}};return this.addCommands({cmd:()=>{for(let[i,{newX:s,newY:n,newPageIndex:a}]of e)r(i,s,n,a)},undo:()=>{for(let[i,{savedX:s,savedY:n,savedPageIndex:a}]of e)r(i,s,n,a)},mustExec:!0}),!0}dragSelectedEditors(e,i){if(this.#V)for(let r of this.#V.keys())r.drag(e,i)}rebuild(e){if(null===e.parent){let i=this.getLayer(e.pageIndex);i?(i.changeParent(e),i.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#tu.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#D===e}getActive(){return this.#D}getMode(){return this.#tc}isEditingMode(){return this.#tc!==L.NONE}get imageManager(){return Y(this,"imageManager",new tQ)}getSelectionBoxes(e){let i;if(!e)return null;let r=document.getSelection();for(let i=0,s=r.rangeCount;i<s;i++)if(!e.contains(r.getRangeAt(i).commonAncestorContainer))return null;let{x:s,y:n,width:a,height:o}=e.getBoundingClientRect();switch(e.getAttribute("data-main-rotation")){case"90":i=(e,i,r,l)=>({x:(i-n)/o,y:1-(e+r-s)/a,width:l/o,height:r/a});break;case"180":i=(e,i,r,l)=>({x:1-(e+r-s)/a,y:1-(i+l-n)/o,width:r/a,height:l/o});break;case"270":i=(e,i,r,l)=>({x:1-(i+l-n)/o,y:(e-s)/a,width:l/o,height:r/a});break;default:i=(e,i,r,l)=>({x:(e-s)/a,y:(i-n)/o,width:r/a,height:l/o})}let l=[];for(let e=0,s=r.rangeCount;e<s;e++){let s=r.getRangeAt(e);if(!s.collapsed)for(let{x:e,y:r,width:n,height:a}of s.getClientRects())0!==n&&0!==a&&l.push(i(e,r,n,a))}return 0===l.length?null:l}addChangedExistingAnnotation({annotationElementId:e,id:i}){(this.#F||=new Map).set(e,i)}removeChangedExistingAnnotation({annotationElementId:e}){this.#F?.delete(e)}renderAnnotationElement(e){let i=this.#F?.get(e.data.id);if(!i)return;let r=this.#O.getRawValue(i);r&&(this.#tc!==L.NONE||r.hasBeenModified)&&r.renderAnnotationElement(e)}setMissingCanvas(e,i,r){let s=this.#th?.get(e);s&&(s.setCanvas(i,r),this.#th.delete(e))}addMissingCanvas(e,i){(this.#th||=new Map).set(e,i)}}class t5{#o=null;#tW=!1;#tq=null;#tX=null;#tY=null;#tJ=null;#tK=!1;#tQ=null;#n=null;#tZ=null;#t0=null;#t1=!1;static #t2=null;static _l10n=null;constructor(e){this.#n=e,this.#t1=e._uiManager.useNewAltTextFlow,t5.#t2||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){t5._l10n??=e}async render(){let e=this.#tq=document.createElement("button");e.className="altText",e.tabIndex="0";let i=this.#tX=document.createElement("span");e.append(i),this.#t1?(e.classList.add("new"),e.setAttribute("data-l10n-id",t5.#t2.missing),i.setAttribute("data-l10n-id",t5.#t2["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let r=this.#n._uiManager._signal;e.addEventListener("contextmenu",tM,{signal:r}),e.addEventListener("pointerdown",e=>e.stopPropagation(),{signal:r});let s=e=>{e.preventDefault(),this.#n._uiManager.editAltText(this.#n),this.#t1&&this.#n._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#t5}})};return e.addEventListener("click",s,{capture:!0,signal:r}),e.addEventListener("keydown",i=>{i.target===e&&"Enter"===i.key&&(this.#tK=!0,s(i))},{signal:r}),await this.#t4(),e}get #t5(){return(this.#o?"added":null===this.#o&&this.guessedText&&"review")||"missing"}finish(){this.#tq&&(this.#tq.focus({focusVisible:this.#tK}),this.#tK=!1)}isEmpty(){return this.#t1?null===this.#o:!this.#o&&!this.#tW}hasData(){return this.#t1?null!==this.#o||!!this.#tZ:this.isEmpty()}get guessedText(){return this.#tZ}async setGuessedText(e){null===this.#o&&(this.#tZ=e,this.#t0=await t5._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#t4())}toggleAltTextBadge(e=!1){if(!this.#t1||this.#o)return this.#tQ?.remove(),void(this.#tQ=null);if(!this.#tQ){let e=this.#tQ=document.createElement("div");e.className="noAltTextBadge",this.#n.div.append(e)}this.#tQ.classList.toggle("hidden",!e)}serialize(e){let i=this.#o;return e||this.#tZ!==i||(i=this.#t0),{altText:i,decorative:this.#tW,guessedText:this.#tZ,textWithDisclaimer:this.#t0}}get data(){return{altText:this.#o,decorative:this.#tW}}set data({altText:e,decorative:i,guessedText:r,textWithDisclaimer:s,cancel:n=!1}){r&&(this.#tZ=r,this.#t0=s),this.#o===e&&this.#tW===i||(n||(this.#o=e,this.#tW=i),this.#t4())}toggle(e=!1){this.#tq&&(!e&&this.#tJ&&(clearTimeout(this.#tJ),this.#tJ=null),this.#tq.disabled=!e)}shown(){this.#n._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#t5}})}destroy(){this.#tq?.remove(),this.#tq=null,this.#tX=null,this.#tY=null,this.#tQ?.remove(),this.#tQ=null}async #t4(){let e=this.#tq;if(!e)return;if(this.#t1){if(e.classList.toggle("done",!!this.#o),e.setAttribute("data-l10n-id",t5.#t2[this.#t5]),this.#tX?.setAttribute("data-l10n-id",t5.#t2[`${this.#t5}-label`]),!this.#o)return void this.#tY?.remove()}else{if(!this.#o&&!this.#tW)return e.classList.remove("done"),void this.#tY?.remove();e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=this.#tY;if(!i){this.#tY=i=document.createElement("span"),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${this.#n.id}`;let r=this.#n._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#tJ),this.#tJ=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#tJ=setTimeout(()=>{this.#tJ=null,this.#tY.classList.add("show"),this.#n._reportTelemetry({action:"alt_text_tooltip"})},100)},{signal:r}),e.addEventListener("mouseleave",()=>{this.#tJ&&(clearTimeout(this.#tJ),this.#tJ=null),this.#tY?.classList.remove("show")},{signal:r})}this.#tW?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=this.#o),i.parentNode||e.append(i);let r=this.#n.getElementForAltText();r?.setAttribute("aria-describedby",i.id)}}class t4{#t3=null;#t6=null;#t9=!1;#n=null;#t8=null;#t7=null;#et=null;#ee=null;#ei=!1;#er=null;constructor(e){this.#n=e}renderForToolbar(){let e=this.#t6=document.createElement("button");return e.className="comment",this.#v(e,!1)}renderForStandalone(){let e=this.#t3=document.createElement("button");e.className="annotationCommentButton";let i=this.#n.commentButtonPosition;if(i){let{style:r}=e;r.insetInlineEnd=`calc(${100*("ltr"===this.#n._uiManager.direction?1-i[0]:i[0])}% - var(--comment-button-dim))`,r.top=`calc(${100*i[1]}% - var(--comment-button-dim))`;let s=this.#n.commentButtonColor;s&&(r.backgroundColor=s)}return this.#v(e,!0)}focusButton(){setTimeout(()=>{(this.#t3??this.#t6)?.focus()},0)}onUpdatedColor(){if(!this.#t3)return;let e=this.#n.commentButtonColor;e&&(this.#t3.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#t3?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#er)return this.#er;if(!this.#t3)return null;let{x:e,y:i,height:r}=this.#t3.getBoundingClientRect(),{x:s,y:n,width:a,height:o}=this.#n.parent.boundingClientRect;return[(e-s)/a,(i+r-n)/o]}set commentPopupPositionInLayer(e){this.#er=e}hasDefaultPopupPosition(){return null===this.#er}removeStandaloneCommentButton(){this.#t3?.remove(),this.#t3=null}removeToolbarCommentButton(){this.#t6?.remove(),this.#t6=null}setCommentButtonStates({selected:e,hasPopup:i}){this.#t3&&(this.#t3.classList.toggle("selected",e),this.#t3.ariaExpanded=i)}#v(e,i){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",i?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));let r=this.#n._uiManager._signal;if(!(r instanceof AbortSignal)||r.aborted)return e;e.addEventListener("contextmenu",tM,{signal:r}),i&&(e.addEventListener("focusin",e=>{this.#n._focusEventsAllowed=!1,tk(e)},{capture:!0,signal:r}),e.addEventListener("focusout",e=>{this.#n._focusEventsAllowed=!0,tk(e)},{capture:!0,signal:r})),e.addEventListener("pointerdown",e=>e.stopPropagation(),{signal:r});let s=i=>{i.preventDefault(),e===this.#t6?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",s,{capture:!0,signal:r}),e.addEventListener("keydown",i=>{i.target===e&&"Enter"===i.key&&(this.#t9=!0,s(i))},{signal:r}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:r}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:r}),e}edit(e){let i,r;let s=this.commentPopupPositionInLayer;if(s)[i,r]=s;else{[i,r]=this.#n.commentButtonPosition;let{width:e,height:s,x:n,y:a}=this.#n;i=n+i*e,r=a+r*s}let n=this.#n.parent.boundingClientRect,{x:a,y:o,width:l,height:h}=n;this.#n._uiManager.editComment(this.#n,a+i*l,o+r*h,{...e,parentDimensions:n})}finish(){this.#t6&&(this.#t6.focus({focusVisible:this.#t9}),this.#t9=!1)}isDeleted(){return this.#ei||""===this.#et}isEmpty(){return null===this.#et}hasBeenEdited(){return this.isDeleted()||this.#et!==this.#t8}serialize(){return this.data}get data(){return{text:this.#et,richText:this.#t7,date:this.#ee,deleted:this.isDeleted()}}set data(e){if(e!==this.#et&&(this.#t7=null),null===e)return this.#et="",void(this.#ei=!0);this.#et=e,this.#ee=new Date,this.#ei=!1}setInitialText(e,i=null){this.#t8=e,this.data=e,this.#ee=null,this.#t7=i}shown(){}destroy(){this.#t6?.remove(),this.#t6=null,this.#t3?.remove(),this.#t3=null,this.#et="",this.#t7=null,this.#ee=null,this.#n=null,this.#t9=!1,this.#ei=!1}}class t3{#tw;#es=!1;#en=null;#ea;#eo;#el;#eh;#ed=null;#ec;#eu=null;#ep;#ef=null;constructor({container:e,isPinchingDisabled:i=null,isPinchingStopped:r=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){this.#tw=e,this.#en=r,this.#ea=i,this.#eo=s,this.#el=n,this.#eh=a,this.#ep=new AbortController,this.#ec=AbortSignal.any([o,this.#ep.signal]),e.addEventListener("touchstart",this.#eg.bind(this),{passive:!1,signal:this.#ec})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/tO.pixelRatio}#eg(e){if(this.#ea?.())return;if(1===e.touches.length){if(this.#ed)return;let e=this.#ed=new AbortController,i=AbortSignal.any([this.#ec,e.signal]),r=this.#tw,s={capture:!0,signal:i,passive:!1},n=e=>{"touch"===e.pointerType&&(this.#ed?.abort(),this.#ed=null)};return r.addEventListener("pointerdown",e=>{"touch"===e.pointerType&&(tk(e),n(e))},s),r.addEventListener("pointerup",n,s),void r.addEventListener("pointercancel",n,s)}if(!this.#ef){this.#ef=new AbortController;let e=AbortSignal.any([this.#ec,this.#ef.signal]),i=this.#tw,r={signal:e,capture:!1,passive:!1};i.addEventListener("touchmove",this.#em.bind(this),r);let s=this.#eb.bind(this);i.addEventListener("touchend",s,r),i.addEventListener("touchcancel",s,r),r.capture=!0,i.addEventListener("pointerdown",tk,r),i.addEventListener("pointermove",tk,r),i.addEventListener("pointercancel",tk,r),i.addEventListener("pointerup",tk,r),this.#eo?.()}if(tk(e),2!==e.touches.length||this.#en?.())return void(this.#eu=null);let[i,r]=e.touches;i.identifier>r.identifier&&([i,r]=[r,i]),this.#eu={touch0X:i.screenX,touch0Y:i.screenY,touch1X:r.screenX,touch1Y:r.screenY}}#em(e){if(!this.#eu||2!==e.touches.length)return;tk(e);let[i,r]=e.touches;i.identifier>r.identifier&&([i,r]=[r,i]);let{screenX:s,screenY:n}=i,{screenX:a,screenY:o}=r,l=this.#eu,{touch0X:h,touch0Y:d,touch1X:c,touch1Y:u}=l,p=Math.hypot(a-s,o-n)||1,f=Math.hypot(c-h,u-d)||1;if(!this.#es&&Math.abs(f-p)<=t3.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,!this.#es)return void(this.#es=!0);let g=[(s+a)/2,(n+o)/2];this.#el?.(g,f,p)}#eb(e){e.touches.length>=2||(this.#ef&&(this.#ef.abort(),this.#ef=null,this.#eh?.()),this.#eu&&(tk(e),this.#eu=null,this.#es=!1))}destroy(){this.#ep?.abort(),this.#ep=null,this.#ed?.abort(),this.#ed=null}}class t6{#ev=null;#ey=null;#o=null;#l=null;#t3=null;#e_=!1;#ew=null;#eA="";#ex=null;#eS=null;#eE=null;#eC=null;#eT=null;#eM="";#ek=!1;#eI=null;#eD=!1;#eR=!1;#eP=!1;#eL=null;#eN=0;#eO=0;#eF=null;#eB=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#eU=!1;#ej=t6._zIndex++;static _borderLineWidth=-1;static _colorManager=new t1;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let e=t6.prototype._resizeWithKeyboard,i=t2.TRANSLATE_SMALL,r=t2.TRANSLATE_BIG;return Y(this,"_resizerKeyboardManager",new t0([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-i,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-r,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[i,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[r,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-i]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-r]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,i]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,r]}],[["Escape","mac+Escape"],t6.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;let{rotation:i,rawDims:{pageWidth:r,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=i,this.pageRotation=(360+i-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,s],this.pageTranslation=[n,a];let[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Y(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let i=new t9({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});i.annotationElementId=e.annotationElementId,i.deleted=!0,i._uiManager.addToAnnotationStorage(i)}static initialize(e,i){if(t6._l10n??=e,t6._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==t6._borderLineWidth)return;let r=getComputedStyle(document.documentElement);t6._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,i){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,i){G("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#eU}set _isDraggable(e){this.#eU=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){let[e,i]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*i/(2*e),this.y+=this.width*e/(2*i);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*i/(2*e),this.y-=this.width*e/(2*i);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#ej}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#e$(),this.#eC?.remove(),this.#eC=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#ek?this.#ek=!1:this.parent.setSelected(this))}focusout(e){if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let i=e.relatedTarget;i?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,i,r,s){let[n,a]=this.parentDimensions;[r,s]=this.screenToPageTranslation(r,s),this.x=(e+r)/n,this.y=(i+s)/a,this.fixAndSetPosition()}_moveAfterPaste(e,i){let[r,s]=this.parentDimensions;this.setAt(e*r,i*s,this.width*r,this.height*s),this._onTranslated()}#eH([e,i],r,s){[r,s]=this.screenToPageTranslation(r,s),this.x+=r/e,this.y+=s/i,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,i){this.#eH(this.parentDimensions,e,i)}translateInPage(e,i){this.#eI||=[this.x,this.y,this.width,this.height],this.#eH(this.pageDimensions,e,i),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,i){this.#eI||=[this.x,this.y,this.width,this.height];let{div:r,parentDimensions:[s,n]}=this;if(this.x+=e/s,this.y+=i/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:e,y:i}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,i)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this,[l,h]=this.getBaseTranslation();a+=l,o+=h;let{style:d}=r;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),r.scrollIntoView({block:"nearest"})}_onTranslating(e,i){}_onTranslated(e,i){}get _hasBeenMoved(){return!!this.#eI&&(this.#eI[0]!==this.x||this.#eI[1]!==this.y)}get _hasBeenResized(){return!!this.#eI&&(this.#eI[2]!==this.width||this.#eI[3]!==this.height)}getBaseTranslation(){let[e,i]=this.parentDimensions,{_borderLineWidth:r}=t6,s=r/e,n=r/i;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:i},pageDimensions:[r,s]}=this,{x:n,y:a,width:o,height:l}=this;if(o*=r,l*=s,n*=r,a*=s,this._mustFixPosition)switch(e){case 0:n=tp(n,0,r-o),a=tp(a,0,s-l);break;case 90:n=tp(n,0,r-l),a=tp(a,o,s);break;case 180:n=tp(n,o,r),a=tp(a,l,s);break;case 270:n=tp(n,l,r),a=tp(a,0,s-o)}this.x=n/=r,this.y=a/=s;let[h,d]=this.getBaseTranslation();n+=h,a+=d,i.left=`${(100*n).toFixed(2)}%`,i.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static #ez(e,i,r){switch(r){case 90:return[i,-e];case 180:return[-e,-i];case 270:return[-i,e];default:return[e,i]}}screenToPageTranslation(e,i){return t6.#ez(e,i,this.parentRotation)}pageTranslationToScreen(e,i){return t6.#ez(e,i,360-this.parentRotation)}#eV(e){switch(e){case 90:{let[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[i,r]}=this;return[i*e,r*e]}setDims(){let{div:{style:e},width:i,height:r}=this;e.width=`${(100*i).toFixed(2)}%`,e.height=`${(100*r).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#eG(){if(this.#ex)return;this.#ex=document.createElement("div"),this.#ex.classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],i=this._uiManager._signal;for(let r of e){let e=document.createElement("div");this.#ex.append(e),e.classList.add("resizer",r),e.setAttribute("data-resizer-name",r),e.addEventListener("pointerdown",this.#eW.bind(this,r),{signal:i}),e.addEventListener("contextmenu",tM,{signal:i}),e.tabIndex=-1}this.div.prepend(this.#ex)}#eW(e,i){i.preventDefault();let{isMac:r}=tn.platform;if(0!==i.button||i.ctrlKey&&r)return;this.#o?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,this.#eS=[i.screenX,i.screenY];let n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#eq.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",tk,{passive:!1,signal:a}),window.addEventListener("contextmenu",tM,{signal:a}),this.#eE={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(i.target).cursor;let h=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#o?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#eX()};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})}#eY(e,i,r,s){this.width=r,this.height=s,this.x=e,this.y=i,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#eX(){if(!this.#eE)return;let{savedX:e,savedY:i,savedWidth:r,savedHeight:s}=this.#eE;this.#eE=null;let n=this.x,a=this.y,o=this.width,l=this.height;n===e&&a===i&&o===r&&l===s||this.addCommands({cmd:this.#eY.bind(this,n,a,o,l),undo:this.#eY.bind(this,e,i,r,s),mustExec:!0})}static _round(e){return Math.round(1e4*e)/1e4}#eq(e,i){var r,s;let[n,a]=this.parentDimensions,o=this.x,l=this.y,h=this.width,d=this.height,c=t6.MIN_SIZE/n,u=t6.MIN_SIZE/a,p=this.#eV(this.rotation),f=(e,i)=>[p[0]*e+p[2]*i,p[1]*e+p[3]*i],g=this.#eV(360-this.rotation),m,b,v=!1,y=!1;switch(e){case"topLeft":v=!0,m=(e,i)=>[0,0],b=(e,i)=>[e,i];break;case"topMiddle":m=(e,i)=>[e/2,0],b=(e,i)=>[e/2,i];break;case"topRight":v=!0,m=(e,i)=>[e,0],b=(e,i)=>[0,i];break;case"middleRight":y=!0,m=(e,i)=>[e,i/2],b=(e,i)=>[0,i/2];break;case"bottomRight":v=!0,m=(e,i)=>[e,i],b=(e,i)=>[0,0];break;case"bottomMiddle":m=(e,i)=>[e/2,i],b=(e,i)=>[e/2,0];break;case"bottomLeft":v=!0,m=(e,i)=>[0,i],b=(e,i)=>[e,0];break;case"middleLeft":y=!0,m=(e,i)=>[0,i/2],b=(e,i)=>[e,i/2]}let _=m(h,d),w=b(h,d),A=f(...w),x=t6._round(o+A[0]),S=t6._round(l+A[1]),E,C,T=1,M=1;if(i.fromKeyboard)({deltaX:E,deltaY:C}=i);else{let{screenX:e,screenY:r}=i,[s,n]=this.#eS;[E,C]=this.screenToPageTranslation(e-s,r-n),this.#eS[0]=e,this.#eS[1]=r}if([E,C]=(r=E/n,s=C/a,[g[0]*r+g[2]*s,g[1]*r+g[3]*s]),v){let e=Math.hypot(h,d);T=M=Math.max(Math.min(Math.hypot(w[0]-_[0]-E,w[1]-_[1]-C)/e,1/h,1/d),c/h,u/d)}else y?T=tp(Math.abs(w[0]-_[0]-E),c,1)/h:M=tp(Math.abs(w[1]-_[1]-C),u,1)/d;let k=t6._round(h*T),I=t6._round(d*M),D=x-(A=f(...b(k,I)))[0],R=S-A[1];this.#eI||=[this.x,this.y,this.width,this.height],this.width=k,this.height=I,this.x=D,this.y=R,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#o?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#eR)return this._editToolbar;this._editToolbar=new tX(this),this.div.append(this._editToolbar.render());let{toolbarButtons:e}=this;if(e)for(let[i,r]of e)await this._editToolbar.addButton(i,r);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#o?.destroy()}addContainer(e){let i=this._editToolbar?.div;i?i.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#o||(t5.initialize(t6._l10n),this.#o=new t5(this),this.#ev&&(this.#o.data=this.#ev,this.#ev=null)),this.#o}get altTextData(){return this.#o?.data}set altTextData(e){this.#o&&(this.#o.data=e)}get guessedAltText(){return this.#o?.guessedText}async setGuessedAltText(e){await this.#o?.setGuessedText(e)}serializeAltText(e){return this.#o?.serialize(e)}hasAltText(){return!!this.#o&&!this.#o.isEmpty()}hasAltTextData(){return this.#o?.hasData()??!1}focusCommentButton(){this.#l?.focusButton()}addCommentButton(){return this.#l||=new t4(this)}addStandaloneCommentButton(){this.#t3?this._uiManager.isEditingMode()&&this.#t3.classList.remove("hidden"):this.hasComment&&(this.#t3=this.#l.renderForStandalone(),this.div.append(this.#t3))}removeStandaloneCommentButton(){this.#l.removeStandaloneCommentButton(),this.#t3=null}hideStandaloneCommentButton(){this.#t3?.classList.add("hidden")}get comment(){let{data:{richText:e,text:i,date:r,deleted:s}}=this.#l;return{text:i,richText:e,date:r,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#l||=new t4(this),this.#l.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:i,richText:r}){if(!i||(this.#l||=new t4(this),this.#l.setInitialText(e,r),!this.annotationElementId))return;let s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#l?.hasBeenEdited()}get hasDeletedComment(){return this.#l?.isDeleted()}get hasComment(){return!!this.#l&&!this.#l.isEmpty()&&!this.#l.isDeleted()}async editComment(e){this.#l||=new t4(this),this.#l.edit(e)}toggleComment(e,i){this.hasComment&&this._uiManager.toggleComment(this,e,i)}setSelectedCommentButton(e){this.#l.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){let[,,,i]=e.rect,[r]=this.pageDimensions,[s]=this.pageTranslation,n=s+r+1;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[n,i-100,n+180,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:i}}){this.#l.data=i?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){let e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#e_?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#eJ();let[i,r]=this.parentDimensions;this.parentRotation%180!=0&&(e.style.maxWidth=`${(100*r/i).toFixed(2)}%`,e.style.maxHeight=`${(100*i/r).toFixed(2)}%`);let[s,n]=this.getInitialTranslation();return this.translate(s,n),tJ(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#eB||=new t3({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#eK.bind(this),onPinching:this.#eQ.bind(this),onPinchEnd:this.#eZ.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#eK(){this.#eE={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#o?.toggle(!1),this.parent.togglePointerEvents(!1)}#eQ(e,i,r){let s=r/i*.7+1-.7;if(1===s)return;let n=this.#eV(this.rotation),a=(e,i)=>[n[0]*e+n[2]*i,n[1]*e+n[3]*i],[o,l]=this.parentDimensions,h=this.x,d=this.y,c=this.width,u=this.height;s=Math.max(Math.min(s,1/c,1/u),t6.MIN_SIZE/o/c,t6.MIN_SIZE/l/u);let p=t6._round(c*s),f=t6._round(u*s);if(p===c&&f===u)return;this.#eI||=[h,d,c,u];let g=a(c/2,u/2),m=t6._round(h+g[0]),b=t6._round(d+g[1]),v=a(p/2,f/2);this.x=m-v[0],this.y=b-v[1],this.width=p,this.height=f,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#eZ(){this.#o?.toggle(!0),this.parent.togglePointerEvents(!0),this.#eX()}pointerdown(e){let{isMac:i}=tn.platform;0!==e.button||e.ctrlKey&&i?e.preventDefault():(this.#ek=!0,this._isDraggable?this.#e0(e):this.#e1(e))}#e1(e){let{isMac:i}=tn.platform;e.ctrlKey&&!i||e.shiftKey||e.metaKey&&i?this.parent.toggleSelected(this):this.parent.setSelected(this)}#e0(e){let{isSelected:i}=this;this._uiManager.setUpDragSession();let r=!1,s=new AbortController,n=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:n},o=e=>{s.abort(),this.#ew=null,this.#ek=!1,this._uiManager.endDragSession()||this.#e1(e),r&&this._onStopDragging()};i&&(this.#eN=e.clientX,this.#eO=e.clientY,this.#ew=e.pointerId,this.#eA=e.pointerType,window.addEventListener("pointermove",e=>{r||(r=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());let{clientX:i,clientY:s,pointerId:n}=e;if(n!==this.#ew)return void tk(e);let[a,o]=this.screenToPageTranslation(i-this.#eN,s-this.#eO);this.#eN=i,this.#eO=s,this._uiManager.dragSelectedEditors(a,o)},a),window.addEventListener("touchmove",tk,a),window.addEventListener("pointerdown",e=>{e.pointerType===this.#eA&&(this.#eB||e.isPrimary)&&o(e),tk(e)},a));let l=e=>{this.#ew&&this.#ew!==e.pointerId?tk(e):o(e)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#eL&&clearTimeout(this.#eL),this.#eL=setTimeout(()=>{this.#eL=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,i,r){e.changeParent(this),this.x=i,this.y=r,this.fixAndSetPosition(),this._onTranslated()}getRect(e,i,r=this.rotation){let s=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/s,d=i/s,c=this.x*n,u=this.y*a,p=this.width*n,f=this.height*a;switch(r){case 0:return[c+h+o,a-u-d-f+l,c+h+p+o,a-u-d+l];case 90:return[c+d+o,a-u+h+l,c+d+f+o,a-u+h+p+l];case 180:return[c-h-p+o,a-u+d+l,c-h+o,a-u+d+f+l];case 270:return[c-d-f+o,a-u-h-p+l,c-d+o,a-u-h+l];default:throw Error("Invalid rotation")}}getRectInCurrentCoords(e,i){let[r,s,n,a]=e,o=n-r,l=a-s;switch(this.rotation){case 0:return[r,i-a,o,l];case 90:return[r,i-s,l,o];case 180:return[n,i-s,o,l];case 270:return[n,i-a,l,o];default:throw Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&t6._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#l?.onUpdatedColor()}getData(){let{comment:{text:e,color:i,date:r,opacity:s,deleted:n,richText:a},uid:o,pageIndex:l,creationDate:h,modificationDate:d}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:h,modificationDate:r||d,popupRef:!n,color:i,opacity:s}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#eR=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#eR=!1,!0)}isInEditMode(){return this.#eR}shouldGetKeyboardEvents(){return this.#eP}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:i,bottom:r,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return i<a&&s>0&&e<n&&r>0}#eJ(){if(this.#eT||!this.div)return;this.#eT=new AbortController;let e=this._uiManager.combinedSignal(this.#eT);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#eJ()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,i=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,i,r){let s=new this.prototype.constructor({parent:i,id:i.getNextId(),uiManager:r,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});s.rotation=e.rotation,s.#ev=e.accessibilityData,s._isCopy=e.isCopy||!1;let[n,a]=s.pageDimensions,[o,l,h,d]=s.getRectInCurrentCoords(e.rect,a);return s.x=o/n,s.y=l/a,s.width=h/n,s.height=d/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#eT?.abort(),this.#eT=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#eL&&(clearTimeout(this.#eL),this.#eL=null),this.#e$(),this.removeEditToolbar(),this.#eF){for(let e of this.#eF.values())clearTimeout(e);this.#eF=null}this.parent=null,this.#eB?.destroy(),this.#eB=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#eG(),this.#ex.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return"ltr"===this._uiManager.direction?[1,0]:[0,0]}get commentButtonPositionInPage(){let{commentButtonPosition:[e,i]}=this,[r,s,n,a]=this.getPDFRect();return[t6._round(r+(n-r)*e),t6._round(s+(a-s)*(1-i))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#l.commentPopupPositionInLayer}set commentPopupPosition(e){this.#l.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#l.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#l.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#l.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),this.#eE={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let i=this.#ex.children;if(!this.#ey){this.#ey=Array.from(i);let e=this.#e2.bind(this),r=this.#e5.bind(this),s=this._uiManager._signal;for(let i of this.#ey){let n=i.getAttribute("data-resizer-name");i.setAttribute("role","spinbutton"),i.addEventListener("keydown",e,{signal:s}),i.addEventListener("blur",r,{signal:s}),i.addEventListener("focus",this.#e4.bind(this,n),{signal:s}),i.setAttribute("data-l10n-id",t6._l10nResizer[n])}}let r=this.#ey[0],s=0;for(let e of i){if(e===r)break;s++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#ey.length/4);if(n!==s){if(n<s)for(let e=0;e<s-n;e++)this.#ex.append(this.#ex.firstChild);else if(n>s)for(let e=0;e<n-s;e++)this.#ex.firstChild.before(this.#ex.lastChild);let e=0;for(let r of i){let i=this.#ey[e++].getAttribute("data-resizer-name");r.setAttribute("data-l10n-id",t6._l10nResizer[i])}}this.#e3(0),this.#eP=!0,this.#ex.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#e2(e){t6._resizerKeyboardManager.exec(this,e)}#e5(e){this.#eP&&e.relatedTarget?.parentNode!==this.#ex&&this.#e$()}#e4(e){this.#eM=this.#eP?e:""}#e3(e){if(this.#ey)for(let i of this.#ey)i.tabIndex=e}_resizeWithKeyboard(e,i){this.#eP&&this.#eq(this.#eM,{deltaX:e,deltaY:i,fromKeyboard:!0})}#e$(){this.#eP=!1,this.#e3(-1),this.#eX()}_stopResizingWithKeyboard(){this.#e$(),this.div.focus()}select(){this.isSelected&&this._editToolbar?this._editToolbar.show():(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#o?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#ex?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#o?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,i){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){"BUTTON"!==e.target.nodeName&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#eD}set isEditing(e){this.#eD=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,i=!1){if(i){this.#eF||=new Map;let{action:i}=e,r=this.#eF.get(i);return r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#eF.delete(i),0===this.#eF.size&&(this.#eF=null)},t6._telemetryTimeout),void this.#eF.set(i,r)}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#e_=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#e_=!0}updateFakeAnnotationElement(e){if(this.#eC||this.deleted)return this.deleted?(this.#eC.remove(),void(this.#eC=null)):void((this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#eC.updateEdited({rect:this.getPDFRect(),popup:this.comment}));this.#eC=e.addFakeAnnotation(this)}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let i=e.container.querySelector(".annotationContent");if(i){if("CANVAS"===i.nodeName){let e=i;(i=document.createElement("div")).classList.add("annotationContent",this.editorType),e.before(i)}}else(i=document.createElement("div")).classList.add("annotationContent",this.editorType),e.container.prepend(i);return i}resetAnnotationElement(e){let{firstChild:i}=e.container;"DIV"===i?.nodeName&&i.classList.contains("annotationContent")&&i.remove()}}class t9 extends t6{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}class t8{constructor(e){this.h1=e?4294967295&e:3285377520,this.h2=e?4294967295&e:3285377520}update(e){let i,r;if("string"==typeof e){i=new Uint8Array(2*e.length),r=0;for(let s=0,n=e.length;s<n;s++){let n=e.charCodeAt(s);n<=255?i[r++]=n:(i[r++]=n>>>8,i[r++]=255&n)}}else{if(!ArrayBuffer.isView(e))throw Error("Invalid data format, must be a string or TypedArray.");r=(i=e.slice()).byteLength}let s=r>>2,n=r-4*s,a=new Uint32Array(i.buffer,0,s),o=0,l=0,h=this.h1,d=this.h2;for(let e=0;e<s;e++)1&e?(h^=o=461845907*(o=(o=3432918353*(o=a[e])&4294901760|11601*o&65535)<<15|o>>>17)&4294901760|13715*o&65535,h=5*(h=h<<13|h>>>19)+3864292196):(d^=l=461845907*(l=(l=3432918353*(l=a[e])&4294901760|11601*l&65535)<<15|l>>>17)&4294901760|13715*l&65535,d=5*(d=d<<13|d>>>19)+3864292196);switch(o=0,n){case 3:o^=i[4*s+2]<<16;case 2:o^=i[4*s+1]<<8;case 1:o^=i[4*s],o=461845907*(o=(o=3432918353*o&4294901760|11601*o&65535)<<15|o>>>17)&4294901760|13715*o&65535,1&s?h^=o:d^=o}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,i=this.h2;return e^=i>>>1,i=4283543511*i&4294901760|(2950163797*(i<<16|(e=3981806797*e&4294901760|36045*e&65535)>>>16)&4294901760)>>>16,e^=i>>>1,i=3301882366*i&4294901760|(3120437893*(i<<16|(e=444984403*e&4294901760|60499*e&65535)>>>16)&4294901760)>>>16,((e^=i>>>1)>>>0).toString(16).padStart(8,"0")+(i>>>0).toString(16).padStart(8,"0")}}let t7=Object.freeze({map:null,hash:"",transfer:void 0});class et{#e6=!1;#e9=null;#e8=null;#e7=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,i){let r=this.#e7.get(e);return void 0===r?i:Object.assign(i,r)}getRawValue(e){return this.#e7.get(e)}remove(e){let i=this.#e7.get(e);if(void 0!==i&&(i instanceof t6&&this.#e8.delete(i.annotationElementId),this.#e7.delete(e),0===this.#e7.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor)){for(let e of this.#e7.values())if(e instanceof t6)return;this.onAnnotationEditor(null)}}setValue(e,i){let r=this.#e7.get(e),s=!1;if(void 0!==r)for(let[e,n]of Object.entries(i))r[e]!==n&&(s=!0,r[e]=n);else s=!0,this.#e7.set(e,i);s&&this.#it(),i instanceof t6&&((this.#e8||=new Map).set(i.annotationElementId,i),"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(i.constructor._type))}has(e){return this.#e7.has(e)}get size(){return this.#e7.size}#it(){this.#e6||(this.#e6=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#e6&&(this.#e6=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new ee(this)}get serializable(){if(0===this.#e7.size)return t7;let e=new Map,i=new t8,r=[],s=Object.create(null),n=!1;for(let[r,a]of this.#e7){let o=a instanceof t6?a.serialize(!1,s):a;o&&(e.set(r,o),i.update(`${r}:${JSON.stringify(o)}`),n||=!!o.bitmap)}if(n)for(let i of e.values())i.bitmap&&r.push(i.bitmap);return e.size>0?{map:e,hash:i.hexdigest(),transfer:r}:t7}get editorStats(){let e=null,i=new Map,r=0,s=0;for(let n of this.#e7.values()){if(!(n instanceof t6)){n.popup&&(n.popup.deleted?s+=1:r+=1);continue}n.isCommentDeleted?s+=1:n.hasEditedComment&&(r+=1);let a=n.telemetryFinalData;if(!a)continue;let{type:o}=a;i.has(o)||i.set(o,Object.getPrototypeOf(n).constructor),e||=Object.create(null);let l=e[o]||=new Map;for(let[e,i]of Object.entries(a)){if("type"===e)continue;let r=l.get(e);r||(r=new Map,l.set(e,r));let s=r.get(i)??0;r.set(i,s+1)}}if((s>0||r>0)&&((e||=Object.create(null)).comments={deleted:s,edited:r}),!e)return null;for(let[r,s]of i)e[r]=s.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){this.#e9=null}updateEditor(e,i){let r=this.#e8?.get(e);return!!r&&(r.updateFromAnnotationLayer(i),!0)}getEditor(e){return this.#e8?.get(e)||null}get modifiedIds(){if(this.#e9)return this.#e9;let e=[];if(this.#e8)for(let i of this.#e8.values())i.serialize()&&e.push(i.annotationElementId);return this.#e9={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#e7.entries()}}class ee extends et{#ie;constructor(e){super();let{map:i,hash:r,transfer:s}=e.serializable,n=structuredClone(i,s?{transfer:s}:null);this.#ie={map:n,hash:r,transfer:s}}get print(){G("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#ie}get modifiedIds(){return Y(this,"modifiedIds",{ids:new Set,hash:""})}}class ei{#ii=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:i=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let i=this.styleElement.sheet;i.insertRule(e,i.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#ii.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:i,_inspectFont:r}){if(e&&!this.#ii.has(e.loadedName)){if(W(!i,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:i,src:s,style:n}=e,a=new FontFace(i,s,n);this.addNativeFontFace(a);try{await a.load(),this.#ii.add(i),r?.(e)}catch{V(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}G("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void await this.loadSystemFont(e);if(this.isFontLoadingAPISupported){let i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(r){throw V(`Failed to load font '${i.family}': '${r}'.`),e.disableFontFace=!0,r}}return}let i=e.createFontFaceRule();if(i){if(this.insertRule(i),this.isSyncFontLoadingSupported)return;await new Promise(i=>{let r=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){return Y(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return Y(this,"isSyncFontLoadingSupported",I||tn.platform.isFirefox)}_queueLoadingCallback(e){let{loadingRequests:i}=this,r={done:!1,complete:function(){for(W(!r.done,"completeRequest() cannot be called twice."),r.done=!0;i.length>0&&i[0].done;)setTimeout(i.shift().callback,0)},callback:e};return i.push(r),r}get _loadTestFont(){return Y(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,i){var r;let s,n;function a(e,i){return e.charCodeAt(i)<<24|e.charCodeAt(i+1)<<16|e.charCodeAt(i+2)<<8|255&e.charCodeAt(i+3)}function o(e,i,r,s){return e.substring(0,i)+s+e.substring(i+r)}let l=this._document.createElement("canvas");l.width=1,l.height=1;let h=l.getContext("2d"),d=0,c=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont,p=a(u=o(u,976,c.length,c),16);for(s=0,n=c.length-3;s<n;s+=4)p=p-1482184792+a(c,s)|0;s<c.length&&(p=p-1482184792+a(c+"XXX",s)|0),u=o(u,16,4,String.fromCharCode((r=p)>>24&255,r>>16&255,r>>8&255,255&r));let f=`@font-face {font-family:"${c}";src:url(data:font/opentype;base64,${btoa(u)});}`;this.insertRule(f);let g=this._document.createElement("div");for(let i of(g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px",[e.loadedName,c])){let e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=i,g.append(e)}this._document.body.append(g),function e(i,r){if(++d>30)return V("Load test font never loaded."),void r();h.font="30px "+i,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0?r():setTimeout(e.bind(null,i,r))}(c,()=>{g.remove(),i.complete()})}}class er{#ir;constructor(e,i=null,r,s){this.compiledGlyphs=Object.create(null),this.#ir=e,this._inspectFont=i,r&&Object.assign(this,r),s&&(this.charProcOperatorList=s)}createNativeFontFace(){let e;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){let i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}else e=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),e}createFontFaceRule(){let e;if(!this.data||this.disableFontFace)return null;let i=`url(data:${this.mimetype};base64,${tf(this.data)});`;if(this.cssFontInfo){let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${i}}`}else e=`@font-face {font-family:"${this.loadedName}";src:${i}}`;return this._inspectFont?.(this,i),e}getPathGenerator(e,i){let r;if(void 0!==this.compiledGlyphs[i])return this.compiledGlyphs[i];let s=this.loadedName+"_path_"+i;try{r=e.get(s)}catch(e){V(`getPathGenerator - ignoring character: "${e}".`)}let n=new Path2D(r||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[i]=n}get black(){return this.#ir.black}get bold(){return this.#ir.bold}get disableFontFace(){return this.#ir.disableFontFace??!1}get fontExtraProperties(){return this.#ir.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#ir.isInvalidPDFjsFont}get isType3Font(){return this.#ir.isType3Font}get italic(){return this.#ir.italic}get missingFile(){return this.#ir.missingFile}get remeasure(){return this.#ir.remeasure}get vertical(){return this.#ir.vertical}get ascent(){return this.#ir.ascent}get defaultWidth(){return this.#ir.defaultWidth}get descent(){return this.#ir.descent}get bbox(){return this.#ir.bbox}get fontMatrix(){return this.#ir.fontMatrix}get fallbackName(){return this.#ir.fallbackName}get loadedName(){return this.#ir.loadedName}get mimetype(){return this.#ir.mimetype}get name(){return this.#ir.name}get data(){return this.#ir.data}clearData(){this.#ir.clearData()}get cssFontInfo(){return this.#ir.cssFontInfo}get systemFontInfo(){return this.#ir.systemFontInfo}get defaultVMetrics(){return this.#ir.defaultVMetrics}}function es(e){if("string"!=typeof e)return null;if(e.endsWith("/"))return e;throw Error(`Invalid factory url: "${e}" must include trailing slash.`)}let en=e=>"object"==typeof e&&Number.isInteger(e?.num)&&e.num>=0&&Number.isInteger(e?.gen)&&e.gen>=0,ea=(function(e,i,r){if(!Array.isArray(r)||r.length<2)return!1;let[s,n,...a]=r;if(!e(s)&&!Number.isInteger(s)||!i(n))return!1;let o=a.length,l=!0;switch(n.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return 0===o;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(4!==o)return!1;l=!1;break;default:return!1}for(let e of a)if(!("number"==typeof e||l&&null===e))return!1;return!0}).bind(null,en,e=>"object"==typeof e&&"string"==typeof e?.name);class eo{#is=new Map;#ia=Promise.resolve();postMessage(e,i){let r={data:structuredClone(e,i?{transfer:i}:null)};this.#ia.then(()=>{for(let[e]of this.#is)e.call(this,r)})}addEventListener(e,i,r=null){let s=null;if(r?.signal instanceof AbortSignal){let{signal:n}=r;if(n.aborted)return void V("LoopbackPort - cannot use an `aborted` signal.");let a=()=>this.removeEventListener(e,i);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#is.set(i,s)}removeEventListener(e,i){let r=this.#is.get(i);r?.(),this.#is.delete(i)}terminate(){for(let[,e]of this.#is)e?.();this.#is.clear()}}function el(){}function eh(e){if(e instanceof ti||e instanceof Z||e instanceof K||e instanceof tt||e instanceof Q)return e;switch(e instanceof Error||"object"==typeof e&&null!==e||G('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new ti(e.message);case"InvalidPDFException":return new Z(e.message);case"PasswordException":return new K(e.message,e.code);case"ResponseException":return new tt(e.message,e.status,e.missing);case"UnknownErrorException":return new Q(e.message,e.details)}return new Q(e.message,e.toString())}class ed{#io=new AbortController;constructor(e,i,r){this.sourceName=e,this.targetName=i,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),r.addEventListener("message",this.#il.bind(this),{signal:this.#io.signal})}#il({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream)return void this.#ih(e);if(e.callback){let i=e.callbackId,r=this.callbackCapabilities[i];if(!r)throw Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],1===e.callback)r.resolve(e.data);else{if(2!==e.callback)throw Error("Unexpected callback case");r.reject(eh(e.reason))}return}let i=this.actionHandler[e.action];if(!i)throw Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let r=this.sourceName,s=e.sourceName,n=this.comObj;return void Promise.try(i,e.data).then(function(i){n.postMessage({sourceName:r,targetName:s,callback:1,callbackId:e.callbackId,data:i})},function(i){n.postMessage({sourceName:r,targetName:s,callback:2,callbackId:e.callbackId,reason:eh(i)})})}e.streamId?this.#id(e):i(e.data)}on(e,i){let r=this.actionHandler;if(r[e])throw Error(`There is already an actionName called "${e}"`);r[e]=i}send(e,i,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:i},r)}sendWithPromise(e,i,r){let s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:i},r)}catch(e){n.reject(e)}return n.promise}sendWithStream(e,i,r,s){let n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:r=>{let h=Promise.withResolvers();return this.streamControllers[n]={controller:r,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:n,data:i,desiredSize:r.desiredSize},s),h.promise},pull:e=>{let i=Promise.withResolvers();return this.streamControllers[n].pullCall=i,l.postMessage({sourceName:a,targetName:o,stream:6,streamId:n,desiredSize:e.desiredSize}),i.promise},cancel:e=>{W(e instanceof Error,"cancel must have a valid reason");let i=Promise.withResolvers();return this.streamControllers[n].cancelCall=i,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:1,streamId:n,reason:eh(e)}),i.promise}},r)}#id(e){let i=e.streamId,r=this.sourceName,s=e.sourceName,n=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(e,a=1,o){if(this.isCancelled)return;let l=this.desiredSize;this.desiredSize-=a,l>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:r,targetName:s,stream:4,streamId:i,chunk:e},o)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:r,targetName:s,stream:3,streamId:i}),delete a.streamSinks[i])},error(e){W(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:r,targetName:s,stream:5,streamId:i,reason:eh(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[i]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:r,targetName:s,stream:8,streamId:i,success:!0})},function(e){n.postMessage({sourceName:r,targetName:s,stream:8,streamId:i,reason:eh(e)})})}#ih(e){let i=e.streamId,r=this.sourceName,s=e.sourceName,n=this.comObj,a=this.streamControllers[i],o=this.streamSinks[i];switch(e.stream){case 8:e.success?a.startCall.resolve():a.startCall.reject(eh(e.reason));break;case 7:e.success?a.pullCall.resolve():a.pullCall.reject(eh(e.reason));break;case 6:if(!o){n.postMessage({sourceName:r,targetName:s,stream:7,streamId:i,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||el).then(function(){n.postMessage({sourceName:r,targetName:s,stream:7,streamId:i,success:!0})},function(e){n.postMessage({sourceName:r,targetName:s,stream:7,streamId:i,reason:eh(e)})});break;case 4:if(W(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case 3:if(W(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#ic(a,i);break;case 5:W(a,"error should have stream controller"),a.controller.error(eh(e.reason)),this.#ic(a,i);break;case 2:e.success?a.cancelCall.resolve():a.cancelCall.reject(eh(e.reason)),this.#ic(a,i);break;case 1:if(!o)break;let l=eh(e.reason);Promise.try(o.onCancel||el,l).then(function(){n.postMessage({sourceName:r,targetName:s,stream:2,streamId:i,success:!0})},function(e){n.postMessage({sourceName:r,targetName:s,stream:2,streamId:i,reason:eh(e)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[i];break;default:throw Error("Unexpected stream case")}}async #ic(e,i){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[i]}destroy(){this.#io?.abort(),this.#io=null}}class ec{#iu=!1;constructor({enableHWA:e=!1}){this.#iu=e}create(e,i){if(e<=0||i<=0)throw Error("Invalid canvas size");let r=this._createCanvas(e,i);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!this.#iu})}}reset(e,i,r){if(!e.canvas)throw Error("Canvas is not specified");if(i<=0||r<=0)throw Error("Invalid canvas size");e.canvas.width=i,e.canvas.height=r}destroy(e){if(!e.canvas)throw Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,i){G("Abstract method `_createCanvas` called.")}}class eu extends ec{constructor({ownerDocument:e=globalThis.document,enableHWA:i=!1}){super({enableHWA:i}),this._document=e}_createCanvas(e,i){let r=this._document.createElement("canvas");return r.width=e,r.height=i,r}}class ep{constructor({baseUrl:e=null,isCompressed:i=!0}){this.baseUrl=e,this.isCompressed=i}async fetch({name:e}){if(!this.baseUrl)throw Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw Error("CMap name must be specified.");let i=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(i).then(e=>({cMapData:e,isCompressed:this.isCompressed})).catch(e=>{throw Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})}async _fetch(e){G("Abstract method `_fetch` called.")}}class ef extends ep{async _fetch(e){let i=await ty(e,this.isCompressed?"arraybuffer":"text");return i instanceof ArrayBuffer?new Uint8Array(i):ts(i)}}k(2489);class eg{addFilter(e){return"none"}addHCMFilter(e,i){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,i,r,s,n){return"none"}destroy(e=!1){}}class em extends eg{#ip;#ig;#im;#ib;#iv;#iy;#w=0;constructor({docId:e,ownerDocument:i=globalThis.document}){super(),this.#ib=e,this.#iv=i}get #x(){return this.#ig||=new Map}get #i_(){return this.#iy||=new Map}get #iw(){if(!this.#im){let e=this.#iv.createElement("div"),{style:i}=e;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;let r=this.#iv.createElementNS(tb,"svg");r.setAttribute("width",0),r.setAttribute("height",0),this.#im=this.#iv.createElementNS(tb,"defs"),e.append(r),r.append(this.#im),this.#iv.body.append(e)}return this.#im}#iA(e){if(1===e.length){let i=e[0],r=Array(256);for(let e=0;e<256;e++)r[e]=i[e]/255;let s=r.join(",");return[s,s,s]}let[i,r,s]=e,n=Array(256),a=Array(256),o=Array(256);for(let e=0;e<256;e++)n[e]=i[e]/255,a[e]=r[e]/255,o[e]=s[e]/255;return[n.join(","),a.join(","),o.join(",")]}#ix(e){if(void 0===this.#ip){this.#ip="";let e=this.#iv.URL;e!==this.#iv.baseURI&&(tA(e)?V('#createUrl: ignore "data:"-URL for performance reasons.'):this.#ip=X(e,""))}return`url(${this.#ip}#${e})`}addFilter(e){if(!e)return"none";let i=this.#x.get(e);if(i)return i;let[r,s,n]=this.#iA(e),a=1===e.length?r:`${r}${s}${n}`;if(i=this.#x.get(a))return this.#x.set(e,i),i;let o=`g_${this.#ib}_transfer_map_${this.#w++}`,l=this.#ix(o);this.#x.set(e,l),this.#x.set(a,l);let h=this.#iS(o);return this.#iE(r,s,n,h),l}addHCMFilter(e,i){let r=`${e}-${i}`,s="base",n=this.#i_.get(s);if(n?.key===r||(n?(n.filter?.remove(),n.key=r,n.url="none",n.filter=null):(n={key:r,url:"none",filter:null},this.#i_.set(s,n)),!e||!i))return n.url;let a=this.#iC(e);e=to.makeHexColor(...a);let o=this.#iC(i);if(i=to.makeHexColor(...o),this.#iw.style.color="","#000000"===e&&"#ffffff"===i||e===i)return n.url;let l=Array(256);for(let e=0;e<=255;e++){let i=e/255;l[e]=i<=.03928?i/12.92:((i+.055)/1.055)**2.4}let h=l.join(","),d=`g_${this.#ib}_hcm_filter`,c=n.filter=this.#iS(d);this.#iE(h,h,h,c),this.#iT(c);let u=(e,i)=>{let r=a[e]/255,s=o[e]/255,n=Array(i+1);for(let e=0;e<=i;e++)n[e]=r+e/i*(s-r);return n.join(",")};return this.#iE(u(0,5),u(1,5),u(2,5),c),n.url=this.#ix(d),n.url}addAlphaFilter(e){let i=this.#x.get(e);if(i)return i;let[r]=this.#iA([e]),s=`alpha_${r}`;if(i=this.#x.get(s))return this.#x.set(e,i),i;let n=`g_${this.#ib}_alpha_map_${this.#w++}`,a=this.#ix(n);this.#x.set(e,a),this.#x.set(s,a);let o=this.#iS(n);return this.#iM(r,o),a}addLuminosityFilter(e){let i,r,s=this.#x.get(e||"luminosity");if(s)return s;if(e?([i]=this.#iA([e]),r=`luminosity_${i}`):r="luminosity",s=this.#x.get(r))return this.#x.set(e,s),s;let n=`g_${this.#ib}_luminosity_map_${this.#w++}`,a=this.#ix(n);this.#x.set(e,a),this.#x.set(r,a);let o=this.#iS(n);return this.#ik(o),e&&this.#iM(i,o),a}addHighlightHCMFilter(e,i,r,s,n){let a=`${i}-${r}-${s}-${n}`,o=this.#i_.get(e);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},this.#i_.set(e,o)),!i||!r))return o.url;let[l,h]=[i,r].map(this.#iC.bind(this)),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),c=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[u,p]=[s,n].map(this.#iC.bind(this));c<d&&([d,c,u,p]=[c,d,p,u]),this.#iw.style.color="";let f=(e,i,r)=>{let s=Array(256),n=(c-d)/r,a=e/255,o=(i-e)/(255*r),l=0;for(let e=0;e<=r;e++){let i=Math.round(d+e*n),r=a+e*o;for(let e=l;e<=i;e++)s[e]=r;l=i+1}for(let e=l;e<256;e++)s[e]=s[l-1];return s.join(",")},g=`g_${this.#ib}_hcm_${e}_filter`,m=o.filter=this.#iS(g);return this.#iT(m),this.#iE(f(u[0],p[0],5),f(u[1],p[1],5),f(u[2],p[2],5),m),o.url=this.#ix(g),o.url}destroy(e=!1){e&&this.#iy?.size||(this.#im?.parentNode.parentNode.remove(),this.#im=null,this.#ig?.clear(),this.#ig=null,this.#iy?.clear(),this.#iy=null,this.#w=0)}#ik(e){let i=this.#iv.createElementNS(tb,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(i)}#iT(e){let i=this.#iv.createElementNS(tb,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(i)}#iS(e){let i=this.#iv.createElementNS(tb,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",e),this.#iw.append(i),i}#iI(e,i,r){let s=this.#iv.createElementNS(tb,i);s.setAttribute("type","discrete"),s.setAttribute("tableValues",r),e.append(s)}#iE(e,i,r,s){let n=this.#iv.createElementNS(tb,"feComponentTransfer");s.append(n),this.#iI(n,"feFuncR",e),this.#iI(n,"feFuncG",i),this.#iI(n,"feFuncB",r)}#iM(e,i){let r=this.#iv.createElementNS(tb,"feComponentTransfer");i.append(r),this.#iI(r,"feFuncA",e)}#iC(e){return this.#iw.style.color=e,tR(getComputedStyle(this.#iw).getPropertyValue("color"))}}class eb{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw Error("Font filename must be specified.");let i=`${this.baseUrl}${e}`;return this._fetch(i).catch(e=>{throw Error(`Unable to load font data at: ${i}`)})}async _fetch(e){G("Abstract method `_fetch` called.")}}class ev extends eb{async _fetch(e){return new Uint8Array(await ty(e,"arraybuffer"))}}class ey{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw Error("Wasm filename must be specified.");let i=`${this.baseUrl}${e}`;return this._fetch(i).catch(e=>{throw Error(`Unable to load wasm data at: ${i}`)})}async _fetch(e){G("Abstract method `_fetch` called.")}}class e_ extends ey{async _fetch(e){return new Uint8Array(await ty(e,"arraybuffer"))}}if(I){let e;try{let i=process.getBuiltinModule("module").createRequire("undefined"==typeof document?r(17360).pathToFileURL(__filename).href:C&&"SCRIPT"===C.tagName.toUpperCase()&&C.src||new URL("index.cjs",document.baseURI).href);try{e=i("@napi-rs/canvas")}catch(e){V(`Cannot load "@napi-rs/canvas" package: "${e}".`)}}catch(e){V(`Cannot access the \`require\` function: "${e}".`)}globalThis.DOMMatrix||(e?.DOMMatrix?globalThis.DOMMatrix=e.DOMMatrix:V("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(e?.ImageData?globalThis.ImageData=e.ImageData:V("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(e?.Path2D?globalThis.Path2D=e.Path2D:V("Cannot polyfill `Path2D`, rendering may be broken.")),globalThis.navigator?.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function ew(e){let i=process.getBuiltinModule("fs");return new Uint8Array(await i.promises.readFile(e))}class eA extends eg{}class ex extends ec{_createCanvas(e,i){return process.getBuiltinModule("module").createRequire("undefined"==typeof document?r(17360).pathToFileURL(__filename).href:C&&"SCRIPT"===C.tagName.toUpperCase()&&C.src||new URL("index.cjs",document.baseURI).href)("@napi-rs/canvas").createCanvas(e,i)}}class eS extends ep{async _fetch(e){return ew(e)}}class eE extends eb{async _fetch(e){return ew(e)}}class eC extends ey{async _fetch(e){return ew(e)}}k(7588);let eT="__forcedDependency",{floor:eM,ceil:ek}=Math;function eI(e,i,r,s,n,a){e[4*i+0]=Math.min(e[4*i+0],r),e[4*i+1]=Math.min(e[4*i+1],s),e[4*i+2]=Math.max(e[4*i+2],n),e[4*i+3]=Math.max(e[4*i+3],a)}let eD=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class eR{#iD;#iR;constructor(e,i){this.#iD=e,this.#iR=i}get length(){return this.#iD.length}isEmpty(e){return this.#iD[e]===eD}minX(e){return this.#iR[4*e+0]/256}minY(e){return this.#iR[4*e+1]/256}maxX(e){return(this.#iR[4*e+2]+1)/256}maxY(e){return(this.#iR[4*e+3]+1)/256}}let eP=(e,i)=>{if(!e)return;let r=e.get(i);return r||(r={dependencies:new Set,isRenderingOperation:!1},e.set(i,r)),r};class eL{#iP={__proto__:null};#iL={__proto__:null,transform:[],moveText:[],sameLineText:[],[eT]:[]};#iN=new Map;#iO=[];#iF=[];#iB=[[1,0,0,1,0,0]];#iU=[-1/0,-1/0,1/0,1/0];#ij=new Float64Array([1/0,1/0,-1/0,-1/0]);#i$=-1;#iH=new Set;#iz=new Map;#iV=new Map;#iG;#iW;#iq;#iD;#iX;constructor(e,i,r=!1){this.#iG=e.width,this.#iW=e.height,this.#iY(i),r&&(this.#iX=new Map)}growOperationsCount(e){e>=this.#iD.length&&this.#iY(e,this.#iD)}#iY(e,i){let r=new ArrayBuffer(4*e);this.#iq=new Uint8ClampedArray(r),this.#iD=new Uint32Array(r),i&&i.length>0?(this.#iD.set(i),this.#iD.fill(eD,i.length)):this.#iD.fill(eD)}save(e){return this.#iP={__proto__:this.#iP},this.#iL={__proto__:this.#iL,transform:{__proto__:this.#iL.transform},moveText:{__proto__:this.#iL.moveText},sameLineText:{__proto__:this.#iL.sameLineText},[eT]:{__proto__:this.#iL[eT]}},this.#iU={__proto__:this.#iU},this.#iO.push(e),this}restore(e){let i=Object.getPrototypeOf(this.#iP);if(null===i)return this;this.#iP=i,this.#iL=Object.getPrototypeOf(this.#iL),this.#iU=Object.getPrototypeOf(this.#iU);let r=this.#iO.pop();return void 0!==r&&(eP(this.#iX,e)?.dependencies.add(r),this.#iD[e]=this.#iD[r]),this}recordOpenMarker(e){return this.#iO.push(e),this}getOpenMarker(){return 0===this.#iO.length?null:this.#iO.at(-1)}recordCloseMarker(e){let i=this.#iO.pop();return void 0!==i&&(eP(this.#iX,e)?.dependencies.add(i),this.#iD[e]=this.#iD[i]),this}beginMarkedContent(e){return this.#iF.push(e),this}endMarkedContent(e){let i=this.#iF.pop();return void 0!==i&&(eP(this.#iX,e)?.dependencies.add(i),this.#iD[e]=this.#iD[i]),this}pushBaseTransform(e){return this.#iB.push(to.multiplyByDOMMatrix(this.#iB.at(-1),e.getTransform())),this}popBaseTransform(){return this.#iB.length>1&&this.#iB.pop(),this}recordSimpleData(e,i){return this.#iP[e]=i,this}recordIncrementalData(e,i){return this.#iL[e].push(i),this}resetIncrementalData(e,i){return this.#iL[e].length=0,this}recordNamedData(e,i){return this.#iN.set(e,i),this}recordSimpleDataFromNamed(e,i,r){this.#iP[e]=this.#iN.get(i)??r}recordFutureForcedDependency(e,i){return this.recordIncrementalData(eT,i),this}inheritSimpleDataAsFutureForcedDependencies(e){for(let i of e)i in this.#iP&&this.recordFutureForcedDependency(i,this.#iP[i]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(let e of this.#iH)this.recordFutureForcedDependency(eT,e);return this}resetBBox(e){return this.#i$!==e&&(this.#i$=e,this.#ij[0]=1/0,this.#ij[1]=1/0,this.#ij[2]=-1/0,this.#ij[3]=-1/0),this}recordClipBox(e,i,r,s,n,a){let o=to.multiplyByDOMMatrix(this.#iB.at(-1),i.getTransform()),l=[1/0,1/0,-1/0,-1/0];to.axialAlignedBoundingBox([r,n,s,a],o,l);let h=to.intersect(this.#iU,l);return h?(this.#iU[0]=h[0],this.#iU[1]=h[1],this.#iU[2]=h[2],this.#iU[3]=h[3]):(this.#iU[0]=this.#iU[1]=1/0,this.#iU[2]=this.#iU[3]=-1/0),this}recordBBox(e,i,r,s,n,a){let o=this.#iU;if(o[0]===1/0)return this;let l=to.multiplyByDOMMatrix(this.#iB.at(-1),i.getTransform());if(o[0]===-1/0)return to.axialAlignedBoundingBox([r,n,s,a],l,this.#ij),this;let h=[1/0,1/0,-1/0,-1/0];return to.axialAlignedBoundingBox([r,n,s,a],l,h),this.#ij[0]=Math.min(this.#ij[0],Math.max(h[0],o[0])),this.#ij[1]=Math.min(this.#ij[1],Math.max(h[1],o[1])),this.#ij[2]=Math.max(this.#ij[2],Math.min(h[2],o[2])),this.#ij[3]=Math.max(this.#ij[3],Math.min(h[3],o[3])),this}recordCharacterBBox(e,i,r,s=1,n=0,a=0,o){let l,h;let d=r.bbox;if(d&&!1!==(l=d[2]!==d[0]&&d[3]!==d[1]&&this.#iV.get(r))&&(h=[0,0,0,0],to.axialAlignedBoundingBox(d,r.fontMatrix,h),1===s&&0===n&&0===a||to.scaleMinMax([s,0,0,-s,n,a],h),l))return this.recordBBox(e,i,h[0],h[2],h[1],h[3]);if(!o)return this.recordFullPageBBox(e);let c=o();return d&&h&&void 0===l&&(l=h[0]<=n-c.actualBoundingBoxLeft&&h[2]>=n+c.actualBoundingBoxRight&&h[1]<=a-c.actualBoundingBoxAscent&&h[3]>=a+c.actualBoundingBoxDescent,this.#iV.set(r,l),l)?this.recordBBox(e,i,h[0],h[2],h[1],h[3]):this.recordBBox(e,i,n-c.actualBoundingBoxLeft,n+c.actualBoundingBoxRight,a-c.actualBoundingBoxAscent,a+c.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#ij[0]=Math.max(0,this.#iU[0]),this.#ij[1]=Math.max(0,this.#iU[1]),this.#ij[2]=Math.min(this.#iG,this.#iU[2]),this.#ij[3]=Math.min(this.#iW,this.#iU[3]),this}getSimpleIndex(e){return this.#iP[e]}recordDependencies(e,i){let r=this.#iH,s=this.#iP,n=this.#iL;for(let e of i)e in this.#iP?r.add(s[e]):e in n&&n[e].forEach(r.add,r);return this}recordNamedDependency(e,i){return this.#iN.has(i)&&this.#iH.add(this.#iN.get(i)),this}recordOperation(e,i=!1){if(this.recordDependencies(e,[eT]),this.#iX){let i=eP(this.#iX,e),{dependencies:r}=i;this.#iH.forEach(r.add,r),this.#iO.forEach(r.add,r),this.#iF.forEach(r.add,r),r.delete(e),i.isRenderingOperation=!0}if(this.#i$===e){let r=eM(256*this.#ij[0]/this.#iG),s=eM(256*this.#ij[1]/this.#iW),n=ek(256*this.#ij[2]/this.#iG),a=ek(256*this.#ij[3]/this.#iW);for(let i of(eI(this.#iq,e,r,s,n,a),this.#iH))i!==e&&eI(this.#iq,i,r,s,n,a);for(let i of this.#iO)i!==e&&eI(this.#iq,i,r,s,n,a);for(let i of this.#iF)i!==e&&eI(this.#iq,i,r,s,n,a);i||(this.#iH.clear(),this.#i$=-1)}return this}recordShowTextOperation(e,i=!1){let r=Array.from(this.#iH);for(let s of(this.recordOperation(e,i),this.recordIncrementalData("sameLineText",e),r))this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(e,i=!1){return this.#i$===e&&(this.#i$=-1,this.#iU[0]=Math.max(this.#iU[0],this.#ij[0]),this.#iU[1]=Math.max(this.#iU[1],this.#ij[1]),this.#iU[2]=Math.min(this.#iU[2],this.#ij[2]),this.#iU[3]=Math.min(this.#iU[3],this.#ij[3]),i||this.#iH.clear()),this}_takePendingDependencies(){let e=this.#iH;return this.#iH=new Set,e}_extractOperation(e){let i=this.#iz.get(e);return this.#iz.delete(e),i}_pushPendingDependencies(e){for(let i of e)this.#iH.add(i)}take(){return this.#iV.clear(),new eR(this.#iD,this.#iq)}takeDebugMetadata(){return this.#iX}}class eN{#iJ;#iK;#iQ;#iZ=0;#i0=0;constructor(e,i,r){if(e instanceof eN&&!!r===e.#iQ)return e;this.#iJ=e,this.#iK=i,this.#iQ=!!r}growOperationsCount(){throw Error("Unreachable")}save(e){return this.#i0++,this.#iJ.save(this.#iK),this}restore(e){return this.#i0>0&&(this.#iJ.restore(this.#iK),this.#i0--),this}recordOpenMarker(e){return this.#iZ++,this}getOpenMarker(){return this.#iZ>0?this.#iK:this.#iJ.getOpenMarker()}recordCloseMarker(e){return this.#iZ--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#iJ.pushBaseTransform(e),this}popBaseTransform(){return this.#iJ.popBaseTransform(),this}recordSimpleData(e,i){return this.#iJ.recordSimpleData(e,this.#iK),this}recordIncrementalData(e,i){return this.#iJ.recordIncrementalData(e,this.#iK),this}resetIncrementalData(e,i){return this.#iJ.resetIncrementalData(e,this.#iK),this}recordNamedData(e,i){return this}recordSimpleDataFromNamed(e,i,r){return this.#iJ.recordSimpleDataFromNamed(e,i,this.#iK),this}recordFutureForcedDependency(e,i){return this.#iJ.recordFutureForcedDependency(e,this.#iK),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#iJ.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#iJ.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#iQ||this.#iJ.resetBBox(this.#iK),this}recordClipBox(e,i,r,s,n,a){return this.#iQ||this.#iJ.recordClipBox(this.#iK,i,r,s,n,a),this}recordBBox(e,i,r,s,n,a){return this.#iQ||this.#iJ.recordBBox(this.#iK,i,r,s,n,a),this}recordCharacterBBox(e,i,r,s,n,a,o){return this.#iQ||this.#iJ.recordCharacterBBox(this.#iK,i,r,s,n,a,o),this}recordFullPageBBox(e){return this.#iQ||this.#iJ.recordFullPageBBox(this.#iK),this}getSimpleIndex(e){return this.#iJ.getSimpleIndex(e)}recordDependencies(e,i){return this.#iJ.recordDependencies(this.#iK,i),this}recordNamedDependency(e,i){return this.#iJ.recordNamedDependency(this.#iK,i),this}recordOperation(e){return this.#iJ.recordOperation(this.#iK,!0),this}recordShowTextOperation(e){return this.#iJ.recordShowTextOperation(this.#iK,!0),this}bboxToClipBoxDropOperation(e){return this.#iQ||this.#iJ.bboxToClipBoxDropOperation(this.#iK,!0),this}take(){throw Error("Unreachable")}takeDebugMetadata(){throw Error("Unreachable")}}let eO=["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],eF=["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],eB=["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],eU=["filter","fillColor","fillAlpha"],ej=["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],e$=["transform"],eH=["transform","fillColor"],ez="Fill",eV="Stroke",eG="Shading";function eW(e,i){if(!i)return;let r=i[2]-i[0],s=i[3]-i[1],n=new Path2D;n.rect(i[0],i[1],r,s),e.clip(n)}class eq{isModifyingCurrentTransform(){return!1}getPattern(){G("Abstract method `getPattern` called.")}}class eX extends eq{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let i;for(let r of("axial"===this._type?i=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(i=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)),this._colorStops))i.addColorStop(r[0],r[1]);return i}getPattern(e,i,r,s){let n;if(s===eV||s===ez){let a=i.current.getClippedPathBoundingBox(s,tP(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,h=i.cachedCanvases.getCanvas("pattern",o,l),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),r=to.transform(r,[1,0,0,1,a[0],a[1]]),d.transform(...i.baseTransform),this.matrix&&d.transform(...this.matrix),eW(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(h.canvas,"no-repeat");let c=new DOMMatrix(r);n.setTransform(c)}else eW(e,this._bbox),n=this._createGradient(e);return n}}function eY(e,i,r,s,n,a,o,l){let h,d,c,u,p,f,g,m,b;let v=i.coords,y=i.colors,_=e.data,w=4*e.width;v[r+1]>v[s+1]&&(h=r,r=s,s=h,h=a,a=o,o=h),v[s+1]>v[n+1]&&(h=s,s=n,n=h,h=o,o=l,l=h),v[r+1]>v[s+1]&&(h=r,r=s,s=h,h=a,a=o,o=h);let A=(v[r]+i.offsetX)*i.scaleX,x=(v[r+1]+i.offsetY)*i.scaleY,S=(v[s]+i.offsetX)*i.scaleX,E=(v[s+1]+i.offsetY)*i.scaleY,C=(v[n]+i.offsetX)*i.scaleX,T=(v[n+1]+i.offsetY)*i.scaleY;if(x>=T)return;let M=y[a],k=y[a+1],I=y[a+2],D=y[o],R=y[o+1],P=y[o+2],L=y[l],N=y[l+1],O=y[l+2],F=Math.round(x),B=Math.round(T);for(let e=F;e<=B;e++){let i;if(e<E){let i=e<x?0:(x-e)/(x-E);d=A-(A-S)*i,c=M-(M-D)*i,u=k-(k-R)*i,p=I-(I-P)*i}else{let i;d=S-(S-C)*(i=e>T?1:E===T?0:(E-e)/(E-T)),c=D-(D-L)*i,u=R-(R-N)*i,p=P-(P-O)*i}f=A-(A-C)*(i=e<x?0:e>T?1:(x-e)/(x-T)),g=M-(M-L)*i,m=k-(k-N)*i,b=I-(I-O)*i;let r=Math.round(Math.min(d,f)),s=Math.round(Math.max(d,f)),n=w*e+4*r;for(let e=r;e<=s;e++)(i=(d-e)/(d-f))<0?i=0:i>1&&(i=1),_[n++]=c-(c-g)*i|0,_[n++]=u-(u-m)*i|0,_[n++]=p-(p-b)*i|0,_[n++]=255}}class eJ extends eq{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,i,r){let s=Math.floor(this._bounds[0]),n=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-s,o=Math.ceil(this._bounds[3])-n,l=Math.min(Math.ceil(Math.abs(a*e[0]*1.1)),3e3),h=Math.min(Math.ceil(Math.abs(o*e[1]*1.1)),3e3),d=a/l,c=o/h,u={coords:this._coords,colors:this._colors,offsetX:-s,offsetY:-n,scaleX:1/d,scaleY:1/c},p=l+4,f=h+4,g=r.getCanvas("mesh",p,f),m=g.context,b=m.createImageData(l,h);if(i){let e=b.data;for(let r=0,s=e.length;r<s;r+=4)e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2],e[r+3]=255}for(let e of this._figures)!function(e,i,r){let s,n;let a=i.coords,o=i.colors;switch(i.type){case"lattice":let l=i.verticesPerRow,h=Math.floor(a.length/l)-1,d=l-1;for(s=0;s<h;s++){let i=s*l;for(let s=0;s<d;s++,i++)eY(e,r,a[i],a[i+1],a[i+l],o[i],o[i+1],o[i+l]),eY(e,r,a[i+l+1],a[i+1],a[i+l],o[i+l+1],o[i+1],o[i+l])}break;case"triangles":for(s=0,n=a.length;s<n;s+=3)eY(e,r,a[s],a[s+1],a[s+2],o[s],o[s+1],o[s+2]);break;default:throw Error("illegal figure")}}(b,e,u);return m.putImageData(b,2,2),{canvas:g.canvas,offsetX:s-2*d,offsetY:n-2*c,scaleX:d,scaleY:c}}isModifyingCurrentTransform(){return!0}getPattern(e,i,r,s){eW(e,this._bbox);let n=new Float32Array(2);if(s===eG)to.singularValueDecompose2dScale(tP(e),n);else if(this.matrix){to.singularValueDecompose2dScale(this.matrix,n);let[e,r]=n;to.singularValueDecompose2dScale(i.baseTransform,n),n[0]*=e,n[1]*=r}else to.singularValueDecompose2dScale(i.baseTransform,n);let a=this._createMeshCanvas(n,s===eG?null:this._background,i.cachedCanvases);return s!==eG&&(e.setTransform(...i.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class eK extends eq{getPattern(){return"hotpink"}}class eQ{static MAX_PATTERN_SIZE=3e3;constructor(e,i,r,s){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=i,this.canvasGraphicsFactory=r,this.baseTransform=s}createPatternCanvas(e,i){let{bbox:r,operatorList:s,paintType:n,tilingType:a,color:o,canvasGraphicsFactory:l}=this,{xstep:h,ystep:d}=this;h=Math.abs(h),d=Math.abs(d),z("TilingType: "+a);let c=r[0],u=r[1],p=r[2],f=r[3],g=p-c,m=f-u,b=new Float32Array(2);to.singularValueDecompose2dScale(this.matrix,b);let[v,y]=b;to.singularValueDecompose2dScale(this.baseTransform,b);let _=v*b[0],w=y*b[1],A=g,x=m,S=!1,E=!1,C=Math.ceil(d*w);Math.ceil(h*_)>=Math.ceil(g*_)?A=h:S=!0,C>=Math.ceil(m*w)?x=d:E=!0;let T=this.getSizeAndScale(A,this.ctx.canvas.width,_),M=this.getSizeAndScale(x,this.ctx.canvas.height,w),k=e.cachedCanvases.getCanvas("pattern",T.size,M.size),I=k.context,D=l.createCanvasGraphics(I,i);if(D.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(D,n,o),I.translate(-T.scale*c,-M.scale*u),D.transform(0,T.scale,0,0,M.scale,0,0),I.save(),D.dependencyTracker?.save(),this.clipBbox(D,c,u,p,f),D.baseTransform=tP(D.ctx),D.executeOperatorList(s),D.endDrawing(),D.dependencyTracker?.restore(),I.restore(),S||E){let i=k.canvas;S&&(A=h),E&&(x=d);let r=this.getSizeAndScale(A,this.ctx.canvas.width,_),s=this.getSizeAndScale(x,this.ctx.canvas.height,w),n=r.size,a=s.size,o=e.cachedCanvases.getCanvas("pattern-workaround",n,a),l=o.context,p=S?Math.floor(g/h):0,f=E?Math.floor(m/d):0;for(let e=0;e<=p;e++)for(let r=0;r<=f;r++)l.drawImage(i,n*e,a*r,n,a,0,0,n,a);return{canvas:o.canvas,scaleX:r.scale,scaleY:s.scale,offsetX:c,offsetY:u}}return{canvas:k.canvas,scaleX:T.scale,scaleY:M.scale,offsetX:c,offsetY:u}}getSizeAndScale(e,i,r){let s=Math.max(eQ.MAX_PATTERN_SIZE,i),n=Math.ceil(e*r);return n>=s?n=s:r=n/e,{scale:r,size:n}}clipBbox(e,i,r,s,n){let a=s-i,o=n-r;e.ctx.rect(i,r,a,o),to.axialAlignedBoundingBox([i,r,s,n],tP(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,i,r){let s=e.ctx,n=e.current;switch(i){case 1:let{fillStyle:a,strokeStyle:o}=this.ctx;s.fillStyle=n.fillColor=a,s.strokeStyle=n.strokeColor=o;break;case 2:s.fillStyle=s.strokeStyle=r,n.fillColor=n.strokeColor=r;break;default:throw new te(`Unsupported paint type: ${i}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,i,r,s,n){let a=r;s!==eG&&(a=to.transform(a,i.baseTransform),this.matrix&&(a=to.transform(a,this.matrix)));let o=this.createPatternCanvas(i,n),l=new DOMMatrix(a);l=(l=l.translate(o.offsetX,o.offsetY)).scale(1/o.scaleX,1/o.scaleY);let h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}}let eZ=new DOMMatrix,e0=new Float32Array(2),e1=new Float32Array([1/0,1/0,-1/0,-1/0]);class e2{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,i,r){let s;return void 0!==this.cache[e]?(s=this.cache[e],this.canvasFactory.reset(s,i,r)):(s=this.canvasFactory.create(i,r),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let i=this.cache[e];this.canvasFactory.destroy(i),delete this.cache[e]}}}function e5(e,i,r,s,n,a,o,l,h,d){let[c,u,p,f,g,m]=tP(e);if(0===u&&0===p){let b=Math.round(o*c+g),v=Math.round(l*f+m),y=Math.abs(Math.round((o+h)*c+g)-b)||1,_=Math.abs(Math.round((l+d)*f+m)-v)||1;return e.setTransform(Math.sign(c),0,0,Math.sign(f),b,v),e.drawImage(i,r,s,n,a,0,0,y,_),e.setTransform(c,u,p,f,g,m),[y,_]}if(0===c&&0===f){let b=Math.round(l*p+g),v=Math.round(o*u+m),y=Math.abs(Math.round((l+d)*p+g)-b)||1,_=Math.abs(Math.round((o+h)*u+m)-v)||1;return e.setTransform(0,Math.sign(u),Math.sign(p),0,b,v),e.drawImage(i,r,s,n,a,0,0,_,y),e.setTransform(c,u,p,f,g,m),[_,y]}return e.drawImage(i,r,s,n,a,o,l,h,d),[Math.hypot(c,u)*h,Math.hypot(p,f)*d]}class e4{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=D;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=0;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,i,r){r?.(this),this.clipBox=new Float32Array([0,0,e,i]),this.minMax=e1.slice()}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=ez,i=null){let r=this.minMax.slice();if(e===eV){i||G("Stroke bounding box must include transform."),to.singularValueDecompose2dScale(i,e0);let e=e0[0]*this.lineWidth/2,s=e0[1]*this.lineWidth/2;r[0]-=e,r[1]-=s,r[2]+=e,r[3]+=s}return r}updateClipFromPath(){let e=to.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(e1,0)}getClippedPathBoundingBox(e=ez,i=null){return to.intersect(this.clipBox,this.getPathBoundingBox(e,i))}}function e3(e,i){let r,s,n,a;if(i instanceof ImageData)return void e.putImageData(i,0,0);let o=i.height,l=i.width,h=o%16,d=(o-h)/16,c=0===h?d:d+1,u=e.createImageData(l,16),p,f=0,g=i.data,m=u.data;if(i.kind===F.GRAYSCALE_1BPP){let i=g.byteLength,a=new Uint32Array(m.buffer,0,m.byteLength>>2),o=a.length,b=l+7>>3,v=tn.isLittleEndian?4278190080:255;for(r=0;r<c;r++){for(n=r<d?16:h,p=0,s=0;s<n;s++){let e=i-f,r=0,s=e>b?l:8*e-7,n=-8&s,o=0,h=0;for(;r<n;r+=8)h=g[f++],a[p++]=128&h?4294967295:v,a[p++]=64&h?4294967295:v,a[p++]=32&h?4294967295:v,a[p++]=16&h?4294967295:v,a[p++]=8&h?4294967295:v,a[p++]=4&h?4294967295:v,a[p++]=2&h?4294967295:v,a[p++]=1&h?4294967295:v;for(;r<s;r++)0===o&&(h=g[f++],o=128),a[p++]=h&o?4294967295:v,o>>=1}for(;p<o;)a[p++]=0;e.putImageData(u,0,16*r)}}else if(i.kind===F.RGBA_32BPP){for(s=0,a=64*l,r=0;r<d;r++)m.set(g.subarray(f,f+a)),f+=a,e.putImageData(u,0,s),s+=16;r<c&&(a=l*h*4,m.set(g.subarray(f,f+a)),e.putImageData(u,0,s))}else{if(i.kind!==F.RGB_24BPP)throw Error(`bad image kind: ${i.kind}`);for(a=l*(n=16),r=0;r<c;r++){for(r>=d&&(a=l*(n=h)),p=0,s=a;s--;)m[p++]=g[f++],m[p++]=g[f++],m[p++]=g[f++],m[p++]=255;e.putImageData(u,0,16*r)}}}function e6(e,i){if(i.bitmap)return void e.drawImage(i.bitmap,0,0);let r=i.height,s=i.width,n=r%16,a=(r-n)/16,o=0===n?a:a+1,l=e.createImageData(s,16),h=0,d=i.data,c=l.data;for(let i=0;i<o;i++){let r=i<a?16:n;({srcPos:h}=function({src:e,srcPos:i=0,dest:r,width:s,height:n,nonBlackColor:a=4294967295,inverseDecode:o=!1}){let l=tn.isLittleEndian?4278190080:255,[h,d]=o?[a,l]:[l,a],c=s>>3,u=7&s,p=e.length;r=new Uint32Array(r.buffer);let f=0;for(let s=0;s<n;s++){for(let s=i+c;i<s;i++){let s=i<p?e[i]:255;r[f++]=128&s?d:h,r[f++]=64&s?d:h,r[f++]=32&s?d:h,r[f++]=16&s?d:h,r[f++]=8&s?d:h,r[f++]=4&s?d:h,r[f++]=2&s?d:h,r[f++]=1&s?d:h}if(0===u)continue;let s=i<p?e[i++]:255;for(let e=0;e<u;e++)r[f++]=s&1<<7-e?d:h}return{srcPos:i,destPos:f}}({src:d,srcPos:h,dest:c,width:s,height:r,nonBlackColor:0})),e.putImageData(l,0,16*i)}}function e9(e,i){for(let r of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==e[r]&&(i[r]=e[r]);void 0!==e.setLineDash&&(i.setLineDash(e.getLineDash()),i.lineDashOffset=e.lineDashOffset)}function e8(e){e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0);let{filter:i}=e;"none"!==i&&""!==i&&(e.filter="none")}function e7(e,i){if(i)return!0;to.singularValueDecompose2dScale(e,e0);let r=Math.fround(tO.pixelRatio*tv.PDF_TO_CSS_UNITS);return e0[0]<=r&&e0[1]<=r}let it=["butt","round","square"],ie=["miter","round","bevel"],ii={},ir={};class is{constructor(e,i,r,s,n,{optionalContentConfig:a,markedContentStack:o=null},l,h,d){this.ctx=e,this.current=new e4(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=i,this.objs=r,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new e2(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=d??null}getObject(e,i,r=null){return"string"==typeof i?(this.dependencyTracker?.recordNamedDependency(e,i),i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i)):r}beginDrawing({transform:e,viewport:i,transparency:r=!1,background:s=null}){let n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,r){let e=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...tP(this.compositeCtx))}this.ctx.save(),e8(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...i.transform),this.viewportScale=i.scale,this.baseTransform=tP(this.ctx)}executeOperatorList(e,i,r,s,n){let a,o;let l=e.argsArray,h=e.fnArray,d=i||0,c=l.length;if(c===d)return d;let u=c-d>10&&"function"==typeof r,p=u?Date.now()+15:0,f=0,g=this.commonObjs,m=this.objs;for(;;){if(void 0!==s&&d===s.nextBreakPoint)return s.breakIt(d,r),d;if(!n||n(d)){if(a=h[d],o=l[d]??null,a!==j.dependency)null===o?this[a](d):this[a](d,...o);else for(let e of o){this.dependencyTracker?.recordNamedData(e,d);let i=e.startsWith("g_")?g:m;if(!i.has(e))return i.get(e,r),d}}if(++d===c)return d;if(u&&++f>10){if(Date.now()>p)return r(),d;f=0}}}#i1(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){for(let e of(this.#i1(),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this._cachedBitmapsMap.values())){for(let i of e.values())"undefined"!=typeof HTMLCanvasElement&&i instanceof HTMLCanvasElement&&(i.width=i.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#i2()}#i2(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){let i=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=i}}}_scaleImage(e,i){let r=e.width??e.displayWidth,s=e.height??e.displayHeight,n,a,o=Math.max(Math.hypot(i[0],i[1]),1),l=Math.max(Math.hypot(i[2],i[3]),1),h=r,d=s,c="prescale1";for(;o>2&&h>1||l>2&&d>1;){let i=h,r=d;o>2&&h>1&&(i=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),o/=h/i),l>2&&d>1&&(r=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,l/=d/r),(a=(n=this.cachedCanvases.getCanvas(c,i,r)).context).clearRect(0,0,i,r),a.drawImage(e,0,0,h,d,0,0,i,r),e=n.canvas,h=i,d=r,c="prescale1"===c?"prescale2":"prescale1"}return{img:e,paintWidth:h,paintHeight:d}}_createMaskCanvas(e,i){let r,s,n,a;let o=this.ctx,{width:l,height:h}=i,d=this.current.fillColor,c=this.current.patternFill,u=tP(o);if((i.bitmap||i.data)&&i.count>1){let a=i.bitmap||i.data.buffer;s=JSON.stringify(c?u:[u.slice(0,4),d]),(r=this._cachedBitmapsMap.get(a))||(r=new Map,this._cachedBitmapsMap.set(a,r));let o=r.get(s);if(o&&!c){let i=Math.round(Math.min(u[0],u[2])+u[4]),r=Math.round(Math.min(u[1],u[3])+u[5]);return this.dependencyTracker?.recordDependencies(e,eH),{canvas:o,offsetX:i,offsetY:r}}n=o}n||e6((a=this.cachedCanvases.getCanvas("maskCanvas",l,h)).context,i);let p=to.transform(u,[1/l,0,0,-1/h,0,0]);p=to.transform(p,[1,0,0,1,0,-h]);let f=e1.slice();to.axialAlignedBoundingBox([0,0,l,h],p,f);let[g,m,b,v]=f,y=this.cachedCanvases.getCanvas("fillCanvas",Math.round(b-g)||1,Math.round(v-m)||1),_=y.context;_.translate(-g,-m),_.transform(...p),n||(n=(n=this._scaleImage(a.canvas,tL(_))).img,r&&c&&r.set(s,n)),_.imageSmoothingEnabled=e7(tP(_),i.interpolate),e5(_,n,0,0,n.width,n.height,0,0,l,h),_.globalCompositeOperation="source-in";let w=to.transform(tL(_),[1,0,0,1,-g,-m]);return _.fillStyle=c?d.getPattern(o,this,w,ez,e):d,_.fillRect(0,0,l,h),r&&!c&&(this.cachedCanvases.delete("fillCanvas"),r.set(s,y.canvas)),this.dependencyTracker?.recordDependencies(e,eH),{canvas:y.canvas,offsetX:Math.round(g),offsetY:Math.round(m)}}setLineWidth(e,i){this.dependencyTracker?.recordSimpleData("lineWidth",e),i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(e,i){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=it[i]}setLineJoin(e,i){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=ie[i]}setMiterLimit(e,i){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=i}setDash(e,i,r){this.dependencyTracker?.recordSimpleData("dash",e);let s=this.ctx;void 0!==s.setLineDash&&(s.setLineDash(i),s.lineDashOffset=r)}setRenderingIntent(e,i){}setFlatness(e,i){}setGState(e,i){for(let[r,s]of i)switch(r){case"LW":this.setLineWidth(e,s);break;case"LC":this.setLineCap(e,s);break;case"LJ":this.setLineJoin(e,s);break;case"ML":this.setMiterLimit(e,s);break;case"D":this.setDash(e,s[0],s[1]);break;case"RI":this.setRenderingIntent(e,s);break;case"FL":this.setFlatness(e,s);break;case"Font":this.setFont(e,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw Error("beginSMaskMode called while already in smask mode");let i=this.ctx.canvas.width,r=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(s,i,r);this.suspendedCtx=this.ctx;let a=this.ctx=n.context;a.setTransform(this.suspendedCtx.getTransform()),e9(this.suspendedCtx,a),function(e,i){if(e._removeMirroring)throw Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){i.save(),this.__originalSave()},e.restore=function(){i.restore(),this.__originalRestore()},e.translate=function(e,r){i.translate(e,r),this.__originalTranslate(e,r)},e.scale=function(e,r){i.scale(e,r),this.__originalScale(e,r)},e.transform=function(e,r,s,n,a,o){i.transform(e,r,s,n,a,o),this.__originalTransform(e,r,s,n,a,o)},e.setTransform=function(e,r,s,n,a,o){i.setTransform(e,r,s,n,a,o),this.__originalSetTransform(e,r,s,n,a,o)},e.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){i.rotate(e),this.__originalRotate(e)},e.clip=function(e){i.clip(e),this.__originalClip(e)},e.moveTo=function(e,r){i.moveTo(e,r),this.__originalMoveTo(e,r)},e.lineTo=function(e,r){i.lineTo(e,r),this.__originalLineTo(e,r)},e.bezierCurveTo=function(e,r,s,n,a,o){i.bezierCurveTo(e,r,s,n,a,o),this.__originalBezierCurveTo(e,r,s,n,a,o)},e.rect=function(e,r,s,n){i.rect(e,r,s,n),this.__originalRect(e,r,s,n)},e.closePath=function(){i.closePath(),this.__originalClosePath()},e.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),e9(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let i=this.current.activeSMask,r=this.suspendedCtx;this.composeSMask(r,i,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,i,r,s){let n=s[0],a=s[1],o=s[2]-n,l=s[3]-a;0!==o&&0!==l&&(this.genericComposeSMask(i.context,r,o,l,i.subtype,i.backdrop,i.transferMap,n,a,i.offsetX,i.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}genericComposeSMask(e,i,r,s,n,a,o,l,h,d,c){let u=e.canvas,p=l-d,f=h-c;if(a){if(p<0||f<0||p+r>u.width||f+s>u.height){let e=this.cachedCanvases.getCanvas("maskExtension",r,s),i=e.context;i.drawImage(u,-p,-f),i.globalCompositeOperation="destination-atop",i.fillStyle=a,i.fillRect(0,0,r,s),i.globalCompositeOperation="source-over",u=e.canvas,p=f=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let i=new Path2D;i.rect(p,f,r,s),e.clip(i),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(p,f,r,s),e.restore()}}i.save(),i.globalAlpha=1,i.setTransform(1,0,0,1,0,0),"Alpha"===n&&o?i.filter=this.filterFactory.addAlphaFilter(o):"Luminosity"===n&&(i.filter=this.filterFactory.addLuminosityFilter(o));let g=new Path2D;g.rect(l,h,r,s),i.clip(g),i.globalCompositeOperation="destination-in",i.drawImage(u,p,f,r,s,l,h,r,s),i.restore()}save(e){this.inSMaskMode&&e9(this.ctx,this.suspendedCtx),this.ctx.save();let i=this.current;this.stateStack.push(i),this.current=i.clone(),this.dependencyTracker?.save(e)}restore(e){this.dependencyTracker?.restore(e),0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&e9(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(e,i,r,s,n,a,o){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(i,r,s,n,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,i,r,s){let[n]=r;if(!s)return n||=r[0]=new Path2D,void this[i](e,n);if(null!==this.dependencyTracker){let r=i===j.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,s[0]-r,s[2]+r,s[1]-r,s[3]+r).recordDependencies(e,["transform"])}if(!(n instanceof Path2D)){let e=r[0]=new Path2D;for(let i=0,r=n.length;i<r;)switch(n[i++]){case 0:e.moveTo(n[i++],n[i++]);break;case 1:e.lineTo(n[i++],n[i++]);break;case 2:e.bezierCurveTo(n[i++],n[i++],n[i++],n[i++],n[i++],n[i++]);break;case 3:e.closePath();break;default:V(`Unrecognized drawing path operator: ${n[i-1]}`)}n=e}to.axialAlignedBoundingBox(s,tP(this.ctx),this.current.minMax),this[i](e,n),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,i,r=!0){let s=this.ctx,n=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible){if("object"==typeof n&&n?.getPattern){let r=n.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=n.getPattern(s,this,tL(s),eV,e),r){let e=new Path2D;e.addPath(i,s.getTransform().invertSelf().multiplySelf(r)),i=e}this.rescaleAndStroke(i,!1),s.restore()}else this.rescaleAndStroke(i,!0)}this.dependencyTracker?.recordDependencies(e,eO),r&&this.consumePath(e,i,this.current.getClippedPathBoundingBox(eV,tP(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e,i){this.stroke(e,i)}fill(e,i,r=!0){let s=this.ctx,n=this.current.fillColor,a=!1;if(this.current.patternFill){let r=n.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(e),s.save(),s.fillStyle=n.getPattern(s,this,tL(s),ez,e),r){let e=new Path2D;e.addPath(i,s.getTransform().invertSelf().multiplySelf(r)),i=e}a=!0}let o=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==o&&(this.pendingEOFill?(s.fill(i,"evenodd"),this.pendingEOFill=!1):s.fill(i)),this.dependencyTracker?.recordDependencies(e,eF),a&&(s.restore(),this.dependencyTracker?.restore(e)),r&&this.consumePath(e,i,o)}eoFill(e,i){this.pendingEOFill=!0,this.fill(e,i)}fillStroke(e,i){this.fill(e,i,!1),this.stroke(e,i,!1),this.consumePath(e,i)}eoFillStroke(e,i){this.pendingEOFill=!0,this.fillStroke(e,i)}closeFillStroke(e,i){this.fillStroke(e,i)}closeEOFillStroke(e,i){this.pendingEOFill=!0,this.fillStroke(e,i)}endPath(e,i){this.consumePath(e,i)}rawFillPath(e,i){this.ctx.fill(i),this.dependencyTracker?.recordDependencies(e,eU).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=ii}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=ir}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){let i=this.pendingTextPaths,r=this.ctx;if(this.dependencyTracker){let{dependencyTracker:r}=this;void 0!==i&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(void 0!==i){let e=new Path2D,s=r.getTransform().invertSelf();for(let{transform:r,x:n,y:a,fontSize:o,path:l}of i)l&&e.addPath(l,new DOMMatrix(r).preMultiplySelf(s).translate(n,a).scale(o,-o));r.clip(e)}delete this.pendingTextPaths}setCharSpacing(e,i){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=i}setWordSpacing(e,i){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=i}setHScale(e,i){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=i/100}setLeading(e,i){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-i}setFont(e,i,r){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",i,e);let s=this.commonObjs.get(i),n=this.current;if(!s)throw Error(`Can't find font for ${i}`);if(n.fontMatrix=s.fontMatrix||D,0!==n.fontMatrix[0]&&0!==n.fontMatrix[3]||V("Invalid font matrix for font "+i),r<0?(r=-r,n.fontDirection=-1):n.fontDirection=1,this.current.font=s,this.current.fontSize=r,s.isType3Font)return;let a=s.loadedName||"sans-serif",o=s.systemFontInfo?.css||`"${a}", ${s.fallbackName}`,l="normal";s.black?l="900":s.bold&&(l="bold");let h=s.italic?"italic":"normal",d=r;r<16?d=16:r>100&&(d=100),this.current.fontSizeScale=r/d,this.ctx.font=`${h} ${l} ${d}px ${o}`}setTextRenderingMode(e,i){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=i}setTextRise(e,i){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=i}moveText(e,i,r){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=r}setLeadingMoveText(e,i,r){this.setLeading(e,-r),this.moveText(e,i,r)}setTextMatrix(e,i){this.dependencyTracker?.recordSimpleData("textMatrix",e);let{current:r}=this;r.textMatrix=i,r.textMatrixScale=Math.hypot(i[0],i[1]),r.x=r.lineX=0,r.y=r.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#i5(e,i,r){let s=new Path2D;return s.addPath(e,new DOMMatrix(r).invertSelf().multiplySelf(i)),s}paintChar(e,i,r,s,n,a){let o;let l=this.ctx,h=this.current,d=h.font,c=h.textRenderingMode,u=h.fontSize/h.fontSizeScale,p=3&c,f=!!(4&c),g=h.patternFill&&!d.missingFile,m=h.patternStroke&&!d.missingFile;if((d.disableFontFace||f||g||m)&&!d.missingFile&&(o=d.getPathGenerator(this.commonObjs,i)),o&&(d.disableFontFace||g||m)){let i;if(l.save(),l.translate(r,s),l.scale(u,-u),this.dependencyTracker?.recordCharacterBBox(e,l,d),0===p||2===p){if(n){i=l.getTransform(),l.setTransform(...n);let e=this.#i5(o,i,n);l.fill(e)}else l.fill(o)}if(1===p||2===p){if(a){i||=l.getTransform(),l.setTransform(...a);let{a:e,b:r,c:s,d:n}=i,h=to.inverseTransform(a),d=to.transform([e,r,s,n,0,0],h);to.singularValueDecompose2dScale(d,e0),l.lineWidth*=Math.max(e0[0],e0[1])/u,l.stroke(this.#i5(o,i,a))}else l.lineWidth/=u,l.stroke(o)}l.restore()}else 0!==p&&2!==p||(l.fillText(i,r,s),this.dependencyTracker?.recordCharacterBBox(e,l,d,u,r,s,()=>l.measureText(i))),1!==p&&2!==p||(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,l,d,u,r,s,()=>l.measureText(i)).recordDependencies(e,eO),l.strokeText(i,r,s));f&&((this.pendingTextPaths||=[]).push({transform:tP(l),x:r,y:s,fontSize:u,path:o}),this.dependencyTracker?.recordCharacterBBox(e,l,d,u,r,s))}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let i=e.getImageData(0,0,10,10).data,r=!1;for(let e=3;e<i.length;e+=4)if(i[e]>0&&i[e]<255){r=!0;break}return Y(this,"isFontSubpixelAAEnabled",r)}showText(e,i){let r,s;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,ej).resetBBox(e),4&this.current.textRenderingMode&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());let n=this.current,a=n.font;if(a.isType3Font)return this.showType3Text(e,i),void this.dependencyTracker?.recordShowTextOperation(e);let o=n.fontSize;if(0===o)return void this.dependencyTracker?.recordOperation(e);let l=this.ctx,h=n.fontSizeScale,d=n.charSpacing,c=n.wordSpacing,u=n.fontDirection,p=n.textHScale*u,f=i.length,g=a.vertical,m=g?1:-1,b=a.defaultVMetrics,v=o*n.fontMatrix[0],y=0===n.textRenderingMode&&!a.disableFontFace&&!n.patternFill;if(l.save(),n.textMatrix&&l.transform(...n.textMatrix),l.translate(n.x,n.y+n.textRise),u>0?l.scale(p,-1):l.scale(p,1),n.patternFill){l.save();let i=n.fillColor.getPattern(l,this,tL(l),ez,e);r=tP(l),l.restore(),l.fillStyle=i}if(n.patternStroke){l.save();let i=n.strokeColor.getPattern(l,this,tL(l),eV,e);s=tP(l),l.restore(),l.strokeStyle=i}let _=n.lineWidth,w=n.textMatrixScale;if(0===w||0===_){let e=3&n.textRenderingMode;1!==e&&2!==e||(_=this.getSinglePixelWidth())}else _/=w;if(1!==h&&(l.scale(h,h),_/=h),l.lineWidth=_,a.isInvalidPDFjsFont){let r=[],s=0;for(let e of i)r.push(e.unicode),s+=e.width;let a=r.join("");if(l.fillText(a,0,0),null!==this.dependencyTracker){let i=l.measureText(a);this.dependencyTracker.recordBBox(e,this.ctx,-i.actualBoundingBoxLeft,i.actualBoundingBoxRight,-i.actualBoundingBoxAscent,i.actualBoundingBoxDescent).recordShowTextOperation(e)}return n.x+=s*v*p,l.restore(),void this.compose()}let A,x=0;for(A=0;A<f;++A){let n=i[A];if("number"==typeof n){x+=m*n*o/1e3;continue}let p=!1,f=(n.isSpace?c:0)+d,_=n.fontChar,w=n.accent,S,E,C,T=n.width;if(g){let e=n.vmetric||b,i=-(n.vmetric?e[1]:.5*T)*v,r=e[2]*v;T=e?-e[0]:T,S=i/h,E=(x+r)/h}else S=x/h,E=0;if(a.remeasure&&T>0){let e=1e3*(C=l.measureText(_)).width/o*h;if(T<e&&this.isFontSubpixelAAEnabled){let i=T/e;p=!0,l.save(),l.scale(i,1),S/=i}else T!==e&&(S+=(T-e)/2e3*o/h)}if(this.contentVisible&&(n.isInFont||a.missingFile)){if(y&&!w)l.fillText(_,S,E),this.dependencyTracker?.recordCharacterBBox(e,l,C?{bbox:null}:a,o/h,S,E,()=>C??l.measureText(_));else if(this.paintChar(e,_,S,E,r,s),w){let i=S+o*w.offset.x/h,n=E-o*w.offset.y/h;this.paintChar(e,w.fontChar,i,n,r,s)}}x+=g?T*v-f*u:T*v+f*u,p&&l.restore()}g?n.y-=x:n.x+=x*p,l.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,i){let r,s,n,a;let o=this.ctx,l=this.current,h=l.font,d=l.fontSize,c=l.fontDirection,u=h.vertical?1:-1,p=l.charSpacing,f=l.wordSpacing,g=l.textHScale*c,m=l.fontMatrix||D,b=i.length;if(3===l.textRenderingMode||0===d)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,o.save(),l.textMatrix&&o.transform(...l.textMatrix),o.translate(l.x,l.y+l.textRise),o.scale(g,c);let v=this.dependencyTracker;for(this.dependencyTracker=v?new eN(v,e):null,r=0;r<b;++r){if("number"==typeof(s=i[r])){a=u*s*d/1e3,this.ctx.translate(a,0),l.x+=a*g;continue}let e=(s.isSpace?f:0)+p,c=h.charProcOperatorList[s.operatorListId];c?this.contentVisible&&(this.save(),o.scale(d,d),o.transform(...m),this.executeOperatorList(c),this.restore()):V(`Type3 character "${s.operatorListId}" is not available.`);let b=[s.width,0];to.applyTransform(b,m),n=b[0]*d+e,o.translate(n,0),l.x+=n*g}o.restore(),v&&(this.dependencyTracker=v)}setCharWidth(e,i,r){}setCharWidthAndBounds(e,i,r,s,n,a,o){let l=new Path2D;l.rect(s,n,a-s,o-n),this.ctx.clip(l),this.dependencyTracker?.recordBBox(e,this.ctx,s,a,n,o).recordClipBox(e,this.ctx,s,a,n,o),this.endPath(e)}getColorN_Pattern(e,i){let r;if("TilingPattern"===i[0]){let e=this.baseTransform||tP(this.ctx);r=new eQ(i,this.ctx,{createCanvasGraphics:(e,i)=>new is(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new eN(this.dependencyTracker,i,!0):null)},e)}else r=this._getPattern(e,i[1],i[2]);return r}setStrokeColorN(e,...i){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,i),this.current.patternStroke=!0}setFillColorN(e,...i){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,i),this.current.patternFill=!0}setStrokeRGBColor(e,i){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=i,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,i){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=i,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,i,r=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=function(e){switch(e[0]){case"RadialAxial":return new eX(e);case"Mesh":return new eJ(e);case"Dummy":return new eK}throw Error(`Unknown IR type: ${e[0]}`)}(this.getObject(e,i)),this.cachedPatterns.set(i,s)),r&&(s.matrix=r),s}shadingFill(e,i){if(!this.contentVisible)return;let r=this.ctx;this.save(e);let s=this._getPattern(e,i);r.fillStyle=s.getPattern(r,this,tL(r),eG,e);let n=tL(r);if(n){let{width:e,height:i}=r.canvas,s=e1.slice();to.axialAlignedBoundingBox([0,0,e,i],n,s);let[a,o,l,h]=s;this.ctx.fillRect(a,o,l-a,h-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,e$).recordDependencies(e,eF).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){G("Should not call beginInlineImage")}beginImageData(){G("Should not call beginImageData")}paintFormXObjectBegin(e,i,r){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),i&&this.transform(e,...i),this.baseTransform=tP(this.ctx),r)){to.axialAlignedBoundingBox(r,this.baseTransform,this.current.minMax);let[i,s,n,a]=r,o=new Path2D;o.rect(i,s,n-i,a-s),this.ctx.clip(o),this.dependencyTracker?.recordClipBox(e,this.ctx,i,n,s,a),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,i){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let r=this.ctx;i.isolated||z("TODO: Support non-isolated groups."),i.knockout&&V("Knockout groups not supported.");let s=tP(r);if(i.matrix&&r.transform(...i.matrix),!i.bbox)throw Error("Bounding box is required.");let n=e1.slice();to.axialAlignedBoundingBox(i.bbox,tP(r),n);let a=[0,0,r.canvas.width,r.canvas.height],o=Math.floor((n=to.intersect(n,a)||[0,0,0,0])[0]),l=Math.floor(n[1]),h=Math.max(Math.ceil(n[2])-o,1),d=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,d]);let c="groupAt"+this.groupLevel;i.smask&&(c+="_smask_"+this.smaskCounter++%2);let u=this.cachedCanvases.getCanvas(c,h,d),p=u.context;p.translate(-o,-l),p.transform(...s);let f=new Path2D,[g,m,b,v]=i.bbox;if(f.rect(g,m,b-g,v-m),i.matrix){let e=new Path2D;e.addPath(f,new DOMMatrix(i.matrix)),f=e}p.clip(f),i.smask&&this.smaskStack.push({canvas:u.canvas,context:p,offsetX:o,offsetY:l,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}),i.smask&&!this.dependencyTracker||(r.setTransform(1,0,0,1,0,0),r.translate(o,l),r.save()),e9(r,p),this.ctx=p,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(r),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(r),this.groupLevel++}endGroup(e,i){if(!this.contentVisible)return;this.groupLevel--;let r=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),i.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();let i=tP(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...i);let s=e1.slice();to.axialAlignedBoundingBox([0,0,r.canvas.width,r.canvas.height],i,s),this.ctx.drawImage(r.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,i,r,s,n,a){if(this.#i1(),e8(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),r){let n=r[2]-r[0],o=r[3]-r[1];if(a&&this.annotationCanvasMap){(s=s.slice())[4]-=r[0],s[5]-=r[1],(r=r.slice())[0]=r[1]=0,r[2]=n,r[3]=o,to.singularValueDecompose2dScale(tP(this.ctx),e0);let{viewportScale:e}=this,a=Math.ceil(n*this.outputScaleX*e),l=Math.ceil(o*this.outputScaleY*e);this.annotationCanvas=this.canvasFactory.create(a,l);let{canvas:h,context:d}=this.annotationCanvas;this.annotationCanvasMap.set(i,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=d,this.ctx.save(),this.ctx.setTransform(e0[0],0,0,-e0[1],0,o*e0[1]),e8(this.ctx)}else{e8(this.ctx),this.endPath(e);let i=new Path2D;i.rect(r[0],r[1],n,o),this.ctx.clip(i)}}this.current=new e4(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...s),this.transform(e,...n)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#i2(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,i){if(!this.contentVisible)return;let r=i.count;(i=this.getObject(e,i.data,i)).count=r;let s=this.ctx,n=this._createMaskCanvas(e,i),a=n.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,n.offsetX,n.offsetX+a.width,n.offsetY,n.offsetY+a.height).recordOperation(e),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,i,r,s=0,n=0,a,o){if(!this.contentVisible)return;i=this.getObject(e,i.data,i);let l=this.ctx;l.save();let h=tP(l);l.transform(r,s,n,a,0,0);let d=this._createMaskCanvas(e,i);l.setTransform(1,0,0,1,d.offsetX-h[4],d.offsetY-h[5]),this.dependencyTracker?.resetBBox(e);for(let i=0,c=o.length;i<c;i+=2){let c=to.transform(h,[r,s,n,a,o[i],o[i+1]]);l.drawImage(d.canvas,c[4],c[5]),this.dependencyTracker?.recordBBox(e,this.ctx,c[4],c[4]+d.canvas.width,c[5],c[5]+d.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,i){if(!this.contentVisible)return;let r=this.ctx,s=this.current.fillColor,n=this.current.patternFill;for(let a of(this.dependencyTracker?.resetBBox(e).recordDependencies(e,eH),i)){let{data:i,width:o,height:l,transform:h}=a,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),c=d.context;c.save(),e6(c,this.getObject(e,i,a)),c.globalCompositeOperation="source-in",c.fillStyle=n?s.getPattern(c,this,tL(r),ez,e):s,c.fillRect(0,0,o,l),c.restore(),r.save(),r.transform(...h),r.scale(1,-1),e5(r,d.canvas,0,0,o,l,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,o,0,l),r.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,i){if(!this.contentVisible)return;let r=this.getObject(e,i);r?this.paintInlineImageXObject(e,r):V("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,i,r,s,n){if(!this.contentVisible)return;let a=this.getObject(e,i);if(!a)return void V("Dependent image isn't ready yet");let o=a.width,l=a.height,h=[];for(let e=0,i=n.length;e<i;e+=2)h.push({transform:[r,0,0,s,n[e],n[e+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(e,a,h)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;let{bitmap:i,width:r,height:s}=e,n=this.cachedCanvases.getCanvas("inlineImage",r,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(i,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e,i){let r;if(!this.contentVisible)return;let s=i.width,n=i.height,a=this.ctx;this.save(e);let{filter:o}=a;if("none"!==o&&""!==o&&(a.filter="none"),a.scale(1/s,-1/n),i.bitmap)r=this.applyTransferMapsToBitmap(i);else if("function"==typeof HTMLElement&&i instanceof HTMLElement||!i.data)r=i;else{let e=this.cachedCanvases.getCanvas("inlineImage",s,n).context;e3(e,i),r=this.applyTransferMapsToCanvas(e)}let l=this._scaleImage(r,tL(a));a.imageSmoothingEnabled=e7(tP(a),i.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,a,0,s,-n,0).recordDependencies(e,eB).recordOperation(e),e5(a,l.img,0,0,l.paintWidth,l.paintHeight,0,-n,s,n),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,i,r){let s;if(!this.contentVisible)return;let n=this.ctx;if(i.bitmap)s=i.bitmap;else{let e=i.width,r=i.height,n=this.cachedCanvases.getCanvas("inlineImage",e,r).context;e3(n,i),s=this.applyTransferMapsToCanvas(n)}for(let i of(this.dependencyTracker?.resetBBox(e),r))n.save(),n.transform(...i.transform),n.scale(1,-1),e5(n,s,i.x,i.y,i.w,i.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,1,-1,0),n.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,eF).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,i){}markPointProps(e,i,r){}beginMarkedContent(e,i){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,i,r){this.dependencyTracker?.beginMarkedContent(e),"OC"===i?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(r)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,i,r){let s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(r);let n=this.ctx;this.pendingClip?(s||(this.pendingClip===ir?n.clip(i,"evenodd"):n.clip(i)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=tP(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let i=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,s)/i}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let e,i;let{lineWidth:r}=this.current,{a:s,b:n,c:a,d:o}=this.ctx.getTransform();if(0===n&&0===a){let n=Math.abs(s),a=Math.abs(o);if(n===a){if(0===r)e=i=1/n;else{let s=n*r;e=i=s<1?1/s:1}}else if(0===r)e=1/n,i=1/a;else{let s=n*r,o=a*r;e=s<1?1/s:1,i=o<1?1/o:1}}else{let l=Math.abs(s*o-n*a),h=Math.hypot(s,n),d=Math.hypot(a,o);if(0===r)e=d/l,i=h/l;else{let s=r*l;e=d>s?d/s:1,i=h>s?h/s:1}}this._cachedScaleForStroking[0]=e,this._cachedScaleForStroking[1]=i}return this._cachedScaleForStroking}rescaleAndStroke(e,i){let{ctx:r,current:{lineWidth:s}}=this,[n,a]=this.getScaleForStroking();if(n===a)return r.lineWidth=(s||1)*n,void r.stroke(e);let o=r.getLineDash();i&&r.save(),r.scale(n,a),eZ.a=1/n,eZ.d=1/a;let l=new Path2D;if(l.addPath(e,eZ),o.length>0){let e=Math.max(n,a);r.setLineDash(o.map(i=>i/e)),r.lineDashOffset/=e}r.lineWidth=s||1,r.stroke(l),i&&r.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(let e in j)void 0!==is.prototype[e]&&(is.prototype[j[e]]=is.prototype[e]);class ia{#i4;#i3;#i6;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){let i=new TextEncoder,r={},s=0;for(let n of ia.strings){let a=i.encode(e[n]);r[n]=a,s+=4+a.length}let n=new ArrayBuffer(s),a=new Uint8Array(n),o=new DataView(n),l=0;for(let e of ia.strings){let i=r[e],s=i.length;o.setUint32(l,s),a.set(i,l+4),l+=4+s}return W(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}constructor(e){this.#i4=e,this.#i3=new DataView(this.#i4),this.#i6=new TextDecoder}#i9(e){W(e<ia.strings.length,"Invalid string index");let i=0;for(let r=0;r<e;r++)i+=this.#i3.getUint32(i)+4;let r=this.#i3.getUint32(i);return this.#i6.decode(new Uint8Array(this.#i4,i+4,r))}get fontFamily(){return this.#i9(0)}get fontWeight(){return this.#i9(1)}get italicAngle(){return this.#i9(2)}}class io{#i4;#i3;#i6;static strings=["css","loadedName","baseFontName","src"];static write(e){let i=new TextEncoder,r={},s=0;for(let n of io.strings){let a=i.encode(e[n]);r[n]=a,s+=4+a.length}let n,a,o=1+(s+=4);e.style&&(n=i.encode(e.style.style),a=i.encode(e.style.weight),o+=4+n.length+4+a.length);let l=new ArrayBuffer(o),h=new Uint8Array(l),d=new DataView(l),c=0;for(let i of(d.setUint8(c++,e.guessFallback?1:0),d.setUint32(c,0),c+=4,s=0,io.strings)){let e=r[i],n=e.length;s+=4+n,d.setUint32(c,n),h.set(e,c+4),c+=4+n}return d.setUint32(c-s-4,s),e.style&&(d.setUint32(c,n.length),h.set(n,c+4),c+=4+n.length,d.setUint32(c,a.length),h.set(a,c+4),c+=4+a.length),W(c<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(c)}constructor(e){this.#i4=e,this.#i3=new DataView(this.#i4),this.#i6=new TextDecoder}get guessFallback(){return 0!==this.#i3.getUint8(0)}#i9(e){W(e<io.strings.length,"Invalid string index");let i=5;for(let r=0;r<e;r++)i+=this.#i3.getUint32(i)+4;let r=this.#i3.getUint32(i);return this.#i6.decode(new Uint8Array(this.#i4,i+4,r))}get css(){return this.#i9(0)}get loadedName(){return this.#i9(1)}get baseFontName(){return this.#i9(2)}get src(){return this.#i9(3)}get style(){let e=1;e+=4+this.#i3.getUint32(e);let i=this.#i3.getUint32(e),r=this.#i6.decode(new Uint8Array(this.#i4,e+4,i));e+=4+i;let s=this.#i3.getUint32(e);return{style:r,weight:this.#i6.decode(new Uint8Array(this.#i4,e+4,s))}}}class il{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static #i8=Math.ceil(2*this.bools.length/8);static #i7=this.#i8+8*this.numbers.length;static #rt=this.#i7+1+8;static #re=this.#rt+1+48;static #ri=this.#re+1+6;#i4;#i6;#i3;constructor({data:e,extra:i}){this.#i4=e,this.#i6=new TextDecoder,this.#i3=new DataView(this.#i4),i&&Object.assign(this,i)}#rr(e){W(e<il.bools.length,"Invalid boolean index");let i=this.#i3.getUint8(Math.floor(e/4))>>2*e%8&3;return 0===i?void 0:2===i}get black(){return this.#rr(0)}get bold(){return this.#rr(1)}get disableFontFace(){return this.#rr(2)}get fontExtraProperties(){return this.#rr(3)}get isInvalidPDFjsFont(){return this.#rr(4)}get isType3Font(){return this.#rr(5)}get italic(){return this.#rr(6)}get missingFile(){return this.#rr(7)}get remeasure(){return this.#rr(8)}get vertical(){return this.#rr(9)}#rs(e){return W(e<il.numbers.length,"Invalid number index"),this.#i3.getFloat64(il.#i8+8*e)}get ascent(){return this.#rs(0)}get defaultWidth(){return this.#rs(1)}get descent(){return this.#rs(2)}get bbox(){let e=il.#i7;if(0===this.#i3.getUint8(e))return;e+=1;let i=[];for(let r=0;r<4;r++)i.push(this.#i3.getInt16(e,!0)),e+=2;return i}get fontMatrix(){let e=il.#rt;if(0===this.#i3.getUint8(e))return;e+=1;let i=[];for(let r=0;r<6;r++)i.push(this.#i3.getFloat64(e,!0)),e+=8;return i}get defaultVMetrics(){let e=il.#re;if(0===this.#i3.getUint8(e))return;e+=1;let i=[];for(let r=0;r<3;r++)i.push(this.#i3.getInt16(e,!0)),e+=2;return i}#i9(e){W(e<il.strings.length,"Invalid string index");let i=il.#ri+4;for(let r=0;r<e;r++)i+=this.#i3.getUint32(i)+4;let r=this.#i3.getUint32(i),s=new Uint8Array(r);return s.set(new Uint8Array(this.#i4,i+4,r)),this.#i6.decode(s)}get fallbackName(){return this.#i9(0)}get loadedName(){return this.#i9(1)}get mimetype(){return this.#i9(2)}get name(){return this.#i9(3)}get data(){let e=il.#ri;e+=4+this.#i3.getUint32(e),e+=4+this.#i3.getUint32(e),e+=4+this.#i3.getUint32(e);let i=this.#i3.getUint32(e);if(0!==i)return new Uint8Array(this.#i4,e+4,i)}clearData(){let e=il.#ri;e+=4+this.#i3.getUint32(e),e+=4+this.#i3.getUint32(e),e+=4+this.#i3.getUint32(e);let i=this.#i3.getUint32(e);new Uint8Array(this.#i4,e+4,i).fill(0),this.#i3.setUint32(e,0)}get cssFontInfo(){let e=il.#ri;e+=4+this.#i3.getUint32(e),e+=4+this.#i3.getUint32(e);let i=this.#i3.getUint32(e);if(0===i)return null;let r=new Uint8Array(i);return r.set(new Uint8Array(this.#i4,e+4,i)),new ia(r.buffer)}get systemFontInfo(){let e=il.#ri;e+=4+this.#i3.getUint32(e);let i=this.#i3.getUint32(e);if(0===i)return null;let r=new Uint8Array(i);return r.set(new Uint8Array(this.#i4,e+4,i)),new io(r.buffer)}static write(e){let i=e.systemFontInfo?io.write(e.systemFontInfo):null,r=e.cssFontInfo?ia.write(e.cssFontInfo):null,s=new TextEncoder,n={},a=0;for(let i of il.strings)n[i]=s.encode(e[i]),a+=4+n[i].length;let o=new ArrayBuffer(il.#ri+4+a+4+(i?i.byteLength:0)+4+(r?r.byteLength:0)+4+(e.data?e.data.length:0)),l=new Uint8Array(o),h=new DataView(o),d=0,c=il.bools.length,u=0,p=0;for(let i=0;i<c;i++){let r=e[il.bools[i]];u|=(void 0===r?0:r?2:1)<<p,8!==(p+=2)&&i!==c-1||(h.setUint8(d++,u),u=0,p=0)}for(let i of(W(d===il.#i8,"FontInfo.write: Boolean properties offset mismatch"),il.numbers))h.setFloat64(d,e[i]),d+=8;if(W(d===il.#i7,"FontInfo.write: Number properties offset mismatch"),e.bbox)for(let i of(h.setUint8(d++,4),e.bbox))h.setInt16(d,i,!0),d+=2;else h.setUint8(d++,0),d+=8;if(W(d===il.#rt,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix)for(let i of(h.setUint8(d++,6),e.fontMatrix))h.setFloat64(d,i,!0),d+=8;else h.setUint8(d++,0),d+=48;if(W(d===il.#re,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics)for(let i of(h.setUint8(d++,1),e.defaultVMetrics))h.setInt16(d,i,!0),d+=2;else h.setUint8(d++,0),d+=6;for(let e of(W(d===il.#ri,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(il.#ri,0),d+=4,il.strings)){let i=n[e],r=i.length;h.setUint32(d,r),l.set(i,d+4),d+=4+r}if(h.setUint32(il.#ri,d-il.#ri-4),i){let e=i.byteLength;h.setUint32(d,e),W(d+4+e<=o.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),l.set(new Uint8Array(i),d+4),d+=4+e}else h.setUint32(d,0),d+=4;if(r){let e=r.byteLength;h.setUint32(d,e),W(d+4+e<=o.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),l.set(new Uint8Array(r),d+4),d+=4+e}else h.setUint32(d,0),d+=4;return void 0===e.data?(h.setUint32(d,0),d+=4):(h.setUint32(d,e.data.length),l.set(e.data,d+4),d+=4+e.data.length),W(d<=o.byteLength,"FontInfo.write: Buffer overflow"),o.transferToFixedLength(d)}}class ih{static #rn=null;static #ra="";static get workerPort(){return this.#rn}static set workerPort(e){if(!("undefined"!=typeof Worker&&e instanceof Worker)&&null!==e)throw Error("Invalid `workerPort` type.");this.#rn=e}static get workerSrc(){return this.#ra}static set workerSrc(e){if("string"!=typeof e)throw Error("Invalid `workerSrc` type.");this.#ra=e}}class id{#ro;#rl;constructor({parsedData:e,rawData:i}){this.#ro=e,this.#rl=i}getRaw(){return this.#rl}get(e){return this.#ro.get(e)??null}[Symbol.iterator](){return this.#ro.entries()}}let ic=Symbol("INTERNAL");class iu{#rh=!1;#rd=!1;#rc=!1;#ru=!0;constructor(e,{name:i,intent:r,usage:s,rbGroups:n}){this.#rh=!!(2&e),this.#rd=!!(4&e),this.name=i,this.intent=r,this.usage=s,this.rbGroups=n}get visible(){if(this.#rc)return this.#ru;if(!this.#ru)return!1;let{print:e,view:i}=this.usage;return this.#rh?"OFF"!==i?.viewState:!this.#rd||"OFF"!==e?.printState}_setVisible(e,i,r=!1){e!==ic&&G("Internal method `_setVisible` called."),this.#rc=r,this.#ru=i}}class ip{#rp=null;#rf=new Map;#rg=null;#rm=null;constructor(e,i=2){if(this.renderingIntent=i,this.name=null,this.creator=null,null!==e){for(let r of(this.name=e.name,this.creator=e.creator,this.#rm=e.order,e.groups))this.#rf.set(r.id,new iu(i,r));if("OFF"===e.baseState)for(let e of this.#rf.values())e._setVisible(ic,!1);for(let i of e.on)this.#rf.get(i)._setVisible(ic,!0);for(let i of e.off)this.#rf.get(i)._setVisible(ic,!1);this.#rg=this.getHash()}}#rb(e){let i=e.length;if(i<2)return!0;let r=e[0];for(let s=1;s<i;s++){let i;let n=e[s];if(Array.isArray(n))i=this.#rb(n);else{if(!this.#rf.has(n))return V(`Optional content group not found: ${n}`),!0;i=this.#rf.get(n).visible}switch(r){case"And":if(!i)return!1;break;case"Or":if(i)return!0;break;case"Not":return!i;default:return!0}}return"And"===r}isVisible(e){if(0===this.#rf.size)return!0;if(!e)return z("Optional content group not defined."),!0;if("OCG"===e.type)return this.#rf.has(e.id)?this.#rf.get(e.id).visible:(V(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#rb(e.expression);if(!e.policy||"AnyOn"===e.policy){for(let i of e.ids){if(!this.#rf.has(i))return V(`Optional content group not found: ${i}`),!0;if(this.#rf.get(i).visible)return!0}return!1}if("AllOn"===e.policy){for(let i of e.ids){if(!this.#rf.has(i))return V(`Optional content group not found: ${i}`),!0;if(!this.#rf.get(i).visible)return!1}return!0}if("AnyOff"===e.policy){for(let i of e.ids){if(!this.#rf.has(i))return V(`Optional content group not found: ${i}`),!0;if(!this.#rf.get(i).visible)return!0}return!1}if("AllOff"===e.policy){for(let i of e.ids){if(!this.#rf.has(i))return V(`Optional content group not found: ${i}`),!0;if(this.#rf.get(i).visible)return!1}return!0}return V(`Unknown optional content policy ${e.policy}.`),!0}return V(`Unknown group type ${e.type}.`),!0}setVisibility(e,i=!0,r=!0){let s=this.#rf.get(e);if(s){if(r&&i&&s.rbGroups.length)for(let i of s.rbGroups)for(let r of i)r!==e&&this.#rf.get(r)?._setVisible(ic,!1,!0);s._setVisible(ic,!!i,!0),this.#rp=null}else V(`Optional content group not found: ${e}`)}setOCGState({state:e,preserveRB:i}){let r;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":r=s;continue}let e=this.#rf.get(s);if(e)switch(r){case"ON":this.setVisibility(s,!0,i);break;case"OFF":this.setVisibility(s,!1,i);break;case"Toggle":this.setVisibility(s,!e.visible,i)}}this.#rp=null}get hasInitialVisibility(){return null===this.#rg||this.getHash()===this.#rg}getOrder(){return this.#rf.size?this.#rm?this.#rm.slice():[...this.#rf.keys()]:null}getGroup(e){return this.#rf.get(e)||null}getHash(){if(null!==this.#rp)return this.#rp;let e=new t8;for(let[i,r]of this.#rf)e.update(`${i}:${r.visible}`);return this.#rp=e.hexdigest()}[Symbol.iterator](){return this.#rf.entries()}}class ig{constructor(e,{disableRange:i=!1,disableStream:r=!1}){W(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,n?.length>0){let e=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!r,this._isRangeSupported=!i,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((e,i)=>{this._onReceiveData({begin:e,chunk:i})}),e.addProgressListener((e,i)=>{this._onProgress({loaded:e,total:i})}),e.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:i}){let r=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r):W(this._rangeReaders.some(function(i){return i._begin===e&&(i._enqueue(r),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){void 0===e.total?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let i=this._rangeReaders.indexOf(e);i>=0&&this._rangeReaders.splice(i,1)}getFullReader(){W(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new im(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,i){if(i<=this._progressiveDataLength)return null;let r=new ib(this,e,i);return this._pdfDataRangeTransport.requestDataRange(e,i),this._rangeReaders.push(r),r}cancelAllRequests(e){for(let i of(this._fullRequestReader?.cancel(e),this._rangeReaders.slice(0)))i.cancel(e);this._pdfDataRangeTransport.abort()}}class im{constructor(e,i,r=!1,s=null){for(let n of(this._stream=e,this._done=r||!1,this._filename=tx(s)?s:null,this._queuedChunks=i||[],this._loaded=0,this._queuedChunks))this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){for(let e of(this._done=!0,this._requests))e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class ib{constructor(e,i,r){this._stream=e,this._begin=i,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{for(let i of(this._requests.shift().resolve({value:e,done:!1}),this._requests))i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){for(let e of(this._done=!0,this._requests))e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function iv(e,i){let r=new Headers;if(!e||!i||"object"!=typeof i)return r;for(let e in i){let s=i[e];void 0!==s&&r.append(e,s)}return r}function iy(e){return URL.parse(e)?.origin??null}function i_({responseHeaders:e,isHttp:i,rangeChunkSize:r,disableRange:s}){let n={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(e.get("Content-Length"),10);return!Number.isInteger(a)||(n.suggestedLength=a,a<=2*r)||s||!i||"bytes"!==e.get("Accept-Ranges")||"identity"!==(e.get("Content-Encoding")||"identity")||(n.allowRangeRequests=!0),n}function iw(e){let i=e.get("Content-Disposition");if(i){let e=function(e){let i=!0,r=s("filename\\*","i").exec(e);if(r){let e=o(r=r[1]);return a(e=h(e=l(e=unescape(e))))}if(r=function(e){let i;let r=[],n=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(i=n.exec(e));){let[,e,s,n]=i;if((e=parseInt(e,10))in r){if(0===e)break}else r[e]=[s,n]}let a=[];for(let e=0;e<r.length&&(e in r);++e){let[i,s]=r[e];s=o(s),i&&(s=unescape(s),0===e&&(s=l(s))),a.push(s)}return a.join("")}(e))return a(h(r));if(r=s("filename","i").exec(e)){let e=o(r=r[1]);return a(e=h(e))}function s(e,i){return RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',i)}function n(e,r){if(e){if(!/^[\x00-\xFF]+$/.test(r))return r;try{let s=new TextDecoder(e,{fatal:!0}),n=ts(r);r=s.decode(n),i=!1}catch{}}return r}function a(e){return i&&/[\x80-\xff]/.test(e)&&(e=n("utf-8",e),i&&(e=n("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){let i=e.slice(1).split('\\"');for(let e=0;e<i.length;++e){let r=i[e].indexOf('"');-1!==r&&(i[e]=i[e].slice(0,r),i.length=e+1),i[e]=i[e].replaceAll(/\\(.)/g,"$1")}e=i.join('"')}return e}function l(e){let i=e.indexOf("'");return -1===i?e:n(e.slice(0,i),e.slice(i+1).replace(/^[^']*'/,""))}function h(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(e,i,r,s){if("q"===r||"Q"===r)return n(i,s=(s=s.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(e,i){return String.fromCharCode(parseInt(i,16))}));try{s=atob(s)}catch{}return n(i,s)})}return""}(i);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(tx(e))return e}return null}function iA(e,i){return new tt(`Unexpected server response (${e}) while retrieving PDF "${i}".`,e,404===e||0===e&&i.startsWith("file:"))}function ix(e){return 200===e||206===e}function iS(e,i,r){return{method:"GET",headers:e,signal:r.signal,mode:"cors",credentials:i?"include":"same-origin",redirect:"follow"}}function iE(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(V(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}class iC{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=iv(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new iT(this),this._fullRequestReader}getRangeReader(e,i){if(i<=this._progressiveDataLength)return null;let r=new iM(this,e,i);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){for(let i of(this._fullRequestReader?.cancel(e),this._rangeRequestReaders.slice(0)))i.cancel(e)}}class iT{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let i=e.source;this._withCredentials=i.withCredentials||!1,this._contentLength=i.length,this._headersCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange;let r=new Headers(e.headers),s=i.url;fetch(s,iS(r,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=iy(i.url),!ix(i.status))throw iA(i.status,s);this._reader=i.body.getReader(),this._headersCapability.resolve();let r=i.headers,{allowRangeRequests:n,suggestedLength:a}=i_({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=a||this._contentLength,this._filename=iw(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ti("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:e,done:i}=await this._reader.read();return i?{value:e,done:i}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:iE(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class iM{constructor(e,i,r){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let n=new Headers(e.headers);n.append("Range",`bytes=${i}-${r-1}`);let a=s.url;fetch(a,iS(n,this._withCredentials,this._abortController)).then(i=>{let r=iy(i.url);if(r!==e._responseOrigin)throw Error(`Expected range response-origin "${r}" to match "${e._responseOrigin}".`);if(!ix(i.status))throw iA(i.status,a);this._readCapability.resolve(),this._reader=i.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:e,done:i}=await this._reader.read();return i?{value:e,done:i}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:iE(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class ik{_responseOrigin=null;constructor({url:e,httpHeaders:i,withCredentials:r}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=iv(this.isHttp,i),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let i=new XMLHttpRequest,r=this.currXhrId++,s=this.pendingRequests[r]={xhr:i};for(let[e,r]of(i.open("GET",this.url),i.withCredentials=this.withCredentials,this.headers))i.setRequestHeader(e,r);return this.isHttp&&"begin"in e&&"end"in e?(i.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=206):s.expectedStatus=200,i.responseType="arraybuffer",W(e.onError,"Expected `onError` callback to be provided."),i.onerror=()=>{e.onError(i.status)},i.onreadystatechange=this.onStateChange.bind(this,r),i.onprogress=this.onProgress.bind(this,r),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,i.send(null),r}onProgress(e,i){let r=this.pendingRequests[e];r&&r.onProgress?.(i)}onStateChange(e,i){let r=this.pendingRequests[e];if(!r)return;let s=r.xhr;if(s.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),4!==s.readyState||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===s.status&&this.isHttp)return void r.onError(s.status);let n=s.status||200;if(!(200===n&&206===r.expectedStatus)&&n!==r.expectedStatus)return void r.onError(s.status);let a=function(e){let i=e.response;return"string"!=typeof i?i:ts(i).buffer}(s);if(206===n){let e=s.getResponseHeader("Content-Range"),i=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);i?r.onDone({begin:parseInt(i[1],10),chunk:a}):(V('Missing or invalid "Content-Range" header.'),r.onError(0))}else a?r.onDone({begin:0,chunk:a}):r.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let i=this.pendingRequests[e].xhr;delete this.pendingRequests[e],i.abort()}}class iI{constructor(e){this._source=e,this._manager=new ik(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let i=this._rangeRequestReaders.indexOf(e);i>=0&&this._rangeRequestReaders.splice(i,1)}getFullReader(){return W(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new iD(this._manager,this._source),this._fullRequestReader}getRangeReader(e,i){let r=new iR(this._manager,e,i);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){for(let i of(this._fullRequestReader?.cancel(e),this._rangeRequestReaders.slice(0)))i.cancel(e)}}class iD{constructor(e,i){this._manager=e,this._url=i.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._contentLength=i.length,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,i=this._manager.getRequestXhr(e);this._manager._responseOrigin=iy(i.responseURL);let r=i.getAllResponseHeaders(),s=new Headers(r?r.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(e=>{let[i,...r]=e.split(": ");return[i,r.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=i_({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=iw(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){for(let i of(this._storedError=iA(e,this._url),this._headersCapability.reject(this._storedError),this._requests))i.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){for(let i of(this._done=!0,this._headersCapability.reject(e),this._requests))i.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class iR{constructor(e,i,r){this._manager=e,this._url=e.url,this._requestId=e.request({begin:i,end:r,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=iy(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let i=e.chunk;for(let e of(this._requests.length>0?this._requests.shift().resolve({value:i,done:!1}):this._queuedChunk=i,this._done=!0,this._requests))e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){for(let i of(this._storedError??=iA(e,this._url),this._requests))i.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){for(let e of(this._done=!0,this._requests))e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}let iP=/^[a-z][a-z0-9\-+.]+:/i;class iL{constructor(e){this.source=e,this.url=function(e){return new URL(iP.test(e)?e:process.getBuiltinModule("url").pathToFileURL(e))}(e.url),W("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new iN(this),this._fullRequestReader}getRangeReader(e,i){if(i<=this._progressiveDataLength)return null;let r=new iO(this,e,i);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){for(let i of(this._fullRequestReader?.cancel(e),this._rangeRequestReaders.slice(0)))i.cancel(e)}}class iN{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let i=e.source;this._contentLength=i.length,this._loaded=0,this._filename=null,this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then(e=>{this._contentLength=e.size,this._setReadableStream(r.createReadStream(this._url)),this._headersCapability.resolve()},e=>{"ENOENT"===e.code&&(e=iA(0,this._url.href)),this._storedError=e,this._headersCapability.reject(e)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return null===e?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ti("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class iO{constructor(e,i,r){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:i,end:r-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return null===e?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}let iF=Symbol("INITIAL_DATA");class iB{#rv=Object.create(null);#ry(e){return this.#rv[e]||={...Promise.withResolvers(),data:iF}}get(e,i=null){if(i){let r=this.#ry(e);return r.promise.then(()=>i(r.data)),null}let r=this.#rv[e];if(!r||r.data===iF)throw Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){let i=this.#rv[e];return!!i&&i.data!==iF}delete(e){let i=this.#rv[e];return!(!i||i.data===iF)&&(delete this.#rv[e],!0)}resolve(e,i=null){let r=this.#ry(e);r.data=i,r.resolve()}clear(){for(let e in this.#rv){let{data:i}=this.#rv[e];i?.bitmap?.close()}this.#rv=Object.create(null)}*[Symbol.iterator](){for(let e in this.#rv){let{data:i}=this.#rv[e];i!==iF&&(yield[e,i])}}}class iU{#r_=Promise.withResolvers();#tw=null;#rw=!1;#rA=!!globalThis.FontInspector?.enabled;#rx=null;#rS=null;#rE=0;#rC=0;#rT=null;#rM=null;#rk=0;#rI=0;#rD=Object.create(null);#rR=[];#rP=null;#rL=[];#rN=new WeakMap;#rO=null;static #rF=new Map;static #rB=new Map;static #rU=new WeakMap;static #rj=null;static #r$=new Set;constructor({textContentSource:e,container:i,viewport:r}){if(e instanceof ReadableStream)this.#rP=e;else{if("object"!=typeof e)throw Error('No "textContentSource" parameter specified.');this.#rP=new ReadableStream({start(i){i.enqueue(e),i.close()}})}this.#tw=this.#rM=i,this.#rI=r.scale*tO.pixelRatio,this.#rk=r.rotation,this.#rS={div:null,properties:null,ctx:null};let{pageWidth:s,pageHeight:n,pageX:a,pageY:o}=r.rawDims;this.#rO=[1,0,0,-1,-a,o+n],this.#rC=s,this.#rE=n,iU.#rH(),tN(i,r),this.#r_.promise.finally(()=>{iU.#r$.delete(this),this.#rS=null,this.#rD=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:i}=tn.platform;return Y(this,"fontFamilyMap",new Map([["sans-serif",(e&&i?"Calibri, ":"")+"sans-serif"],["monospace",(e&&i?"Lucida Console, ":"")+"monospace"]]))}render(){let e=()=>{this.#rT.read().then(({value:i,done:r})=>{r?this.#r_.resolve():(this.#rx??=i.lang,Object.assign(this.#rD,i.styles),this.#rz(i.items),e())},this.#r_.reject)};return this.#rT=this.#rP.getReader(),iU.#r$.add(this),e(),this.#r_.promise}update({viewport:e,onBefore:i=null}){let r=e.scale*tO.pixelRatio,s=e.rotation;if(s!==this.#rk&&(i?.(),this.#rk=s,tN(this.#rM,{rotation:s})),r!==this.#rI){i?.(),this.#rI=r;let e={div:null,properties:null,ctx:iU.#rV(this.#rx)};for(let i of this.#rL)e.properties=this.#rN.get(i),e.div=i,this.#rG(e)}}cancel(){let e=new ti("TextLayer task cancelled.");this.#rT?.cancel(e).catch(()=>{}),this.#rT=null,this.#r_.reject(e)}get textDivs(){return this.#rL}get textContentItemsStr(){return this.#rR}#rz(e){if(this.#rw)return;this.#rS.ctx??=iU.#rV(this.#rx);let i=this.#rL,r=this.#rR;for(let s of e){if(i.length>1e5)return V("Ignoring additional textDivs for performance reasons."),void(this.#rw=!0);if(void 0!==s.str)r.push(s.str),this.#rW(s);else if("beginMarkedContentProps"===s.type||"beginMarkedContent"===s.type){let e=this.#tw;this.#tw=document.createElement("span"),this.#tw.classList.add("markedContent"),s.id&&this.#tw.setAttribute("id",`${s.id}`),e.append(this.#tw)}else"endMarkedContent"===s.type&&(this.#tw=this.#tw.parentNode)}}#rW(e){let i,r;let s=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};this.#rL.push(s);let a=to.transform(this.#rO,e.transform),o=Math.atan2(a[1],a[0]),l=this.#rD[e.fontName];l.vertical&&(o+=Math.PI/2);let h=this.#rA&&l.fontSubstitution||l.fontFamily;h=iU.fontFamilyMap.get(h)||h;let d=Math.hypot(a[2],a[3]),c=d*iU.#rq(h,l,this.#rx);0===o?(i=a[4],r=a[5]-c):(i=a[4]+c*Math.sin(o),r=a[5]-c*Math.cos(o));let u="calc(var(--total-scale-factor) *",p=s.style;this.#tw===this.#rM?(p.left=`${(100*i/this.#rC).toFixed(2)}%`,p.top=`${(100*r/this.#rE).toFixed(2)}%`):(p.left=`${u}${i.toFixed(2)}px)`,p.top=`${u}${r.toFixed(2)}px)`),p.fontSize=`${u}${(iU.#rj*d).toFixed(2)}px)`,p.fontFamily=h,n.fontSize=d,s.setAttribute("role","presentation"),s.textContent=e.str,s.dir=e.dir,this.#rA&&(s.dataset.fontName=l.fontSubstitutionLoadedName||e.fontName),0!==o&&(n.angle=180/Math.PI*o);let f=!1;if(e.str.length>1)f=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){let i=Math.abs(e.transform[0]),r=Math.abs(e.transform[3]);i!==r&&Math.max(i,r)/Math.min(i,r)>1.5&&(f=!0)}if(f&&(n.canvasWidth=l.vertical?e.height:e.width),this.#rN.set(s,n),this.#rS.div=s,this.#rS.properties=n,this.#rG(this.#rS),n.hasText&&this.#tw.append(s),n.hasEOL){let e=document.createElement("br");e.setAttribute("role","presentation"),this.#tw.append(e)}}#rG(e){let{div:i,properties:r,ctx:s}=e,{style:n}=i,a="";if(iU.#rj>1&&(a=`scale(${1/iU.#rj})`),0!==r.canvasWidth&&r.hasText){let{fontFamily:e}=n,{canvasWidth:o,fontSize:l}=r;iU.#rX(s,l*this.#rI,e);let{width:h}=s.measureText(i.textContent);h>0&&(a=`scaleX(${o*this.#rI/h}) ${a}`)}0!==r.angle&&(a=`rotate(${r.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#r$.size>0)){for(let{canvas:e}of(this.#rF.clear(),this.#rB.values()))e.remove();this.#rB.clear()}}static #rV(e=null){let i=this.#rB.get(e||="");if(!i){let r=document.createElement("canvas");r.className="hiddenCanvasElement",r.lang=e,document.body.append(r),i=r.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#rB.set(e,i),this.#rU.set(i,{size:0,family:""})}return i}static #rX(e,i,r){let s=this.#rU.get(e);i===s.size&&r===s.family||(e.font=`${i}px ${r}`,s.size=i,s.family=r)}static #rH(){if(null!==this.#rj)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#rj=e.getBoundingClientRect().height,e.remove()}static #rq(e,i,r){let s=this.#rF.get(e);if(s)return s;let n=this.#rV(r);n.canvas.width=n.canvas.height=30,this.#rX(n,30,e);let a=n.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+l):(tn.platform.isFirefox&&V("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),i.ascent?h=i.ascent:i.descent&&(h=1+i.descent)),this.#rF.set(e,h),h}}function ij(e={}){"string"==typeof e||e instanceof URL?e={url:e}:(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let i=new i$,{docId:r}=i,s=e.url?function(e){if(e instanceof URL)return e.href;if("string"==typeof e){if(I)return e;let i=URL.parse(e,window.location);if(i)return i.href}throw Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(e.url):null,n=e.data?function(e){if(I&&"undefined"!=typeof Buffer&&e instanceof Buffer)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"==typeof e)return ts(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||"object"==typeof e&&!isNaN(e?.length))return new Uint8Array(e);throw Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(e.data):null,a=e.httpHeaders||null,o=!0===e.withCredentials,l=e.password??null,h=e.range instanceof iH?e.range:null,d=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:65536,c=e.worker instanceof iW?e.worker:null,u=e.verbosity,p="string"!=typeof e.docBaseUrl||tA(e.docBaseUrl)?null:e.docBaseUrl,f=es(e.cMapUrl),g=!1!==e.cMapPacked,m=e.CMapReaderFactory||(I?eS:ef),b=es(e.iccUrl),v=es(e.standardFontDataUrl),y=e.StandardFontDataFactory||(I?eE:ev),_=es(e.wasmUrl),w=e.WasmFactory||(I?eC:e_),A=!0!==e.stopAtErrors,x=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,S=!1!==e.isEvalSupported,E="boolean"==typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!I,C="boolean"==typeof e.isImageDecoderSupported?e.isImageDecoderSupported:!I&&(tn.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,M="boolean"==typeof e.disableFontFace?e.disableFontFace:I,k=!0===e.fontExtraProperties,D=!0===e.enableXfa,R=e.ownerDocument||globalThis.document,P=!0===e.disableRange,L=!0===e.disableStream,N=!0===e.disableAutoFetch,O=!0===e.pdfBug,F=e.CanvasFactory||(I?ex:eu),B=e.FilterFactory||(I?eA:em),U=!0===e.enableHWA,j=!1!==e.useWasm,$=h?h.length:e.length??NaN,z="boolean"==typeof e.useSystemFonts?e.useSystemFonts:!I&&!M,V="boolean"==typeof e.useWorkerFetch?e.useWorkerFetch:!!(m===ef&&y===ev&&w===e_&&f&&v&&_&&tT(f,document.baseURI)&&tT(v,document.baseURI)&&tT(_,document.baseURI));Number.isInteger(u)&&(H=u);let G={canvasFactory:new F({ownerDocument:R,enableHWA:U}),filterFactory:new B({docId:r,ownerDocument:R}),cMapReaderFactory:V?null:new m({baseUrl:f,isCompressed:g}),standardFontDataFactory:V?null:new y({baseUrl:v}),wasmFactory:V?null:new w({baseUrl:_})};c||(c=iW.create({verbosity:u,port:ih.workerPort}),i._worker=c);let W={docId:r,apiVersion:"5.4.296",data:n,password:l,disableAutoFetch:N,rangeChunkSize:d,length:$,docBaseUrl:p,enableXfa:D,evaluatorOptions:{maxImageSize:x,disableFontFace:M,ignoreErrors:A,isEvalSupported:S,isOffscreenCanvasSupported:E,isImageDecoderSupported:C,canvasMaxAreaInBytes:T,fontExtraProperties:k,useSystemFonts:z,useWasm:j,useWorkerFetch:V,cMapUrl:f,iccUrl:b,standardFontDataUrl:v,wasmUrl:_}},q={ownerDocument:R,pdfBug:O,styleElement:null,loadingParams:{disableAutoFetch:N,enableXfa:D}};return c.promise.then(function(){let e;if(i.destroyed)throw Error("Loading aborted");if(c.destroyed)throw Error("Worker was destroyed");let l=c.messageHandler.sendWithPromise("GetDocRequest",W,n?[n.buffer]:null);if(h)e=new ig(h,{disableRange:P,disableStream:L});else if(!n){if(!s)throw Error("getDocument - no `url` parameter provided.");e=new(tT(s)?iC:I?iL:iI)({url:s,length:$,httpHeaders:a,withCredentials:o,rangeChunkSize:d,disableRange:P,disableStream:L})}return l.then(s=>{if(i.destroyed)throw Error("Loading aborted");if(c.destroyed)throw Error("Worker was destroyed");let n=new ed(r,s,c.port),a=new iq(n,i,e,q,G,U);i._transport=a,n.send("Ready",null)})}).catch(i._capability.reject),i}class i${static #ib=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId="d"+i$.#ib++;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class iH{#r_=Promise.withResolvers();#rY=[];#rJ=[];#rK=[];#rQ=[];constructor(e,i,r=!1,s=null){this.length=e,this.initialData=i,this.progressiveDone=r,this.contentDispositionFilename=s}addRangeListener(e){this.#rQ.push(e)}addProgressListener(e){this.#rK.push(e)}addProgressiveReadListener(e){this.#rJ.push(e)}addProgressiveDoneListener(e){this.#rY.push(e)}onDataRange(e,i){for(let r of this.#rQ)r(e,i)}onDataProgress(e,i){this.#r_.promise.then(()=>{for(let r of this.#rK)r(e,i)})}onDataProgressiveRead(e){this.#r_.promise.then(()=>{for(let i of this.#rJ)i(e)})}onDataProgressiveDone(){this.#r_.promise.then(()=>{for(let e of this.#rY)e()})}transportReady(){this.#r_.resolve()}requestDataRange(e,i){G("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class iz{constructor(e,i){this._pdfInfo=e,this._transport=i}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Y(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,i){return this._transport.getAnnotationsByType(e,i)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:i}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(i)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class iV{#rZ=!1;constructor(e,i,r,s=!1){this._pageIndex=e,this._pageInfo=i,this._transport=r,this._stats=s?new tC:null,this._pdfBug=s,this.commonObjs=r.commonObjs,this.objs=new iB,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:i=this.rotate,offsetX:r=0,offsetY:s=0,dontFlip:n=!1}={}){return new t_({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:i,offsetX:r,offsetY:s,dontFlip:n})}getAnnotations({intent:e="display"}={}){let{renderingIntent:i}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,i)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Y(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:i=e.canvas,viewport:r,intent:s="display",annotationMode:n=R.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:d=null,printAnnotationStorage:c=null,isEditing:u=!1,recordOperations:p=!1,operationsFilter:f=null}){this._stats?.time("Overall");let g=this._transport.getRenderingIntent(s,n,c,u),{renderingIntent:m,cacheKey:b}=g;this.#rZ=!1,l||=this._transport.getOptionalContentConfig(m);let v=this._intentStates.get(b);v||(v=Object.create(null),this._intentStates.set(b,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);let y=!!(4&m);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));let _=!!(this._pdfBug&&globalThis.StepperManager?.enabled),w=!this.recordedBBoxes&&(p||_),A=e=>{if(v.renderTasks.delete(x),w){let e=x.gfx?.dependencyTracker.take();e&&(x.stepper&&x.stepper.setOperatorBBoxes(e,x.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=e))}y&&(this.#rZ=!0),this.#r0(),e?(x.capability.reject(e),this._abortOperatorList({intentState:v,reason:e instanceof Error?e:Error(e)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new iY({callback:A,params:{canvas:i,canvasContext:e,dependencyTracker:w?new eL(i,v.operatorList.length,_):null,viewport:r,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:f});(v.renderTasks||=new Set).add(x);let S=x.task;return Promise.all([v.displayReadyCapability.promise,l]).then(([e,i])=>{if(this.destroyed)A();else{if(this._stats?.time("Rendering"),!(i.renderingIntent&m))throw Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:e,optionalContentConfig:i}),x.operatorListChanged()}}).catch(A),S}getOperatorList({intent:e="display",annotationMode:i=R.ENABLE,printAnnotationStorage:r=null,isEditing:s=!1}={}){let n=this._transport.getRenderingIntent(e,i,r,s,!0),a,o=this._intentStates.get(n.cacheKey);return o||(o=Object.create(null),this._intentStates.set(n.cacheKey,o)),o.opListReadCapability||((a=Object.create(null)).operatorListChanged=function(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(a))},o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(a),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(n)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:i=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===i},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(e=>tg.textContent(e));let i=this.streamTextContent(e);return new Promise(function(e,r){let s=i.getReader(),n={items:[],styles:Object.create(null),lang:null};!function i(){s.read().then(function({value:r,done:s}){s?e(n):(n.lang??=r.lang,Object.assign(n.styles,r.styles),n.items.push(...r.items),i())},r)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let i of this._intentStates.values())if(this._abortOperatorList({intentState:i,reason:Error("Page was destroyed."),force:!0}),!i.opListReadCapability)for(let r of i.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),this.#rZ=!1,Promise.all(e)}cleanup(e=!1){this.#rZ=!0;let i=this.#r0();return e&&i&&(this._stats&&=new tC),i}#r0(){if(!this.#rZ||this.destroyed)return!1;for(let{renderTasks:e,operatorList:i}of this._intentStates.values())if(e.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#rZ=!1,!0}_startRenderPage(e,i){let r=this._intentStates.get(i);r&&(this._stats?.timeEnd("Page Request"),r.displayReadyCapability?.resolve(e))}_renderPageChunk(e,i){for(let r=0,s=e.length;r<s;r++)i.operatorList.fnArray.push(e.fnArray[r]),i.operatorList.argsArray.push(e.argsArray[r]);for(let r of(i.operatorList.lastChunk=e.lastChunk,i.operatorList.separateAnnots=e.separateAnnots,i.renderTasks))r.operatorListChanged();e.lastChunk&&this.#r0()}_pumpOperatorList({renderingIntent:e,cacheKey:i,annotationStorageSerializable:r,modifiedIds:s}){let{map:n,transfer:a}=r,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:i,annotationStorage:n,modifiedIds:s},a).getReader(),l=this._intentStates.get(i);l.streamReader=o;let h=()=>{o.read().then(({value:e,done:i})=>{i?l.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,l),h())},e=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){for(let e of(l.operatorList.lastChunk=!0,l.renderTasks))e.operatorListChanged();this.#r0()}if(l.displayReadyCapability)l.displayReadyCapability.reject(e);else{if(!l.opListReadCapability)throw e;l.opListReadCapability.reject(e)}}})};h()}_abortOperatorList({intentState:e,reason:i,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(i instanceof tw){let r=100;return i.extraDelay>0&&i.extraDelay<1e3&&(r+=i.extraDelay),void(e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:i,force:!0})},r))}}if(e.streamReader.cancel(new ti(i.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}let iG=class e{constructor({name:i=null,port:r=null,verbosity:s=H}={}){if(x(this,p),x(this,a,Promise.withResolvers()),x(this,o,null),x(this,l,null),x(this,h,null),this.name=i,this.destroyed=!1,this.verbosity=s,r){if(A(e,u).has(r))throw Error("Cannot use more than one PDFWorker per port.");A(e,u).set(r,this),E(this,p,g).call(this,r)}else E(this,p,m).call(this)}get promise(){return A(this,a).promise}get port(){return A(this,l)}get messageHandler(){return A(this,o)}destroy(){this.destroyed=!0,A(this,h)?.terminate(),S(this,h,null),A(e,u).delete(A(this,l)),S(this,l,null),A(this,o)?.destroy(),S(this,o,null)}static create(i){let r=A(this,u).get(i?.port);if(r){if(r._pendingDestroy)throw Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return r}return new e(i)}static get workerSrc(){if(ih.workerSrc)return ih.workerSrc;throw Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Y(this,"_setupFakeWorkerGlobal",(async()=>A(this,v,y)?A(this,v,y):(await r(36966)(this.workerSrc)).WorkerMessageHandler)())}};a=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakSet,f=function(){A(this,a).resolve(),A(this,o).send("configure",{verbosity:this.verbosity})},g=function(e){S(this,l,e),S(this,o,new ed("main","worker",e)),A(this,o).on("ready",()=>{}),E(this,p,f).call(this)},m=function(){if(A(iG,c)||A(iG,v,y))return void E(this,p,b).call(this);let{workerSrc:e}=iG;try{iG._isSameOrigin(window.location,e)||(e=iG._createCDNWrapper(new URL(e,window.location).href));let i=new Worker(e,{type:"module"}),r=new ed("main","worker",i),s=()=>{n.abort(),r.destroy(),i.terminate(),this.destroyed?A(this,a).reject(Error("Worker was destroyed")):E(this,p,b).call(this)},n=new AbortController;i.addEventListener("error",()=>{A(this,h)||s()},{signal:n.signal}),r.on("test",e=>{n.abort(),!this.destroyed&&e?(S(this,o,r),S(this,l,i),S(this,h,i),E(this,p,f).call(this)):s()}),r.on("ready",e=>{if(n.abort(),this.destroyed)s();else try{d()}catch{E(this,p,b).call(this)}});let d=()=>{let e=new Uint8Array;r.send("test",e,[e.buffer])};return void d()}catch{z("The worker has been disabled.")}E(this,p,b).call(this)},b=function(){A(iG,c)||(V("Setting up fake worker."),S(iG,c,!0)),iG._setupFakeWorkerGlobal.then(e=>{var i,r;if(this.destroyed)return void A(this,a).reject(Error("Worker was destroyed"));let s=new eo;S(this,l,s);let n="fake"+({set _(t){S(iG,d,t,i)},get _(){return A(iG,d,r)}})._++,h=new ed(n+"_worker",n,s);e.setup(h,s),S(this,o,new ed(n,n+"_worker",s)),E(this,p,f).call(this)}).catch(e=>{A(this,a).reject(Error(`Setting up fake worker failed: "${e.message}".`))})},v=new WeakSet,y=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},x(iG,v),x(iG,d,0),x(iG,c,!1),x(iG,u,new WeakMap),I&&(S(iG,c,!0),ih.workerSrc||="./pdf.worker.mjs"),iG._isSameOrigin=(e,i)=>{let r=URL.parse(e);if(!r?.origin||"null"===r.origin)return!1;let s=new URL(i,r);return r.origin===s.origin},iG._createCDNWrapper=e=>{let i=`await import("${e}");`;return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))},iG.fromPort=e=>{if(console.log("Deprecated API usage: `PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw Error("PDFWorker.fromPort - invalid method signature.");return iG.create(e)};let iW=iG;class iq{#r1=new Map;#r2=new Map;#r5=new Map;#r4=new Map;#r3=null;constructor(e,i,r,s,n,a){this.messageHandler=e,this.loadingTask=i,this.commonObjs=new iB,this.fontLoader=new ei({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}#r6(e,i=null){let r=this.#r1.get(e);if(r)return r;let s=this.messageHandler.sendWithPromise(e,i);return this.#r1.set(e,s),s}get annotationStorage(){return Y(this,"annotationStorage",new et)}getRenderingIntent(e,i=R.ENABLE,r=null,s=!1,n=!1){let a=2,o=t7;switch(e){case"any":a=1;break;case"display":break;case"print":a=4;break;default:V(`getRenderingIntent - invalid intent: ${e}`)}let l=4&a&&r instanceof ee?r:this.annotationStorage;switch(i){case R.DISABLE:a+=64;break;case R.ENABLE:break;case R.ENABLE_FORMS:a+=16;break;case R.ENABLE_STORAGE:a+=32,o=l.serializable;break;default:V(`getRenderingIntent - invalid annotationMode: ${i}`)}s&&(a+=128),n&&(a+=256);let{ids:h,hash:d}=l.modifiedIds;return{renderingIntent:a,cacheKey:[a,o.hash,d].join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r3?.reject(Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of this.#r2.values())e.push(i._destroy());this.#r2.clear(),this.#r5.clear(),this.#r4.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let i=this.messageHandler.sendWithPromise("Terminate",null);return e.push(i),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#r1.clear(),this.filterFactory.destroy(),iU.cleanup(),this._networkStream?.cancelAllRequests(new ti("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:i}=this;e.on("GetReader",(e,i)=>{W(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},i.onPull=()=>{this._fullReader.read().then(function({value:e,done:r}){r?i.close():(W(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(e),1,[e]))}).catch(e=>{i.error(e)})},i.onCancel=e=>{this._fullReader.cancel(e),i.ready.catch(e=>{if(!this.destroyed)throw e})}}),e.on("ReaderHeadersReady",async e=>{await this._fullReader.headersReady;let{isStreamingSupported:r,isRangeSupported:s,contentLength:n}=this._fullReader;return r&&s||(this._lastProgress&&i.onProgress?.(this._lastProgress),this._fullReader.onProgress=e=>{i.onProgress?.({loaded:e.loaded,total:e.total})}),{isStreamingSupported:r,isRangeSupported:s,contentLength:n}}),e.on("GetRangeReader",(e,i)=>{W(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(e.begin,e.end);r?(i.onPull=()=>{r.read().then(function({value:e,done:r}){r?i.close():(W(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(e),1,[e]))}).catch(e=>{i.error(e)})},i.onCancel=e=>{r.cancel(e),i.ready.catch(e=>{if(!this.destroyed)throw e})}):i.close()}),e.on("GetDoc",({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,i._capability.resolve(new iz(e,this))}),e.on("DocException",e=>{i._capability.reject(eh(e))}),e.on("PasswordRequest",e=>{this.#r3=Promise.withResolvers();try{if(!i.onPassword)throw eh(e);i.onPassword(e=>{e instanceof Error?this.#r3.reject(e):this.#r3.resolve({password:e})},e.code)}catch(e){this.#r3.reject(e)}return this.#r3.promise}),e.on("DataLoaded",e=>{i.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)}),e.on("StartRenderPage",e=>{this.destroyed||this.#r2.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)}),e.on("commonobj",([i,r,s])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(r){case"Font":if("error"in s){let e=s.error;V(`Error during font loading: ${e}`),this.commonObjs.resolve(i,e);break}let n=new er(new il(s),this._params.pdfBug&&globalThis.FontInspector?.enabled?(e,i)=>globalThis.FontInspector.fontAdded(e,i):null,s.extra,s.charProcOperatorList);this.fontLoader.bind(n).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!n.fontExtraProperties&&n.data&&n.clearData(),this.commonObjs.resolve(i,n)});break;case"CopyLocalImage":let{imageRef:a}=s;for(let e of(W(a,"The imageRef must be defined."),this.#r2.values()))for(let[,r]of e.objs)if(r?.ref===a)return r.dataLen?(this.commonObjs.resolve(i,structuredClone(r)),r.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,s);break;default:throw Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([e,i,r,s])=>{if(this.destroyed)return;let n=this.#r2.get(i);if(!n.objs.has(e)){if(0!==n._intentStates.size)switch(r){case"Image":case"Pattern":n.objs.resolve(e,s);break;default:throw Error(`Got unknown object type ${r}`)}else s?.bitmap?.close()}}),e.on("DocProgress",e=>{this.destroyed||i.onProgress?.({loaded:e.loaded,total:e.total})}),e.on("FetchBinaryData",async e=>{if(this.destroyed)throw Error("Worker was destroyed.");let i=this[e.type];if(!i)throw Error(`${e.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(e)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&V("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:i}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},i).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(Error("Invalid page request."));let i=e-1,r=this.#r5.get(i);if(r)return r;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:i}).then(r=>{if(this.destroyed)throw Error("Transport destroyed");r.refStr&&this.#r4.set(r.refStr,e);let s=new iV(i,r,this,this._params.pdfBug);return this.#r2.set(i,s),s});return this.#r5.set(i,s),s}getPageIndex(e){return en(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(Error("Invalid pageIndex request."))}getAnnotations(e,i){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:i})}getFieldObjects(){return this.#r6("GetFieldObjects")}hasJSActions(){return this.#r6("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,i){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:i})}getDocJSActions(){return this.#r6("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#r6("GetOptionalContentConfig").then(i=>new ip(i,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",i=this.#r1.get(e);if(i)return i;let r=this.messageHandler.sendWithPromise(e,null).then(e=>({info:e[0],metadata:e[1]?new id(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#r1.set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){for(let e of(await this.messageHandler.sendWithPromise("Cleanup",null),this.#r2.values()))if(!e.cleanup())throw Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#r1.clear(),this.filterFactory.destroy(!0),iU.cleanup()}}cachedPageNumber(e){if(!en(e))return null;let i=0===e.gen?`${e.num}R`:`${e.num}R${e.gen}`;return this.#r4.get(i)??null}}class iX{#r9=null;onContinue=null;onError=null;constructor(e){this.#r9=e}get promise(){return this.#r9.capability.promise}cancel(e=0){this.#r9.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#r9.operatorList;if(!e)return!1;let{annotationCanvasMap:i}=this.#r9;return e.form||e.canvas&&i?.size>0}}class iY{#r8=null;static #r7=new WeakSet;constructor({callback:e,params:i,objs:r,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:c=!1,pageColors:u=null,enableHWA:p=!1,operationsFilter:f=null}){this.callback=e,this.params=i,this.objs=r,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=c,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new iX(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=i.canvas,this._canvasContext=i.canvas?null:i.canvasContext,this._enableHWA=p,this._dependencyTracker=i.dependencyTracker,this._operationsFilter=f}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:i}){if(this.cancelled)return;if(this._canvas){if(iY.#r7.has(this._canvas))throw Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");iY.#r7.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{viewport:r,transform:s,background:n,dependencyTracker:a}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new is(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:i},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:s,viewport:r,transparency:e,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,i=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#r8&&(window.cancelAnimationFrame(this.#r8),this.#r8=null),iY.#r7.delete(this._canvas),e||=new tw(`Rendering cancelled, page ${this._pageIndex+1}`,i),this.callback(e),this.task.onError?.(e)}operatorListChanged(){this.graphicsReady?(this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#r8=window.requestAnimationFrame(()=>{this.#r8=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),iY.#r7.delete(this._canvas),this.callback())))}}let iJ="5.4.296",iK="f56dc8601";class iQ{#st=null;#se=null;#si;#sr=null;#ss=!1;#sn=!1;#n=null;#sa;#so=null;#b=null;static #sl=null;static get _keyboardManager(){return Y(this,"_keyboardManager",new t0([[["Escape","mac+Escape"],iQ.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],iQ.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],iQ.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],iQ.prototype._moveToPrevious],[["Home","mac+Home"],iQ.prototype._moveToBeginning],[["End","mac+End"],iQ.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:i=null}){e?(this.#sn=!1,this.#n=e):this.#sn=!0,this.#b=e?._uiManager||i,this.#sa=this.#b._eventBus,this.#si=e?.color?.toUpperCase()||this.#b?.highlightColors.values().next().value||"#FFFF98",iQ.#sl||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let e=this.#st=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#n&&(e.ariaControls=`${this.#n.id}_colorpicker_dropdown`);let i=this.#b._signal;e.addEventListener("click",this.#sh.bind(this),{signal:i}),e.addEventListener("keydown",this.#sd.bind(this),{signal:i});let r=this.#se=document.createElement("span");return r.className="swatch",r.ariaHidden="true",r.style.backgroundColor=this.#si,e.append(r),e}renderMainDropdown(){let e=this.#sr=this.#sc();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#sc(){let e=document.createElement("div"),i=this.#b._signal;for(let[r,s]of(e.addEventListener("contextmenu",tM,{signal:i}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#n&&(e.id=`${this.#n.id}_colorpicker_dropdown`),this.#b.highlightColors)){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=r,n.setAttribute("data-l10n-id",iQ.#sl[r]);let a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.ariaSelected=s===this.#si,n.addEventListener("click",this.#su.bind(this,s),{signal:i}),e.append(n)}return e.addEventListener("keydown",this.#sd.bind(this),{signal:i}),e}#su(e,i){i.stopPropagation(),this.#sa.dispatch("switchannotationeditorparams",{source:this,type:N.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#st)return void this.#sh(e);let i=e.target.getAttribute("data-color");i&&this.#su(i,e)}_moveToNext(e){this.#sp?e.target!==this.#st?e.target.nextSibling?.focus():this.#sr.firstChild?.focus():this.#sh(e)}_moveToPrevious(e){e.target!==this.#sr?.firstChild&&e.target!==this.#st?(this.#sp||this.#sh(e),e.target.previousSibling?.focus()):this.#sp&&this._hideDropdownFromKeyboard()}_moveToBeginning(e){this.#sp?this.#sr.firstChild?.focus():this.#sh(e)}_moveToEnd(e){this.#sp?this.#sr.lastChild?.focus():this.#sh(e)}#sd(e){iQ._keyboardManager.exec(this,e)}#sh(e){if(this.#sp)return void this.hideDropdown();if(this.#ss=0===e.detail,this.#so||(this.#so=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#b.combinedSignal(this.#so)})),this.#st.ariaExpanded="true",this.#sr)return void this.#sr.classList.remove("hidden");let i=this.#sr=this.#sc();this.#st.append(i)}#u(e){this.#sr?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#sr?.classList.add("hidden"),this.#st.ariaExpanded="false",this.#so?.abort(),this.#so=null}get #sp(){return this.#sr&&!this.#sr.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#sn||(this.#sp?(this.hideDropdown(),this.#st.focus({preventScroll:!0,focusVisible:this.#ss})):this.#n?.unselect())}updateColor(e){if(this.#se&&(this.#se.style.backgroundColor=e),!this.#sr)return;let i=this.#b.highlightColors.values();for(let r of this.#sr.children)r.ariaSelected=i.next().value===e.toUpperCase()}destroy(){this.#st?.remove(),this.#st=null,this.#se=null,this.#sr?.remove(),this.#sr=null}}class iZ{#sf=null;#n=null;#b=null;static #sl=null;constructor(e){this.#n=e,this.#b=e._uiManager,iZ.#sl||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#sf)return this.#sf;let{editorType:e,colorType:i,colorValue:r}=this.#n,s=this.#sf=document.createElement("input");return s.type="color",s.value=r||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",iZ.#sl[e]),s.addEventListener("input",()=>{this.#b.updateParams(i,s.value)},{signal:this.#b._signal}),s}update(e){this.#sf&&(this.#sf.value=e)}destroy(){this.#sf?.remove(),this.#sf=null}hideDropdown(){}}function i0(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function i1(e){return Math.max(0,Math.min(255,255*e))}k(116),k(531);class i2{static CMYK_G([e,i,r,s]){return["G",1-Math.min(1,.3*e+.59*r+.11*i+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return[e=i1(e),e,e]}static G_HTML([e]){let i=i0(e);return`#${i}${i}${i}`}static RGB_G([e,i,r]){return["G",.3*e+.59*i+.11*r]}static RGB_rgb(e){return e.map(i1)}static RGB_HTML(e){return`#${e.map(i0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,i,r,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,r+s),1-Math.min(1,i+s)]}static CMYK_rgb([e,i,r,s]){return[i1(1-Math.min(1,e+s)),i1(1-Math.min(1,r+s)),i1(1-Math.min(1,i+s))]}static CMYK_HTML(e){let i=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(i)}static RGB_CMYK([e,i,r]){let s=1-e,n=1-i,a=1-r;return["CMYK",s,n,a,Math.min(s,n,a)]}}class i5{create(e,i,r=!1){if(e<=0||i<=0)throw Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),r||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${i}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${i}`),s}createElement(e){if("string"!=typeof e)throw Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){G("Abstract method `_createSVG` called.")}}class i4 extends i5{_createSVG(e){return document.createElementNS(tb,e)}}let i3=new WeakSet,i6=60*(new Date).getTimezoneOffset()*1e3;class i9{static create(e){switch(e.data.annotationType){case B.LINK:return new rt(e);case B.TEXT:return new re(e);case B.WIDGET:switch(e.data.fieldType){case"Tx":return new rr(e);case"Btn":return e.data.radioButton?new ra(e):e.data.checkBox?new rn(e):new ro(e);case"Ch":return new rl(e);case"Sig":return new rs(e)}return new ri(e);case B.POPUP:return new rh(e);case B.FREETEXT:return new rc(e);case B.LINE:return new ru(e);case B.SQUARE:return new rp(e);case B.CIRCLE:return new rf(e);case B.POLYLINE:return new rg(e);case B.CARET:return new rb(e);case B.INK:return new rv(e);case B.POLYGON:return new rm(e);case B.HIGHLIGHT:return new ry(e);case B.UNDERLINE:return new r_(e);case B.SQUIGGLY:return new rw(e);case B.STRIKEOUT:return new rA(e);case B.STAMP:return new rx(e);case B.FILEATTACHMENT:return new rS(e);default:return new i8(e)}}}class i8{#sg=null;#sm=!1;#sb=null;constructor(e,{isRenderable:i=!1,ignoreBorder:r=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=i,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,i&&(this.container=this._createContainer(r)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:i}){return!(!e?.str&&!i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return i8._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){let{data:e}=this,i=this.annotationStorage?.getEditor(e.id);return i?i.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){let e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;let{quadPoints:i,inkLists:r,rect:s}=this.data,n=-1/0,a=-1/0;if(i?.length>=8){for(let e=0;e<i.length;e+=8)i[e+1]>a?(a=i[e+1],n=i[e+2]):i[e+1]===a&&(n=Math.max(n,i[e+2]));return[n,a]}if(r?.length>=1){for(let e of r)for(let i=0,r=e.length;i<r;i+=2)e[i+1]>a?(a=e[i+1],n=e[i]):e[i+1]===a&&(n=Math.max(n,e[i]));if(n!==1/0)return[n,a]}return s?[s[2],s[3]]:null}_normalizePoint(e){let{page:{view:i},viewport:{rawDims:{pageWidth:r,pageHeight:s,pageX:n,pageY:a}}}=this.parent;return e[1]=i[3]-e[1]+i[1],e[0]=100*(e[0]-n)/r,e[1]=100*(e[1]-a)/s,e}get commentText(){let{data:e}=this;return this.annotationStorage.getRawValue(`${P}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){let{data:i}=this,r={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(i.id,{popup:r})||this.annotationStorage.setValue(`${P}${i.id}`,{id:i.id,annotationType:i.annotationType,pageIndex:this.parent.page._pageIndex,popup:r,popupRef:i.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#sb?.popup||this.popup)?.remove(),this.#sb=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#sg||={rect:this.data.rect.slice(0)});let{rect:i,popup:r}=e;i&&this.#sv(i);let s=this.#sb?.popup||this.popup;!s&&r?.text&&(this._createPopup(r),s=this.#sb.popup),s&&(s.updateEdited(e),r?.deleted&&(s.remove(),this.#sb=null,this.popup=null))}resetEdited(){this.#sg&&(this.#sv(this.#sg.rect),this.#sb?.popup.resetEdited(),this.#sg=null)}#sv(e){let{container:{style:i},data:{rect:r,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;r?.splice(0,4,...e),i.left=100*(e[0]-o)/n+"%",i.top=100*(a-e[3]+l)/a+"%",0===s?(i.width=100*(e[2]-e[0])/n+"%",i.height=100*(e[3]-e[1])/a+"%"):this.setRotation(s)}_createContainer(e){let{data:i,parent:{page:r,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",i.id),this instanceof ri||this instanceof rt||(n.tabIndex=0);let{style:a}=n;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,i.alternativeText&&(n.title=i.alternativeText),i.noRotate&&n.classList.add("norotate"),!i.rect||this instanceof rh){let{rotation:e}=i;return i.hasOwnCanvas||0===e||this.setRotation(e,n),n}let{width:o,height:l}=this;if(!e&&i.borderStyle.width>0){a.borderWidth=`${i.borderStyle.width}px`;let e=i.borderStyle.horizontalCornerRadius,r=i.borderStyle.verticalCornerRadius;if(e>0||r>0){let i=`calc(${e}px * var(--total-scale-factor)) / calc(${r}px * var(--total-scale-factor))`;a.borderRadius=i}else if(this instanceof ra){let e=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=e}switch(i.borderStyle.style){case 1:a.borderStyle="solid";break;case 2:a.borderStyle="dashed";break;case 3:V("Unimplemented border style: beveled");break;case 4:V("Unimplemented border style: inset");break;case 5:a.borderBottomStyle="solid"}let s=i.borderColor||null;s?(this.#sm=!0,a.borderColor=to.makeHexColor(0|s[0],0|s[1],0|s[2])):a.borderWidth=0}let h=to.normalizeRect([i.rect[0],r.view[3]-i.rect[1]+r.view[1],i.rect[2],r.view[3]-i.rect[3]+r.view[1]]),{pageWidth:d,pageHeight:c,pageX:u,pageY:p}=s.rawDims;a.left=100*(h[0]-u)/d+"%",a.top=100*(h[1]-p)/c+"%";let{rotation:f}=i;return i.hasOwnCanvas||0===f?(a.width=100*o/d+"%",a.height=100*l/c+"%"):this.setRotation(f,n),n}setRotation(e,i=this.container){if(!this.data.rect)return;let{pageWidth:r,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:a}=this;e%180!=0&&([n,a]=[a,n]),i.style.width=100*n/r+"%",i.style.height=100*a/s+"%",i.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(e,i,r)=>{let s=r.detail[e],n=s[0],a=s.slice(1);r.target.style[i]=i2[`${n}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:i2[`${n}_rgb`](a)})};return Y(this,"_commonActions",{display:e=>{let{display:i}=e.detail,r=i%2==1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:1===i||2===i})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:i=>{e("bgColor","backgroundColor",i)},fillColor:i=>{e("fillColor","backgroundColor",i)},fgColor:i=>{e("fgColor","color",i)},textColor:i=>{e("textColor","color",i)},borderColor:i=>{e("borderColor","borderColor",i)},strokeColor:i=>{e("strokeColor","borderColor",i)},rotation:e=>{let i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,i){let r=this._commonActions;for(let s of Object.keys(i.detail)){let n=e[s]||r[s];n?.(i)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let i=this.annotationStorage.getRawValue(this.data.id);if(!i)return;let r=this._commonActions;for(let[s,n]of Object.entries(i)){let a=r[s];a&&(a({detail:{[s]:n},target:e}),delete i[s])}}_createQuadrilaterals(){let e;if(!this.container)return;let{quadPoints:i}=this.data;if(!i)return;let[r,s,n,a]=this.data.rect.map(e=>Math.fround(e));if(8===i.length){let[e,o,l,h]=i.subarray(2,6);if(n===e&&a===o&&r===l&&s===h)return}let{style:o}=this.container;if(this.#sm){let{borderColor:i,borderWidth:r}=o;o.borderWidth=0,e=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${i}" stroke-width="${r}">`],this.container.classList.add("hasBorder")}let l=n-r,h=a-s,{svgFactory:d}=this,c=d.createElement("svg");c.classList.add("quadrilateralsContainer"),c.setAttribute("width",0),c.setAttribute("height",0),c.role="none";let u=d.createElement("defs");c.append(u);let p=d.createElement("clipPath"),f=`clippath_${this.data.id}`;p.setAttribute("id",f),p.setAttribute("clipPathUnits","objectBoundingBox"),u.append(p);for(let s=2,n=i.length;s<n;s+=8){let n=i[s],o=i[s+1],c=i[s+2],u=i[s+3],f=d.createElement("rect"),g=(c-r)/l,m=(a-o)/h,b=(n-c)/l,v=(o-u)/h;f.setAttribute("x",g),f.setAttribute("y",m),f.setAttribute("width",b),f.setAttribute("height",v),p.append(f),e?.push(`<rect vector-effect="non-scaling-stroke" x="${g}" y="${m}" width="${b}" height="${v}"/>`)}this.#sm&&(e.push("</g></svg>')"),o.backgroundImage=e.join("")),this.container.append(c),this.container.style.clipPath=`url(#${f})`}_createPopup(e=null){let i,r;let{data:s}=this;e?(i={str:e.text},r=e.date):(i=s.contentsObj,r=s.modificationDate);let n=this.#sb=new rh({data:{color:s.color,titleObj:s.titleObj,modificationDate:r,contentsObj:i,richText:s.richText,parentRect:s.rect,borderStyle:0,id:`popup_${s.id}`,rotation:s.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(n.render())}get hasPopupElement(){return!!(this.#sb||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#sb}render(){G("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,i=null){let r=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:e,id:n,exportValues:a}of s){if(-1===e||n===i)continue;let s="string"==typeof a?a:null,o=document.querySelector(`[data-element-id="${n}"]`);!o||i3.has(o)?r.push({id:n,exportValue:s,domElement:o}):V(`_getElementsByName - element not allowed: ${n}`)}return r}for(let s of document.getElementsByName(e)){let{exportValue:e}=s,n=s.getAttribute("data-element-id");n!==i&&i3.has(s)&&r.push({id:n,exportValue:e,domElement:s})}return r}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let i of e)i.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:i}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:i,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class i7 extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){let{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class rt extends i8{constructor(e,i=null){super(e,{isRenderable:!0,ignoreBorder:!!i?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:i}=this,r=document.createElement("a");r.setAttribute("data-element-id",e.id);let s=!1;return e.url?(i.addLinkAttributes(r,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(r,e.action,e.overlaidText),s=!0):e.attachment?(this.#sy(r,e.attachment,e.overlaidText,e.attachmentDest),s=!0):e.setOCGState?(this.#s_(r,e.setOCGState,e.overlaidText),s=!0):e.dest?(this._bindLink(r,e.dest,e.overlaidText),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,e),s=!0),e.resetForm?(this._bindResetFormAction(r,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(r,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(r),this.container}#sw(){this.container.setAttribute("data-internal-link","")}_bindLink(e,i,r=""){e.href=this.linkService.getDestinationHash(i),e.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||""===i)&&this.#sw(),r&&(e.title=r)}_bindNamedAction(e,i,r=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(i),!1),r&&(e.title=r),this.#sw()}#sy(e,i,r="",s=null){e.href=this.linkService.getAnchorUrl(""),i.description?e.title=i.description:r&&(e.title=r),e.onclick=()=>(this.downloadManager?.openOrDownloadData(i.content,i.filename,s),!1),this.#sw()}#s_(e,i,r=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(i),!1),r&&(e.title=r),this.#sw()}_bindJSAction(e,i){e.href=this.linkService.getAnchorUrl("");let r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let s of Object.keys(i.actions)){let n=r.get(s);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:s}}),!1))}i.overlaidText&&(e.title=i.overlaidText),e.onclick||(e.onclick=()=>!1),this.#sw()}_bindResetFormAction(e,i){let r=e.onclick;if(r||(e.href=this.linkService.getAnchorUrl("")),this.#sw(),!this._fieldObjects)return V('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(r||(e.onclick=()=>!1));e.onclick=()=>{r?.();let{fields:e,refs:s,include:n}=i,a=[];if(0!==e.length||0!==s.length){let i=new Set(s);for(let r of e)for(let{id:e}of this._fieldObjects[r]||[])i.add(e);for(let e of Object.values(this._fieldObjects))for(let r of e)i.has(r.id)===n&&a.push(r)}else for(let e of Object.values(this._fieldObjects))a.push(...e);let o=this.annotationStorage,l=[];for(let e of a){let{id:i}=e;switch(l.push(i),e.type){case"text":{let r=e.defaultValue||"";o.setValue(i,{value:r});break}case"checkbox":case"radiobutton":{let r=e.defaultValue===e.exportValues;o.setValue(i,{value:r});break}case"combobox":case"listbox":{let r=e.defaultValue||"";o.setValue(i,{value:r});break}default:continue}let r=document.querySelector(`[data-element-id="${i}"]`);r&&(i3.has(r)?r.dispatchEvent(new Event("resetform")):V(`_bindResetFormAction - element not allowed: ${i}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class re extends i8{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class ri extends i8{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&("CANVAS"===e.previousSibling?.nodeName&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return tn.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,i,r,s,n){r.includes("mouse")?e.addEventListener(r,e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(r,e=>{if("blur"===r){if(!i.focused||!e.relatedTarget)return;i.focused=!1}else if("focus"===r){if(i.focused)return;i.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(e)}})})}_setEventListeners(e,i,r,s){for(let[n,a]of r)("Action"===a||this.data.actions?.[a])&&("Focus"!==a&&"Blur"!==a||(i||={focused:!1}),this._setEventListener(e,i,n,a,s),"Focus"!==a||this.data.actions?.Blur?"Blur"!==a||this.data.actions?.Focus||this._setEventListener(e,i,"focus","Focus",null):this._setEventListener(e,i,"blur","Blur",null))}_setBackgroundColor(e){let i=this.data.backgroundColor||null;e.style.backgroundColor=null===i?"transparent":to.makeHexColor(i[0],i[1],i[2])}_setTextStyle(e){let i;let{fontColor:r}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||9,n=e.style,a=e=>Math.round(10*e)/10;if(this.data.multiLine){let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),r=e/(Math.round(e/(1.35*s))||1);i=Math.min(s,a(r/1.35))}else i=Math.min(s,a(Math.abs(this.data.rect[3]-this.data.rect[1]-2)/1.35));n.fontSize=`calc(${i}px * var(--total-scale-factor))`,n.color=to.makeHexColor(r[0],r[1],r[2]),null!==this.data.textAlignment&&(n.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(e,i){i?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",i)}}class rr extends ri{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,i,r,s){let n=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[i]=r),n.setValue(a.id,{[s]:r})}render(){let e=this.annotationStorage,i=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){let s=e.getValue(i,{value:this.data.fieldValue}),n=s.value||"",a=e.getValue(i,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let o=s.formattedValue||this.data.textContent?.join("\n")||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));let l={userValue:n,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((r=document.createElement("textarea")).textContent=o??n,this.data.doNotScroll&&(r.style.overflowY="hidden")):((r=document.createElement("input")).type=this.data.password?"password":"text",r.setAttribute("value",o??n),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),i3.add(r),r.setAttribute("data-element-id",i),r.disabled=this.data.readOnly,r.name=this.data.fieldName,r.tabIndex=0;let{datetimeFormat:h,datetimeType:d,timeStep:c}=this.data,u=!!d&&this.enableScripting;h&&(r.title=h),this._setRequired(r,this.data.required),a&&(r.maxLength=a),r.addEventListener("input",s=>{e.setValue(i,{value:s.target.value}),this.setPropertyOnSiblings(r,"value",s.target.value,"value"),l.formattedValue=null}),r.addEventListener("resetform",e=>{let i=this.data.defaultFieldValue??"";r.value=l.userValue=i,l.formattedValue=null});let p=e=>{let{formattedValue:i}=l;null!=i&&(e.target.value=i),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",e=>{if(l.focused)return;let{target:i}=e;if(u&&(i.type=d,c&&(i.step=c)),l.userValue){let e=l.userValue;if(u){if("time"===d){let r=new Date(e),s=[r.getHours(),r.getMinutes(),r.getSeconds()];i.value=s.map(e=>e.toString().padStart(2,"0")).join(":")}else i.value=new Date(e-i6).toISOString().split("date"===d?"T":".",1)[0]}else i.value=e}l.lastCommittedValue=i.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),r.addEventListener("updatefromsandbox",r=>{this.showElementAndHideCanvas(r.target),this._dispatchEventFromSandbox({value(r){l.userValue=r.detail.value??"",u||e.setValue(i,{value:l.userValue.toString()}),r.target.value=l.userValue},formattedValue(r){let{formattedValue:s}=r.detail;l.formattedValue=s,null!=s&&r.target!==document.activeElement&&(r.target.value=s);let n={formattedValue:s};u&&(n.value=s),e.setValue(i,n)},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:r=>{let{charLimit:s}=r.detail,{target:n}=r;if(0===s)return void n.removeAttribute("maxLength");n.setAttribute("maxLength",s);let a=l.userValue;!a||a.length<=s||(a=a.slice(0,s),n.value=l.userValue=a,e.setValue(i,{value:a}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:a,willCommit:!0,commitKey:1,selStart:n.selectionStart,selEnd:n.selectionEnd}}))}},r)}),r.addEventListener("keydown",e=>{l.commitKey=1;let r=-1;if("Escape"===e.key?r=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(l.commitKey=3):r=2,-1===r)return;let{value:s}=e.target;l.lastCommittedValue!==s&&(l.lastCommittedValue=s,l.userValue=s,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:s,willCommit:!0,commitKey:r,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});let s=p;p=null,r.addEventListener("blur",e=>{if(!l.focused||!e.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{target:r}=e,{value:n}=r;if(u){if(n&&"time"===d){let e=n.split(":").map(e=>parseInt(e,10));n=new Date(2e3,0,1,e[0],e[1],e[2]||0).valueOf(),r.step=""}else n.includes("T")||(n=`${n}T00:00`),n=new Date(n).valueOf();r.type="text"}l.userValue=n,l.lastCommittedValue!==n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:n,willCommit:!0,commitKey:l.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),s(e)}),this.data.actions?.Keystroke&&r.addEventListener("beforeinput",e=>{l.lastCommittedValue=null;let{data:r,target:s}=e,{value:n,selectionStart:a,selectionEnd:o}=s,h=a,d=o;switch(e.inputType){case"deleteWordBackward":{let e=n.substring(0,a).match(/\w*[^\w]*$/);e&&(h-=e[0].length);break}case"deleteWordForward":{let e=n.substring(a).match(/^[^\w]*\w*/);e&&(d+=e[0].length);break}case"deleteContentBackward":a===o&&(h-=1);break;case"deleteContentForward":a===o&&(d+=1)}e.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:n,change:r||"",willCommit:!1,selStart:h,selEnd:d}})}),this._setEventListeners(r,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.value)}if(p&&r.addEventListener("blur",p),this.data.comb){let e=(this.data.rect[2]-this.data.rect[0])/a;r.classList.add("comb"),r.style.letterSpacing=`calc(${e}px * var(--total-scale-factor) - 1ch)`}}else(r=document.createElement("div")).textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell",this.data.hasOwnCanvas&&(r.hidden=!0);return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class rs extends ri{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class rn extends ri{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,i=this.data,r=i.id,s=e.getValue(r,{value:i.exportValue===i.fieldValue}).value;"string"==typeof s&&(s="Off"!==s,e.setValue(r,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return i3.add(n),n.setAttribute("data-element-id",r),n.disabled=i.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=i.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",i.exportValue),n.tabIndex=0,n.addEventListener("change",s=>{let{name:n,checked:a}=s.target;for(let s of this._getElementsByName(n,r)){let r=a&&s.exportValue===i.exportValue;s.domElement&&(s.domElement.checked=r),e.setValue(s.id,{value:r})}e.setValue(r,{value:a})}),n.addEventListener("resetform",e=>{let r=i.defaultFieldValue||"Off";e.target.checked=r===i.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({value(i){i.target.checked="Off"!==i.detail.value,e.setValue(r,{value:i.target.checked})}},i)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ra extends ri{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,i=this.data,r=i.id,s=e.getValue(r,{value:i.fieldValue===i.buttonValue}).value;if("string"==typeof s&&(s=s!==i.buttonValue,e.setValue(r,{value:s})),s)for(let s of this._getElementsByName(i.fieldName,r))e.setValue(s.id,{value:!1});let n=document.createElement("input");if(i3.add(n),n.setAttribute("data-element-id",r),n.disabled=i.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=i.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",i=>{let{name:s,checked:n}=i.target;for(let i of this._getElementsByName(s,r))e.setValue(i.id,{value:!1});e.setValue(r,{value:n})}),n.addEventListener("resetform",e=>{let r=i.defaultFieldValue;e.target.checked=null!=r&&r===i.buttonValue}),this.enableScripting&&this.hasJSActions){let s=i.buttonValue;n.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({value:i=>{let n=s===i.detail.value;for(let s of this._getElementsByName(i.target.name)){let i=n&&s.id===r;s.domElement&&(s.domElement.checked=i),e.setValue(s.id,{value:i})}}},i)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ro extends rt{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let i=e.lastChild;return this.enableScripting&&this.hasJSActions&&i&&(this._setDefaultPropertiesFromJS(i),i.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),e}}class rl extends ri{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,i=this.data.id,r=e.getValue(i,{value:this.data.fieldValue}),s=document.createElement("select");i3.add(s),s.setAttribute("data-element-id",i),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;for(let e of(this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",e=>{let i=this.data.defaultFieldValue;for(let e of s.options)e.selected=e.value===i}),this.data.options)){let i=document.createElement("option");i.textContent=e.displayValue,i.value=e.exportValue,r.value.includes(e.exportValue)&&(i.setAttribute("selected",!0),n=!1),s.append(i)}let a=null;if(n){let e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),s.prepend(e),a=()=>{e.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}let o=e=>{let i=e?"value":"textContent",{options:r,multiple:n}=s;return n?Array.prototype.filter.call(r,e=>e.selected).map(e=>e[i]):-1===r.selectedIndex?null:r[r.selectedIndex][i]},l=o(!1),h=e=>{let i=e.target.options;return Array.prototype.map.call(i,e=>({displayValue:e.textContent,exportValue:e.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({value(r){a?.();let n=r.detail.value,h=new Set(Array.isArray(n)?n:[n]);for(let e of s.options)e.selected=h.has(e.value);e.setValue(i,{value:o(!0)}),l=o(!1)},multipleSelection(e){s.multiple=!0},remove(r){let n=s.options,a=r.detail.remove;n[a].selected=!1,s.remove(a),n.length>0&&-1===Array.prototype.findIndex.call(n,e=>e.selected)&&(n[0].selected=!0),e.setValue(i,{value:o(!0),items:h(r)}),l=o(!1)},clear(r){for(;0!==s.length;)s.remove(0);e.setValue(i,{value:null,items:[]}),l=o(!1)},insert(r){let{index:n,displayValue:a,exportValue:d}=r.detail.insert,c=s.children[n],u=document.createElement("option");u.textContent=a,u.value=d,c?c.before(u):s.append(u),e.setValue(i,{value:o(!0),items:h(r)}),l=o(!1)},items(r){let{items:n}=r.detail;for(;0!==s.length;)s.remove(0);for(let e of n){let{displayValue:i,exportValue:r}=e,n=document.createElement("option");n.textContent=i,n.value=r,s.append(n)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(i,{value:o(!0),items:h(r)}),l=o(!1)},indices(r){let s=new Set(r.detail.indices);for(let e of r.target.options)e.selected=s.has(e.index);e.setValue(i,{value:o(!0)}),l=o(!1)},editable(e){e.target.disabled=!e.detail.editable}},r)}),s.addEventListener("input",r=>{let s=o(!0),n=o(!1);e.setValue(i,{value:s}),r.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:l,change:n,changeEx:s,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],e=>e.target.value)):s.addEventListener("input",function(r){e.setValue(i,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class rh extends i8{constructor(e){let{data:i,elements:r,parent:s}=e,n=!!s._commentManager;if(super(e,{isRenderable:!n&&i8._hasPopupData(i)}),this.elements=r,n&&i8._hasPopupData(i)){let e=this.popup=this.#sA();for(let i of r)i.popup=e}else this.popup=null}#sA(){return new rd({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){let{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";let i=this.popup=this.#sA(),r=[];for(let e of this.elements)e.popup=i,e.container.ariaHasPopup="dialog",r.push(e.data.id),e.addHighlightArea();return this.container.setAttribute("aria-controls",r.map(e=>`${tu}${e}`).join(",")),this.container}}class rd{#U=null;#sx=this.#sd.bind(this);#sS=this.#sE.bind(this);#sC=this.#sT.bind(this);#sM=this.#sk.bind(this);#sI=null;#tw=null;#sD=null;#sR=null;#sP=null;#sL=null;#sN=null;#sO=!1;#sF=null;#sB=null;#M=null;#sU=null;#sj=null;#er=null;#s$=null;#t7=null;#sH=null;#sg=null;#sz=!1;#sV=null;#sG=null;constructor({container:e,color:i,elements:r,titleObj:s,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:h,parentRect:d,open:c,commentManager:u=null}){this.#tw=e,this.#sH=s,this.#sD=a,this.#t7=o,this.#sL=l,this.#sI=i,this.#s$=h,this.#sN=d,this.#sP=r,this.#U=u,this.#sV=r[0],this.#sR=tI.toDateObject(n),this.trigger=r.flatMap(e=>e.getElementsToTriggerPopup()),u?this.renderCommentButton():(this.#sW(),this.#tw.hidden=!0,c&&this.#sk())}#sW(){if(this.#sB)return;this.#sB=new AbortController;let{signal:e}=this.#sB;for(let i of this.trigger)i.addEventListener("click",this.#sM,{signal:e}),i.addEventListener("pointerenter",this.#sC,{signal:e}),i.addEventListener("pointerleave",this.#sS,{signal:e}),i.classList.add("popupTriggerArea");for(let i of this.#sP)i.container?.addEventListener("keydown",this.#sx,{signal:e})}#sq(){let e=this.#sP.find(e=>e.hasCommentButton);e&&(this.#sj=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#sU||(this.#sj||this.#sq(),!this.#sj))return;let{signal:e}=this.#sB=new AbortController,i=!!this.#sV.extraPopupElement,r=()=>{this.#U.toggleCommentPopup(this,!0,void 0,!i)},s=()=>{this.#U.toggleCommentPopup(this,!1,!0,!i)},n=()=>{this.#U.toggleCommentPopup(this,!1,!1)};if(i)for(let i of(this.#sU=this.#sV.container,this.trigger))i.ariaHasPopup="dialog",i.ariaControls="commentPopup",i.addEventListener("keydown",this.#sx,{signal:e}),i.addEventListener("click",r,{signal:e}),i.addEventListener("pointerenter",s,{signal:e}),i.addEventListener("pointerleave",n,{signal:e}),i.classList.add("popupTriggerArea");else{let i=this.#sU=document.createElement("button");i.className="annotationCommentButton";let a=this.#sV.container;i.style.zIndex=a.style.zIndex+1,i.tabIndex=0,i.ariaHasPopup="dialog",i.ariaControls="commentPopup",i.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#sX(),this.#sY(),i.addEventListener("keydown",this.#sx,{signal:e}),i.addEventListener("click",r,{signal:e}),i.addEventListener("pointerenter",s,{signal:e}),i.addEventListener("pointerleave",n,{signal:e}),a.after(i)}}#sY(){if(this.#sV.extraPopupElement&&!this.#sV.editor)return;this.renderCommentButton();let[e,i]=this.#sj,{style:r}=this.#sU;r.left=`calc(${e}%)`,r.top=`calc(${i}% - var(--comment-button-dim))`}#sX(){this.#sV.extraPopupElement||(this.renderCommentButton(),this.#sU.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){let{color:e,opacity:i}=this.#sV.commentData;return e?this.#sL._commentManager.makeCommentColor(e,i):null}focusCommentButton(){setTimeout(()=>{this.#sU?.focus()},0)}getData(){let{richText:e,color:i,opacity:r,creationDate:s,modificationDate:n}=this.#sV.commentData;return{contentsObj:{str:this.comment},richText:e,color:i,opacity:r,creationDate:s,modificationDate:n}}get elementBeforePopup(){return this.#sU}get comment(){return this.#sG||=this.#sV.commentText,this.#sG}set comment(e){e!==this.comment&&(this.#sV.commentText=this.#sG=e)}get parentBoundingClientRect(){return this.#sV.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:i}){this.#sU&&(this.#sU.classList.toggle("selected",e),this.#sU.ariaExpanded=i)}setSelectedCommentButton(e){this.#sU.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#er)return this.#er;let{x:e,y:i,height:r}=this.#sU.getBoundingClientRect(),{x:s,y:n,width:a,height:o}=this.#sV.layer.getBoundingClientRect();return[(e-s)/a,(i+r-n)/o]}set commentPopupPosition(e){this.#er=e}hasDefaultPopupPosition(){return null===this.#er}get commentButtonPosition(){return this.#sj}get commentButtonWidth(){return this.#sU.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){let[i,r]=this.#er||this.commentButtonPosition.map(e=>e/100),s=this.parentBoundingClientRect,{x:n,y:a,width:o,height:l}=s;this.#U.showDialog(null,this,n+i*o,a+r*l,{...e,parentDimensions:s})}render(){if(this.#sF)return;let e=this.#sF=document.createElement("div");if(e.className="popup",this.#sI){let i=e.style.outlineColor=to.makeHexColor(...this.#sI);e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}let i=document.createElement("span");if(i.className="header",this.#sH?.str){let e=document.createElement("span");e.className="title",i.append(e),{dir:e.dir,str:e.textContent}=this.#sH}if(e.append(i),this.#sR){let e=document.createElement("time");e.className="popupDate",e.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),e.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#sR.valueOf()})),e.dateTime=this.#sR.toISOString(),i.append(e)}tq({html:this.#sJ||this.#sD.str,dir:this.#sD?.dir,className:"popupContent"},e),this.#tw.append(e)}get #sJ(){let e=this.#t7,i=this.#sD;return!e?.str||i?.str&&i.str!==e.str?null:this.#t7.html||null}get #sK(){return this.#sJ?.attributes?.style?.fontSize||0}get #sQ(){return this.#sJ?.attributes?.style?.color||null}#sZ(e){let i=[],r={style:{color:this.#sQ,fontSize:this.#sK?`calc(${this.#sK}px * var(--total-scale-factor))`:""}};for(let s of e.split("\n"))i.push({name:"span",value:s,attributes:r});return{str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:i}]}}}#sd(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&this.#sO)&&this.#sk()}updateEdited({rect:e,popup:i,deleted:r}){if(this.#U)return r?(this.remove(),this.#sG=null):i&&(i.deleted?this.remove():(this.#sX(),this.#sG=i.text)),void(e&&(this.#sj=null,this.#sq(),this.#sY()));r||i?.deleted?this.remove():(this.#sW(),this.#sg||={contentsObj:this.#sD,richText:this.#t7},e&&(this.#M=null),i&&i.text&&(this.#t7=this.#sZ(i.text),this.#sR=tI.toDateObject(i.date),this.#sD=null),this.#sF?.remove(),this.#sF=null)}resetEdited(){this.#sg&&({contentsObj:this.#sD,richText:this.#t7}=this.#sg,this.#sg=null,this.#sF?.remove(),this.#sF=null,this.#M=null)}remove(){if(this.#sB?.abort(),this.#sB=null,this.#sF?.remove(),this.#sF=null,this.#sz=!1,this.#sO=!1,this.#sU?.remove(),this.#sU=null,this.trigger)for(let e of this.trigger)e.classList.remove("popupTriggerArea")}#s0(){if(null!==this.#M)return;let{page:{view:e},viewport:{rawDims:{pageWidth:i,pageHeight:r,pageX:s,pageY:n}}}=this.#sL,a=!!this.#sN,o=a?this.#sN:this.#s$;for(let e of this.#sP)if(!o||null!==to.intersect(e.data.rect,o)){o=e.data.rect,a=!0;break}let l=to.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),h=a?o[2]-o[0]+5:0,d=l[0]+h,c=l[1];this.#M=[100*(d-s)/i,100*(c-n)/r];let{style:u}=this.#tw;u.left=`${this.#M[0]}%`,u.top=`${this.#M[1]}%`}#sk(){this.#U?this.#U.toggleCommentPopup(this,!1):(this.#sO=!this.#sO,this.#sO?(this.#sT(),this.#tw.addEventListener("click",this.#sM),this.#tw.addEventListener("keydown",this.#sx)):(this.#sE(),this.#tw.removeEventListener("click",this.#sM),this.#tw.removeEventListener("keydown",this.#sx)))}#sT(){this.#sF||this.render(),this.isVisible?this.#sO&&this.#tw.classList.add("focused"):(this.#s0(),this.#tw.hidden=!1,this.#tw.style.zIndex=parseInt(this.#tw.style.zIndex)+1e3)}#sE(){this.#tw.classList.remove("focused"),!this.#sO&&this.isVisible&&(this.#tw.hidden=!0,this.#tw.style.zIndex=parseInt(this.#tw.style.zIndex)-1e3)}forceHide(){this.#sz=this.isVisible,this.#sz&&(this.#tw.hidden=!0)}maybeShow(){this.#U||(this.#sW(),this.#sz&&(this.#sF||this.#sT(),this.#sz=!1,this.#tw.hidden=!1))}get isVisible(){return!this.#U&&!1===this.#tw.hidden}}class rc extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=L.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");for(let i of(e.classList.add("annotationTextContent"),e.setAttribute("role","comment"),this.textContent)){let r=document.createElement("span");r.textContent=i,e.append(r)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class ru extends i8{#s1=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let{data:e,width:i,height:r}=this,s=this.svgFactory.create(i,r,!0),n=this.#s1=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#s1}addHighlightArea(){this.container.classList.add("highlightArea")}}class rp extends i8{#s2=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let{data:e,width:i,height:r}=this,s=this.svgFactory.create(i,r,!0),n=e.borderStyle.width,a=this.#s2=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",i-n),a.setAttribute("height",r-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#s2}addHighlightArea(){this.container.classList.add("highlightArea")}}class rf extends i8{#s5=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let{data:e,width:i,height:r}=this,s=this.svgFactory.create(i,r,!0),n=e.borderStyle.width,a=this.#s5=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",i/2),a.setAttribute("cy",r/2),a.setAttribute("rx",i/2-n/2),a.setAttribute("ry",r/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#s5}addHighlightArea(){this.container.classList.add("highlightArea")}}class rg extends i8{#s4=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:i,borderStyle:r,popupRef:s},width:n,height:a}=this;if(!i)return this.container;let o=this.svgFactory.create(n,a,!0),l=[];for(let r=0,s=i.length;r<s;r+=2){let s=i[r]-e[0],n=e[3]-i[r+1];l.push(`${s},${n}`)}l=l.join(" ");let h=this.#s4=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",l),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),o.append(h),this.container.append(o),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#s4}addHighlightArea(){this.container.classList.add("highlightArea")}}class rm extends rg{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class rb extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class rv extends i8{#s3=null;#s6=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?L.HIGHLIGHT:L.INK}#s9(e,i){switch(e){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:i,inkLists:r,borderStyle:s,popupRef:n}}=this,{transform:a,width:o,height:l}=this.#s9(i,e),h=this.svgFactory.create(o,l,!0),d=this.#s3=this.svgFactory.createElement("svg:g");h.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",a);for(let e=0,i=r.length;e<i;e++){let i=this.svgFactory.createElement(this.svgElementName);this.#s6.push(i),i.setAttribute("points",r[e].join(",")),d.append(i)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:i,points:r,rect:s}=e,n=this.#s3;if(i>=0&&n.setAttribute("stroke-width",i||1),r)for(let e=0,i=this.#s6.length;e<i;e++)this.#s6[e].setAttribute("points",r[e].join(","));if(s){let{transform:e,width:i,height:r}=this.#s9(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${i} ${r}`),n.setAttribute("transform",e)}}getElementsToTriggerPopup(){return this.#s6}addHighlightArea(){this.container.classList.add("highlightArea")}}class ry extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=L.HIGHLIGHT}render(){let{data:{overlaidText:e,popupRef:i}}=this;if(!i&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){let i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class r_ extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:i}}=this;if(!i&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){let i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class rw extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:i}}=this;if(!i&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){let i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class rA extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:i}}=this;if(!i&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){let i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class rx extends i8{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=L.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class rS extends i8{#s8=null;constructor(e){super(e,{isRenderable:!0});let{file:i}=this.data;this.filename=i.filename,this.content=i.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...i})}render(){let e;this.container.classList.add("fileAttachmentAnnotation");let{container:i,data:r}=this;r.hasAppearance||0===r.fillAlpha?e=document.createElement("div"):((e=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(r.name)?"paperclip":"pushpin"}.svg`,r.fillAlpha&&r.fillAlpha<1&&(e.style=`filter: opacity(${Math.round(100*r.fillAlpha)}%);`)),e.addEventListener("dblclick",this.#s7.bind(this)),this.#s8=e;let{isMac:s}=tn.platform;return i.addEventListener("keydown",e=>{"Enter"===e.key&&(s?e.metaKey:e.ctrlKey)&&this.#s7()}),!r.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),i.append(e),i}getElementsToTriggerPopup(){return this.#s8}addHighlightArea(){this.container.classList.add("highlightArea")}#s7(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class rE{#nt=null;#ne=null;#O=null;#ni=new Map;#nr=null;#ns=null;constructor({div:e,accessibilityManager:i,annotationCanvasMap:r,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:o,commentManager:l,linkService:h,annotationStorage:d}){this.div=e,this.#nt=i,this.#ne=r,this.#nr=o||null,this.#ns=h||null,this.#O=d||new et,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=l||null}hasEditableAnnotations(){return this.#ni.size>0}async #nn(e,i,r){let s=e.firstChild||e,n=s.id=`${tu}${i}`,a=await this.#nr?.getAriaAttributes(n);if(a)for(let[e,i]of a)s.setAttribute(e,i);r?r.at(-1).container.after(e):(this.div.append(e),this.#nt?.moveElementInDOM(this.div,e,s,!1))}async render(e){let{annotations:i}=e,r=this.div;tN(r,this.viewport);let s=new Map,n={data:null,layer:r,linkService:this.#ns,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new i4,annotationStorage:this.#O,enableComment:!0===e.enableComment,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let e of i){if(e.noHTML)continue;let i=e.annotationType===B.POPUP;if(i){let i=s.get(e.id);if(!i)continue;n.elements=i}else if(e.rect[2]===e.rect[0]||e.rect[3]===e.rect[1])continue;n.data=e;let r=i9.create(n);if(!r.isRenderable)continue;if(!i&&e.popupRef){let i=s.get(e.popupRef);i?i.push(r):s.set(e.popupRef,[r])}let a=r.render();e.hidden&&(a.style.visibility="hidden"),await this.#nn(a,e.id,n.elements),r.extraPopupElement?.popup?.renderCommentButton(),r._isEditable&&(this.#ni.set(r.data.id,r),this._annotationEditorUIManager?.renderAnnotationElement(r))}this.#na()}async addLinkAnnotations(e){let i={data:null,layer:this.div,linkService:this.#ns,svgFactory:new i4,parent:this};for(let r of e){r.borderStyle||=rE._defaultBorderStyle,i.data=r;let e=i9.create(i);if(!e.isRenderable)continue;let s=e.render();await this.#nn(s,r.id,null)}}update({viewport:e}){let i=this.div;this.viewport=e,tN(i,{rotation:e.rotation}),this.#na(),i.hidden=!1}#na(){if(!this.#ne)return;let e=this.div;for(let[i,r]of this.#ne){let s=e.querySelector(`[data-annotation-id="${i}"]`);if(!s)continue;r.className="annotationContent";let{firstChild:n}=s;n?"CANVAS"===n.nodeName?n.replaceWith(r):n.classList.contains("annotationContent")?n.after(r):n.before(r):s.append(r);let a=this.#ni.get(i);a&&(a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(i,s.id,r),a._hasNoCanvas=!1):a.canvas=r)}this.#ne.clear()}getEditableAnnotations(){return Array.from(this.#ni.values())}getEditableAnnotation(e){return this.#ni.get(e)}addFakeAnnotation(e){let{div:i}=this,{id:r,rotation:s}=e,n=new i7({data:{id:r,rect:e.getPDFRect(),rotation:s},editor:e,layer:i,parent:this,enableComment:!!this._commentManager,linkService:this.#ns,annotationStorage:this.#O}),a=n.render();return i.append(a),this.#nt?.moveElementInDOM(i,a,a,!1),n.createOrUpdatePopup(),n}static get _defaultBorderStyle(){return Y(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:1,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}let rC=/\r\n?|\n/g;class rT extends t6{#no="";#nl=`${this.id}-editor`;#nh=null;#sK;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let e=rT.prototype,i=e=>e.isEmpty(),r=t2.TRANSLATE_SMALL,s=t2.TRANSLATE_BIG;return Y(this,"_keyboardManager",new t0([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[r,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:i}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,r],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:i}]]))}static _type="freetext";static _editorType=L.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||rT._defaultColor||t6._defaultLineColor,this.#sK=e.fontSize||rT._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(e,i){t6.initialize(e,i);let r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,i){switch(e){case N.FREETEXT_SIZE:rT._defaultFontSize=i;break;case N.FREETEXT_COLOR:rT._defaultColor=i}}updateParams(e,i){switch(e){case N.FREETEXT_SIZE:this.#nd(i);break;case N.FREETEXT_COLOR:this.#sX(i)}}static get defaultPropertiesToUpdate(){return[[N.FREETEXT_SIZE,rT._defaultFontSize],[N.FREETEXT_COLOR,rT._defaultColor||t6._defaultLineColor]]}get propertiesToUpdate(){return[[N.FREETEXT_SIZE,this.#sK],[N.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new iZ(this),[["colorPicker",this._colorPicker]]}get colorType(){return N.FREETEXT_COLOR}#nd(e){let i=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--total-scale-factor))`,this.translate(0,-(e-this.#sK)*this.parentScale),this.#sK=e,this.#nc()},r=this.#sK;this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#sX(e){let i=e=>{this.color=e,this.onUpdatedColor()},r=this.color;this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,i){this._uiManager.translateSelectedEditors(e,i,!0)}getInitialTranslation(){let e=this.parentScale;return[-rT._internalPadding*e,-(rT._internalPadding+this.#sK)*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#nh=new AbortController;let e=this._uiManager.combinedSignal(this.#nh);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#nl),this._isDraggable=!0,this.#nh?.abort(),this.#nh=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#nu(){let e=[];this.editorDiv.normalize();let i=null;for(let r of this.editorDiv.childNodes)i?.nodeType===Node.TEXT_NODE&&"BR"===r.nodeName||(e.push(rT.#np(r)),i=r);return e.join("\n")}#nc(){let e;let[i,r]=this.parentDimensions;if(this.isAttachedToDOM)e=this.div.getBoundingClientRect();else{let{currentLayer:i,div:r}=this,s=r.style.display,n=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",i.div.append(this.div),e=r.getBoundingClientRect(),r.remove(),r.style.display=s,r.classList.toggle("hidden",n)}this.rotation%180==this.parentRotation%180?(this.width=e.width/i,this.height=e.height/r):(this.width=e.height/i,this.height=e.width/r),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#no,i=this.#no=this.#nu().trimEnd();if(e===i)return;let r=e=>{this.#no=e,e?(this.#nf(),this._uiManager.rebuild(this),this.#nc()):this.remove()};this.addCommands({cmd:()=>{r(i)},undo:()=>{r(e)},mustExec:!1}),this.#nc()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){rT._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){let e,i;if(this.div)return this.div;(this._isCopy||this.annotationElementId)&&(e=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#nl),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:r}=this.editorDiv;if(r.fontSize=`calc(${this.#sK}px * var(--total-scale-factor))`,r.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){let[r,s]=this.parentDimensions;if(this.annotationElementId){let n,a;let{position:o}=this._initialData,[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);let[d,c]=this.pageDimensions,[u,p]=this.pageTranslation;switch(this.rotation){case 0:n=e+(o[0]-u)/d,a=i+this.height-(o[1]-p)/c;break;case 90:n=e+(o[0]-u)/d,a=i-(o[1]-p)/c,[l,h]=[h,-l];break;case 180:n=e-this.width+(o[0]-u)/d,a=i-(o[1]-p)/c,[l,h]=[-l,-h];break;case 270:n=e+(o[0]-u-this.height*c)/d,a=i+(o[1]-p-this.width*d)/c,[l,h]=[-h,l]}this.setAt(n*r,a*s,l,h)}else this._moveAfterPaste(e,i);this.#nf(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static #np(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(rC,"")}editorDivPaste(e){let i=e.clipboardData||window.clipboardData,{types:r}=i;if(1===r.length&&"text/plain"===r[0])return;e.preventDefault();let s=rT.#ng(i.getData("text")||"").replaceAll(rC,"\n");if(!s)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let a=n.getRangeAt(0);if(!s.includes("\n"))return a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),void n.collapseToStart();let{startContainer:o,startOffset:l}=a,h=[],d=[];if(o.nodeType===Node.TEXT_NODE){let e=o.parentElement;if(d.push(o.nodeValue.slice(l).replaceAll(rC,"")),e!==this.editorDiv){let i=h;for(let r of this.editorDiv.childNodes)r!==e?i.push(rT.#np(r)):i=d}h.push(o.nodeValue.slice(0,l).replaceAll(rC,""))}else if(o===this.editorDiv){let e=h,i=0;for(let r of this.editorDiv.childNodes)i++===l&&(e=d),e.push(rT.#np(r))}this.#no=`${h.join("\n")}${s}${d.join("\n")}`,this.#nf();let c=new Range,u=Math.sumPrecise(h.map(e=>e.length));for(let{firstChild:e}of this.editorDiv.childNodes)if(e.nodeType===Node.TEXT_NODE){let i=e.nodeValue.length;if(u<=i){c.setStart(e,u),c.setEnd(e,u);break}u-=i}n.removeAllRanges(),n.addRange(c)}#nf(){if(this.editorDiv.replaceChildren(),this.#no)for(let e of this.#no.split("\n")){let i=document.createElement("div");i.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(i)}}#nm(){return this.#no.replaceAll("\xa0"," ")}static #ng(e){return e.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}getPDFRect(){let e=rT._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,i,r){let s=null;if(e instanceof rc){let{data:{defaultAppearanceData:{fontSize:i,fontColor:r},rect:n,rotation:a,id:o,popupRef:l,richText:h,contentsObj:d,creationDate:c,modificationDate:u},textContent:p,textPosition:f,parent:{page:{pageNumber:g}}}=e;if(!p||0===p.length)return null;s=e={annotationType:L.FREETEXT,color:Array.from(r),fontSize:i,value:p.join("\n"),position:f,pageIndex:g-1,rect:n.slice(0),rotation:a,annotationElementId:o,id:o,deleted:!1,popupRef:l,comment:d?.str||null,richText:h,creationDate:c,modificationDate:u}}let n=await super.deserialize(e,i,r);return n.#sK=e.fontSize,n.color=to.makeHexColor(...e.color),n.#no=rT.#ng(e.value),n._initialData=s,e.comment&&n.setCommentData(e),n}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i=t6._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),r=Object.assign(super.serialize(e),{color:i,fontSize:this.#sK,value:this.#nm()});return this.addComment(r),e?(r.isCopy=!0,r):this.annotationElementId&&!this.#nb(r)?null:(r.id=this.annotationElementId,r)}#nb(e){let{value:i,fontSize:r,color:s,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==i||e.fontSize!==r||e.color.some((e,i)=>e!==s[i])||e.pageIndex!==n}renderAnnotationElement(e){let i=super.renderAnnotationElement(e);if(!i)return null;let{style:r}=i;for(let e of(r.fontSize=`calc(${this.#sK}px * var(--total-scale-factor))`,r.color=this.color,i.replaceChildren(),this.#no.split("\n"))){let r=document.createElement("div");r.append(e?document.createTextNode(e):document.createElement("br")),i.append(r)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#no}}),i}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class rM{static PRECISION=1e-4;toSVGPath(){G("Abstract method `toSVGPath` must be implemented.")}get box(){G("Abstract getter `box` must be implemented.")}serialize(e,i){G("Abstract method `serialize` must be implemented.")}static _rescale(e,i,r,s,n,a){a||=new Float32Array(e.length);for(let o=0,l=e.length;o<l;o+=2)a[o]=i+e[o]*s,a[o+1]=r+e[o+1]*n;return a}static _rescaleAndSwap(e,i,r,s,n,a){a||=new Float32Array(e.length);for(let o=0,l=e.length;o<l;o+=2)a[o]=i+e[o+1]*s,a[o+1]=r+e[o]*n;return a}static _translate(e,i,r,s){s||=new Float32Array(e.length);for(let n=0,a=e.length;n<a;n+=2)s[n]=i+e[n],s[n+1]=r+e[n+1];return s}static svgRound(e){return Math.round(1e4*e)}static _normalizePoint(e,i,r,s,n){switch(n){case 90:return[1-i/r,e/s];case 180:return[1-e/r,1-i/s];case 270:return[i/r,1-e/s];default:return[e/r,i/s]}}static _normalizePagePoint(e,i,r){switch(r){case 90:return[1-i,e];case 180:return[1-e,1-i];case 270:return[i,1-e];default:return[e,i]}}static createBezierPoints(e,i,r,s,n,a){return[(e+5*r)/6,(i+5*s)/6,(5*r+n)/6,(5*s+a)/6,(r+n)/2,(s+a)/2]}}class rk{#nv;#ny=[];#n_;#nw;#nA=[];#nx=new Float32Array(18);#nS;#nE;#nC;#nT;#nM;#nk;#nI=[];static #nD=8;static #nR=2;static #nP=rk.#nD+rk.#nR;constructor({x:e,y:i},r,s,n,a,o=0){this.#nv=r,this.#nk=n*s,this.#nw=a,this.#nx.set([NaN,NaN,NaN,NaN,e,i],6),this.#n_=o,this.#nT=rk.#nD*s,this.#nC=rk.#nP*s,this.#nM=s,this.#nI.push(e,i)}isEmpty(){return isNaN(this.#nx[8])}#nL(){let e=this.#nx.subarray(4,6),i=this.#nx.subarray(16,18),[r,s,n,a]=this.#nv;return[(this.#nS+(e[0]-i[0])/2-r)/n,(this.#nE+(e[1]-i[1])/2-s)/a,(this.#nS+(i[0]-e[0])/2-r)/n,(this.#nE+(i[1]-e[1])/2-s)/a]}add({x:e,y:i}){this.#nS=e,this.#nE=i;let[r,s,n,a]=this.#nv,[o,l,h,d]=this.#nx.subarray(8,12),c=e-h,u=i-d,p=Math.hypot(c,u);if(p<this.#nC)return!1;let f=p-this.#nT,g=f/p,m=g*c,b=g*u,v=o,y=l;o=h,l=d,h+=m,d+=b,this.#nI?.push(e,i);let _=-b/f*this.#nk,w=m/f*this.#nk;return(this.#nx.set(this.#nx.subarray(2,8),0),this.#nx.set([h+_,d+w],4),this.#nx.set(this.#nx.subarray(14,18),12),this.#nx.set([h-_,d-w],16),isNaN(this.#nx[6]))?(0===this.#nA.length&&(this.#nx.set([o+_,l+w],2),this.#nA.push(NaN,NaN,NaN,NaN,(o+_-r)/n,(l+w-s)/a),this.#nx.set([o-_,l-w],14),this.#ny.push(NaN,NaN,NaN,NaN,(o-_-r)/n,(l-w-s)/a)),this.#nx.set([v,y,o,l,h,d],6),!this.isEmpty()):(this.#nx.set([v,y,o,l,h,d],6),Math.abs(Math.atan2(y-l,v-o)-Math.atan2(b,m))<Math.PI/2?([o,l,h,d]=this.#nx.subarray(2,6),this.#nA.push(NaN,NaN,NaN,NaN,((o+h)/2-r)/n,((l+d)/2-s)/a),[o,l,v,y]=this.#nx.subarray(14,18),this.#ny.push(NaN,NaN,NaN,NaN,((v+o)/2-r)/n,((y+l)/2-s)/a)):([v,y,o,l,h,d]=this.#nx.subarray(0,6),this.#nA.push(((v+5*o)/6-r)/n,((y+5*l)/6-s)/a,((5*o+h)/6-r)/n,((5*l+d)/6-s)/a,((o+h)/2-r)/n,((l+d)/2-s)/a),[h,d,o,l,v,y]=this.#nx.subarray(12,18),this.#ny.push(((v+5*o)/6-r)/n,((y+5*l)/6-s)/a,((5*o+h)/6-r)/n,((5*l+d)/6-s)/a,((o+h)/2-r)/n,((l+d)/2-s)/a)),!0)}toSVGPath(){if(this.isEmpty())return"";let e=this.#nA,i=this.#ny;if(isNaN(this.#nx[6])&&!this.isEmpty())return this.#nN();let r=[];r.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?r.push(`L${e[i+4]} ${e[i+5]}`):r.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);this.#nO(r);for(let e=i.length-6;e>=6;e-=6)isNaN(i[e])?r.push(`L${i[e+4]} ${i[e+5]}`):r.push(`C${i[e]} ${i[e+1]} ${i[e+2]} ${i[e+3]} ${i[e+4]} ${i[e+5]}`);return this.#nF(r),r.join(" ")}#nN(){let[e,i,r,s]=this.#nv,[n,a,o,l]=this.#nL();return`M${(this.#nx[2]-e)/r} ${(this.#nx[3]-i)/s} L${(this.#nx[4]-e)/r} ${(this.#nx[5]-i)/s} L${n} ${a} L${o} ${l} L${(this.#nx[16]-e)/r} ${(this.#nx[17]-i)/s} L${(this.#nx[14]-e)/r} ${(this.#nx[15]-i)/s} Z`}#nF(e){let i=this.#ny;e.push(`L${i[4]} ${i[5]} Z`)}#nO(e){let[i,r,s,n]=this.#nv,a=this.#nx.subarray(4,6),o=this.#nx.subarray(16,18),[l,h,d,c]=this.#nL();e.push(`L${(a[0]-i)/s} ${(a[1]-r)/n} L${l} ${h} L${d} ${c} L${(o[0]-i)/s} ${(o[1]-r)/n}`)}newFreeDrawOutline(e,i,r,s,n,a){return new rI(e,i,r,s,n,a)}getOutlines(){let e=this.#nA,i=this.#ny,r=this.#nx,[s,n,a,o]=this.#nv,l=new Float32Array((this.#nI?.length??0)+2);for(let e=0,i=l.length-2;e<i;e+=2)l[e]=(this.#nI[e]-s)/a,l[e+1]=(this.#nI[e+1]-n)/o;if(l[l.length-2]=(this.#nS-s)/a,l[l.length-1]=(this.#nE-n)/o,isNaN(r[6])&&!this.isEmpty())return this.#nB(l);let h=new Float32Array(this.#nA.length+24+this.#ny.length),d=e.length;for(let i=0;i<d;i+=2)isNaN(e[i])?h[i]=h[i+1]=NaN:(h[i]=e[i],h[i+1]=e[i+1]);d=this.#nU(h,d);for(let e=i.length-6;e>=6;e-=6)for(let r=0;r<6;r+=2)isNaN(i[e+r])?h[d]=h[d+1]=NaN:(h[d]=i[e+r],h[d+1]=i[e+r+1]),d+=2;return this.#nj(h,d),this.newFreeDrawOutline(h,l,this.#nv,this.#nM,this.#n_,this.#nw)}#nB(e){let i=this.#nx,[r,s,n,a]=this.#nv,[o,l,h,d]=this.#nL(),c=new Float32Array(36);return c.set([NaN,NaN,NaN,NaN,(i[2]-r)/n,(i[3]-s)/a,NaN,NaN,NaN,NaN,(i[4]-r)/n,(i[5]-s)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(i[16]-r)/n,(i[17]-s)/a,NaN,NaN,NaN,NaN,(i[14]-r)/n,(i[15]-s)/a],0),this.newFreeDrawOutline(c,e,this.#nv,this.#nM,this.#n_,this.#nw)}#nj(e,i){let r=this.#ny;return e.set([NaN,NaN,NaN,NaN,r[4],r[5]],i),i+6}#nU(e,i){let r=this.#nx.subarray(4,6),s=this.#nx.subarray(16,18),[n,a,o,l]=this.#nv,[h,d,c,u]=this.#nL();return e.set([NaN,NaN,NaN,NaN,(r[0]-n)/o,(r[1]-a)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l],i),i+24}}class rI extends rM{#nv;#n$=new Float32Array(4);#n_;#nw;#nI;#nM;#nH;constructor(e,i,r,s,n,a){super(),this.#nH=e,this.#nI=i,this.#nv=r,this.#nM=s,this.#n_=n,this.#nw=a,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#nz(a);let[o,l,h,d]=this.#n$;for(let i=0,r=e.length;i<r;i+=2)e[i]=(e[i]-o)/h,e[i+1]=(e[i+1]-l)/d;for(let e=0,r=i.length;e<r;e+=2)i[e]=(i[e]-o)/h,i[e+1]=(i[e+1]-l)/d}toSVGPath(){let e=[`M${this.#nH[4]} ${this.#nH[5]}`];for(let i=6,r=this.#nH.length;i<r;i+=6)isNaN(this.#nH[i])?e.push(`L${this.#nH[i+4]} ${this.#nH[i+5]}`):e.push(`C${this.#nH[i]} ${this.#nH[i+1]} ${this.#nH[i+2]} ${this.#nH[i+3]} ${this.#nH[i+4]} ${this.#nH[i+5]}`);return e.push("Z"),e.join(" ")}serialize([e,i,r,s],n){let a,o;let l=r-e,h=s-i;switch(n){case 0:a=rM._rescale(this.#nH,e,s,l,-h),o=rM._rescale(this.#nI,e,s,l,-h);break;case 90:a=rM._rescaleAndSwap(this.#nH,e,i,l,h),o=rM._rescaleAndSwap(this.#nI,e,i,l,h);break;case 180:a=rM._rescale(this.#nH,r,i,-l,h),o=rM._rescale(this.#nI,r,i,-l,h);break;case 270:a=rM._rescaleAndSwap(this.#nH,r,s,-l,-h),o=rM._rescaleAndSwap(this.#nI,r,s,-l,-h)}return{outline:Array.from(a),points:[Array.from(o)]}}#nz(e){let i=this.#nH,r=i[4],s=i[5],n=[r,s,r,s],a=r,o=s,l=r,h=s,d=e?Math.max:Math.min,c=new Float32Array(4);for(let e=6,u=i.length;e<u;e+=6){let u=i[e+4],p=i[e+5];isNaN(i[e])?(to.pointBoundingBox(u,p,n),o>p?(a=u,o=p):o===p&&(a=d(a,u)),h<p?(l=u,h=p):h===p&&(l=d(l,u))):(c[0]=c[1]=1/0,c[2]=c[3]=-1/0,to.bezierBoundingBox(r,s,...i.slice(e,e+6),c),to.rectBoundingBox(c[0],c[1],c[2],c[3],n),o>c[1]?(a=c[0],o=c[1]):o===c[1]&&(a=d(a,c[0])),h<c[3]?(l=c[2],h=c[3]):h===c[3]&&(l=d(l,c[2]))),r=u,s=p}let u=this.#n$;u[0]=n[0]-this.#n_,u[1]=n[1]-this.#n_,u[2]=n[2]-n[0]+2*this.#n_,u[3]=n[3]-n[1]+2*this.#n_,this.firstPoint=[a,o],this.lastPoint=[l,h]}get box(){return this.#n$}newOutliner(e,i,r,s,n,a=0){return new rk(e,i,r,s,n,a)}getNewOutline(e,i){let[r,s,n,a]=this.#n$,[o,l,h,d]=this.#nv,c=n*h,u=a*d,p=r*h+o,f=s*d+l,g=this.newOutliner({x:this.#nI[0]*c+p,y:this.#nI[1]*u+f},this.#nv,this.#nM,e,this.#nw,i??this.#n_);for(let e=2;e<this.#nI.length;e+=2)g.add({x:this.#nI[e]*c+p,y:this.#nI[e+1]*u+f});return g.getOutlines()}}class rD{#nv;#nV;#nG;#nW=[];#nq=[];constructor(e,i=0,r=0,s=!0){let n=[1/0,1/0,-1/0,-1/0];for(let{x:r,y:s,width:a,height:o}of e){let e=1e-4*Math.floor((r-i)/1e-4),l=1e-4*Math.ceil((r+a+i)/1e-4),h=1e-4*Math.floor((s-i)/1e-4),d=1e-4*Math.ceil((s+o+i)/1e-4),c=[e,h,d,!0],u=[l,h,d,!1];this.#nW.push(c,u),to.rectBoundingBox(e,h,l,d,n)}let a=n[2]-n[0]+2*r,o=n[3]-n[1]+2*r,l=n[0]-r,h=n[1]-r,d=s?-1/0:1/0,c=1/0,u=this.#nW.at(s?-1:-2),p=[u[0],u[2]];for(let e of this.#nW){let[i,r,n,u]=e;!u&&s?r<c?(c=r,d=i):r===c&&(d=Math.max(d,i)):u&&!s&&(r<c?(c=r,d=i):r===c&&(d=Math.min(d,i))),e[0]=(i-l)/a,e[1]=(r-h)/o,e[2]=(n-h)/o}this.#nv=new Float32Array([l,h,a,o]),this.#nV=[d,c],this.#nG=p}getOutlines(){this.#nW.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);let e=[];for(let i of this.#nW)i[3]?(e.push(...this.#nX(i)),this.#nY(i)):(this.#nJ(i),e.push(...this.#nX(i)));return this.#nK(e)}#nK(e){let i;let r=[],s=new Set;for(let i of e){let[e,s,n]=i;r.push([e,s,i],[e,n,i])}r.sort((e,i)=>e[1]-i[1]||e[0]-i[0]);for(let e=0,i=r.length;e<i;e+=2){let i=r[e][2],n=r[e+1][2];i.push(n),n.push(i),s.add(i),s.add(n)}let n=[];for(;s.size>0;){let e=s.values().next().value,[r,a,o,l,h]=e;s.delete(e);let d=r,c=a;for(i=[r,o],n.push(i);;){let e;if(s.has(l))e=l;else{if(!s.has(h))break;e=h}s.delete(e),[r,a,o,l,h]=e,d!==r&&(i.push(d,c,r,c===a?a:o),d=r),c=c===a?o:a}i.push(d,c)}return new rR(n,this.#nv,this.#nV,this.#nG)}#nQ(e){let i=this.#nq,r=0,s=i.length-1;for(;r<=s;){let n=r+s>>1,a=i[n][0];if(a===e)return n;a<e?r=n+1:s=n-1}return s+1}#nY([,e,i]){let r=this.#nQ(e);this.#nq.splice(r,0,[e,i])}#nJ([,e,i]){let r=this.#nQ(e);for(let s=r;s<this.#nq.length;s++){let[r,n]=this.#nq[s];if(r!==e)break;if(r===e&&n===i)return void this.#nq.splice(s,1)}for(let s=r-1;s>=0;s--){let[r,n]=this.#nq[s];if(r!==e)break;if(r===e&&n===i)return void this.#nq.splice(s,1)}}#nX(e){let[i,r,s]=e,n=[[i,r,s]],a=this.#nQ(s);for(let e=0;e<a;e++){let[r,s]=this.#nq[e];for(let e=0,a=n.length;e<a;e++){let[,o,l]=n[e];if(!(s<=o||l<=r)){if(o>=r){if(l>s)n[e][1]=s;else{if(1===a)return[];n.splice(e,1),e--,a--}}else n[e][2]=r,l>s&&n.push([i,s,l])}}}return n}}class rR extends rM{#nv;#nZ;constructor(e,i,r,s){super(),this.#nZ=e,this.#nv=i,this.firstPoint=r,this.lastPoint=s}toSVGPath(){let e=[];for(let i of this.#nZ){let[r,s]=i;e.push(`M${r} ${s}`);for(let n=2;n<i.length;n+=2){let a=i[n],o=i[n+1];a===r?(e.push(`V${o}`),s=o):o===s&&(e.push(`H${a}`),r=a)}e.push("Z")}return e.join(" ")}serialize([e,i,r,s],n){let a=[],o=r-e,l=s-i;for(let i of this.#nZ){let r=Array(i.length);for(let n=0;n<i.length;n+=2)r[n]=e+i[n]*o,r[n+1]=s-i[n+1]*l;a.push(r)}return a}get box(){return this.#nv}get classNamesForOutlining(){return["highlightOutline"]}}class rP extends rk{newFreeDrawOutline(e,i,r,s,n,a){return new rL(e,i,r,s,n,a)}}class rL extends rI{newOutliner(e,i,r,s,n,a=0){return new rP(e,i,r,s,n,a)}}class rN extends t6{#n0=null;#n1=0;#n2;#n5=null;#s=null;#n4=null;#n3=null;#n6=0;#n9=null;#n8=null;#w=null;#n7=!1;#nV=null;#nG=null;#at=null;#et="";#nk;#ae="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=L.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let e=rN.prototype;return Y(this,"_keyboardManager",new t0([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||rN._defaultColor,this.#nk=e.thickness||rN._defaultThickness,this.opacity=e.opacity||rN._defaultOpacity,this.#n2=e.boxes||null,this.#ae=e.methodOfCreation||"",this.#et=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#n7=!0,this.#ai(e),this.#ar()):this.#n2&&(this.#n0=e.anchorNode,this.#n1=e.anchorOffset,this.#n3=e.focusNode,this.#n6=e.focusOffset,this.#as(),this.#ar(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#n7?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#nk,methodOfCreation:this.#ae}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#as(){let e=new rD(this.#n2,.001);this.#n8=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#n8.box;let i=new rD(this.#n2,.0025,.001,"ltr"===this._uiManager.direction);this.#n4=i.getOutlines();let{firstPoint:r}=this.#n8;this.#nV=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height];let{lastPoint:s}=this.#n4;this.#nG=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#ai({highlightOutlines:e,highlightId:i,clipPathId:r}){if(this.#n8=e,this.#n4=e.getNewOutline(this.#nk/2+1.5,.0025),i>=0)this.#w=i,this.#n5=r,this.parent.drawLayer.finalizeDraw(i,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#at=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n4.box,path:{d:this.#n4.toSVGPath()}},!0);else if(this.parent){let i=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#w,{bbox:rN.#an(this.#n8.box,(i-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#at,{bbox:rN.#an(this.#n4.box,i),path:{d:this.#n4.toSVGPath()}})}let[s,n,a,o]=e.box;switch(this.rotation){case 0:this.x=s,this.y=n,this.width=a,this.height=o;break;case 90:{let[e,i]=this.parentDimensions;this.x=n,this.y=1-s,this.width=a*i/e,this.height=o*e/i;break}case 180:this.x=1-s,this.y=1-n,this.width=a,this.height=o;break;case 270:{let[e,i]=this.parentDimensions;this.x=1-n,this.y=s,this.width=a*i/e,this.height=o*e/i}}let{firstPoint:l}=e;this.#nV=[(l[0]-s)/a,(l[1]-n)/o];let{lastPoint:h}=this.#n4;this.#nG=[(h[0]-s)/a,(h[1]-n)/o]}static initialize(e,i){t6.initialize(e,i),rN._defaultColor||=i.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,i){switch(e){case N.HIGHLIGHT_COLOR:rN._defaultColor=i;break;case N.HIGHLIGHT_THICKNESS:rN._defaultThickness=i}}translateInPage(e,i){}get toolbarPosition(){return this.#nG}get commentButtonPosition(){return this.#nV}updateParams(e,i){switch(e){case N.HIGHLIGHT_COLOR:this.#sX(i);break;case N.HIGHLIGHT_THICKNESS:this.#aa(i)}}static get defaultPropertiesToUpdate(){return[[N.HIGHLIGHT_COLOR,rN._defaultColor],[N.HIGHLIGHT_THICKNESS,rN._defaultThickness]]}get propertiesToUpdate(){return[[N.HIGHLIGHT_COLOR,this.color||rN._defaultColor],[N.HIGHLIGHT_THICKNESS,this.#nk||rN._defaultThickness],[N.HIGHLIGHT_FREE,this.#n7]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#w,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#s?.updateColor(this.color),super.onUpdatedColor()}#sX(e){let i=(e,i)=>{this.color=e,this.opacity=i,this.onUpdatedColor()},r=this.color,s=this.opacity;this.addCommands({cmd:i.bind(this,e,rN._defaultOpacity),undo:i.bind(this,r,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#aa(e){let i=this.#nk,r=e=>{this.#nk=e,this.#ao(e)};this.addCommands({cmd:r.bind(this,e),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#s=new iQ({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#al())}getBaseTranslation(){return[0,0]}getRect(e,i){return super.getRect(e,i,this.#al())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#ah(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#ar(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let i=!1;this.parent&&!e?this.#ah():e&&(this.#ar(e),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),i&&this.select()}#ao(e){this.#n7&&(this.#ai({highlightOutlines:this.#n8.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#ah(){null!==this.#w&&this.parent&&(this.parent.drawLayer.remove(this.#w),this.#w=null,this.parent.drawLayer.remove(this.#at),this.#at=null)}#ar(e=this.parent){null===this.#w&&({id:this.#w,clipPathId:this.#n5}=e.drawLayer.draw({bbox:this.#n8.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#n7},path:{d:this.#n8.toSVGPath()}},!1,!0),this.#at=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#n7},bbox:this.#n4.box,path:{d:this.#n4.toSVGPath()}},this.#n7),this.#n9&&(this.#n9.style.clipPath=this.#n5))}static #an([e,i,r,s],n){switch(n){case 90:return[1-i-s,e,s,r];case 180:return[1-e-r,1-i-s,r,s];case 270:return[i,1-e-r,s,r]}return[e,i,r,s]}rotate(e){let i;let{drawLayer:r}=this.parent;this.#n7?(e=(e-this.rotation+360)%360,i=rN.#an(this.#n8.box,e)):i=rN.#an([this.x,this.y,this.width,this.height],e),r.updateProperties(this.#w,{bbox:i,root:{"data-main-rotation":e}}),r.updateProperties(this.#at,{bbox:rN.#an(this.#n4.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();this.#et&&(e.setAttribute("aria-label",this.#et),e.setAttribute("role","mark")),this.#n7?e.classList.add("free"):this.div.addEventListener("keydown",this.#ad.bind(this),{signal:this._uiManager._signal});let i=this.#n9=document.createElement("div");return e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=this.#n5,this.setDims(this.width,this.height),tJ(this,this.#n9,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!1}})}#ad(e){rN._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#ac(!0);break;case 1:case 3:this.#ac(!1)}}#ac(e){if(!this.#n0)return;let i=window.getSelection();e?i.setPosition(this.#n0,this.#n1):i.setPosition(this.#n3,this.#n6)}select(){super.select(),this.#at&&this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#at&&(this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{selected:!1}}),this.#n7||this.#ac(!1))}get _mustFixPosition(){return!this.#n7}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#w,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#at,{rootClass:{hidden:!e}}))}#al(){return this.#n7?this.rotation:0}#au(){if(this.#n7)return null;let[e,i]=this.pageDimensions,[r,s]=this.pageTranslation,n=this.#n2,a=new Float32Array(8*n.length),o=0;for(let{x:l,y:h,width:d,height:c}of n){let n=l*e+r,u=(1-h)*i+s;a[o]=a[o+4]=n,a[o+1]=a[o+3]=u,a[o+2]=a[o+6]=n+d*e,a[o+5]=a[o+7]=u-c*i,o+=8}return a}#ap(e){return this.#n8.serialize(e,this.#al())}static startHighlighting(e,i,{target:r,x:s,y:n}){let{x:a,y:o,width:l,height:h}=r.getBoundingClientRect(),d=new AbortController,c=e.combinedSignal(d),u=i=>{d.abort(),this.#af(e,i)};window.addEventListener("blur",u,{signal:c}),window.addEventListener("pointerup",u,{signal:c}),window.addEventListener("pointerdown",tk,{capture:!0,passive:!1,signal:c}),window.addEventListener("contextmenu",tM,{signal:c}),r.addEventListener("pointermove",this.#ag.bind(this,e),{signal:c}),this._freeHighlight=new rP({x:s,y:n},[a,o,l,h],e.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static #ag(e,i){this._freeHighlight.add(i)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static #af(e,i){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,i,r){let s=null;if(e instanceof ry){let{data:{quadPoints:i,rect:r,rotation:n,id:a,color:o,opacity:l,popupRef:h,richText:d,contentsObj:c,creationDate:u,modificationDate:p},parent:{page:{pageNumber:f}}}=e;s=e={annotationType:L.HIGHLIGHT,color:Array.from(o),opacity:l,quadPoints:i,boxes:null,pageIndex:f-1,rect:r.slice(0),rotation:n,annotationElementId:a,id:a,deleted:!1,popupRef:h,richText:d,comment:c?.str||null,creationDate:u,modificationDate:p}}else if(e instanceof rv){let{data:{inkLists:i,rect:r,rotation:n,id:a,color:o,borderStyle:{rawWidth:l},popupRef:h,richText:d,contentsObj:c,creationDate:u,modificationDate:p},parent:{page:{pageNumber:f}}}=e;s=e={annotationType:L.HIGHLIGHT,color:Array.from(o),thickness:l,inkLists:i,boxes:null,pageIndex:f-1,rect:r.slice(0),rotation:n,annotationElementId:a,id:a,deleted:!1,popupRef:h,richText:d,comment:c?.str||null,creationDate:u,modificationDate:p}}let{color:n,quadPoints:a,inkLists:o,opacity:l}=e,h=await super.deserialize(e,i,r);h.color=to.makeHexColor(...n),h.opacity=l||1,o&&(h.#nk=e.thickness),h._initialData=s,e.comment&&h.setCommentData(e);let[d,c]=h.pageDimensions,[u,p]=h.pageTranslation;if(a){let e=h.#n2=[];for(let i=0;i<a.length;i+=8)e.push({x:(a[i]-u)/d,y:1-(a[i+1]-p)/c,width:(a[i+2]-a[i])/d,height:(a[i+1]-a[i+5])/c});h.#as(),h.#ar(),h.rotate(h.rotation)}else if(o){h.#n7=!0;let e=o[0],r={x:e[0]-u,y:c-(e[1]-p)},s=new rP(r,[0,0,d,c],1,h.#nk/2,!0,.001);for(let i=0,n=e.length;i<n;i+=2)r.x=e[i]-u,r.y=c-(e[i+1]-p),s.add(r);let{id:n,clipPathId:a}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:s.toSVGPath()}},!0,!0);h.#ai({highlightOutlines:s.getOutlines(),highlightId:n,clipPathId:a}),h.#ar(),h.rotate(h.parentRotation)}return h}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let i=t6._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),r=super.serialize(e);return Object.assign(r,{color:i,opacity:this.opacity,thickness:this.#nk,quadPoints:this.#au(),outlines:this.#ap(r.rect)}),this.addComment(r),this.annotationElementId&&!this.#nb(r)?null:(r.id=this.annotationElementId,r)}#nb(e){let{color:i}=this._initialData;return this.hasEditedComment||e.color.some((e,r)=>e!==i[r])}renderAnnotationElement(e){return this.deleted?e.hide():e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}static canCreateNewEmptyEditor(){return!1}}class rO{#am=Object.create(null);updateProperty(e,i){this[e]=i,this.updateSVGProperty(e,i)}updateProperties(e){if(e)for(let[i,r]of Object.entries(e))i.startsWith("_")||this.updateProperty(i,r)}updateSVGProperty(e,i){this.#am[e]=i}toSVGProperties(){let e=this.#am;return this.#am=Object.create(null),{root:e}}reset(){this.#am=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){G("Not implemented")}}class rF extends t6{#ab=null;#av;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static #ay=null;static #a_=null;static #aw=null;static #aA=NaN;static #ax=null;static #aS=null;static #aE=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#av=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#aC(e),this.#ar())}#aC({drawOutlines:e,drawId:i,drawingOptions:r}){this.#ab=e,this._drawingOptions||=r,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=this.#aT(e,this.parent),this.#aM(e.box)}#aT(e,i){let{id:r}=i.drawLayer.draw(rF._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return r}static _mergeSVGProperties(e,i){let r=new Set(Object.keys(e));for(let[s,n]of Object.entries(i))r.has(s)?Object.assign(e[s],n):e[s]=n;return e}static getDefaultDrawingOptions(e){G("Not implemented")}static get typesMap(){G("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){let r=this.typesMap.get(e);r&&this._defaultDrawingOptions.updateProperty(r,i),this._currentParent&&(rF.#ay.updateProperty(r,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){let r=this.constructor.typesMap.get(e);r&&this._updateProperty(e,r,i)}static get defaultPropertiesToUpdate(){let e=[],i=this._defaultDrawingOptions;for(let[r,s]of this.typesMap)e.push([r,i[s]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:i}=this;for(let[r,s]of this.constructor.typesMap)e.push([r,i[s]]);return e}_updateProperty(e,i,r){let s=this._drawingOptions,n=s[i],a=r=>{s.updateProperty(i,r);let n=this.#ab.updateProperty(i,r);n&&this.#aM(n),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:a.bind(this,r),undo:a.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,rF._mergeSVGProperties(this.#ab.getPathResizingSVGProperties(this.#ak()),{bbox:this.#aI()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,rF._mergeSVGProperties(this.#ab.getPathResizedSVGProperties(this.#ak()),{bbox:this.#aI()}))}_onTranslating(e,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#aI()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,rF._mergeSVGProperties(this.#ab.getPathTranslatedSVGProperties(this.#ak(),this.parentDimensions),{bbox:this.#aI()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#av&&(this.#av=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#ah(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#ar(),this.#aM(this.#ab.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#ah()):e&&(this._uiManager.addShouldRescale(this),this.#ar(e),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),i&&this.select()}#ah(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#ar(e=this.parent){null!==this._drawId&&this.parent===e||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=this.#aT(this.#ab,e)):this.parent.drawLayer.updateParent(this._drawId,e.drawLayer))}#aD([e,i,r,s]){let{parentDimensions:[n,a],rotation:o}=this;switch(o){case 90:return[i,1-e,a/n*r,n/a*s];case 180:return[1-e,1-i,r,s];case 270:return[1-i,e,a/n*r,n/a*s];default:return[e,i,r,s]}}#ak(){let{x:e,y:i,width:r,height:s,parentDimensions:[n,a],rotation:o}=this;switch(o){case 90:return[1-i,e,n/a*r,a/n*s];case 180:return[1-e,1-i,r,s];case 270:return[i,1-e,n/a*r,a/n*s];default:return[e,i,r,s]}}#aM(e){[this.x,this.y,this.width,this.height]=this.#aD(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#aI(){let{x:e,y:i,width:r,height:s,rotation:n,parentRotation:a,parentDimensions:[o,l]}=this;switch((4*n+a)/90){case 1:return[1-i-s,e,s,r];case 2:return[1-e-r,1-i-s,r,s];case 3:return[i,1-e-r,s,r];case 4:return[e,i-o/l*r,l/o*s,o/l*r];case 5:return[1-i,e,o/l*r,l/o*s];case 6:return[1-e-l/o*s,1-i,l/o*s,o/l*r];case 7:return[i-o/l*r,1-e-l/o*s,o/l*r,l/o*s];case 8:return[e-r,i-s,r,s];case 9:return[1-i,e-r,s,r];case 10:return[1-e,1-i,r,s];case 11:return[i-s,1-e,s,r];case 12:return[e-l/o*s,i,l/o*s,o/l*r];case 13:return[1-i-o/l*r,e-l/o*s,o/l*r,l/o*s];case 14:return[1-e,1-i-o/l*r,l/o*s,o/l*r];case 15:return[i,1-e,o/l*r,l/o*s];default:return[e,i,r,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,rF._mergeSVGProperties({bbox:this.#aI()},this.#ab.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#aM(this.#ab.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){let e,i;if(this.div)return this.div;this._isCopy&&(e=this.x,i=this.y);let r=super.render();r.classList.add("draw");let s=document.createElement("div");return r.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,i),r}static createDrawerInstance(e,i,r,s,n){G("Not implemented")}static startDrawing(e,i,r,s){let{target:n,offsetX:a,offsetY:o,pointerId:l,pointerType:h}=s;if(rF.#ax&&rF.#ax!==h)return;let{viewport:{rotation:d}}=e,{width:c,height:u}=n.getBoundingClientRect(),p=rF.#a_=new AbortController,f=e.combinedSignal(p);rF.#aA||=l,rF.#ax??=h,window.addEventListener("pointerup",e=>{rF.#aA===e.pointerId?this._endDraw(e):rF.#aS?.delete(e.pointerId)},{signal:f}),window.addEventListener("pointercancel",e=>{rF.#aA===e.pointerId?this._currentParent.endDrawingSession():rF.#aS?.delete(e.pointerId)},{signal:f}),window.addEventListener("pointerdown",e=>{rF.#ax===e.pointerType&&((rF.#aS||=new Set).add(e.pointerId),rF.#ay.isCancellable()&&(rF.#ay.removeLastElement(),rF.#ay.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",tM,{signal:f}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:f}),n.addEventListener("touchmove",e=>{e.timeStamp===rF.#aE&&tk(e)},{signal:f}),e.toggleDrawing(),i._editorUndoBar?.hide(),rF.#ay?e.drawLayer.updateProperties(this._currentDrawId,rF.#ay.startNew(a,o,c,u,d)):(i.updateUIForDefaultProperties(this),rF.#ay=this.createDrawerInstance(a,o,c,u,d),rF.#aw=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(rF.#aw.toSVGProperties(),rF.#ay.defaultSVGProperties),!0,!1))}static _drawMove(e){if(rF.#aE=-1,!rF.#ay)return;let{offsetX:i,offsetY:r,pointerId:s}=e;rF.#aA===s&&(rF.#aS?.size>=1?this._endDraw(e):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,rF.#ay.add(i,r)),rF.#aE=e.timeStamp,tk(e)))}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,rF.#ay=null,rF.#aw=null,rF.#ax=null,rF.#aE=NaN),rF.#a_&&(rF.#a_.abort(),rF.#a_=null,rF.#aA=NaN,rF.#aS=null)}static _endDraw(e){let i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),e?.target===i.div&&i.drawLayer.updateProperties(this._currentDrawId,rF.#ay.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){let e=rF.#ay,r=this._currentDrawId,s=e.getLastElement();return void i.addCommands({cmd:()=>{i.drawLayer.updateProperties(r,e.setLastElement(s))},undo:()=>{i.drawLayer.updateProperties(r,e.removeLastElement())},mustExec:!1,type:N.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(e){let i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(N.DRAW_STEP),!rF.#ay.isEmpty()){let{pageDimensions:[r,s],scale:n}=i,a=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:rF.#ay.getOutlines(r*n,s*n,n,this._INNER_MARGIN),drawingOptions:rF.#aw,mustBeCommitted:!e});return this._cleanup(!0),a}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,r,s,n,a){G("Not implemented")}static async deserialize(e,i,r){let{rawDims:{pageWidth:s,pageHeight:n,pageX:a,pageY:o}}=i.viewport,l=this.deserializeDraw(a,o,s,n,this._INNER_MARGIN,e),h=await super.deserialize(e,i,r);return h.createDrawingOptions(e),h.#aC({drawOutlines:l}),h.#ar(),h.onScaleChanging(),h.rotate(),h}serializeDraw(e){let[i,r]=this.pageTranslation,[s,n]=this.pageDimensions;return this.#ab.serialize([i,r,s,n],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class rB{#nx=new Float64Array(6);#s1;#aR;#rk;#nk;#nI;#aP="";#aL=0;#nZ=new rU;#aN;#aO;constructor(e,i,r,s,n,a){this.#aN=r,this.#aO=s,this.#rk=n,this.#nk=a,[e,i]=this.#aF(e,i);let o=this.#s1=[NaN,NaN,NaN,NaN,e,i];this.#nI=[e,i],this.#aR=[{line:o,points:this.#nI}],this.#nx.set(o,0)}updateProperty(e,i){"stroke-width"===e&&(this.#nk=i)}#aF(e,i){return rM._normalizePoint(e,i,this.#aN,this.#aO,this.#rk)}isEmpty(){return!this.#aR||0===this.#aR.length}isCancellable(){return this.#nI.length<=10}add(e,i){[e,i]=this.#aF(e,i);let[r,s,n,a]=this.#nx.subarray(2,6),o=e-n,l=i-a;return 2>=Math.hypot(this.#aN*o,this.#aO*l)?null:(this.#nI.push(e,i),isNaN(r)?(this.#nx.set([n,a,e,i],2),this.#s1.push(NaN,NaN,NaN,NaN,e,i)):(isNaN(this.#nx[0])&&this.#s1.splice(6,6),this.#nx.set([r,s,n,a,e,i],0),this.#s1.push(...rM.createBezierPoints(r,s,n,a,e,i))),{path:{d:this.toSVGPath()}})}end(e,i){return this.add(e,i)||(2===this.#nI.length?{path:{d:this.toSVGPath()}}:null)}startNew(e,i,r,s,n){this.#aN=r,this.#aO=s,this.#rk=n,[e,i]=this.#aF(e,i);let a=this.#s1=[NaN,NaN,NaN,NaN,e,i];this.#nI=[e,i];let o=this.#aR.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#aR.push({line:a,points:this.#nI}),this.#nx.set(a,0),this.#aL=0,this.toSVGPath(),null}getLastElement(){return this.#aR.at(-1)}setLastElement(e){return this.#aR?(this.#aR.push(e),this.#s1=e.line,this.#nI=e.points,this.#aL=0,{path:{d:this.toSVGPath()}}):this.#nZ.setLastElement(e)}removeLastElement(){if(!this.#aR)return this.#nZ.removeLastElement();this.#aR.pop(),this.#aP="";for(let e=0,i=this.#aR.length;e<i;e++){let{line:i,points:r}=this.#aR[e];this.#s1=i,this.#nI=r,this.#aL=0,this.toSVGPath()}return{path:{d:this.#aP}}}toSVGPath(){let e=rM.svgRound(this.#s1[4]),i=rM.svgRound(this.#s1[5]);if(2===this.#nI.length)return this.#aP=`${this.#aP} M ${e} ${i} Z`,this.#aP;if(this.#nI.length<=6){let r=this.#aP.lastIndexOf("M");this.#aP=`${this.#aP.slice(0,r)} M ${e} ${i}`,this.#aL=6}if(4===this.#nI.length){let e=rM.svgRound(this.#s1[10]),i=rM.svgRound(this.#s1[11]);return this.#aP=`${this.#aP} L ${e} ${i}`,this.#aL=12,this.#aP}let r=[];0===this.#aL&&(r.push(`M ${e} ${i}`),this.#aL=6);for(let e=this.#aL,i=this.#s1.length;e<i;e+=6){let[i,s,n,a,o,l]=this.#s1.slice(e,e+6).map(rM.svgRound);r.push(`C${i} ${s} ${n} ${a} ${o} ${l}`)}return this.#aP+=r.join(" "),this.#aL=this.#s1.length,this.#aP}getOutlines(e,i,r,s){let n=this.#aR.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#nZ.build(this.#aR,e,i,r,this.#rk,this.#nk,s),this.#nx=null,this.#s1=null,this.#aR=null,this.#aP=null,this.#nZ}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class rU extends rM{#n$;#aB=0;#n_;#aR;#aN;#aO;#aU;#rk;#nk;build(e,i,r,s,n,a,o){this.#aN=i,this.#aO=r,this.#aU=s,this.#rk=n,this.#nk=a,this.#n_=o??0,this.#aR=e,this.#aj()}get thickness(){return this.#nk}setLastElement(e){return this.#aR.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#aR.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:i}of this.#aR)if(e.push(`M${rM.svgRound(i[4])} ${rM.svgRound(i[5])}`),6!==i.length){if(12===i.length&&isNaN(i[6]))e.push(`L${rM.svgRound(i[10])} ${rM.svgRound(i[11])}`);else for(let r=6,s=i.length;r<s;r+=6){let[s,n,a,o,l,h]=i.subarray(r,r+6).map(rM.svgRound);e.push(`C${s} ${n} ${a} ${o} ${l} ${h}`)}}else e.push("Z");return e.join("")}serialize([e,i,r,s],n){let a,o,l,h,d,c,u,p,f;let g=[],m=[],[b,v,y,_]=this.#a$();switch(this.#rk){case 0:f=rM._rescale,a=e,o=i+s,l=r,h=-s,d=e+b*r,c=i+(1-v-_)*s,u=e+(b+y)*r,p=i+(1-v)*s;break;case 90:f=rM._rescaleAndSwap,a=e,o=i,l=r,h=s,d=e+v*r,c=i+b*s,u=e+(v+_)*r,p=i+(b+y)*s;break;case 180:f=rM._rescale,a=e+r,o=i,l=-r,h=s,d=e+(1-b-y)*r,c=i+v*s,u=e+(1-b)*r,p=i+(v+_)*s;break;case 270:f=rM._rescaleAndSwap,a=e+r,o=i+s,l=-r,h=-s,d=e+(1-v-_)*r,c=i+(1-b-y)*s,u=e+(1-v)*r,p=i+(1-b)*s}for(let{line:e,points:i}of this.#aR)g.push(f(e,a,o,l,h,n?Array(e.length):null)),m.push(f(i,a,o,l,h,n?Array(i.length):null));return{lines:g,points:m,rect:[d,c,u,p]}}static deserialize(e,i,r,s,n,{paths:{lines:a,points:o},rotation:l,thickness:h}){let d,c,u,p,f;let g=[];switch(l){case 0:f=rM._rescale,d=-e/r,c=i/s+1,u=1/r,p=-1/s;break;case 90:f=rM._rescaleAndSwap,d=-i/s,c=-e/r,u=1/s,p=1/r;break;case 180:f=rM._rescale,d=e/r+1,c=-i/s,u=-1/r,p=1/s;break;case 270:f=rM._rescaleAndSwap,d=i/s+1,c=e/r+1,u=-1/s,p=-1/r}if(!a)for(let e of(a=[],o)){let i=e.length;if(2===i){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1]]));continue}if(4===i){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1],NaN,NaN,NaN,NaN,e[2],e[3]]));continue}let r=new Float32Array(3*(i-2));a.push(r);let[s,n,o,l]=e.subarray(0,4);r.set([NaN,NaN,NaN,NaN,s,n],0);for(let a=4;a<i;a+=2){let i=e[a],h=e[a+1];r.set(rM.createBezierPoints(s,n,o,l,i,h),3*(a-2)),[s,n,o,l]=[o,l,i,h]}}for(let e=0,i=a.length;e<i;e++)g.push({line:f(a[e].map(e=>e??NaN),d,c,u,p),points:f(o[e].map(e=>e??NaN),d,c,u,p)});let m=new this.prototype.constructor;return m.build(g,r,s,1,l,h,n),m}#aH(e=this.#nk){let i=this.#n_+e/2*this.#aU;return this.#rk%180==0?[i/this.#aN,i/this.#aO]:[i/this.#aO,i/this.#aN]}#a$(){let[e,i,r,s]=this.#n$,[n,a]=this.#aH(0);return[e+n,i+a,r-2*n,s-2*a]}#aj(){let e=this.#n$=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:i}of this.#aR){if(i.length<=12){for(let r=4,s=i.length;r<s;r+=6)to.pointBoundingBox(i[r],i[r+1],e);continue}let r=i[4],s=i[5];for(let n=6,a=i.length;n<a;n+=6){let[a,o,l,h,d,c]=i.subarray(n,n+6);to.bezierBoundingBox(r,s,a,o,l,h,d,c,e),r=d,s=c}}let[i,r]=this.#aH();e[0]=tp(e[0]-i,0,1),e[1]=tp(e[1]-r,0,1),e[2]=tp(e[2]+i,0,1),e[3]=tp(e[3]+r,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#n$}updateProperty(e,i){return"stroke-width"===e?this.#aa(i):null}#aa(e){let[i,r]=this.#aH();this.#nk=e;let[s,n]=this.#aH(),[a,o]=[s-i,n-r],l=this.#n$;return l[0]-=a,l[1]-=o,l[2]+=2*a,l[3]+=2*o,l}updateParentDimensions([e,i],r){let[s,n]=this.#aH();this.#aN=e,this.#aO=i,this.#aU=r;let[a,o]=this.#aH(),l=a-s,h=o-n,d=this.#n$;return d[0]-=l,d[1]-=h,d[2]+=2*l,d[3]+=2*h,d}updateRotation(e){return this.#aB=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#n$.map(rM.svgRound).join(" ")}get defaultProperties(){let[e,i]=this.#n$;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rM.svgRound(e)} ${rM.svgRound(i)}`}}}get rotationTransform(){let[,,e,i]=this.#n$,r=0,s=0,n=0,a=0,o=0,l=0;switch(this.#aB){case 90:s=i/e,n=-e/i,o=e;break;case 180:r=-1,a=-1,o=e,l=i;break;case 270:s=-i/e,n=e/i,l=i;break;default:return""}return`matrix(${r} ${s} ${n} ${a} ${rM.svgRound(o)} ${rM.svgRound(l)})`}getPathResizingSVGProperties([e,i,r,s]){let[n,a]=this.#aH(),[o,l,h,d]=this.#n$;if(Math.abs(h-n)<=rM.PRECISION||Math.abs(d-a)<=rM.PRECISION){let n=e+r/2-(o+h/2),a=i+s/2-(l+d/2);return{path:{"transform-origin":`${rM.svgRound(e)} ${rM.svgRound(i)}`,transform:`${this.rotationTransform} translate(${n} ${a})`}}}let c=(r-2*n)/(h-2*n),u=(s-2*a)/(d-2*a);return{path:{"transform-origin":`${rM.svgRound(o)} ${rM.svgRound(l)}`,transform:`${this.rotationTransform} scale(${h/r} ${d/s}) translate(${rM.svgRound(n)} ${rM.svgRound(a)}) scale(${c} ${u}) translate(${rM.svgRound(-n)} ${rM.svgRound(-a)})`}}}getPathResizedSVGProperties([e,i,r,s]){let[n,a]=this.#aH(),o=this.#n$,[l,h,d,c]=o;if(o[0]=e,o[1]=i,o[2]=r,o[3]=s,Math.abs(d-n)<=rM.PRECISION||Math.abs(c-a)<=rM.PRECISION){let n=e+r/2-(l+d/2),a=i+s/2-(h+c/2);for(let{line:e,points:i}of this.#aR)rM._translate(e,n,a,e),rM._translate(i,n,a,i);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rM.svgRound(e)} ${rM.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let u=(r-2*n)/(d-2*n),p=(s-2*a)/(c-2*a),f=-u*(l+n)+e+n,g=-p*(h+a)+i+a;if(1!==u||1!==p||0!==f||0!==g)for(let{line:e,points:i}of this.#aR)rM._rescale(e,f,g,u,p,e),rM._rescale(i,f,g,u,p,i);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rM.svgRound(e)} ${rM.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,i],r){let[s,n]=r,a=this.#n$,o=e-a[0],l=i-a[1];if(this.#aN===s&&this.#aO===n)for(let{line:e,points:i}of this.#aR)rM._translate(e,o,l,e),rM._translate(i,o,l,i);else{let e=this.#aN/s,i=this.#aO/n;for(let{line:r,points:a}of(this.#aN=s,this.#aO=n,this.#aR))rM._rescale(r,o,l,e,i,r),rM._rescale(a,o,l,e,i,a);a[2]*=e,a[3]*=i}return a[0]=e,a[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${rM.svgRound(e)} ${rM.svgRound(i)}`}}}get defaultSVGProperties(){let e=this.#n$;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${rM.svgRound(e[0])} ${rM.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class rj extends rO{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:t6._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,i){"stroke-width"===e&&(i??=this["stroke-width"],i*=this._viewParameters.realScale),super.updateSVGProperty(e,i)}clone(){let e=new rj(this._viewParameters);return e.updateAll(this),e}}class r$ extends rF{static _type="ink";static _editorType=L.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,i){t6.initialize(e,i),this._defaultDrawingOptions=new rj(i.viewParameters)}static getDefaultDrawingOptions(e){let i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return Y(this,"typesMap",new Map([[N.INK_THICKNESS,"stroke-width"],[N.INK_COLOR,"stroke"],[N.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,i,r,s,n){return new rB(e,i,r,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,i,r,s,n,a){return rU.deserialize(e,i,r,s,n,a)}static async deserialize(e,i,r){let s=null;if(e instanceof rv){let{data:{inkLists:i,rect:r,rotation:n,id:a,color:o,opacity:l,borderStyle:{rawWidth:h},popupRef:d,richText:c,contentsObj:u,creationDate:p,modificationDate:f},parent:{page:{pageNumber:g}}}=e;s=e={annotationType:L.INK,color:Array.from(o),thickness:h,opacity:l,paths:{points:i},boxes:null,pageIndex:g-1,rect:r.slice(0),rotation:n,annotationElementId:a,id:a,deleted:!1,popupRef:d,richText:c,comment:u?.str||null,creationDate:p,modificationDate:f}}let n=await super.deserialize(e,i,r);return n._initialData=s,e.comment&&n.setCommentData(e),n}get toolbarButtons(){return this._colorPicker||=new iZ(this),[["colorPicker",this._colorPicker]]}get colorType(){return N.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:i,parent:r}=this;i.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(e,i.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:i,opacity:r}){this._drawingOptions=r$.getDefaultDrawingOptions({stroke:to.makeHexColor(...e),"stroke-width":i,"stroke-opacity":r})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:i,points:r}=this.serializeDraw(e),{_drawingOptions:{stroke:s,"stroke-opacity":n,"stroke-width":a}}=this,o=Object.assign(super.serialize(e),{color:t6._colorManager.convert(s),opacity:n,thickness:a,paths:{lines:i,points:r}});return this.addComment(o),e?(o.isCopy=!0,o):this.annotationElementId&&!this.#nb(o)?null:(o.id=this.annotationElementId,o)}#nb(e){let{color:i,thickness:r,opacity:s,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((e,r)=>e!==i[r])||e.thickness!==r||e.opacity!==s||e.pageIndex!==n}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let{points:i,rect:r}=this.serializeDraw(!1);return e.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:i,popup:this.comment}),null}}class rH extends rU{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}class rz{static #az={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static #aV(e,i,r,s){return s-=i,0==(r-=e)?s>0?0:4:1===r?s+6:2-s}static #aG=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static #aW(e,i,r,s,n,a,o){let l=this.#aV(r,s,n,a);for(let n=0;n<8;n++){let a=(-n+l-o+16)%8;if(0!==e[(r+this.#aG[2*a])*i+(s+this.#aG[2*a+1])])return a}return -1}static #aq(e,i,r,s,n,a,o){let l=this.#aV(r,s,n,a);for(let n=0;n<8;n++){let a=(n+l+o+16)%8;if(0!==e[(r+this.#aG[2*a])*i+(s+this.#aG[2*a+1])])return a}return -1}static #aX(e,i,r,s){let n=e.length,a=new Int32Array(n);for(let i=0;i<n;i++)a[i]=e[i]<=s?1:0;for(let e=1;e<r-1;e++)a[e*i]=a[e*i+i-1]=0;for(let e=0;e<i;e++)a[e]=a[i*r-1-e]=0;let o,l=1,h=[];for(let e=1;e<r-1;e++){o=1;for(let r=1;r<i-1;r++){let s;let n=e*i+r,d=a[n];if(0===d)continue;let c=e,u=r;if(1===d&&0===a[n-1])l+=1,u-=1;else{if(!(d>=1&&0===a[n+1])){1!==d&&(o=Math.abs(d));continue}l+=1,u+=1,d>1&&(o=d)}let p=[r,e],f=u===r+1,g={isHole:f,points:p,id:l,parent:0};for(let e of(h.push(g),h))if(e.id===o){s=e;break}s?s.isHole?g.parent=f?s.parent:o:g.parent=f?o:s.parent:g.parent=f?o:0;let m=this.#aW(a,i,e,r,c,u,0);if(-1===m){a[n]=-l,1!==a[n]&&(o=Math.abs(a[n]));continue}let b=this.#aG[2*m],v=this.#aG[2*m+1],y=e+b,_=r+v;c=y,u=_;let w=e,A=r;for(;;){let s=this.#aq(a,i,w,A,c,u,1);b=this.#aG[2*s],v=this.#aG[2*s+1];let h=w+b,d=A+v;p.push(d,h);let f=w*i+A;if(0===a[f+1]?a[f]=-l:1===a[f]&&(a[f]=l),h===e&&d===r&&w===y&&A===_){1!==a[n]&&(o=Math.abs(a[n]));break}c=w,u=A,w=h,A=d}}}return h}static #aY(e,i,r,s){if(r-i<=4){for(let n=i;n<r-2;n+=2)s.push(e[n],e[n+1]);return}let n=e[i],a=e[i+1],o=e[r-4]-n,l=e[r-3]-a,h=Math.hypot(o,l),d=o/h,c=l/h,u=d*a-c*n,p=1/h,f=Math.atan(l/o),g=Math.cos(f),m=Math.sin(f),b=p*(Math.abs(g)+Math.abs(m)),v=p*(1-b+b**2),y=Math.max(Math.atan(Math.abs(m+g)*v),Math.atan(Math.abs(m-g)*v)),_=0,w=i;for(let s=i+2;s<r-2;s+=2){let i=Math.abs(u-d*e[s+1]+c*e[s]);i>_&&(w=s,_=i)}_>(h*y)**2?(this.#aY(e,i,w+2,s),this.#aY(e,w,r,s)):s.push(n,a)}static #aJ(e){let i=[],r=e.length;return this.#aY(e,0,r,i),i.push(e[r-2],e[r-1]),i.length<=4?null:i}static #aK(e,i,r,s,n,a){let o=new Float32Array(a**2),l=-2*s**2,h=a>>1;for(let e=0;e<a;e++){let i=(e-h)**2;for(let r=0;r<a;r++)o[e*a+r]=Math.exp((i+(r-h)**2)/l)}let d=new Float32Array(256),c=-2*n**2;for(let e=0;e<256;e++)d[e]=Math.exp(e**2/c);let u=new Uint8Array(e.length),p=new Uint32Array(256);for(let s=0;s<r;s++)for(let n=0;n<i;n++){let l=s*i+n,c=e[l],f=0,g=0;for(let l=0;l<a;l++){let u=s+l-h;if(!(u<0||u>=r))for(let r=0;r<a;r++){let s=n+r-h;if(s<0||s>=i)continue;let p=e[u*i+s],m=o[l*a+r]*d[Math.abs(p-c)];f+=p*m,g+=m}}p[u[l]=Math.round(f/g)]++}return[u,p]}static #aQ(e){let i=new Uint32Array(256);for(let r of e)i[r]++;return i}static #aZ(e){let i=new Uint8ClampedArray(e.length>>2),r=-1/0,s=1/0;for(let n=0,a=i.length;n<a;n++){let a=i[n]=e[n<<2];r=Math.max(r,a),s=Math.min(s,a)}let n=255/(r-s);for(let e=0,r=i.length;e<r;e++)i[e]=(i[e]-s)*n;return i}static #a0(e){let i,r=-1/0,s=-1/0,n=e.findIndex(e=>0!==e),a=n,o=n;for(i=n;i<256;i++){let n=e[i];n>r&&(i-a>s&&(s=i-a,o=i-1),r=n,a=i)}for(i=o-1;i>=0&&!(e[i]>e[i+1]);i--);return i}static #a1(e){let i=e,{width:r,height:s}=e,{maxDim:n}=this.#az,a=r,o=s;if(r>n||s>n){let l=r,h=s,d=Math.log2(Math.max(r,s)/n),c=Math.floor(d);d=d===c?c-1:c;for(let r=0;r<d;r++){let r=new OffscreenCanvas(a=Math.ceil(l/2),o=Math.ceil(h/2));r.getContext("2d").drawImage(e,0,0,l,h,0,0,a,o),l=a,h=o,e!==i&&e.close(),e=r.transferToImageBitmap()}let u=Math.min(n/a,n/o);a=Math.round(a*u),o=Math.round(o*u)}let l=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});l.fillStyle="white",l.fillRect(0,0,a,o),l.filter="grayscale(1)",l.drawImage(e,0,0,e.width,e.height,0,0,a,o);let h=l.getImageData(0,0,a,o).data;return[this.#aZ(h),a,o]}static extractContoursFromText(e,{fontFamily:i,fontStyle:r,fontWeight:s},n,a,o,l){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1}),c=d.font=`${r} ${s} 200px ${i}`,{actualBoundingBoxLeft:u,actualBoundingBoxRight:p,actualBoundingBoxAscent:f,actualBoundingBoxDescent:g,fontBoundingBoxAscent:m,fontBoundingBoxDescent:b,width:v}=d.measureText(e),y=Math.ceil(1.5*Math.max(Math.abs(u)+Math.abs(p)||0,v)),_=Math.ceil(1.5*Math.max(Math.abs(f)+Math.abs(g)||200,Math.abs(m)+Math.abs(b)||200));(d=(h=new OffscreenCanvas(y,_)).getContext("2d",{alpha:!0,willReadFrequently:!0})).font=c,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,y,_),d.fillStyle="black",d.fillText(e,.5*y/2,1.5*_/2);let w=this.#aZ(d.getImageData(0,0,y,_).data),A=this.#aQ(w),x=this.#a0(A),S=this.#aX(w,y,_,x);return this.processDrawnLines({lines:{curves:S,width:y,height:_},pageWidth:n,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,i,r,s,n){let[a,o,l]=this.#a1(e),[h,d]=this.#aK(a,o,l,Math.hypot(o,l)*this.#az.sigmaSFactor,this.#az.sigmaR,this.#az.kernelSize),c=this.#a0(d),u=this.#aX(h,o,l,c);return this.processDrawnLines({lines:{curves:u,width:o,height:l},pageWidth:i,pageHeight:r,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:i,pageHeight:r,rotation:s,innerMargin:n,mustSmooth:a,areContours:o}){s%180!=0&&([i,r]=[r,i]);let{curves:l,width:h,height:d}=e,c=e.thickness??0,u=[],p=Math.min(i/h,r/d),f=p/i,g=p/r,m=[];for(let{points:e}of l){let i=a?this.#aJ(e):e;if(!i)continue;m.push(i);let r=i.length,s=new Float32Array(r),n=new Float32Array(3*(2===r?2:r-2));if(u.push({line:n,points:s}),2===r){s[0]=i[0]*f,s[1]=i[1]*g,n.set([NaN,NaN,NaN,NaN,s[0],s[1]],0);continue}let[o,l,h,d]=i;o*=f,l*=g,h*=f,d*=g,s.set([o,l,h,d],0),n.set([NaN,NaN,NaN,NaN,o,l],0);for(let e=4;e<r;e+=2){let r=s[e]=i[e]*f,a=s[e+1]=i[e+1]*g;n.set(rM.createBezierPoints(o,l,h,d,r,a),3*(e-2)),[o,l,h,d]=[h,d,r,a]}}if(0===u.length)return null;let b=o?new rH:new rU;return b.build(u,i,r,1,s,o?0:c,n),{outline:b,newCurves:m,areContours:o,thickness:c,width:h,height:d}}static async compressSignature({outlines:e,areContours:i,thickness:r,width:s,height:n}){let a,o=1/0,l=-1/0,h=0;for(let i of e){h+=i.length;for(let e=2,r=i.length;e<r;e++){let r=i[e]-i[e-2];o=Math.min(o,r),l=Math.max(l,r)}}a=o>=-128&&l<=127?Int8Array:o>=-32768&&l<=32767?Int16Array:Int32Array;let d=e.length,c=8+3*d,u=new Uint32Array(c),p=0;for(let o of(u[p++]=c*Uint32Array.BYTES_PER_ELEMENT+(h-2*d)*a.BYTES_PER_ELEMENT,u[p++]=0,u[p++]=s,u[p++]=n,u[p++]=i?0:1,u[p++]=Math.max(0,Math.floor(r??0)),u[p++]=d,u[p++]=a.BYTES_PER_ELEMENT,e))u[p++]=o.length-2,u[p++]=o[0],u[p++]=o[1];let f=new CompressionStream("deflate-raw"),g=f.writable.getWriter();await g.ready,g.write(u);let m=a.prototype.constructor;for(let i of e){let e=new m(i.length-2);for(let r=2,s=i.length;r<s;r++)e[r-2]=i[r]-i[r-2];g.write(e)}return g.close(),tf(new Uint8Array(await new Response(f.readable).arrayBuffer()))}static async decompressSignature(e){try{let i;let r=Uint8Array.fromBase64?Uint8Array.fromBase64(e):ts(atob(e)),{readable:s,writable:n}=new DecompressionStream("deflate-raw"),a=n.getWriter();await a.ready,a.write(r).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,l=0;for await(let e of s)(o||=new Uint8Array(new Uint32Array(e.buffer,0,4)[0])).set(e,l),l+=e.length;let h=new Uint32Array(o.buffer,0,o.length>>2),d=h[1];if(0!==d)throw Error(`Invalid version: ${d}`);let c=h[2],u=h[3],p=0===h[4],f=h[5],g=h[6],m=h[7],b=[],v=(8+3*g)*Uint32Array.BYTES_PER_ELEMENT;switch(m){case Int8Array.BYTES_PER_ELEMENT:i=new Int8Array(o.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:i=new Int16Array(o.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:i=new Int32Array(o.buffer,v)}l=0;for(let e=0;e<g;e++){let r=h[3*e+8],s=new Float32Array(r+2);b.push(s);for(let i=0;i<2;i++)s[i]=h[3*e+8+i+1];for(let e=0;e<r;e++)s[e+2]=s[e]+i[l++]}return{areContours:p,thickness:f,outlines:b,width:c,height:u}}catch(e){return V(`decompressSignature: ${e}`),null}}}class rV extends rO{constructor(){super(),super.updateProperties({fill:t6._defaultLineColor,"stroke-width":0})}clone(){let e=new rV;return e.updateAll(this),e}}class rG extends rj{constructor(e){super(e),super.updateProperties({stroke:t6._defaultLineColor,"stroke-width":1})}clone(){let e=new rG(this._viewParameters);return e.updateAll(this),e}}class rW extends rF{#a2=!1;#a5=null;#a4=null;#a3=null;static _type="signature";static _editorType=L.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#a4=e.signatureData||null,this.#a5=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,i){t6.initialize(e,i),this._defaultDrawingOptions=new rV,this._defaultDrawnSignatureOptions=new rG(i.viewParameters)}static getDefaultDrawingOptions(e){let i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!1}static get typesMap(){return Y(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#a5}}static computeTelemetryFinalData(e){let i=e.get("hasDescription");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){let e,i;if(this.div)return this.div;let{_isCopy:r}=this;if(r&&(this._isCopy=!1,e=this.x,i=this.y),super.render(),null===this._drawId){if(this.#a4){let{lines:e,mustSmooth:i,areContours:r,description:s,uuid:n,heightInPage:a}=this.#a4,{rawDims:{pageWidth:o,pageHeight:l},rotation:h}=this.parent.viewport,d=rz.processDrawnLines({lines:e,pageWidth:o,pageHeight:l,rotation:h,innerMargin:rW._INNER_MARGIN,mustSmooth:i,areContours:r});this.addSignature(d,a,s,n)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#a5||""}));return r&&(this._isCopy=!0,this._moveAfterPaste(e,i)),this.div}setUuid(e){this.#a3=e,this.addEditToolbar()}getUuid(){return this.#a3}get description(){return this.#a5}set description(e){this.#a5=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(i=>{i?.updateEditSignatureButton(e)}))}getSignaturePreview(){let{newCurves:e,areContours:i,thickness:r,width:s,height:n}=this.#a4,a=Math.max(s,n);return{areContours:i,outline:rz.processDrawnLines({lines:{curves:e.map(e=>({points:e})),thickness:r,width:s,height:n},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:i}).outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,i,r,s){let n;let{x:a,y:o}=this,{outline:l}=this.#a4=e;this.#a2=l instanceof rH,this.description=r,this.#a2?n=rW.getDefaultDrawingOptions():(n=rW._defaultDrawnSignatureOptions.clone()).updateProperties({"stroke-width":l.thickness}),this._addOutlines({drawOutlines:l,drawingOptions:n});let[,h]=this.pageDimensions,d=i/h;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(e){let{rawDims:{pageWidth:i,pageHeight:r},rotation:s}=this.parent.viewport;return rz.process(e,i,r,s,rW._INNER_MARGIN)}getFromText(e,i){let{rawDims:{pageWidth:r,pageHeight:s},rotation:n}=this.parent.viewport;return rz.extractContoursFromText(e,i,r,s,n,rW._INNER_MARGIN)}getDrawnSignature(e){let{rawDims:{pageWidth:i,pageHeight:r},rotation:s}=this.parent.viewport;return rz.processDrawnLines({lines:e,pageWidth:i,pageHeight:r,rotation:s,innerMargin:rW._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:i}){e?this._drawingOptions=rW.getDefaultDrawingOptions():(this._drawingOptions=rW._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":i}))}serialize(e=!1){if(this.isEmpty())return null;let{lines:i,points:r}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":s}}=this,n=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#a2,color:[0,0,0],thickness:this.#a2?0:s});return this.addComment(n),e?(n.paths={lines:i,points:r},n.uuid=this.#a3,n.isCopy=!0):n.lines=i,this.#a5&&(n.accessibilityData={type:"Figure",alt:this.#a5}),n}static deserializeDraw(e,i,r,s,n,a){return a.areContours?rH.deserialize(e,i,r,s,n,a):rU.deserialize(e,i,r,s,n,a)}static async deserialize(e,i,r){let s=await super.deserialize(e,i,r);return s.#a2=e.areContours,s.description=e.accessibilityData?.alt||"",s.#a3=e.uuid,s}}class rq extends t6{#a6=null;#a9=null;#a8=null;#a7=null;#ot=null;#oe="";#oi=null;#or=!1;#os=null;#on=!1;#oa=!1;static _type="stamp";static _editorType=L.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#a7=e.bitmapUrl,this.#ot=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,i){t6.initialize(e,i)}static isHandlingMimeForPasting(e){return tF.includes(e)}static paste(e,i){i.pasteEditor({mode:L.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let i=e.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}#oo(e,i=!1){e?(this.#a6=e.bitmap,i||(this.#a9=e.id,this.#on=e.isSvg),e.file&&(this.#oe=e.file.name),this.#ol()):this.remove()}#oh(){if(this.#a8=null,this._uiManager.enableWaiting(!1),this.#oi){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#a6)this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#a6){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}}async mlGuessAltText(e=null,i=!0){if(this.hasAltTextData())return null;let{mlManager:r}=this._uiManager;if(!r)throw Error("No ML.");if(!await r.isEnabledFor("altText"))throw Error("ML isn't enabled for alt text.");let{data:s,width:n,height:a}=e||this.copyCanvas(null,null,!0).imageData,o=await r.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!o)throw Error("No response from the AI service.");if(o.error)throw Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw Error("No valid response from the AI service.");let l=o.output;return await this.setGuessedAltText(l),i&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#od(){if(this.#a9)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#a9).then(e=>this.#oo(e,!0)).finally(()=>this.#oh());if(this.#a7){let e=this.#a7;return this.#a7=null,this._uiManager.enableWaiting(!0),void(this.#a8=this._uiManager.imageManager.getFromUrl(e).then(e=>this.#oo(e)).finally(()=>this.#oh()))}if(this.#ot){let e=this.#ot;return this.#ot=null,this._uiManager.enableWaiting(!0),void(this.#a8=this._uiManager.imageManager.getFromFile(e).then(e=>this.#oo(e)).finally(()=>this.#oh()))}let e=document.createElement("input");e.type="file",e.accept=tF.join(",");let i=this._uiManager._signal;this.#a8=new Promise(r=>{e.addEventListener("change",async()=>{if(e.files&&0!==e.files.length){this._uiManager.enableWaiting(!0);let i=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#oo(i)}else this.remove();r()},{signal:i}),e.addEventListener("cancel",()=>{this.remove(),r()},{signal:i})}).finally(()=>this.#oh()),e.click()}remove(){this.#a9&&(this.#a6=null,this._uiManager.imageManager.deleteId(this.#a9),this.#oi?.remove(),this.#oi=null,this.#os&&(clearTimeout(this.#os),this.#os=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#a9&&null===this.#oi&&this.#od(),this.isAttachedToDOM||this.parent.add(this))):this.#a9&&this.#od()}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#a8||this.#a6||this.#a7||this.#ot||this.#a9||this.#or)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){let e,i;return this.div||(this._isCopy&&(e=this.x,i=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#or||(this.#a6?this.#ol():this.#od()),this._isCopy&&this._moveAfterPaste(e,i),this._uiManager.addShouldRescale(this)),this.div}setCanvas(e,i){let{id:r,bitmap:s}=this._uiManager.imageManager.getFromCanvas(e,i);i.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(this.#a9=r,s&&(this.#a6=s),this.#or=!1,this.#ol())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(null!==this.#os&&clearTimeout(this.#os),this.#os=setTimeout(()=>{this.#os=null,this.#oc()},200))}#ol(){let{div:e}=this,{width:i,height:r}=this.#a6,[s,n]=this.pageDimensions;if(this.width)i=this.width*s,r=this.height*n;else if(i>.75*s||r>.75*n){let e=Math.min(.75*s/i,.75*n/r);i*=e,r*=e}this._uiManager.enableWaiting(!1);let a=this.#oi=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=i/s,this.height=r/n,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(e.hidden=!1),this.#oc(),this.#oa||(this.parent.addUndoableEditor(this),this.#oa=!0),this._reportTelemetry({action:"inserted_image"}),this.#oe&&this.div.setAttribute("aria-description",this.#oe),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,i,r=!1){e||(e=224);let{width:s,height:n}=this.#a6,a=new tO,o=this.#a6,l=s,h=n,d=null;if(i){if(s>i||n>i){let e=Math.min(i/s,i/n);l=Math.floor(s*e),h=Math.floor(n*e)}let e=(d=document.createElement("canvas")).width=Math.ceil(l*a.sx),r=d.height=Math.ceil(h*a.sy);this.#on||(o=this.#ou(e,r));let c=d.getContext("2d");c.filter=this._uiManager.hcmFilter;let u="white",p="#cfcfd8";"none"!==this._uiManager.hcmFilter?p="black":tB.isDarkMode&&(u="#8f8f9d",p="#42414d");let f=15*a.sx,g=15*a.sy,m=new OffscreenCanvas(2*f,2*g),b=m.getContext("2d");b.fillStyle=u,b.fillRect(0,0,2*f,2*g),b.fillStyle=p,b.fillRect(0,0,f,g),b.fillRect(f,g,f,g),c.fillStyle=c.createPattern(m,"repeat"),c.fillRect(0,0,e,r),c.drawImage(o,0,0,o.width,o.height,0,0,e,r)}let c=null;if(r){let i,r;if(a.symmetric&&o.width<e&&o.height<e)i=o.width,r=o.height;else if(o=this.#a6,s>e||n>e){let a=Math.min(e/s,e/n);i=Math.floor(s*a),r=Math.floor(n*a),this.#on||(o=this.#ou(i,r))}let l=new OffscreenCanvas(i,r).getContext("2d",{willReadFrequently:!0});l.drawImage(o,0,0,o.width,o.height,0,0,i,r),c={width:i,height:r,data:l.getImageData(0,0,i,r).data}}return{canvas:d,width:l,height:h,imageData:c}}#ou(e,i){let{width:r,height:s}=this.#a6,n=r,a=s,o=this.#a6;for(;n>2*e||a>2*i;){let r=n,s=a;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*i&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let l=new OffscreenCanvas(n,a);l.getContext("2d").drawImage(o,0,0,r,s,0,0,n,a),o=l.transferToImageBitmap()}return o}#oc(){let[e,i]=this.parentDimensions,{width:r,height:s}=this,n=new tO,a=Math.ceil(r*e*n.sx),o=Math.ceil(s*i*n.sy),l=this.#oi;if(!l||l.width===a&&l.height===o)return;l.width=a,l.height=o;let h=this.#on?this.#a6:this.#ou(a,o),d=l.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,a,o)}#op(e){if(e){if(this.#on){let e=this._uiManager.imageManager.getSvgUrl(this.#a9);if(e)return e}let e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#a6,e.getContext("2d").drawImage(this.#a6,0,0),e.toDataURL()}if(this.#on){let[e,i]=this.pageDimensions,r=Math.round(this.width*e*tv.PDF_TO_CSS_UNITS),s=Math.round(this.height*i*tv.PDF_TO_CSS_UNITS),n=new OffscreenCanvas(r,s);return n.getContext("2d").drawImage(this.#a6,0,0,this.#a6.width,this.#a6.height,0,0,r,s),n.transferToImageBitmap()}return structuredClone(this.#a6)}static async deserialize(e,i,r){let s=null,n=!1;if(e instanceof rx){let a,o;let{data:{rect:l,rotation:h,id:d,structParent:c,popupRef:u,richText:p,contentsObj:f,creationDate:g,modificationDate:m},container:b,parent:{page:{pageNumber:v}},canvas:y}=e;y?(delete e.canvas,{id:a,bitmap:o}=r.imageManager.getFromCanvas(b.id,y),y.remove()):(n=!0,e._hasNoCanvas=!0);let _=(await i._structTree.getAriaAttributes(`${tu}${d}`))?.get("aria-label")||"";s=e={annotationType:L.STAMP,bitmapId:a,bitmap:o,pageIndex:v-1,rect:l.slice(0),rotation:h,annotationElementId:d,id:d,deleted:!1,accessibilityData:{decorative:!1,altText:_},isSvg:!1,structParent:c,popupRef:u,richText:p,comment:f?.str||null,creationDate:g,modificationDate:m}}let a=await super.deserialize(e,i,r),{rect:o,bitmap:l,bitmapUrl:h,bitmapId:d,isSvg:c,accessibilityData:u}=e;n?(r.addMissingCanvas(e.id,a),a.#or=!0):d&&r.imageManager.isValidId(d)?(a.#a9=d,l&&(a.#a6=l)):a.#a7=h,a.#on=c;let[p,f]=a.pageDimensions;return a.width=(o[2]-o[0])/p,a.height=(o[3]-o[1])/f,u&&(a.altTextData=u),a._initialData=s,e.comment&&a.setCommentData(e),a.#oa=!!s,a}serialize(e=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let r=Object.assign(super.serialize(e),{bitmapId:this.#a9,isSvg:this.#on});if(this.addComment(r),e)return r.bitmapUrl=this.#op(!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;let{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(r.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let e=this.#nb(r);return e.isSame?null:(e.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1,r.id=this.annotationElementId,delete r.bitmapId,r)}if(null===i)return r;i.stamps||=new Map;let a=this.#on?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(i.stamps.has(this.#a9)){if(this.#on){let e=i.stamps.get(this.#a9);a>e.area&&(e.area=a,e.serialized.bitmap.close(),e.serialized.bitmap=this.#op(!1))}}else i.stamps.set(this.#a9,{area:a,serialized:r}),r.bitmap=this.#op(!1);return r}#nb(e){let{pageIndex:i,accessibilityData:{altText:r}}=this._initialData,s=e.pageIndex===i,n=(e.accessibilityData?.alt||"")===r;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(e){return this.deleted?e.hide():e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}}class rX{#nt;#of=!1;#og=null;#om=null;#ob=null;#ov=new Map;#oy=!1;#o_=!1;#ow=!1;#oA=null;#ox=null;#oS=null;#oE=null;#oC=null;#oT=-1;#b;static _initialized=!1;static #G=new Map([rT,r$,rq,rN,rW].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:i,div:r,structTreeLayer:s,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:l,viewport:h,l10n:d}){let c=[...rX.#G.values()];if(!rX._initialized)for(let i of(rX._initialized=!0,c))i.initialize(d,e);e.registerEditorTypes(c),this.#b=e,this.pageIndex=i,this.div=r,this.#nt=n,this.#og=a,this.viewport=h,this.#oS=l,this.drawLayer=o,this._structTree=s,this.#b.addLayer(this)}get isEmpty(){return 0===this.#ov.size}get isInvisible(){return this.isEmpty&&this.#b.getMode()===L.NONE}updateToolbar(e){this.#b.updateToolbar(e)}updateMode(e=this.#b.getMode()){switch(this.#oM(),e){case L.NONE:return this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case L.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case L.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:i}=this.div;if(i.toggle("nonEditing",!1),e===L.POPUP)i.toggle("commentEditing",!0);else for(let r of(i.toggle("commentEditing",!1),rX.#G.values()))i.toggle(`${r._type}Editing`,e===r._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#oS?.div}setEditingState(e){this.#b.setEditingState(e)}addCommands(e){this.#b.addCommands(e)}cleanUndoStack(e){this.#b.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#og?.div.classList.toggle("disabled",!e)}get #ok(){return 0!==this.#ov.size?this.#ov.values():this.#b.getEditors(this.pageIndex)}async enable(){this.#ow=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#oC?.abort(),this.#oC=null;let e=new Set;for(let i of this.#ok)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#b.removeChangedExistingAnnotation(i),e.add(i.annotationElementId));let i=this.#og;if(i)for(let r of i.getEditableAnnotations()){if(r.hide(),this.#b.isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;let i=await this.deserialize(r);i&&(this.addOrRebuild(i),i.enableEditing())}this.#ow=!1,this.#b._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o_=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#oS&&!this.#oC){this.#oC=new AbortController;let e=this.#b.combinedSignal(this.#oC);this.#oS.div.addEventListener("pointerdown",e=>{let i;let{clientX:r,clientY:s,timeStamp:n}=e;if(n-this.#oT>500)return void(this.#oT=n);this.#oT=-1;let{classList:a}=this.div;a.toggle("getElements",!0);let o=document.elementsFromPoint(r,s);if(a.toggle("getElements",!1),!this.div.contains(o[0]))return;let l=RegExp(`^${P}[0-9]+$`);for(let e of o)if(l.test(e.id)){i=e.id;break}if(!i)return;let h=this.#ov.get(i);null===h?.annotationElementId&&(e.stopPropagation(),e.preventDefault(),h.dblclick(e))},{signal:e,capture:!0})}let e=this.#og;if(e){let i=new Map,r=new Map;for(let s of this.#ok)s.disableEditing(),s.annotationElementId?null===s.serialize()?(r.set(s.annotationElementId,s),this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()):i.set(s.annotationElementId,s):s.updateFakeAnnotationElement(e);for(let s of e.getEditableAnnotations()){let{id:e}=s.data;if(this.#b.isDeletedAnnotationElement(e)){s.updateEdited({deleted:!0});continue}let n=r.get(e);n?(n.resetAnnotationElement(s),n.show(!1)):(n=i.get(e))&&(this.#b.addChangedExistingAnnotation(n),n.renderAnnotationElement(s)&&n.show(!1)),s.show()}}this.#oM(),this.isEmpty&&(this.div.hidden=!0);let{classList:i}=this.div;for(let e of rX.#G.values())i.remove(`${e._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o_=!1}getEditableAnnotation(e){return this.#og?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#b.getActive()!==e&&this.#b.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#oS?.div&&!this.#oE){this.#oE=new AbortController;let e=this.#b.combinedSignal(this.#oE);this.#oS.div.addEventListener("pointerdown",this.#oI.bind(this),{signal:e}),this.#oS.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#oS?.div&&this.#oE&&(this.#oE.abort(),this.#oE=null,this.#oS.div.classList.remove("highlighting"))}#oI(e){this.#b.unselectAll();let{target:i}=e;if(i===this.#oS.div||("img"===i.getAttribute("role")||i.classList.contains("endOfContent"))&&this.#oS.div.contains(i)){let{isMac:i}=tn.platform;if(0!==e.button||e.ctrlKey&&i)return;this.#b.showAllEditors("highlight",!0,!0),this.#oS.div.classList.add("free"),this.toggleDrawing(),rN.startHighlighting(this,"ltr"===this.#b.direction,{target:this.#oS.div,x:e.x,y:e.y}),this.#oS.div.addEventListener("pointerup",()=>{this.#oS.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#b._signal}),e.preventDefault()}}enableClick(){if(this.#om)return;this.#om=new AbortController;let e=this.#b.combinedSignal(this.#om);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let i=this.pointerup.bind(this);this.div.addEventListener("pointerup",i,{signal:e}),this.div.addEventListener("pointercancel",i,{signal:e})}disableClick(){this.#om?.abort(),this.#om=null}attach(e){this.#ov.set(e.id,e);let{annotationElementId:i}=e;i&&this.#b.isDeletedAnnotationElement(i)&&this.#b.removeDeletedAnnotationElement(e)}detach(e){this.#ov.delete(e.id),this.#nt?.removePointerInTextLayer(e.contentDiv),!this.#o_&&e.annotationElementId&&this.#b.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#b.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#b.addDeletedAnnotationElement(e.annotationElementId),t6.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(e.parent!==this||!e.isAttachedToDOM){if(this.changeParent(e),this.#b.addEditor(e),this.attach(e),!e.isAttachedToDOM){let i=e.render();this.div.append(i),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#ow),this.#b.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:i}=document;e.div.contains(i)&&!this.#ob&&(e._focusEventsAllowed=!1,this.#ob=setTimeout(()=>{this.#ob=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#b._signal}),i.focus())},0)),e._structTreeParentId=this.#nt?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getEditorByUID(e){for(let i of this.#ov.values())if(i.uid===e)return i;return null}getNextId(){return this.#b.getId()}get #oD(){return rX.#G.get(this.#b.getMode())}combinedSignal(e){return this.#b.combinedSignal(e)}#oR(e){let i=this.#oD;return i?new i.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#oD?.canCreateNewEmptyEditor()}async pasteEditor(e,i){this.updateToolbar(e),await this.#b.updateMode(e.mode);let{offsetX:r,offsetY:s}=this.#oP(),n=this.getNextId(),a=this.#oR({parent:this,id:n,x:r,y:s,uiManager:this.#b,isCentered:!0,...i});a&&this.add(a)}async deserialize(e){return await rX.#G.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#b)||null}createAndAddNewEditor(e,i,r={}){let s=this.getNextId(),n=this.#oR({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:this.#b,isCentered:i,...r});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}#oP(){let{x:e,y:i,width:r,height:s}=this.boundingClientRect,n=Math.max(0,i),a=(Math.max(0,e)+Math.min(window.innerWidth,e+r))/2-e,o=(n+Math.min(window.innerHeight,i+s))/2-i,[l,h]=this.viewport.rotation%180==0?[a,o]:[o,a];return{offsetX:l,offsetY:h}}addNewEditor(e={}){this.createAndAddNewEditor(this.#oP(),!0,e)}setSelected(e){this.#b.setSelected(e)}toggleSelected(e){this.#b.toggleSelected(e)}unselect(e){this.#b.unselect(e)}pointerup(e){let{isMac:i}=tn.platform;if(0!==e.button||e.ctrlKey&&i||e.target!==this.div||!this.#oy||(this.#oy=!1,this.#oD?.isDrawer&&this.#oD.supportMultipleDrawings))return;if(!this.#of)return void(this.#of=!0);let r=this.#b.getMode();r!==L.STAMP&&r!==L.SIGNATURE?this.createAndAddNewEditor(e,!1):this.#b.unselectAll()}pointerdown(e){if(this.#b.getMode()===L.HIGHLIGHT&&this.enableTextSelection(),this.#oy)return void(this.#oy=!1);let{isMac:i}=tn.platform;if(0!==e.button||e.ctrlKey&&i||e.target!==this.div)return;if(this.#oy=!0,this.#oD?.isDrawer)return void this.startDrawingSession(e);let r=this.#b.getActive();this.#of=!r||r.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#oA)return void this.#oD.startDrawing(this,this.#b,!1,e);this.#b.setCurrentDrawingSession(this),this.#oA=new AbortController;let i=this.#b.combinedSignal(this.#oA);this.div.addEventListener("blur",({relatedTarget:e})=>{e&&!this.div.contains(e)&&(this.#ox=null,this.commitOrRemove())},{signal:i}),this.#oD.startDrawing(this,this.#b,!1,e)}pause(e){if(e){let{activeElement:e}=document;return void(this.div.contains(e)&&(this.#ox=e))}this.#ox&&setTimeout(()=>{this.#ox?.focus(),this.#ox=null},0)}endDrawingSession(e=!1){return this.#oA?(this.#b.setCurrentDrawingSession(null),this.#oA.abort(),this.#oA=null,this.#ox=null,this.#oD.endDrawing(e)):null}findNewParent(e,i,r){let s=this.#b.findParent(i,r);return null!==s&&s!==this&&(s.changeParent(e),!0)}commitOrRemove(){return!!this.#oA&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#oA&&this.#oD.onScaleChangingWhenDrawing(this)}destroy(){for(let e of(this.commitOrRemove(),this.#b.getActive()?.parent===this&&(this.#b.commitOrRemove(),this.#b.setActiveEditor(null)),this.#ob&&(clearTimeout(this.#ob),this.#ob=null),this.#ov.values()))this.#nt?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#ov.clear(),this.#b.removeLayer(this)}#oM(){for(let e of this.#ov.values())e.isEmpty()&&e.remove()}render({viewport:e}){for(let i of(this.viewport=e,tN(this.div,e),this.#b.getEditors(this.pageIndex)))this.add(i),i.rebuild();this.updateMode()}update({viewport:e}){this.#b.commitOrRemove(),this.#oM();let i=this.viewport.rotation,r=e.rotation;if(this.viewport=e,tN(this.div,{rotation:r}),i!==r)for(let e of this.#ov.values())e.rotate(r)}get pageDimensions(){let{pageWidth:e,pageHeight:i}=this.viewport.rawDims;return[e,i]}get scale(){return this.#b.viewParameters.realScale}}class rY{#sL=null;#oL=new Map;#oN=new Map;static #w=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(this.#sL){if(this.#sL!==e){if(this.#oL.size>0)for(let i of this.#oL.values())i.remove(),e.append(i);this.#sL=e}}else this.#sL=e}static get _svgFactory(){return Y(this,"_svgFactory",new i4)}static #oO(e,[i,r,s,n]){let{style:a}=e;a.top=100*r+"%",a.left=100*i+"%",a.width=100*s+"%",a.height=100*n+"%"}#oF(){let e=rY._svgFactory.create(1,1,!0);return this.#sL.append(e),e.setAttribute("aria-hidden",!0),e}#oB(e,i){let r=rY._svgFactory.createElement("clipPath");e.append(r);let s=`clip_${i}`;r.setAttribute("id",s),r.setAttribute("clipPathUnits","objectBoundingBox");let n=rY._svgFactory.createElement("use");return r.append(n),n.setAttribute("href",`#${i}`),n.classList.add("clip"),s}#oU(e,i){for(let[r,s]of Object.entries(i))null===s?e.removeAttribute(r):e.setAttribute(r,s)}draw(e,i=!1,r=!1){let s=rY.#w++,n=this.#oF(),a=rY._svgFactory.createElement("defs");n.append(a);let o=rY._svgFactory.createElement("path");a.append(o);let l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),i&&this.#oN.set(s,o);let h=r?this.#oB(a,l):null,d=rY._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),this.#oL.set(s,n),{id:s,clipPathId:`url(#${h})`}}drawOutline(e,i){let r;let s=rY.#w++,n=this.#oF(),a=rY._svgFactory.createElement("defs");n.append(a);let o=rY._svgFactory.createElement("path");a.append(o);let l=`path_p${this.pageIndex}_${s}`;if(o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),i){let e=rY._svgFactory.createElement("mask");a.append(e),r=`mask_p${this.pageIndex}_${s}`,e.setAttribute("id",r),e.setAttribute("maskUnits","objectBoundingBox");let i=rY._svgFactory.createElement("rect");e.append(i),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("fill","white");let n=rY._svgFactory.createElement("use");e.append(n),n.setAttribute("href",`#${l}`),n.setAttribute("stroke","none"),n.setAttribute("fill","black"),n.setAttribute("fill-rule","nonzero"),n.classList.add("mask")}let h=rY._svgFactory.createElement("use");n.append(h),h.setAttribute("href",`#${l}`),r&&h.setAttribute("mask",`url(#${r})`);let d=h.cloneNode();return n.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(n,e),this.#oL.set(s,n),s}finalizeDraw(e,i){this.#oN.delete(e),this.updateProperties(e,i)}updateProperties(e,i){if(!i)return;let{root:r,bbox:s,rootClass:n,path:a}=i,o="number"==typeof e?this.#oL.get(e):e;if(o){if(r&&this.#oU(o,r),s&&rY.#oO(o,s),n){let{classList:e}=o;for(let[i,r]of Object.entries(n))e.toggle(i,r)}if(a){let e=o.firstChild.firstChild;this.#oU(e,a)}}}updateParent(e,i){if(i===this)return;let r=this.#oL.get(e);r&&(i.#sL.append(r),this.#oL.delete(e),i.#oL.set(e,r))}remove(e){this.#oN.delete(e),null!==this.#sL&&(this.#oL.get(e).remove(),this.#oL.delete(e))}destroy(){for(let e of(this.#sL=null,this.#oL.values()))e.remove();this.#oL.clear(),this.#oN.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:rD},globalThis.pdfjsLib={AbortException:ti,AnnotationEditorLayer:rX,AnnotationEditorParamsType:N,AnnotationEditorType:L,AnnotationEditorUIManager:t2,AnnotationLayer:rE,AnnotationMode:R,AnnotationType:B,applyOpacity:tj,build:iK,ColorPicker:iQ,createValidAbsoluteUrl:q,CSSConstants:tU,DOMSVGFactory:i4,DrawLayer:rY,FeatureTest:tn,fetchData:ty,findContrastColor:tW,getDocument:ij,getFilenameFromUrl:tS,getPdfFilenameFromUrl:tE,getRGB:tR,getUuid:tc,getXfaPageViewport:tD,GlobalWorkerOptions:ih,ImageKind:F,InvalidPDFException:Z,isDataScheme:tA,isPdfFile:tx,isValidExplicitDest:ea,MathClamp:tp,noContextMenu:tM,normalizeUnicode:td,OPS:j,OutputScale:tO,PasswordResponses:$,PDFDataRangeTransport:iH,PDFDateString:tI,PDFWorker:iW,PermissionFlag:O,PixelsPerInch:tv,RenderingCancelledException:tw,renderRichText:tq,ResponseException:tt,setLayerDimensions:tN,shadow:Y,SignatureExtractor:rz,stopEvent:tk,SupportedImageMimeTypes:tF,TextLayer:iU,TouchManager:t3,updateUrlHash:X,Util:to,VerbosityLevel:U,version:iJ,XfaLayer:tm};let rJ=Object.freeze(Object.defineProperty({__proto__:null,AbortException:ti,AnnotationEditorLayer:rX,AnnotationEditorParamsType:N,AnnotationEditorType:L,AnnotationEditorUIManager:t2,AnnotationLayer:rE,AnnotationMode:R,AnnotationType:B,CSSConstants:tU,ColorPicker:iQ,DOMSVGFactory:i4,DrawLayer:rY,FeatureTest:tn,GlobalWorkerOptions:ih,ImageKind:F,InvalidPDFException:Z,MathClamp:tp,OPS:j,OutputScale:tO,PDFDataRangeTransport:iH,PDFDateString:tI,PDFWorker:iW,PasswordResponses:$,PermissionFlag:O,PixelsPerInch:tv,RenderingCancelledException:tw,ResponseException:tt,SignatureExtractor:rz,SupportedImageMimeTypes:tF,TextLayer:iU,TouchManager:t3,Util:to,VerbosityLevel:U,XfaLayer:tm,applyOpacity:tj,build:iK,createValidAbsoluteUrl:q,fetchData:ty,findContrastColor:tW,getDocument:ij,getFilenameFromUrl:tS,getPdfFilenameFromUrl:tE,getRGB:tR,getUuid:tc,getXfaPageViewport:tD,isDataScheme:tA,isPdfFile:tx,isValidExplicitDest:ea,noContextMenu:tM,normalizeUnicode:td,renderRichText:tq,setLayerDimensions:tN,shadow:Y,stopEvent:tk,updateUrlHash:X,version:iJ},Symbol.toStringTag,{value:"Module"}));class rK extends Error{constructor(e,i){void 0!==i?super(e??"Invalid PDF",{cause:i}):super(e??"Invalid PDF"),this.name="InvalidPDFException",Object.setPrototypeOf(this,rK.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,rK)}}class rQ extends Error{constructor(e,i){void 0!==i?super(e??"Password required or incorrect",{cause:i}):super(e??"Password required or incorrect"),this.name="PasswordException",Object.setPrototypeOf(this,rQ.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,rQ)}}class rZ extends Error{constructor(e,i){void 0!==i?super(e??"PDF format error",{cause:i}):super(e??"PDF format error"),this.name="FormatError",Object.setPrototypeOf(this,rZ.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,rZ)}}class r0 extends Error{constructor(e,i,r){void 0!==r?super(e??"Unknown error",{cause:r}):super(e??"Unknown error"),this.name="UnknownErrorException",Object.setPrototypeOf(this,r0.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r0),this.details=i}}class r1 extends Error{constructor(e,i,r,s){void 0!==s?super(e??"Response error",{cause:s}):super(e??"Response error"),this.name="ResponseException",Object.setPrototypeOf(this,r1.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r1),this.status=i,this.missing=r}}class r2 extends Error{constructor(e,i){void 0!==i?super(e??"Operation aborted",{cause:i}):super(e??"Operation aborted"),this.name="AbortException",Object.setPrototypeOf(this,r2.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r2)}}function r5(e){if(e instanceof Error)switch(e.name){case"InvalidPDFException":return new rK(e.message,e);case"PasswordException":return new rQ(e.message,e);case"FormatError":return new rZ(e.message,e);case"UnknownErrorException":return new r0(e.message,e.details,e);case"ResponseException":return new r1(e.message,e.status,e.missing,e);case"AbortException":return new r2(e.message,e);default:return e}return Error(String(e))}class r4{static tolerance=2;static applyTransform(e,i){return[e[0]*i[0]+e[1]*i[2]+i[4],e[0]*i[1]+e[1]*i[3]+i[5]]}}class r3 extends r4{x;y;constructor(e,i){super(),this.x=e,this.y=i}equal(e){return e.x===this.x&&e.y===this.y}transform(e){let i=r4.applyTransform([this.x,this.y],e);return this.x=i[0],this.y=i[1],this}}var r6=((s=r6||{})[s.None=0]="None",s[s.Horizontal=1]="Horizontal",s[s.Vertical=2]="Vertical",s);class r9 extends r4{from;to;direction=0;length=0;intersections=[];gaps=[];constructor(e,i){super(),this.from=e,this.to=i,this.init()}init(){let e=this.from,i=this.to;if(Math.abs(e.y-i.y)<r4.tolerance){if(this.direction=1,i.y=e.y,e.x>i.x){let r=e;e=i,i=r}this.length=i.x-e.x}else if(Math.abs(e.x-i.x)<r4.tolerance){if(this.direction=2,i.x=e.x,e.y>i.y){let r=e;e=i,i=r}this.length=i.y-e.y}this.from=e,this.to=i}_valid=void 0;get valid(){return void 0===this._valid&&(this._valid=0!==this.direction&&this.length>r4.tolerance),this._valid}get normalized(){return 1===this.direction?new r9(new r3(this.from.x-r4.tolerance,this.from.y),new r3(this.to.x+r4.tolerance,this.from.y)):2===this.direction?new r9(new r3(this.from.x,this.from.y-r4.tolerance),new r3(this.from.x,this.to.y+r4.tolerance)):this}addGap(e){this.gaps.push(e)}containsPoint(e){return 2===this.direction?this.from.x===e.x&&e.y>=this.from.y&&e.y<=this.to.y:1===this.direction&&this.from.y===e.y&&e.x>=this.from.x&&e.x<=this.to.x}addIntersectionPoint(e){for(let i of this.intersections)if(i.equal(e))return;this.intersections.push(e)}intersection(e){let i;if(!this.valid||!e.valid)return i;let r=this.normalized,s=e.normalized;if(1===this.direction&&2===e.direction){let n=s.from.x,a=r.from.y;if(n>r.from.x&&n<r.to.x&&a>s.from.y&&a<s.to.y){let r=new r3(n,a);this.addIntersectionPoint(r),e.addIntersectionPoint(r),i=r}}else if(2===this.direction&&1===e.direction){let n=r.from.x,a=s.from.y;if(n>s.from.x&&n<s.to.x&&a>r.from.y&&a<r.to.y){let r=new r3(n,a);this.addIntersectionPoint(r),e.addIntersectionPoint(r),i=r}}return i}transform(e){let i=this.from.transform(e),r=this.to.transform(e),s=Math.min(i.x,r.x),n=Math.min(i.y,r.y),a=Math.abs(i.x-r.x),o=Math.abs(i.y-r.y);return this.from=new r3(s,n),this.to=new r3(s+a,n+o),this.init(),this}}class r8{minXY;maxXY;rows;rowPivots;colPivots;constructor(e,i,r,s){this.minXY=e,this.maxXY=i,this.rows=[],this.rowPivots=r,this.colPivots=s}findCell(e,i){if(e>=this.minXY.x&&i>=this.minXY.y&&e<=this.maxXY.x&&i<=this.maxXY.y){for(let r of this.rows)for(let s of r)if(s.minXY.x<=e&&s.minXY.y<=i&&s.maxXY.x>=e&&s.maxXY.y>=i)return s}}get cellCount(){return this.rows.reduce((e,i)=>e+i.length,0)}get rowCount(){return this.rows.length}check(){let e=(this.colPivots.length-1)*(this.rowPivots.length-1),i=0;for(let e of this.rows)for(let r of e)i+=(r.colspan||1)*(r.rowspan||1);return e===i}toArray(){let e=[];for(let i of this.rows){let r=[];for(let e of i){let i=e.text.join("");i=(i=i.replace(/^[\s]+|[\s]+$/g,"")).trim(),r.push(i)}e.push(r)}return e}}class r7{hLines=[];vLines=[];constructor(e){e.direction===r6.Horizontal?this.hLines.push(e):e.direction===r6.Vertical&&this.vLines.push(e)}get isValid(){return this.hLines.length+this.vLines.length>4}get rowPivots(){let e=new Set;for(let i of this.hLines)e.add(i.from.y);return[...e].sort((e,i)=>e-i)}get colPivots(){let e=new Set;for(let i of this.vLines)e.add(i.from.x);return[...e].sort((e,i)=>e-i)}add(e){if(this.intersection(e)){if(e.direction===r6.Horizontal)return this.hLines.push(e),!0;if(e.direction===r6.Vertical)return this.vLines.push(e),!0}return!1}intersection(e){let i=!1;if(!e.valid)return i;if(e.direction===r6.Horizontal)for(let r of this.vLines)e.intersection(r)&&(i=!0);else if(e.direction===r6.Vertical)for(let r of this.hLines)e.intersection(r)&&(i=!0);return i}getSameHorizontal(e){let i=[e],r=[];for(;this.hLines.length>0;){let s=this.hLines.shift();s&&(s.from.y===e.from.y?i.push(s):r.push(s))}return this.hLines=r,i}getSameVertical(e){let i=[e],r=[];for(;this.vLines.length>0;){let s=this.vLines.shift();s&&(s.from.x===e.from.x?i.push(s):r.push(s))}return this.vLines=r,i}mergeHorizontalLines(e){e.sort((e,i)=>e.from.x-i.from.x);let i=e[0].from.x,r=e[e.length-1].to.x,s=new r9(new r3(i,e[0].from.y),new r3(r,e[0].from.y));for(let i=1;i<e.length;i++){let r=e[i-1],n=e[i];if(Math.abs(r.to.x-n.from.x)>r4.tolerance){let e=new r9(new r3(r.to.x,r.from.y),new r3(n.from.x,n.from.y));s.addGap(e)}}return s}mergeVerticalLines(e){e.sort((e,i)=>e.from.y-i.from.y);let i=e[0].from.y,r=e[e.length-1].to.y,s=new r9(new r3(e[0].from.x,i),new r3(e[0].from.x,r));for(let i=1;i<e.length;i++){let r=e[i-1],n=e[i];if(Math.abs(r.to.y-n.from.y)>r4.tolerance){let e=new r9(new r3(r.to.x,r.to.y),new r3(r.to.x,n.from.y));s.addGap(e)}}return s}normalize(){this.hLines=this.hLines.filter(e=>e.intersections.length>1),this.vLines=this.vLines.filter(e=>e.intersections.length>1),this.hLines.sort((e,i)=>e.from.y-i.from.y),this.vLines.sort((e,i)=>e.from.x-i.from.x);let e=[];for(;this.hLines.length>0;){let i=this.hLines.shift();if(!i)continue;let r=this.getSameHorizontal(i),s=this.mergeHorizontalLines(r);e.push(s)}this.hLines=e;let i=[];for(;this.vLines.length>0;){let e=this.vLines.shift();if(!e)continue;let r=this.getSameVertical(e),s=this.mergeVerticalLines(r);i.push(s)}this.vLines=i}verticalExists(e,i,r){if(e.direction!==r6.Vertical)throw Error("Line is not vertical");if(i>=r)throw Error("y1 must be less than y2");if(e.from.y<=i&&e.to.y>=r){for(let s of e.gaps)if(s.from.y<=i&&s.to.y>=r)return!1;return!0}return!1}horizontalExists(e,i,r){if(e.direction!==r6.Horizontal)throw Error("Line is not horizontal");if(i>=r)throw Error("x1 must be less than x2");if(e.from.x<=i&&e.to.x>=r){for(let s of e.gaps)if(s.from.x<=i&&s.to.x>=r)return!1;return!0}return!1}findBottomLineIndex(e,i){for(let r=e;r<this.hLines.length;r++){let e=this.hLines[r];if(e.from.x<=i&&e.to.x>=i)return r}return -1}findVerticalLineIndexs(e,i){let r=[];for(let s=0;s<this.vLines.length;s++){let n=this.vLines[s];n.from.y<=i&&n.to.y>=i&&e.intersection(n)&&r.push(s)}return r}getRow(e,i,r){let s=[],n=this.hLines[e],a=this.findVerticalLineIndexs(n,r);for(let r=1;r<a.length;r++){let o=this.vLines[a[r-1]],l=this.vLines[a[r]],h=(o.from.x+l.from.x)/2,d=this.findBottomLineIndex(i,h),c=this.hLines[d],u={minXY:new r3(o.from.x,n.from.y),maxXY:new r3(l.from.x,c.from.y),width:l.from.x-o.from.x,height:c.from.y-n.from.y,text:[]},p=a[r]-a[r-1],f=d-e;p>1&&(u.colspan=p),f>1&&(u.rowspan=f),s.push(u)}return s}toData(){let e=this.rowPivots,i=this.colPivots,r=new r8(new r3(i[0],e[0]),new r3(i[i.length-1],e[e.length-1]),e,i);for(let e=1;e<this.hLines.length;e++){let i=this.hLines[e-1],s=this.hLines[e],n=(i.from.y+s.from.y)/2,a=this.getRow(e-1,e,n);r.rows.push(a)}return r}}class st{hLines=[];vLines=[];add(e){e.valid&&(e.direction===r6.Horizontal?this.hLines.push(e):e.direction===r6.Vertical&&this.vLines.push(e))}addRectangle(e){for(let i of e.getLines())this.add(i)}getTableData(){let e=[];for(let i of this.getTables()){let r=i.toData();r&&e.push(r)}return e}getTables(){let e=[];for(;0!==this.hLines.length;){let i=this.hLines.shift();if(!i||this.tryFill(e,i))continue;let r=new r7(i);this.fillTable(r),e.push(r)}for(;0!==this.vLines.length;){let i=this.vLines.shift();if(!i||this.tryFill(e,i))continue;let r=new r7(i);this.fillTable(r),e.push(r)}let i=e.filter(e=>e.isValid);for(let e of i)e.normalize();return i}normalize(){this.normalizeHorizontal(),this.normalizeVertical()}normalizeHorizontal(){this.hLines.sort((e,i)=>e.from.y-i.from.y);let e=[],i=[];for(let r of this.hLines)if(0===i.length)i.push(r);else if(Math.abs(i[0]?.from.y-r.from.y)<r4.tolerance)i.push(r);else{let s=this.margeHorizontalLines(i);e.push(...s),i=[r]}if(i.length>0){let r=this.margeHorizontalLines(i);e.push(...r)}this.hLines=e}normalizeVertical(){this.vLines.sort((e,i)=>e.from.x-i.from.x);let e=[],i=[];for(let r of this.vLines)if(0===i.length)i.push(r);else if(Math.abs(i[0]?.from.x-r.from.x)<r4.tolerance)i.push(r);else{let s=this.margeVerticalLines(i);e.push(...s),i=[r]}if(i.length>0){let r=this.margeVerticalLines(i);e.push(...r)}this.vLines=e}fillTable(e){let i=[],r=[];for(let r of this.vLines)e.add(r)||i.push(r);for(let i of this.hLines)e.add(i)||r.push(i);this.hLines=r,this.vLines=i}tryFill(e,i){for(let r of e)if(r.add(i))return this.fillTable(r),!0;return!1}margeHorizontalLines(e){let i=[];e.sort((e,i)=>e.from.x-i.from.x);let r=e[0]?.from.y;if(void 0===r)return i;let s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let a of e)a.from.x-n<r4.tolerance?(a.from.x<s&&(s=a.from.x),a.to.x>n&&(n=a.to.x)):(n>s&&i.push(new r9(new r3(s,r),new r3(n,r))),s=a.from.x,n=a.to.x);let a=i[i.length-1];return a?a.from.x!==s&&a.to.x!==n&&i.push(new r9(new r3(s,r),new r3(n,r))):i.push(new r9(new r3(s,r),new r3(n,r))),i}margeVerticalLines(e){let i=[];e.sort((e,i)=>e.from.y-i.from.y);let r=e[0]?.from.x;if(void 0===r)return i;let s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let a of e)a.from.y-n<r4.tolerance?(a.from.y<s&&(s=a.from.y),a.to.y>n&&(n=a.to.y)):(n>s&&i.push(new r9(new r3(r,s),new r3(r,n))),s=a.from.y,n=a.to.y);let a=i[i.length-1];return a?a.from.y!==s&&a.to.y!==n&&i.push(new r9(new r3(r,s),new r3(r,n))):i.push(new r9(new r3(r,s),new r3(r,n))),i}}class se extends r4{from;width;height;constructor(e,i,r){super(),this.from=e,this.width=i,this.height=r}get to(){return new r3(this.from.x+this.width,this.from.y+this.height)}getLines(){let e=this.to;return[new r9(this.from,new r3(e.x,this.from.y)),new r9(this.from,new r3(this.from.x,e.y)),new r9(new r3(e.x,this.from.y),e),new r9(new r3(this.from.x,e.y),e)].filter(e=>e.valid)}transform(e){let i=r4.applyTransform([this.from.x,this.from.y],e),r=r4.applyTransform([this.from.x+this.width,this.from.y+this.height],e),s=Math.min(i[0],r[0]),n=Math.min(i[1],r[1]),a=Math.abs(i[0]-r[0]),o=Math.abs(i[1]-r[1]);return this.from=new r3(s,n),this.width=a,this.height=o,this}}class si{pages=[];total=0;getPageImage(e,i){for(let r of this.pages)if(r.pageNumber===e){for(let e of r.images)if(e.name===i)return e}return null}constructor(e){this.total=e}}let sr=["xmp:createdate","xmp:modifydate","xmp:metadatadate","xap:createdate","xap:modifydate","xap:metadatadate"];class ss{total;info;metadata;fingerprints;permission;outline;pages=[];getDateNode(){let e={},i=this.info?.CreationDate;i&&(e.CreationDate=tI.toDateObject(i));let r=this.info?.ModDate;if(r&&(e.ModDate=tI.toDateObject(r)),!this.metadata)return e;for(let i of sr){let r=this.metadata?.get(i),s=this.parseISODateString(r);switch(i){case"xmp:createdate":e.XmpCreateDate=s;break;case"xmp:modifydate":e.XmpModifyDate=s;break;case"xmp:metadatadate":e.XmpMetadataDate=s;break;case"xap:createdate":e.XapCreateDate=s;break;case"xap:modifydate":e.XapModifyDate=s;break;case"xap:metadatadate":e.XapMetadataDate=s}}return e}parseISODateString(e){if(!e)return;let i=Date.parse(e);return Number.isNaN(i)?void 0:new Date(i)}constructor(e){this.total=e}}function sn(e){return e.lineThreshold=e?.lineThreshold??4.6,e.cellThreshold=e?.cellThreshold??7,e.cellSeparator=e?.cellSeparator??"	",e.lineEnforce=e?.lineEnforce??!0,e.pageJoiner=e?.pageJoiner??"\n-- page_number of total_number --",e.imageThreshold=e?.imageThreshold??80,e.imageDataUrl=e?.imageDataUrl??!0,e.imageBuffer=e?.imageBuffer??!0,e.scale=e?.scale??1,e}var sa=((n=sa||{})[n[void 0]=0]="undefined",n[n.hline=1]="hline",n[n.vline=2]="vline",n[n.rectangle=3]="rectangle",n);class so{pages=[];total=0;constructor(e){this.total=e}}class sl{pages=[];mergedTables=[];total=0;constructor(e){this.total=e}}class sh{pages=[];text="";total=0;getPageText(e){for(let i of this.pages)if(i.num===e)return i.text;return""}constructor(e){this.total=e}}i.AbortException=r2,i.FormatError=rZ,i.InvalidPDFException=rK,i.Line=r9,i.LineDirection=r6,i.LineStore=st,i.PDFParse=class{options;doc;progress={loaded:-1,total:0};constructor(e){void 0===e.verbosity&&(e.verbosity=U.ERRORS),"undefined"!=typeof Buffer&&e.data instanceof Buffer&&(e.data=new Uint8Array(e.data)),this.options=e}async destroy(){this.doc&&(await this.doc.destroy(),this.doc=void 0)}static get isNodeJS(){return!("object"!=typeof process||"[object process]"!=`${process}`||process.versions.nw||process.versions.electron&&void 0!==process.type&&"browser"!==process.type)}static setWorker(e){return void 0===globalThis.pdfjs&&(globalThis.pdfjs=rJ),null===ih?"":(void 0!==e&&(ih.workerSrc=e),ih.workerSrc)}async getInfo(e={}){let i=await this.load(),r=new ss(i.numPages),{info:s,metadata:n}=await i.getMetadata();r.info=s,r.metadata=n,r.fingerprints=i.fingerprints,r.outline=await i.getOutline(),r.permission=await i.getPermissions();let a=await i.getPageLabels();if(e.parsePageInfo){for(let s=1;s<=r.total;s++)if(this.shouldParse(s,r.total,e)){let e=await i.getPage(s),n=await this.getPageLinks(e);n.pageLabel=a?.[e.pageNumber],r.pages.push(n),e.cleanup()}}return r}async getPageLinks(e){let i=e.getViewport({scale:1}),r={pageNumber:e.pageNumber,links:[],width:i.width,height:i.height};for(let i of await e.getAnnotations({intent:"display"})||[]){if("Link"!==i.subtype)continue;let e=i.url??i.unsafeUrl;if(!e)continue;let s=i.overlaidText||"";r.links.push({url:e,text:s})}return r}async getText(e={}){let i=await this.load(),r=new sh(i.numPages);for(let s=1;s<=r.total;s++)if(this.shouldParse(s,r.total,e)){let n=await i.getPage(s),a=await this.getPageText(n,e,r.total);r.pages.push({text:a,num:s}),n.cleanup()}for(let i of r.pages)if(e.pageJoiner){let s=e.pageJoiner.replace("page_number",`${i.num}`);s=s.replace("total_number",`${r.total}`),r.text+=`${i.text}
${s}

`}else r.text+=`${i.text}

`;return r}async load(){try{if(void 0===this.doc){let e=ij(this.options);e.onProgress=e=>{this.progress=e},this.doc=await e.promise}return this.doc}catch(e){throw r5(e)}}shouldParse(e,i,r){return r.partial=r?.partial??[],r.first=r?.first??0,r.last=r?.last??0,r.partial.length>0?!!r.partial.includes(e):r.first>0&&r.last>0?e>=r.first&&e<=r.last:r.first>0?e<=r.first:!(r.last>0)||e>i-r.last}async getPageText(e,i,r){let s=e.getViewport({scale:1}),n=sn(i),a=await e.getTextContent({includeMarkedContent:!!n.includeMarkedContent,disableNormalization:!!n.disableNormalization}),o=new Map;n.parseHyperlinks&&(o=await this.getHyperlinks(e,s));let l=[],h,d,c=0;for(let e of a.items){if(!("str"in e))continue;let i=e.transform??e.transform,[r,a]=s.convertToViewportPoint(i[4],i[5]);if(n.parseHyperlinks){let i=(o.get(e.str)||[]).find(e=>r>=e.rect.left&&r<=e.rect.right&&a>=e.rect.top&&a<=e.rect.bottom);i&&(e.str=`[${e.str}](${i.url})`)}if(n.lineEnforce&&void 0!==d&&Math.abs(d-a)>n.lineThreshold){let i=l.length?l[l.length-1]:void 0,r=e.str.startsWith("\n")||""===e.str.trim()&&e.hasEOL;!1===i?.endsWith("\n")&&!r&&Math.abs(d-a)-1>c&&(l.push("\n"),c=0)}n.cellSeparator&&void 0!==d&&Math.abs(d-a)<n.lineThreshold&&void 0!==h&&Math.abs(h-r)>n.cellThreshold&&(e.str=`${n.cellSeparator}${e.str}`),l.push(e.str),h=r+e.width,d=a,c=Math.max(c,e.height),e.hasEOL&&l.push("\n"),(e.hasEOL||e.str.endsWith("\n"))&&(c=0)}return n.itemJoiner?l.join(n.itemJoiner):l.join("")}async getHyperlinks(e,i){let r=new Map;for(let s of await e.getAnnotations({intent:"display"})||[]){if("Link"!==s.subtype)continue;let e=s.url??s.unsafeUrl;if(!e)continue;let n=s.overlaidText;if(!n)continue;let a=i.convertToViewportRectangle(s.rect),o={rect:{left:Math.min(a[0],a[2])-.5,top:Math.min(a[1],a[3])-.5,right:Math.max(a[0],a[2])+.5,bottom:Math.max(a[1],a[3])+.5},url:e,text:n,used:!1},l=r.get(n);l?l.push(o):r.set(n,[o])}return r}async getImage(e={}){let i=await this.load(),r=new si(i.numPages);sn(e);for(let s=1;s<=r.total;s++)if(this.shouldParse(s,r.total,e)){let n=await i.getPage(s),a=await n.getOperatorList(),o={pageNumber:s,images:[]};r.pages.push(o);for(let r=0;r<a.fnArray.length;r++)if(a.fnArray[r]===j.paintInlineImageXObject||a.fnArray[r]===j.paintImageXObject){let s=a.argsArray[r][0],l=n.commonObjs.has(s)?this.resolveEmbeddedImage(n.commonObjs,s):this.resolveEmbeddedImage(n.objs,s),{width:h,height:d,kind:c,data:u}=await l;if(e.imageThreshold&&(e.imageThreshold>=h||e.imageThreshold>=d))continue;let p=i.canvasFactory.create(h,d),f=p.context,g=null;c===F.RGBA_32BPP?(g=f.createImageData(h,d)).data.set(u):(g=f.createImageData(h,d),this.convertToRGBA({src:u,dest:new Uint32Array(g.data.buffer),width:h,height:d,kind:c})),f.putImageData(g,0,0);let m=new Uint8Array,b="";if("function"==typeof p.canvas.toBuffer){let i;e.imageBuffer&&(m=new Uint8Array(i=p.canvas.toBuffer("image/png"))),e.imageDataUrl&&(i||(m=new Uint8Array(i=p.canvas.toBuffer("image/png"))),b=`data:image/png;base64,${i.toString("base64")}`)}else e.imageBuffer&&(m=new Uint8Array(p.context.getImageData(0,0,p.canvas.width,p.canvas.height).data)),e.imageDataUrl&&(b=p.canvas.toDataURL("image/png"));o.images.push({data:m,dataUrl:b,name:s,height:d,width:h,kind:c})}}return r}convertToRGBA({src:e,dest:i,width:r,height:s,kind:n}){if(n===F.RGB_24BPP)for(let r=0,s=0;r<e.length;r+=3,s++){let n=e[r],a=e[r+1],o=e[r+2];i[s]=-16777216|o<<16|a<<8|n}else if(n===F.GRAYSCALE_1BPP){let n=0;for(let a=0;a<e.length;a++){let o=e[a];for(let e=7;e>=0&&!(n>=r*s);e--){let r=1==(o>>e&1)?255:0;i[n++]=-16777216|r<<16|r<<8|r}}}else{if(null!=n)throw Error(`convertToRGBA: Unsupported image kind: ${n}. Available kinds: GRAYSCALE_1BPP=${F.GRAYSCALE_1BPP}, RGB_24BPP=${F.RGB_24BPP}, RGBA_32BPP=${F.RGBA_32BPP}`);{let a=e.length/(r*s);if(.1>Math.abs(a-3))for(let r=0,s=0;r<e.length;r+=3,s++){let n=e[r],a=e[r+1],o=e[r+2];i[s]=-16777216|o<<16|a<<8|n}else if(.1>Math.abs(a-4))for(let r=0,s=0;r<e.length;r+=4,s++){let n=e[r],a=e[r+1],o=e[r+2],l=e[r+3];i[s]=l<<24|o<<16|a<<8|n}else{if(!(.1>Math.abs(a-1)))throw Error(`convertToRGBA: Cannot infer image format. kind: ${n}, bytesPerPixel: ${a}, width: ${r}, height: ${s}, dataLength: ${e.length}`);for(let r=0;r<e.length;r++){let s=e[r];i[r]=-16777216|s<<16|s<<8|s}}}}}resolveEmbeddedImage(e,i){return new Promise((r,s)=>{e.get(i,e=>{if(e){let n;if(e.data instanceof Uint8Array)n=e.data;else if(e.data instanceof Uint8ClampedArray)n=new Uint8Array(e.data);else if(e.data?.buffer)n=new Uint8Array(e.data.buffer);else if(e.bitmap){let i=this.doc.canvasFactory.create(e.bitmap.width,e.bitmap.height);i.context.drawImage(e.bitmap,0,0),n=new Uint8Array(i.context.getImageData(0,0,e.bitmap.width,e.bitmap.height).data.buffer)}else ArrayBuffer.isView(e.data)&&(n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength));if(!n)return void s(Error(`Image object ${i}: data field is empty or invalid. Available fields: ${Object.keys(e).join(", ")}`));if(0===n.length)return void s(Error(`Image object ${i}: data buffer is empty (length: 0)`));r({width:e.width,height:e.height,kind:e.kind,data:n})}else s(Error(`Image object ${i} not found`))})})}async getScreenshot(e={}){let i=sn(e),r=new so((await this.load()).numPages);if(void 0===this.doc)throw Error("PDF document not loaded");for(let e=1;e<=r.total;e++)if(this.shouldParse(e,r.total,i)){let s=await this.doc.getPage(e),n=s.getViewport({scale:i.scale});if(i.desiredWidth){n=s.getViewport({scale:1});let e=i.desiredWidth/n.width;n=s.getViewport({scale:e})}let a=this.doc.canvasFactory.create(n.width,n.height),o={canvasContext:a.context,viewport:n,canvas:a.canvas},l=s.render(o);await l.promise;let h=new Uint8Array,d="";if("function"==typeof a.canvas.toBuffer){let e;i.imageBuffer&&(h=new Uint8Array(e=a.canvas.toBuffer("image/png"))),i.imageDataUrl&&(e||(h=new Uint8Array(e=a.canvas.toBuffer("image/png"))),d=`data:image/png;base64,${e.toString("base64")}`)}else i.imageBuffer&&(h=new Uint8Array(a.context.getImageData(0,0,a.canvas.width,a.canvas.height).data)),i.imageDataUrl&&(d=a.canvas.toDataURL("image/png"));r.pages.push({data:h,dataUrl:d,pageNumber:e,width:n.width,height:n.height,scale:n.scale}),s.cleanup()}return r}async getTable(e={}){let i=new sl((await this.load()).numPages);if(void 0===this.doc)throw Error("PDF document not loaded");for(let r=1;r<=i.total;r++)if(this.shouldParse(r,i.total,e)){let e=await this.doc.getPage(r),s=await this.getPageTables(e);s.normalize();let n=s.getTableData();await this.fillPageTables(e,n);let a={num:r,tables:[]};for(let e of n)a.tables.push(e.toArray());i.pages.push(a),e.cleanup()}return i}getPathGeometry(e){let i=e[2]-e[0],r=e[3]-e[1];return e[0]===1/0?sa.undefined:i>5&&r>5?sa.rectangle:i>5&&0===r?sa.hline:0===i&&r>5?sa.vline:sa.undefined}async getPageTables(e){let i=new st,r=e.getViewport({scale:1}),s=[1,0,0,1,0,0],n=[],a=await e.getOperatorList();for(let e=0;e<a.fnArray.length;e++){let o=a.fnArray[e],l=a.argsArray[e],h=l?.[0]??0,d=l?.[2]??[1/0,1/0,-1/0,-1/0];if(o===j.constructPath){if(h!==j.stroke)continue;let e=this.getPathGeometry(d);if(e===sa.rectangle){let e=new se(new r3(d[0],d[1]),d[2]-d[0],d[3]-d[1]);e.transform(s),e.transform(r.transform),i.addRectangle(e)}else if(e===sa.hline||e===sa.vline){let e=new r9(new r3(d[0],d[1]),new r3(d[2],d[3]));e.transform(s),e.transform(r.transform),i.add(e)}}else if(o===j.setLineWidth);else if(o===j.save)n.push(s);else if(o===j.restore){let e=n.pop();e&&(s=e)}else o===j.transform&&(s=to.transform(s,l))}return i}async fillPageTables(e,i){let r=e.getViewport({scale:1});for(let s of(await e.getTextContent({includeMarkedContent:!1,disableNormalization:!1})).items){if(!("str"in s))continue;let e=to.transform(to.transform(r.transform,s.transform),[1,0,0,-1,0,0]);for(let r of i){let i=r.findCell(e[4],e[5]);if(i){i.text.push(s.str),s.hasEOL&&i.text.push("\n");break}}}}},i.PasswordException=rQ,i.Point=r3,i.Rectangle=se,i.ResponseException=r1,i.Shape=r4,i.Table=r7,i.UnknownErrorException=r0,i.VerbosityLevel=U,i.getException=r5}};var i=require("../../../../webpack-runtime.js");i.C(e);var r=e=>i(i.s=e),s=i.X(0,[7787,5541,5405,4833,3392,540],()=>r(49002));module.exports=s})();