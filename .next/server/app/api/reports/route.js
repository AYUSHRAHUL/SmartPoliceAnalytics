"use strict";(()=>{var e={};e.id=9867,e.ids=[9867],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},9714:e=>{e.exports=require("constants")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},10021:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{GET:()=>w,runtime:()=>m});var o=r(73278),s=r(45002),a=r(54877),i=r(23392),u=r.n(i),c=r(59015),d=r(1035),p=r(21899),l=r(13534),f=r(51104);let m="nodejs";async function x(e){return new Promise((t,r)=>{let n=new c.Z({margin:50}),o=[];n.on("data",e=>o.push(e)),n.on("end",()=>{t(Buffer.concat(o))}),n.on("error",r),n.fontSize(18).text("Police Good Work Recognition Report",{align:"center"}),n.moveDown(),e.forEach((e,t)=>{n.fontSize(12).text(`${t+1}. ${e.name} (${e.badgeId}) - ${e.department} | Score: ${e.totalScore.toFixed(2)}`),n.moveDown(.5)}),n.end()})}async function h(e){let t=new(u()).Workbook,r=t.addWorksheet("Performance Report");return r.columns=[{header:"Name",key:"name",width:28},{header:"Badge ID",key:"badgeId",width:15},{header:"Department",key:"department",width:20},{header:"Designation",key:"designation",width:20},{header:"Case Closed",key:"caseClosed",width:16},{header:"Cyber Resolved",key:"cyberResolved",width:16},{header:"Feedback Score",key:"feedbackScore",width:16},{header:"Awareness Programs",key:"awarenessPrograms",width:18},{header:"Emergency Responses",key:"emergencyResponses",width:18},{header:"Total Score",key:"totalScore",width:16}],e.forEach(e=>{r.addRow(e)}),await t.xlsx.writeBuffer()}async function w(e){let t=(0,l.m)(e);if(!("role"in t))return t;let{searchParams:r}=new URL(e.url),n=r.get("format")??"pdf";if(!["pdf","xlsx"].includes(n))return(0,f.yw)("Invalid format. Use pdf or xlsx.");try{await (0,d.Q)();let e=await p.pB.find().sort({totalScore:-1}).limit(100).lean();if("pdf"===n){let t=await x(e);return new Response(new Uint8Array(t),{headers:{"Content-Type":"application/pdf","Content-Disposition":'attachment; filename="police-report.pdf"'}})}let t=await h(e);return new Response(new Uint8Array(t),{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":'attachment; filename="police-report.xlsx"'}})}catch(e){return(0,f.I3)("Failed to generate report",e)}}let y=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/reports/route",pathname:"/api/reports",filename:"route",bundlePath:"app/api/reports/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\reports\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:k}=y,R="/api/reports/route";function q(){return(0,a.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}},16910:(e,t,r)=>{r.d(t,{$v:()=>f,I2:()=>m,Md:()=>c,Oe:()=>p,c_:()=>d,w5:()=>x,z:()=>l});var n=r(63506),o=r.n(n),s=r(67390),a=r.n(s),i=r(52845),u=r(56377);let c="police-dashboard-token";function d(e){return o().hash(e,10)}function p(e,t){return o().compare(e,t)}function l(e){let t=u.O.JWT_SECRET,r=u.O.JWT_EXPIRES_IN||"7d";return a().sign(e,t,{expiresIn:r})}function f(e){let t=u.O.JWT_SECRET;return a().verify(e,t)}function m(){(0,i.cookies)().delete(c)}function x(){return i.cookies().get(c)?.value??null}},51104:(e,t,r)=>{r.d(t,{Hs:()=>i,I3:()=>d,ID:()=>u,i2:()=>s,ok:()=>o,v6:()=>c,yw:()=>a});var n=r(71309);function o(e,t){return n.NextResponse.json({success:!0,data:e},{status:200,...t})}function s(e){return n.NextResponse.json({success:!0,data:e},{status:201})}function a(e,t){return n.NextResponse.json({success:!1,message:e,details:t},{status:400})}function i(e="Unauthorized"){return n.NextResponse.json({success:!1,message:e},{status:401})}function u(e="Forbidden"){return n.NextResponse.json({success:!1,message:e},{status:403})}function c(e="Not found"){return n.NextResponse.json({success:!1,message:e},{status:404})}function d(e="Internal server error",t){return console.error(e,t),n.NextResponse.json({success:!1,message:e},{status:500})}},13534:(e,t,r)=>{r.d(t,{M:()=>a,m:()=>s});var n=r(16910),o=r(51104);function s(e){let t=e.cookies.get(n.Md)?.value;if(!t)return(0,o.Hs)();try{return(0,n.$v)(t)}catch(e){return console.warn("Auth verification failed",e),(0,o.Hs)()}}function a(e,t){let r=s(e);return"role"in r&&!t.includes(r.role)?(0,o.ID)():r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7787,5541,5405,4833,3392,8960,9015,540],()=>r(10021));module.exports=n})();