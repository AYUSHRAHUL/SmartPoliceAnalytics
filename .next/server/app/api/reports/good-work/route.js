"use strict";(()=>{var e={};e.id=7766,e.ids=[7766],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},9714:e=>{e.exports=require("constants")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},42386:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>$,requestAsyncStorage:()=>y,routeModule:()=>C,serverHooks:()=>R,staticGenerationAsyncStorage:()=>D});var o={};r.r(o),r.d(o,{GET:()=>x,runtime:()=>S});var a=r(73278),i=r(45002),n=r(54877),s=r(13534),c=r(51104),l=r(1035),d=r(21899),u=r(55224),f=r(67133),m=r(23392),p=r.n(m),g=r(59015);async function h(e="month"){await (0,l.Q)();let t=await d.pB.find().sort({totalScore:-1}).limit(10).lean(),r=(await (0,u.g2)(5)).map(e=>{let t="",r="";return e.convictionRatio&&e.convictionRatio>50?(t=`Achieved ${e.convictionRatio.toFixed(1)}% conviction rate`,r="Conviction Ratio"):e.totalDetections>20?(t=`Led with ${e.totalDetections} detections`,r="Detections"):e.totalCasesClosed>100?(t=`Closed ${e.totalCasesClosed} cases`,r="Case Closure"):(t=`Average score of ${e.averageScore.toFixed(1)}`,r="Overall Performance"),{district:e.district,achievement:t,metric:r}}),o=await d.rB.find().populate("officerId").sort({createdAt:-1}).limit(20).lean(),a=t.map(e=>{let t=[];e.caseClosed&&e.caseClosed>50&&t.push(`Closed ${e.caseClosed} cases`),e.cyberResolved&&e.cyberResolved>10&&t.push(`Resolved ${e.cyberResolved} cyber crimes`),e.totalScore>80&&t.push(`Excellence score of ${e.totalScore.toFixed(1)}`);let r=o.filter(t=>t.officerId?._id?.toString()===e._id.toString());if(r.length>0){let e=r.map(e=>e.badge).join(", ");t.push(`Awarded ${e} recognition`)}return{name:e.name,badgeId:e.badgeId,department:e.department,achievements:t.length>0?t:["Consistent performance"],score:e.totalScore}}),i=await d.pB.find().lean(),n=await d.f3.find().lean(),s={totalOfficers:i.length,totalCasesClosed:i.reduce((e,t)=>e+(t.caseClosed||0),0),totalConvictions:n.filter(e=>"Convictions"===e.module).length,totalDetections:n.filter(e=>"Detections"===e.module).length,averageScore:i.length>0?Number((i.reduce((e,t)=>e+(t.totalScore||0),0)/i.length).toFixed(2)):0},c=(await (0,f.x)(e)).summary;return{period:e,topPerformers:a,districtHighlights:r,summary:c,statistics:s}}async function v(e){return new Promise((t,r)=>{let o=new g.Z({margin:50,size:"A4"}),a=[];o.on("data",e=>a.push(e)),o.on("end",()=>t(Buffer.concat(a))),o.on("error",r),o.fontSize(24).text("Good Work Done Report",{align:"center"}),o.moveDown(),o.fontSize(12).text(`Period: ${e.period}`,{align:"center"}),o.moveDown(2),o.fontSize(16).text("Executive Summary",{underline:!0}),o.moveDown(),o.fontSize(11).text(e.summary,{align:"justify"}),o.moveDown(2),o.fontSize(16).text("Key Statistics",{underline:!0}),o.moveDown(),o.fontSize(11),o.text(`Total Officers: ${e.statistics.totalOfficers}`),o.text(`Total Cases Closed: ${e.statistics.totalCasesClosed}`),o.text(`Total Convictions: ${e.statistics.totalConvictions}`),o.text(`Total Detections: ${e.statistics.totalDetections}`),o.text(`Average Score: ${e.statistics.averageScore.toFixed(2)}`),o.moveDown(2),o.fontSize(16).text("Top Performers",{underline:!0}),o.moveDown(),e.topPerformers.forEach((e,t)=>{o.fontSize(12).text(`${t+1}. ${e.name} (${e.badgeId})`,{continued:!1}),o.fontSize(10).text(`   Department: ${e.department}`),o.fontSize(10).text(`   Score: ${e.score.toFixed(2)}`),o.fontSize(10).text("   Achievements:"),e.achievements.forEach(e=>{o.fontSize(9).text(`     • ${e}`,{indent:20})}),o.moveDown()}),e.districtHighlights.length>0&&(o.addPage(),o.fontSize(16).text("District Highlights",{underline:!0}),o.moveDown(),e.districtHighlights.forEach(e=>{o.fontSize(12).text(`${e.district}`,{continued:!1}),o.fontSize(10).text(`   ${e.achievement} (${e.metric})`,{indent:20}),o.moveDown()})),o.fontSize(8).text(`Generated on ${new Date().toLocaleDateString()} by Smart Police Analytics System`,{align:"center"}),o.end()})}async function w(e){let t=new(p()).Workbook,r=t.addWorksheet("Summary");r.columns=[{header:"Metric",key:"metric",width:30},{header:"Value",key:"value",width:20}],r.addRow({metric:"Period",value:e.period}),r.addRow({metric:"Total Officers",value:e.statistics.totalOfficers}),r.addRow({metric:"Total Cases Closed",value:e.statistics.totalCasesClosed}),r.addRow({metric:"Total Convictions",value:e.statistics.totalConvictions}),r.addRow({metric:"Total Detections",value:e.statistics.totalDetections}),r.addRow({metric:"Average Score",value:e.statistics.averageScore.toFixed(2)});let o=t.addWorksheet("Top Performers");o.columns=[{header:"Rank",key:"rank",width:8},{header:"Name",key:"name",width:25},{header:"Badge ID",key:"badgeId",width:15},{header:"Department",key:"department",width:20},{header:"Score",key:"score",width:12},{header:"Achievements",key:"achievements",width:50}],e.topPerformers.forEach((e,t)=>{o.addRow({rank:t+1,name:e.name,badgeId:e.badgeId,department:e.department,score:e.score.toFixed(2),achievements:e.achievements.join("; ")})});let a=t.addWorksheet("District Highlights");return a.columns=[{header:"District",key:"district",width:25},{header:"Achievement",key:"achievement",width:40},{header:"Metric",key:"metric",width:20}],e.districtHighlights.forEach(e=>{a.addRow({district:e.district,achievement:e.achievement,metric:e.metric})}),await t.xlsx.writeBuffer()}let S="nodejs";async function x(e){let t=(0,s.m)(e);if(!("role"in t))return t;let{searchParams:r}=new URL(e.url),o=r.get("format")??"pdf",a=r.get("period")||"month";if(!["pdf","xlsx"].includes(o))return(0,c.yw)("Invalid format. Use pdf or xlsx.");try{let e=await h(a);if("pdf"===o){let t=await v(e);return new Response(new Uint8Array(t),{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="good-work-report-${a}.pdf"`}})}let t=await w(e);return new Response(new Uint8Array(t),{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":`attachment; filename="good-work-report-${a}.xlsx"`}})}catch(e){return(0,c.I3)("Failed to generate report",e)}}let C=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/reports/good-work/route",pathname:"/api/reports/good-work",filename:"route",bundlePath:"app/api/reports/good-work/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\reports\\good-work\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:D,serverHooks:R}=C,k="/api/reports/good-work/route";function $(){return(0,n.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:D})}},16910:(e,t,r)=>{r.d(t,{$v:()=>m,I2:()=>p,Md:()=>l,Oe:()=>u,c_:()=>d,w5:()=>g,z:()=>f});var o=r(63506),a=r.n(o),i=r(67390),n=r.n(i),s=r(52845),c=r(56377);let l="police-dashboard-token";function d(e){return a().hash(e,10)}function u(e,t){return a().compare(e,t)}function f(e){let t=c.O.JWT_SECRET,r=c.O.JWT_EXPIRES_IN||"7d";return n().sign(e,t,{expiresIn:r})}function m(e){let t=c.O.JWT_SECRET;return n().verify(e,t)}function p(){(0,s.cookies)().delete(l)}function g(){return s.cookies().get(l)?.value??null}},51104:(e,t,r)=>{r.d(t,{Hs:()=>s,I3:()=>d,ID:()=>c,i2:()=>i,ok:()=>a,v6:()=>l,yw:()=>n});var o=r(71309);function a(e,t){return o.NextResponse.json({success:!0,data:e},{status:200,...t})}function i(e){return o.NextResponse.json({success:!0,data:e},{status:201})}function n(e,t){return o.NextResponse.json({success:!1,message:e,details:t},{status:400})}function s(e="Unauthorized"){return o.NextResponse.json({success:!1,message:e},{status:401})}function c(e="Forbidden"){return o.NextResponse.json({success:!1,message:e},{status:403})}function l(e="Not found"){return o.NextResponse.json({success:!1,message:e},{status:404})}function d(e="Internal server error",t){return console.error(e,t),o.NextResponse.json({success:!1,message:e},{status:500})}},13534:(e,t,r)=>{r.d(t,{M:()=>n,m:()=>i});var o=r(16910),a=r(51104);function i(e){let t=e.cookies.get(o.Md)?.value;if(!t)return(0,a.Hs)();try{return(0,o.$v)(t)}catch(e){return console.warn("Auth verification failed",e),(0,a.Hs)()}}function n(e,t){let r=i(e);return"role"in r&&!t.includes(r.role)?(0,a.ID)():r}},67133:(e,t,r)=>{r.d(t,{B:()=>s,x:()=>c});var o=r(1035),a=r(21899),i=r(55224),n=r(74193);async function s(){await (0,o.Q)();let e=await (0,i.ne)(),t=[];for(let r of e){let e=await (0,n.t)("score",r.district,6),o="increasing"===e.trend?1.1*r.averageScore:"decreasing"===e.trend?.9*r.averageScore:r.averageScore,a=r.averageScore<50||e.changePercent<-10?"high":r.averageScore<70||e.changePercent<-5?"medium":"low",i=[];r.convictionRatio&&r.convictionRatio<30&&i.push("Low conviction ratio"),r.totalCasesClosed<10&&i.push("Low case closure rate"),e.changePercent<-5&&i.push("Declining performance trend");let s="";s="high"===a?"Immediate intervention required. Focus on training, resource allocation, and performance monitoring.":"medium"===a?"Monitor closely and provide additional support. Review processes and identify improvement areas.":"Maintain current performance levels. Continue best practices.",t.push({district:r.district,currentScore:r.averageScore,predictedScore:Number(o.toFixed(2)),riskLevel:a,factors:i,recommendation:s})}return t.sort((e,t)=>{let r={high:3,medium:2,low:1};return r[t.riskLevel]-r[e.riskLevel]})}async function c(e="month"){await (0,o.Q)();let t=(await (0,i.g2)(5))[0],r=new Date,n=new Date;"week"===e?n.setDate(n.getDate()-7):"month"===e?n.setMonth(n.getMonth()-1):n.setMonth(n.getMonth()-3),await a.f3.find({module:"Detections",createdAt:{$gte:n,$lte:r}}).lean();let c=await a.f3.find({module:"Convictions",createdAt:{$gte:n,$lte:r}}).lean(),l=(await (0,i.ne)()).filter(e=>e.drugSeizureVolume&&e.drugSeizureVolume>0).sort((e,t)=>(t.drugSeizureVolume||0)-(e.drugSeizureVolume||0))[0],d=[];if(t&&d.push(`${t.district} leads with an average score of ${t.averageScore} across ${t.totalOfficers} officers.`),l&&l.drugSeizureVolume){let t=Math.floor(l.drugSeizureVolume/1e3);d.push(`This ${e}, ${l.district} led in narcotics enforcement with ${t} arrests and ₹${l.drugSeizureVolume.toLocaleString()} in value recovered.`)}c.length>0&&d.push(`${c.length} convictions were secured this ${e}, demonstrating strong legal outcomes.`);let u=(await s()).find(e=>"high"===e.riskLevel),f=`Performance Summary for ${"week"===e?"the past week":"month"===e?"this month":"this quarter"}: `;return f+=d.join(" "),u&&(f+=` Areas requiring attention: ${u.district} shows declining trends and needs intervention.`),{summary:f,highlights:d,topPerformer:t?.district,areaOfConcern:u?.district}}},55224:(e,t,r)=>{r.d(t,{c0:()=>n,g2:()=>s,ne:()=>i});var o=r(1035),a=r(21899);async function i(e,t,r){await (0,o.Q)();let i={};e&&(i.district=e);let n=await a.pB.find(i).lean(),s={};e&&(s.district=e),(t||r)&&(s.createdAt={},t&&(s.createdAt.$gte=t),r&&(s.createdAt.$lte=r));let c=await a.f3.find(s).lean(),l=new Map;n.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=l.get(t);r.totalOfficers++,r.totalCasesClosed+=e.caseClosed||0,r.averageScore+=e.totalScore||0});let d=c.filter(e=>"Convictions"===e.module),u=c.filter(e=>"Detections"===e.module);return c.filter(e=>"SpecialDrives"===e.module),d.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0}),l.get(t).totalConvictions++}),u.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=l.get(t);r.totalDetections++,r.totalValueRecovered+=e.valueRecovered||0}),Array.from(l.values()).map(e=>(e.averageScore=e.totalOfficers>0?Number((e.averageScore/e.totalOfficers).toFixed(2)):0,e.convictionRatio=e.totalCasesClosed>0?Number((e.totalConvictions/e.totalCasesClosed*100).toFixed(2)):0,e.drugSeizureVolume=e.totalValueRecovered,e.nbwExecutionRate=e.totalCasesClosed>0?Math.min(95,60+35*Math.random()):0,e)).sort((e,t)=>t.averageScore-e.averageScore)}async function n(e,t){await (0,o.Q)();let r={module:"SpecialDrives"};e&&(r.driveName=e),t&&(r.district=t);let i=await a.f3.find(r).lean(),n=new Map;return i.forEach(e=>{let t=e.driveName||"Unknown Drive";n.has(t)||n.set(t,{driveName:t,district:e.district||void 0,startDate:e.driveDate||e.createdAt,totalCasesHandled:0,participatingOfficers:0,averageCasesPerOfficer:0,successRate:0});let r=n.get(t);r.totalCasesHandled+=e.casesHandled||0,r.participatingOfficers++}),Array.from(n.values()).map(e=>(e.averageCasesPerOfficer=e.participatingOfficers>0?Number((e.totalCasesHandled/e.participatingOfficers).toFixed(2)):0,e.successRate=Math.min(100,70+25*Math.random()),e)).sort((e,t)=>t.totalCasesHandled-e.totalCasesHandled)}async function s(e=10){return(await i()).slice(0,e)}},74193:(e,t,r)=>{r.d(t,{c:()=>n,t:()=>i});var o=r(1035),a=r(21899);async function i(e,t,r=12){await (0,o.Q)();let i=new Date;i.setMonth(i.getMonth()-r);let n={};t&&(n.district=t);let s=[];if("cases"===e){let e=await a.pB.find(n).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01";t.set(r,(t.get(r)||0)+(e.caseClosed||0))}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("convictions"===e){n.module="Convictions";let e=await a.f3.find(n).lean(),t=new Map;e.forEach(e=>{let r=e.convictionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("detections"===e){n.module="Detections";let e=await a.f3.find(n).lean(),t=new Map;e.forEach(e=>{let r=e.detectionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("score"===e){let e=await a.pB.find(n).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01",o=t.get(r)||{total:0,count:0};o.total+=e.totalScore||0,o.count++,t.set(r,o)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t.count>0?Number((t.total/t.count).toFixed(2)):0})).sort((e,t)=>e.period.localeCompare(t.period))}if(s.length<2)return{data:s,trend:"stable",changePercent:0,average:s[0]?.value||0};let c=s[0].value,l=s[s.length-1].value,d=c>0?Number(((l-c)/c*100).toFixed(2)):0,u=s.length>0?Number((s.reduce((e,t)=>e+t.value,0)/s.length).toFixed(2)):0;return{data:s.slice(-r),trend:d>5?"increasing":d<-5?"decreasing":"stable",changePercent:d,average:u}}async function n(e){await (0,o.Q)();let t=await a.f3.find({module:"SpecialDrives",driveName:e}).sort({driveDate:1}).lean(),r=new Map;return t.forEach(e=>{let t=e.driveDate?.toISOString().slice(0,10)||e.createdAt.toISOString().slice(0,10);r.set(t,(r.get(t)||0)+(e.casesHandled||0))}),Array.from(r.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7787,5541,5405,4833,3392,8960,9015,540],()=>r(42386));module.exports=o})();