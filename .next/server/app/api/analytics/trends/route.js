"use strict";(()=>{var e={};e.id=3962,e.ids=[3962],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},74500:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>d,runtime:()=>u});var a=r(73278),s=r(45002),o=r(54877),i=r(1035),c=r(74193),l=r(51104);let u="nodejs";async function d(e){try{await (0,i.Q)();let{searchParams:t}=new URL(e.url),r=t.get("type"),n=t.get("metric"),a=t.get("district"),s=t.get("driveName"),o=Number(t.get("months")||12);if("drive"===r){if(!s)return(0,l.yw)("driveName is required for drive trends");let e=await (0,c.c)(s);return(0,l.ok)(e)}if(!n)return(0,l.yw)("metric is required for monthly trends");let u=await (0,c.t)(n,a||void 0,o);return(0,l.ok)(u)}catch(e){return(0,l.I3)("Failed to fetch trend analysis",e)}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/trends/route",pathname:"/api/analytics/trends",filename:"route",bundlePath:"app/api/analytics/trends/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\analytics\\trends\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=p,v="/api/analytics/trends/route";function h(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},51104:(e,t,r)=>{r.d(t,{Hs:()=>i,I3:()=>u,ID:()=>c,i2:()=>s,ok:()=>a,v6:()=>l,yw:()=>o});var n=r(71309);function a(e,t){return n.NextResponse.json({success:!0,data:e},{status:200,...t})}function s(e){return n.NextResponse.json({success:!0,data:e},{status:201})}function o(e,t){return n.NextResponse.json({success:!1,message:e,details:t},{status:400})}function i(e="Unauthorized"){return n.NextResponse.json({success:!1,message:e},{status:401})}function c(e="Forbidden"){return n.NextResponse.json({success:!1,message:e},{status:403})}function l(e="Not found"){return n.NextResponse.json({success:!1,message:e},{status:404})}function u(e="Internal server error",t){return console.error(e,t),n.NextResponse.json({success:!1,message:e},{status:500})}},74193:(e,t,r)=>{r.d(t,{c:()=>o,t:()=>s});var n=r(1035),a=r(21899);async function s(e,t,r=12){await (0,n.Q)();let s=new Date;s.setMonth(s.getMonth()-r);let o={};t&&(o.district=t);let i=[];if("cases"===e){let e=await a.pB.find(o).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01";t.set(r,(t.get(r)||0)+(e.caseClosed||0))}),i=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("convictions"===e){o.module="Convictions";let e=await a.f3.find(o).lean(),t=new Map;e.forEach(e=>{let r=e.convictionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),i=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("detections"===e){o.module="Detections";let e=await a.f3.find(o).lean(),t=new Map;e.forEach(e=>{let r=e.detectionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),i=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("score"===e){let e=await a.pB.find(o).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01",n=t.get(r)||{total:0,count:0};n.total+=e.totalScore||0,n.count++,t.set(r,n)}),i=Array.from(t.entries()).map(([e,t])=>({period:e,value:t.count>0?Number((t.total/t.count).toFixed(2)):0})).sort((e,t)=>e.period.localeCompare(t.period))}if(i.length<2)return{data:i,trend:"stable",changePercent:0,average:i[0]?.value||0};let c=i[0].value,l=i[i.length-1].value,u=c>0?Number(((l-c)/c*100).toFixed(2)):0,d=i.length>0?Number((i.reduce((e,t)=>e+t.value,0)/i.length).toFixed(2)):0;return{data:i.slice(-r),trend:u>5?"increasing":u<-5?"decreasing":"stable",changePercent:u,average:d}}async function o(e){await (0,n.Q)();let t=await a.f3.find({module:"SpecialDrives",driveName:e}).sort({driveDate:1}).lean(),r=new Map;return t.forEach(e=>{let t=e.driveDate?.toISOString().slice(0,10)||e.createdAt.toISOString().slice(0,10);r.set(t,(r.get(t)||0)+(e.casesHandled||0))}),Array.from(r.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7787,5541,4833,540],()=>r(74500));module.exports=n})();