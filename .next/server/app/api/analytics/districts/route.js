"use strict";(()=>{var e={};e.id=6467,e.ids=[6467],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77550:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>C,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var s={};a.r(s),a.d(s,{GET:()=>u,runtime:()=>d});var r=a(73278),o=a(45002),i=a(54877),n=a(1035),c=a(55224),l=a(51104);let d="nodejs";async function u(e){try{await (0,n.Q)();let{searchParams:t}=new URL(e.url),a=t.get("district"),s=t.get("top");if(s){let e=Number(s)||10,t=await (0,c.g2)(e);return(0,l.ok)(t)}let r=await (0,c.ne)(a||void 0);return(0,l.ok)(r)}catch(e){return(0,l.I3)("Failed to fetch district analytics",e)}}let f=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/districts/route",pathname:"/api/analytics/districts",filename:"route",bundlePath:"app/api/analytics/districts/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\analytics\\districts\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:v,serverHooks:m}=f,g="/api/analytics/districts/route";function C(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}},51104:(e,t,a)=>{a.d(t,{Hs:()=>n,I3:()=>d,ID:()=>c,i2:()=>o,ok:()=>r,v6:()=>l,yw:()=>i});var s=a(71309);function r(e,t){return s.NextResponse.json({success:!0,data:e},{status:200,...t})}function o(e){return s.NextResponse.json({success:!0,data:e},{status:201})}function i(e,t){return s.NextResponse.json({success:!1,message:e,details:t},{status:400})}function n(e="Unauthorized"){return s.NextResponse.json({success:!1,message:e},{status:401})}function c(e="Forbidden"){return s.NextResponse.json({success:!1,message:e},{status:403})}function l(e="Not found"){return s.NextResponse.json({success:!1,message:e},{status:404})}function d(e="Internal server error",t){return console.error(e,t),s.NextResponse.json({success:!1,message:e},{status:500})}},55224:(e,t,a)=>{a.d(t,{c0:()=>i,g2:()=>n,ne:()=>o});var s=a(1035),r=a(21899);async function o(e,t,a){await (0,s.Q)();let o={};e&&(o.district=e);let i=await r.pB.find(o).lean(),n={};e&&(n.district=e),(t||a)&&(n.createdAt={},t&&(n.createdAt.$gte=t),a&&(n.createdAt.$lte=a));let c=await r.f3.find(n).lean(),l=new Map;i.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let a=l.get(t);a.totalOfficers++,a.totalCasesClosed+=e.caseClosed||0,a.averageScore+=e.totalScore||0});let d=c.filter(e=>"Convictions"===e.module),u=c.filter(e=>"Detections"===e.module);return c.filter(e=>"SpecialDrives"===e.module),d.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0}),l.get(t).totalConvictions++}),u.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let a=l.get(t);a.totalDetections++,a.totalValueRecovered+=e.valueRecovered||0}),Array.from(l.values()).map(e=>(e.averageScore=e.totalOfficers>0?Number((e.averageScore/e.totalOfficers).toFixed(2)):0,e.convictionRatio=e.totalCasesClosed>0?Number((e.totalConvictions/e.totalCasesClosed*100).toFixed(2)):0,e.drugSeizureVolume=e.totalValueRecovered,e.nbwExecutionRate=e.totalCasesClosed>0?Math.min(95,60+35*Math.random()):0,e)).sort((e,t)=>t.averageScore-e.averageScore)}async function i(e,t){await (0,s.Q)();let a={module:"SpecialDrives"};e&&(a.driveName=e),t&&(a.district=t);let o=await r.f3.find(a).lean(),i=new Map;return o.forEach(e=>{let t=e.driveName||"Unknown Drive";i.has(t)||i.set(t,{driveName:t,district:e.district||void 0,startDate:e.driveDate||e.createdAt,totalCasesHandled:0,participatingOfficers:0,averageCasesPerOfficer:0,successRate:0});let a=i.get(t);a.totalCasesHandled+=e.casesHandled||0,a.participatingOfficers++}),Array.from(i.values()).map(e=>(e.averageCasesPerOfficer=e.participatingOfficers>0?Number((e.totalCasesHandled/e.participatingOfficers).toFixed(2)):0,e.successRate=Math.min(100,70+25*Math.random()),e)).sort((e,t)=>t.totalCasesHandled-e.totalCasesHandled)}async function n(e=10){return(await o()).slice(0,e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[7787,5541,4833,540],()=>a(77550));module.exports=s})();