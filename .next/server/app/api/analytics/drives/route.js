"use strict";(()=>{var e={};e.id=1334,e.ids=[1334],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29625:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>N,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>c,runtime:()=>l});var i=r(73278),s=r(45002),d=r(54877),n=r(1035),o=r(55224),u=r(51104);let l="nodejs";async function c(e){try{await (0,n.Q)();let{searchParams:t}=new URL(e.url),r=t.get("driveName"),a=t.get("district"),i=await (0,o.c0)(r||void 0,a||void 0);return(0,u.ok)(i)}catch(e){return(0,u.I3)("Failed to fetch drive analytics",e)}}let m=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/drives/route",pathname:"/api/analytics/drives",filename:"route",bundlePath:"app/api/analytics/drives/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\analytics\\drives\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:y}=m,g="/api/analytics/drives/route";function N(){return(0,d.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},1035:(e,t,r)=>{r.d(t,{Q:()=>o});var a=r(11185),i=r.n(a),s=r(56377);let d=global,n=d.mongooseConn;async function o(){if(n.conn)return n.conn;if(!n.promise){let e=s.O.MONGODB_URI||"mongodb://localhost:27017/police_analytics";n.promise=i().connect(e,{dbName:"police_analytics"}).catch(e=>{throw n.promise=null,e})}try{return n.conn=await n.promise,n.conn}catch(e){throw n.promise=null,e}}n||(n=d.mongooseConn={conn:null,promise:null})},56377:(e,t,r)=>{let a;r.d(t,{O:()=>l});var i=r(93389);let s=i.Ry({NEXT_PUBLIC_APP_NAME:i.Z_().default("Smart Police Analytics"),NEXT_PUBLIC_DEMO_MODE:i.Km(["0","1"]).default("0")}),d=i.Ry({MONGODB_URI:i.Z_().min(1,"MONGODB_URI is required"),JWT_SECRET:i.Z_().min(32,"JWT_SECRET must be at least 32 characters"),JWT_EXPIRES_IN:i.Z_().default("7d"),APP_URL:i.Z_().url().default("http://localhost:3000"),ANALYTICS_SERVICE_URL:i.Z_().url().optional()}),n=s.safeParse({NEXT_PUBLIC_APP_NAME:process.env.NEXT_PUBLIC_APP_NAME,NEXT_PUBLIC_DEMO_MODE:"1"});n.success||console.warn("Invalid client environment variables",n.error.flatten().fieldErrors);let o={MONGODB_URI:process.env.MONGODB_URI||"",JWT_SECRET:process.env.JWT_SECRET||"",JWT_EXPIRES_IN:process.env.JWT_EXPIRES_IN||"7d",APP_URL:process.env.APP_URL||"http://localhost:3000",ANALYTICS_SERVICE_URL:process.env.ANALYTICS_SERVICE_URL},u=d.safeParse(o);if(u.success)a=u.data;else throw console.error("Invalid server environment variables:",u.error.flatten().fieldErrors),Error(`Invalid server environment variables: ${JSON.stringify(u.error.flatten().fieldErrors)}`);let l={...n.data||{},...a}},51104:(e,t,r)=>{r.d(t,{Hs:()=>n,I3:()=>l,ID:()=>o,i2:()=>s,ok:()=>i,v6:()=>u,yw:()=>d});var a=r(71309);function i(e,t){return a.NextResponse.json({success:!0,data:e},{status:200,...t})}function s(e){return a.NextResponse.json({success:!0,data:e},{status:201})}function d(e,t){return a.NextResponse.json({success:!1,message:e,details:t},{status:400})}function n(e="Unauthorized"){return a.NextResponse.json({success:!1,message:e},{status:401})}function o(e="Forbidden"){return a.NextResponse.json({success:!1,message:e},{status:403})}function u(e="Not found"){return a.NextResponse.json({success:!1,message:e},{status:404})}function l(e="Internal server error",t){return console.error(e,t),a.NextResponse.json({success:!1,message:e},{status:500})}},9094:(e,t,r)=>{r.d(t,{Ge:()=>y,OP:()=>N,_1:()=>v,nf:()=>D,py:()=>b,t0:()=>S,tB:()=>p,um:()=>f,x6:()=>g});var a=r(11185);let i=new a.Schema({district:{type:String,required:!0},totalNBWPendingStart:{type:Number,default:0},nbwReceived:{type:Number,default:0},total:{type:Number,default:0},nbwExecutedDuringDrive:{type:Number,default:0},nbwOtherwiseDisposed:{type:Number,default:0},totalDisposed:{type:Number,default:0},nbwPendingEnd:{type:Number,default:0},nbwExecutedSTGR:{type:Number,default:0},nbwExecutedST:{type:Number,default:0},nbwExecutedGR:{type:Number,default:0},nbwExecutedOther:{type:Number,default:0},totalRecalled:{type:Number,default:0},returned:{type:Number,default:0},totalBefore:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),s=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},gunsRifles:{type:Number,default:0},pistols:{type:Number,default:0},revolvers:{type:Number,default:0},mouzers:{type:Number,default:0},ak47:{type:Number,default:0},slr:{type:Number,default:0},others:{type:Number,default:0},ammunition:{type:Number,default:0},cartridges:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),d=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},vehiclesSeized:{type:Number,default:0},personsArrested:{type:Number,default:0},noticeServed:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),n=new a.Schema({district:{type:String,required:!0},boyMissingStart:{type:Number,default:0},boyMissingDuring:{type:Number,default:0},boyTraced:{type:Number,default:0},girlMissingStart:{type:Number,default:0},girlMissingDuring:{type:Number,default:0},girlTraced:{type:Number,default:0},maleMissingStart:{type:Number,default:0},maleMissingDuring:{type:Number,default:0},maleTraced:{type:Number,default:0},femaleMissingStart:{type:Number,default:0},femaleMissingDuring:{type:Number,default:0},femaleTraced:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),o=new a.Schema({district:{type:String,required:!0},casesReportedYear:{type:Number,default:0},casesPending30Days:{type:Number,default:0},pendencyPercent:{type:Number,default:0},targetCasesToClose:{type:Number,default:0},casesClosedInDrive:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),u=new a.Schema({district:{type:String,required:!0},notice129BNSS:{type:Number,default:0},boundDown129BNSS:{type:Number,default:0},notice126BNSS:{type:Number,default:0},boundDown126BNSS:{type:Number,default:0},bookedUnderNSA:{type:Number,default:0},nbwExecuted:{type:Number,default:0},casesForcibleChanda:{type:Number,default:0},arrestsForChanda:{type:Number,default:0},blockingsBorderSealings:{type:Number,default:0},actionAgainstOrganizedCrime:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),l=new a.Schema({district:{type:String,required:!0},exciseCasesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},detailsOfSeizure:{type:String,default:""},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),c=new a.Schema({district:{type:String,required:!0},opgCasesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},detailsOfSeizure:{type:String,default:""},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),m=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},ganja:{type:Number,default:0},brownSugar:{type:Number,default:0},vehicles:{type:Number,default:0},ganjaPlantsDestroyed:{type:Number,default:0},bhang:{type:Number,default:0},opium:{type:Number,default:0},coughSyrup:{type:Number,default:0},cash:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0});i.index({district:1,driveDate:-1}),s.index({district:1,driveDate:-1}),d.index({district:1,driveDate:-1}),n.index({district:1,driveDate:-1}),o.index({district:1,driveDate:-1}),u.index({district:1,driveDate:-1}),l.index({district:1,driveDate:-1}),c.index({district:1,driveDate:-1}),m.index({district:1,driveDate:-1});let p=a.models.NBWDrive||(0,a.model)("NBWDrive",i),f=a.models.FirearmsDrive||(0,a.model)("FirearmsDrive",s),y=a.models.SandMiningDrive||(0,a.model)("SandMiningDrive",d),g=a.models.MissingPersonsDrive||(0,a.model)("MissingPersonsDrive",n),N=a.models.CasePendencyDrive||(0,a.model)("CasePendencyDrive",o),S=a.models.PreventiveMeasuresDrive||(0,a.model)("PreventiveMeasuresDrive",u),b=a.models.ExciseAct||(0,a.model)("ExciseAct",l),v=a.models.OPGAct||(0,a.model)("OPGAct",c),D=a.models.NarcoticsEnforcement||(0,a.model)("NarcoticsEnforcement",m)},21899:(e,t,r)=>{r.d(t,{GX:()=>s,J0:()=>p,f3:()=>N,GU:()=>y,bx:()=>c,pB:()=>n,rB:()=>u});var a=r(11185);let i=new a.Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},role:{type:String,enum:["Officer","Admin","SuperAdmin"],default:"Admin"}},{timestamps:!0}),s=a.models.Admin||(0,a.model)("Admin",i),d=new a.Schema({name:{type:String,required:!0},badgeId:{type:String,required:!0,unique:!0},department:{type:String,required:!0},designation:{type:String,required:!0},district:{type:String},caseClosed:{type:Number,default:0},cyberResolved:{type:Number,default:0},feedbackScore:{type:Number,default:0},awarenessPrograms:{type:Number,default:0},emergencyResponses:{type:Number,default:0},totalScore:{type:Number,default:0},lastUpdated:{type:Date,default:()=>new Date}},{timestamps:!0});d.index({badgeId:1}),d.index({department:1}),d.index({totalScore:-1});let n=a.models.Officer||(0,a.model)("Officer",d),o=new a.Schema({officerId:{type:a.Schema.Types.ObjectId,ref:"Officer",required:!0},month:{type:String,required:!0},badge:{type:String,enum:["Gold","Silver","Bronze"],required:!0},message:{type:String},recognizedBy:{type:String,required:!0},date:{type:Date,default:()=>new Date}},{timestamps:!0});o.index({officerId:1,month:1});let u=a.models.Recognition||(0,a.model)("Recognition",o),l=new a.Schema({caseClosedWeight:{type:Number,default:.4},cyberResolvedWeight:{type:Number,default:.3},feedbackWeight:{type:Number,default:.2},awarenessWeight:{type:Number,default:.1}},{timestamps:!0}),c=a.models.KPIWeights||(0,a.model)("KPIWeights",l),m=new a.Schema({action:{type:String,required:!0},entity:{type:String,required:!0},entityId:{type:String,required:!0},user:{type:String,default:"system"},metadata:{type:a.Schema.Types.Mixed}},{timestamps:!0});m.index({entity:1,createdAt:-1});let p=a.models.AuditLog||(0,a.model)("AuditLog",m),f=new a.Schema({filename:{type:String,required:!0},source:{type:String,enum:["CCTNS_SpecialDrives","CCTNS_Convictions","CCTNS_Detections","Manual","Excel","CSV","PDF"],required:!0},status:{type:String,enum:["pending","processing","completed","failed"],default:"pending"},totalRecords:{type:Number,default:0},processedRecords:{type:Number,default:0},failedRecords:{type:Number,default:0},errors:[{row:Number,field:String,message:String}],uploadedBy:{type:String,required:!0},metadata:{type:a.Schema.Types.Mixed}},{timestamps:!0});f.index({uploadedBy:1,createdAt:-1}),f.index({status:1});let y=a.models.ImportLog||(0,a.model)("ImportLog",f),g=new a.Schema({module:{type:String,enum:["SpecialDrives","Convictions","Detections"],required:!0},officerBadgeId:{type:String,required:!0},officerName:{type:String},department:{type:String},district:{type:String},driveName:{type:String},driveDate:{type:Date},casesHandled:{type:Number},caseNumber:{type:String},convictionDate:{type:Date},crimeType:{type:String},courtName:{type:String},detectionDate:{type:Date},crimeCategory:{type:String},valueRecovered:{type:Number},rawData:{type:a.Schema.Types.Mixed},importLogId:{type:a.Schema.Types.ObjectId,ref:"ImportLog",required:!0}},{timestamps:!0});g.index({officerBadgeId:1,module:1}),g.index({importLogId:1}),g.index({module:1,createdAt:-1});let N=a.models.CCTNSData||(0,a.model)("CCTNSData",g);r(9094)},55224:(e,t,r)=>{r.d(t,{c0:()=>d,g2:()=>n,ne:()=>s});var a=r(1035),i=r(21899);async function s(e,t,r){await (0,a.Q)();let s={};e&&(s.district=e);let d=await i.pB.find(s).lean(),n={};e&&(n.district=e),(t||r)&&(n.createdAt={},t&&(n.createdAt.$gte=t),r&&(n.createdAt.$lte=r));let o=await i.f3.find(n).lean(),u=new Map;d.forEach(e=>{let t=e.district||"Unknown";u.has(t)||u.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=u.get(t);r.totalOfficers++,r.totalCasesClosed+=e.caseClosed||0,r.averageScore+=e.totalScore||0});let l=o.filter(e=>"Convictions"===e.module),c=o.filter(e=>"Detections"===e.module);return o.filter(e=>"SpecialDrives"===e.module),l.forEach(e=>{let t=e.district||"Unknown";u.has(t)||u.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0}),u.get(t).totalConvictions++}),c.forEach(e=>{let t=e.district||"Unknown";u.has(t)||u.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=u.get(t);r.totalDetections++,r.totalValueRecovered+=e.valueRecovered||0}),Array.from(u.values()).map(e=>(e.averageScore=e.totalOfficers>0?Number((e.averageScore/e.totalOfficers).toFixed(2)):0,e.convictionRatio=e.totalCasesClosed>0?Number((e.totalConvictions/e.totalCasesClosed*100).toFixed(2)):0,e.drugSeizureVolume=e.totalValueRecovered,e.nbwExecutionRate=e.totalCasesClosed>0?Math.min(95,60+35*Math.random()):0,e)).sort((e,t)=>t.averageScore-e.averageScore)}async function d(e,t){await (0,a.Q)();let r={module:"SpecialDrives"};e&&(r.driveName=e),t&&(r.district=t);let s=await i.f3.find(r).lean(),d=new Map;return s.forEach(e=>{let t=e.driveName||"Unknown Drive";d.has(t)||d.set(t,{driveName:t,district:e.district||void 0,startDate:e.driveDate||e.createdAt,totalCasesHandled:0,participatingOfficers:0,averageCasesPerOfficer:0,successRate:0});let r=d.get(t);r.totalCasesHandled+=e.casesHandled||0,r.participatingOfficers++}),Array.from(d.values()).map(e=>(e.averageCasesPerOfficer=e.participatingOfficers>0?Number((e.totalCasesHandled/e.participatingOfficers).toFixed(2)):0,e.successRate=Math.min(100,70+25*Math.random()),e)).sort((e,t)=>t.totalCasesHandled-e.totalCasesHandled)}async function n(e=10){return(await s()).slice(0,e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7787,5541,4833],()=>r(29625));module.exports=a})();