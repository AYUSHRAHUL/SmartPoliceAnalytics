"use strict";(()=>{var e={};e.id=9936,e.ids=[9936],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24452:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{GET:()=>u,runtime:()=>d});var i=a(73278),o=a(45002),n=a(54877),s=a(1035),c=a(67133),l=a(51104);let d="nodejs";async function u(e){try{await (0,s.Q)();let{searchParams:t}=new URL(e.url),a=t.get("type");if("predictions"===a){let e=await (0,c.B)();return(0,l.ok)(e)}if("summary"===a){let e=t.get("period")||"month",a=await (0,c.x)(e);return(0,l.ok)(a)}let[r,i]=await Promise.all([(0,c.B)(),(0,c.x)("month")]);return(0,l.ok)({predictions:r,summary:i})}catch(e){return(0,l.I3)("Failed to fetch AI insights",e)}}let f=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/insights/route",pathname:"/api/analytics/insights",filename:"route",bundlePath:"app/api/analytics/insights/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\analytics\\insights\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=f,v="/api/analytics/insights/route";function h(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},51104:(e,t,a)=>{a.d(t,{Hs:()=>s,I3:()=>d,ID:()=>c,i2:()=>o,ok:()=>i,v6:()=>l,yw:()=>n});var r=a(71309);function i(e,t){return r.NextResponse.json({success:!0,data:e},{status:200,...t})}function o(e){return r.NextResponse.json({success:!0,data:e},{status:201})}function n(e,t){return r.NextResponse.json({success:!1,message:e,details:t},{status:400})}function s(e="Unauthorized"){return r.NextResponse.json({success:!1,message:e},{status:401})}function c(e="Forbidden"){return r.NextResponse.json({success:!1,message:e},{status:403})}function l(e="Not found"){return r.NextResponse.json({success:!1,message:e},{status:404})}function d(e="Internal server error",t){return console.error(e,t),r.NextResponse.json({success:!1,message:e},{status:500})}},67133:(e,t,a)=>{a.d(t,{B:()=>s,x:()=>c});var r=a(1035),i=a(21899),o=a(55224),n=a(74193);async function s(){await (0,r.Q)();let e=await (0,o.ne)(),t=[];for(let a of e){let e=await (0,n.t)("score",a.district,6),r="increasing"===e.trend?1.1*a.averageScore:"decreasing"===e.trend?.9*a.averageScore:a.averageScore,i=a.averageScore<50||e.changePercent<-10?"high":a.averageScore<70||e.changePercent<-5?"medium":"low",o=[];a.convictionRatio&&a.convictionRatio<30&&o.push("Low conviction ratio"),a.totalCasesClosed<10&&o.push("Low case closure rate"),e.changePercent<-5&&o.push("Declining performance trend");let s="";s="high"===i?"Immediate intervention required. Focus on training, resource allocation, and performance monitoring.":"medium"===i?"Monitor closely and provide additional support. Review processes and identify improvement areas.":"Maintain current performance levels. Continue best practices.",t.push({district:a.district,currentScore:a.averageScore,predictedScore:Number(r.toFixed(2)),riskLevel:i,factors:o,recommendation:s})}return t.sort((e,t)=>{let a={high:3,medium:2,low:1};return a[t.riskLevel]-a[e.riskLevel]})}async function c(e="month"){await (0,r.Q)();let t=(await (0,o.g2)(5))[0],a=new Date,n=new Date;"week"===e?n.setDate(n.getDate()-7):"month"===e?n.setMonth(n.getMonth()-1):n.setMonth(n.getMonth()-3),await i.f3.find({module:"Detections",createdAt:{$gte:n,$lte:a}}).lean();let c=await i.f3.find({module:"Convictions",createdAt:{$gte:n,$lte:a}}).lean(),l=(await (0,o.ne)()).filter(e=>e.drugSeizureVolume&&e.drugSeizureVolume>0).sort((e,t)=>(t.drugSeizureVolume||0)-(e.drugSeizureVolume||0))[0],d=[];if(t&&d.push(`${t.district} leads with an average score of ${t.averageScore} across ${t.totalOfficers} officers.`),l&&l.drugSeizureVolume){let t=Math.floor(l.drugSeizureVolume/1e3);d.push(`This ${e}, ${l.district} led in narcotics enforcement with ${t} arrests and â‚¹${l.drugSeizureVolume.toLocaleString()} in value recovered.`)}c.length>0&&d.push(`${c.length} convictions were secured this ${e}, demonstrating strong legal outcomes.`);let u=(await s()).find(e=>"high"===e.riskLevel),f=`Performance Summary for ${"week"===e?"the past week":"month"===e?"this month":"this quarter"}: `;return f+=d.join(" "),u&&(f+=` Areas requiring attention: ${u.district} shows declining trends and needs intervention.`),{summary:f,highlights:d,topPerformer:t?.district,areaOfConcern:u?.district}}},55224:(e,t,a)=>{a.d(t,{c0:()=>n,g2:()=>s,ne:()=>o});var r=a(1035),i=a(21899);async function o(e,t,a){await (0,r.Q)();let o={};e&&(o.district=e);let n=await i.pB.find(o).lean(),s={};e&&(s.district=e),(t||a)&&(s.createdAt={},t&&(s.createdAt.$gte=t),a&&(s.createdAt.$lte=a));let c=await i.f3.find(s).lean(),l=new Map;n.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let a=l.get(t);a.totalOfficers++,a.totalCasesClosed+=e.caseClosed||0,a.averageScore+=e.totalScore||0});let d=c.filter(e=>"Convictions"===e.module),u=c.filter(e=>"Detections"===e.module);return c.filter(e=>"SpecialDrives"===e.module),d.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0}),l.get(t).totalConvictions++}),u.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let a=l.get(t);a.totalDetections++,a.totalValueRecovered+=e.valueRecovered||0}),Array.from(l.values()).map(e=>(e.averageScore=e.totalOfficers>0?Number((e.averageScore/e.totalOfficers).toFixed(2)):0,e.convictionRatio=e.totalCasesClosed>0?Number((e.totalConvictions/e.totalCasesClosed*100).toFixed(2)):0,e.drugSeizureVolume=e.totalValueRecovered,e.nbwExecutionRate=e.totalCasesClosed>0?Math.min(95,60+35*Math.random()):0,e)).sort((e,t)=>t.averageScore-e.averageScore)}async function n(e,t){await (0,r.Q)();let a={module:"SpecialDrives"};e&&(a.driveName=e),t&&(a.district=t);let o=await i.f3.find(a).lean(),n=new Map;return o.forEach(e=>{let t=e.driveName||"Unknown Drive";n.has(t)||n.set(t,{driveName:t,district:e.district||void 0,startDate:e.driveDate||e.createdAt,totalCasesHandled:0,participatingOfficers:0,averageCasesPerOfficer:0,successRate:0});let a=n.get(t);a.totalCasesHandled+=e.casesHandled||0,a.participatingOfficers++}),Array.from(n.values()).map(e=>(e.averageCasesPerOfficer=e.participatingOfficers>0?Number((e.totalCasesHandled/e.participatingOfficers).toFixed(2)):0,e.successRate=Math.min(100,70+25*Math.random()),e)).sort((e,t)=>t.totalCasesHandled-e.totalCasesHandled)}async function s(e=10){return(await o()).slice(0,e)}},74193:(e,t,a)=>{a.d(t,{c:()=>n,t:()=>o});var r=a(1035),i=a(21899);async function o(e,t,a=12){await (0,r.Q)();let o=new Date;o.setMonth(o.getMonth()-a);let n={};t&&(n.district=t);let s=[];if("cases"===e){let e=await i.pB.find(n).lean(),t=new Map;e.forEach(e=>{let a=e.lastUpdated?.toISOString().slice(0,7)||"2025-01";t.set(a,(t.get(a)||0)+(e.caseClosed||0))}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("convictions"===e){n.module="Convictions";let e=await i.f3.find(n).lean(),t=new Map;e.forEach(e=>{let a=e.convictionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(a,(t.get(a)||0)+1)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("detections"===e){n.module="Detections";let e=await i.f3.find(n).lean(),t=new Map;e.forEach(e=>{let a=e.detectionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(a,(t.get(a)||0)+1)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("score"===e){let e=await i.pB.find(n).lean(),t=new Map;e.forEach(e=>{let a=e.lastUpdated?.toISOString().slice(0,7)||"2025-01",r=t.get(a)||{total:0,count:0};r.total+=e.totalScore||0,r.count++,t.set(a,r)}),s=Array.from(t.entries()).map(([e,t])=>({period:e,value:t.count>0?Number((t.total/t.count).toFixed(2)):0})).sort((e,t)=>e.period.localeCompare(t.period))}if(s.length<2)return{data:s,trend:"stable",changePercent:0,average:s[0]?.value||0};let c=s[0].value,l=s[s.length-1].value,d=c>0?Number(((l-c)/c*100).toFixed(2)):0,u=s.length>0?Number((s.reduce((e,t)=>e+t.value,0)/s.length).toFixed(2)):0;return{data:s.slice(-a),trend:d>5?"increasing":d<-5?"decreasing":"stable",changePercent:d,average:u}}async function n(e){await (0,r.Q)();let t=await i.f3.find({module:"SpecialDrives",driveName:e}).sort({driveDate:1}).lean(),a=new Map;return t.forEach(e=>{let t=e.driveDate?.toISOString().slice(0,10)||e.createdAt.toISOString().slice(0,10);a.set(t,(a.get(t)||0)+(e.casesHandled||0))}),Array.from(a.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7787,5541,4833,540],()=>a(24452));module.exports=r})();