"use strict";(()=>{var e={};e.id=9936,e.ids=[9936],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24452:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>c,runtime:()=>u});var i=r(73278),n=r(45002),s=r(54877),o=r(1035),d=r(67133),l=r(51104);let u="nodejs";async function c(e){try{await (0,o.Q)();let{searchParams:t}=new URL(e.url),r=t.get("type");if("predictions"===r){let e=await (0,d.B)();return(0,l.ok)(e)}if("summary"===r){let e=t.get("period")||"month",r=await (0,d.x)(e);return(0,l.ok)(r)}let[a,i]=await Promise.all([(0,d.B)(),(0,d.x)("month")]);return(0,l.ok)({predictions:a,summary:i})}catch(e){return(0,l.I3)("Failed to fetch AI insights",e)}}let m=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/insights/route",pathname:"/api/analytics/insights",filename:"route",bundlePath:"app/api/analytics/insights/route"},resolvedPagePath:"C:\\Users\\rahul\\Downloads\\problem -3, team -9\\SmartPoliceAnalytics-main\\SmartPoliceAnalytics-main\\app\\api\\analytics\\insights\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:g}=m,y="/api/analytics/insights/route";function S(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},1035:(e,t,r)=>{r.d(t,{Q:()=>d});var a=r(11185),i=r.n(a),n=r(56377);let s=global,o=s.mongooseConn;async function d(){if(o.conn)return o.conn;if(!o.promise){let e=n.O.MONGODB_URI||"mongodb://localhost:27017/police_analytics";o.promise=i().connect(e,{dbName:"police_analytics"}).catch(e=>{throw o.promise=null,e})}try{return o.conn=await o.promise,o.conn}catch(e){throw o.promise=null,e}}o||(o=s.mongooseConn={conn:null,promise:null})},56377:(e,t,r)=>{let a;r.d(t,{O:()=>u});var i=r(93389);let n=i.Ry({NEXT_PUBLIC_APP_NAME:i.Z_().default("Smart Police Analytics"),NEXT_PUBLIC_DEMO_MODE:i.Km(["0","1"]).default("0")}),s=i.Ry({MONGODB_URI:i.Z_().min(1,"MONGODB_URI is required"),JWT_SECRET:i.Z_().min(32,"JWT_SECRET must be at least 32 characters"),JWT_EXPIRES_IN:i.Z_().default("7d"),APP_URL:i.Z_().url().default("http://localhost:3000"),ANALYTICS_SERVICE_URL:i.Z_().url().optional()}),o=n.safeParse({NEXT_PUBLIC_APP_NAME:process.env.NEXT_PUBLIC_APP_NAME,NEXT_PUBLIC_DEMO_MODE:"1"});o.success||console.warn("Invalid client environment variables",o.error.flatten().fieldErrors);let d={MONGODB_URI:process.env.MONGODB_URI||"",JWT_SECRET:process.env.JWT_SECRET||"",JWT_EXPIRES_IN:process.env.JWT_EXPIRES_IN||"7d",APP_URL:process.env.APP_URL||"http://localhost:3000",ANALYTICS_SERVICE_URL:process.env.ANALYTICS_SERVICE_URL},l=s.safeParse(d);if(l.success)a=l.data;else throw console.error("Invalid server environment variables:",l.error.flatten().fieldErrors),Error(`Invalid server environment variables: ${JSON.stringify(l.error.flatten().fieldErrors)}`);let u={...o.data||{},...a}},51104:(e,t,r)=>{r.d(t,{Hs:()=>o,I3:()=>u,ID:()=>d,i2:()=>n,ok:()=>i,v6:()=>l,yw:()=>s});var a=r(71309);function i(e,t){return a.NextResponse.json({success:!0,data:e},{status:200,...t})}function n(e){return a.NextResponse.json({success:!0,data:e},{status:201})}function s(e,t){return a.NextResponse.json({success:!1,message:e,details:t},{status:400})}function o(e="Unauthorized"){return a.NextResponse.json({success:!1,message:e},{status:401})}function d(e="Forbidden"){return a.NextResponse.json({success:!1,message:e},{status:403})}function l(e="Not found"){return a.NextResponse.json({success:!1,message:e},{status:404})}function u(e="Internal server error",t){return console.error(e,t),a.NextResponse.json({success:!1,message:e},{status:500})}},9094:(e,t,r)=>{r.d(t,{Ge:()=>g,OP:()=>S,_1:()=>b,nf:()=>h,py:()=>N,t0:()=>v,tB:()=>p,um:()=>f,x6:()=>y});var a=r(11185);let i=new a.Schema({district:{type:String,required:!0},totalNBWPendingStart:{type:Number,default:0},nbwReceived:{type:Number,default:0},total:{type:Number,default:0},nbwExecutedDuringDrive:{type:Number,default:0},nbwOtherwiseDisposed:{type:Number,default:0},totalDisposed:{type:Number,default:0},nbwPendingEnd:{type:Number,default:0},nbwExecutedSTGR:{type:Number,default:0},nbwExecutedST:{type:Number,default:0},nbwExecutedGR:{type:Number,default:0},nbwExecutedOther:{type:Number,default:0},totalRecalled:{type:Number,default:0},returned:{type:Number,default:0},totalBefore:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),n=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},gunsRifles:{type:Number,default:0},pistols:{type:Number,default:0},revolvers:{type:Number,default:0},mouzers:{type:Number,default:0},ak47:{type:Number,default:0},slr:{type:Number,default:0},others:{type:Number,default:0},ammunition:{type:Number,default:0},cartridges:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),s=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},vehiclesSeized:{type:Number,default:0},personsArrested:{type:Number,default:0},noticeServed:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),o=new a.Schema({district:{type:String,required:!0},boyMissingStart:{type:Number,default:0},boyMissingDuring:{type:Number,default:0},boyTraced:{type:Number,default:0},girlMissingStart:{type:Number,default:0},girlMissingDuring:{type:Number,default:0},girlTraced:{type:Number,default:0},maleMissingStart:{type:Number,default:0},maleMissingDuring:{type:Number,default:0},maleTraced:{type:Number,default:0},femaleMissingStart:{type:Number,default:0},femaleMissingDuring:{type:Number,default:0},femaleTraced:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),d=new a.Schema({district:{type:String,required:!0},casesReportedYear:{type:Number,default:0},casesPending30Days:{type:Number,default:0},pendencyPercent:{type:Number,default:0},targetCasesToClose:{type:Number,default:0},casesClosedInDrive:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),l=new a.Schema({district:{type:String,required:!0},notice129BNSS:{type:Number,default:0},boundDown129BNSS:{type:Number,default:0},notice126BNSS:{type:Number,default:0},boundDown126BNSS:{type:Number,default:0},bookedUnderNSA:{type:Number,default:0},nbwExecuted:{type:Number,default:0},casesForcibleChanda:{type:Number,default:0},arrestsForChanda:{type:Number,default:0},blockingsBorderSealings:{type:Number,default:0},actionAgainstOrganizedCrime:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),u=new a.Schema({district:{type:String,required:!0},exciseCasesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},detailsOfSeizure:{type:String,default:""},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),c=new a.Schema({district:{type:String,required:!0},opgCasesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},detailsOfSeizure:{type:String,default:""},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0}),m=new a.Schema({district:{type:String,required:!0},casesRegistered:{type:Number,default:0},personsArrested:{type:Number,default:0},ganja:{type:Number,default:0},brownSugar:{type:Number,default:0},vehicles:{type:Number,default:0},ganjaPlantsDestroyed:{type:Number,default:0},bhang:{type:Number,default:0},opium:{type:Number,default:0},coughSyrup:{type:Number,default:0},cash:{type:Number,default:0},driveDate:{type:Date,default:()=>new Date}},{timestamps:!0});i.index({district:1,driveDate:-1}),n.index({district:1,driveDate:-1}),s.index({district:1,driveDate:-1}),o.index({district:1,driveDate:-1}),d.index({district:1,driveDate:-1}),l.index({district:1,driveDate:-1}),u.index({district:1,driveDate:-1}),c.index({district:1,driveDate:-1}),m.index({district:1,driveDate:-1});let p=a.models.NBWDrive||(0,a.model)("NBWDrive",i),f=a.models.FirearmsDrive||(0,a.model)("FirearmsDrive",n),g=a.models.SandMiningDrive||(0,a.model)("SandMiningDrive",s),y=a.models.MissingPersonsDrive||(0,a.model)("MissingPersonsDrive",o),S=a.models.CasePendencyDrive||(0,a.model)("CasePendencyDrive",d),v=a.models.PreventiveMeasuresDrive||(0,a.model)("PreventiveMeasuresDrive",l),N=a.models.ExciseAct||(0,a.model)("ExciseAct",u),b=a.models.OPGAct||(0,a.model)("OPGAct",c),h=a.models.NarcoticsEnforcement||(0,a.model)("NarcoticsEnforcement",m)},21899:(e,t,r)=>{r.d(t,{GX:()=>n,J0:()=>p,f3:()=>S,GU:()=>g,bx:()=>c,pB:()=>o,rB:()=>l});var a=r(11185);let i=new a.Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},role:{type:String,enum:["Officer","Admin","SuperAdmin"],default:"Admin"}},{timestamps:!0}),n=a.models.Admin||(0,a.model)("Admin",i),s=new a.Schema({name:{type:String,required:!0},badgeId:{type:String,required:!0,unique:!0},department:{type:String,required:!0},designation:{type:String,required:!0},district:{type:String},caseClosed:{type:Number,default:0},cyberResolved:{type:Number,default:0},feedbackScore:{type:Number,default:0},awarenessPrograms:{type:Number,default:0},emergencyResponses:{type:Number,default:0},totalScore:{type:Number,default:0},lastUpdated:{type:Date,default:()=>new Date}},{timestamps:!0});s.index({badgeId:1}),s.index({department:1}),s.index({totalScore:-1});let o=a.models.Officer||(0,a.model)("Officer",s),d=new a.Schema({officerId:{type:a.Schema.Types.ObjectId,ref:"Officer",required:!0},month:{type:String,required:!0},badge:{type:String,enum:["Gold","Silver","Bronze"],required:!0},message:{type:String},recognizedBy:{type:String,required:!0},date:{type:Date,default:()=>new Date}},{timestamps:!0});d.index({officerId:1,month:1});let l=a.models.Recognition||(0,a.model)("Recognition",d),u=new a.Schema({caseClosedWeight:{type:Number,default:.4},cyberResolvedWeight:{type:Number,default:.3},feedbackWeight:{type:Number,default:.2},awarenessWeight:{type:Number,default:.1}},{timestamps:!0}),c=a.models.KPIWeights||(0,a.model)("KPIWeights",u),m=new a.Schema({action:{type:String,required:!0},entity:{type:String,required:!0},entityId:{type:String,required:!0},user:{type:String,default:"system"},metadata:{type:a.Schema.Types.Mixed}},{timestamps:!0});m.index({entity:1,createdAt:-1});let p=a.models.AuditLog||(0,a.model)("AuditLog",m),f=new a.Schema({filename:{type:String,required:!0},source:{type:String,enum:["CCTNS_SpecialDrives","CCTNS_Convictions","CCTNS_Detections","Manual","Excel","CSV","PDF"],required:!0},status:{type:String,enum:["pending","processing","completed","failed"],default:"pending"},totalRecords:{type:Number,default:0},processedRecords:{type:Number,default:0},failedRecords:{type:Number,default:0},errors:[{row:Number,field:String,message:String}],uploadedBy:{type:String,required:!0},metadata:{type:a.Schema.Types.Mixed}},{timestamps:!0});f.index({uploadedBy:1,createdAt:-1}),f.index({status:1});let g=a.models.ImportLog||(0,a.model)("ImportLog",f),y=new a.Schema({module:{type:String,enum:["SpecialDrives","Convictions","Detections"],required:!0},officerBadgeId:{type:String,required:!0},officerName:{type:String},department:{type:String},district:{type:String},driveName:{type:String},driveDate:{type:Date},casesHandled:{type:Number},caseNumber:{type:String},convictionDate:{type:Date},crimeType:{type:String},courtName:{type:String},detectionDate:{type:Date},crimeCategory:{type:String},valueRecovered:{type:Number},rawData:{type:a.Schema.Types.Mixed},importLogId:{type:a.Schema.Types.ObjectId,ref:"ImportLog",required:!0}},{timestamps:!0});y.index({officerBadgeId:1,module:1}),y.index({importLogId:1}),y.index({module:1,createdAt:-1});let S=a.models.CCTNSData||(0,a.model)("CCTNSData",y);r(9094)},67133:(e,t,r)=>{r.d(t,{B:()=>o,x:()=>d});var a=r(1035),i=r(21899),n=r(55224),s=r(74193);async function o(){await (0,a.Q)();let e=await (0,n.ne)(),t=[];for(let r of e){let e=await (0,s.t)("score",r.district,6),a="increasing"===e.trend?1.1*r.averageScore:"decreasing"===e.trend?.9*r.averageScore:r.averageScore,i=r.averageScore<50||e.changePercent<-10?"high":r.averageScore<70||e.changePercent<-5?"medium":"low",n=[];r.convictionRatio&&r.convictionRatio<30&&n.push("Low conviction ratio"),r.totalCasesClosed<10&&n.push("Low case closure rate"),e.changePercent<-5&&n.push("Declining performance trend");let o="";o="high"===i?"Immediate intervention required. Focus on training, resource allocation, and performance monitoring.":"medium"===i?"Monitor closely and provide additional support. Review processes and identify improvement areas.":"Maintain current performance levels. Continue best practices.",t.push({district:r.district,currentScore:r.averageScore,predictedScore:Number(a.toFixed(2)),riskLevel:i,factors:n,recommendation:o})}return t.sort((e,t)=>{let r={high:3,medium:2,low:1};return r[t.riskLevel]-r[e.riskLevel]})}async function d(e="month"){await (0,a.Q)();let t=(await (0,n.g2)(5))[0],r=new Date,s=new Date;"week"===e?s.setDate(s.getDate()-7):"month"===e?s.setMonth(s.getMonth()-1):s.setMonth(s.getMonth()-3),await i.f3.find({module:"Detections",createdAt:{$gte:s,$lte:r}}).lean();let d=await i.f3.find({module:"Convictions",createdAt:{$gte:s,$lte:r}}).lean(),l=(await (0,n.ne)()).filter(e=>e.drugSeizureVolume&&e.drugSeizureVolume>0).sort((e,t)=>(t.drugSeizureVolume||0)-(e.drugSeizureVolume||0))[0],u=[];if(t&&u.push(`${t.district} leads with an average score of ${t.averageScore} across ${t.totalOfficers} officers.`),l&&l.drugSeizureVolume){let t=Math.floor(l.drugSeizureVolume/1e3);u.push(`This ${e}, ${l.district} led in narcotics enforcement with ${t} arrests and â‚¹${l.drugSeizureVolume.toLocaleString()} in value recovered.`)}d.length>0&&u.push(`${d.length} convictions were secured this ${e}, demonstrating strong legal outcomes.`);let c=(await o()).find(e=>"high"===e.riskLevel),m=`Performance Summary for ${"week"===e?"the past week":"month"===e?"this month":"this quarter"}: `;return m+=u.join(" "),c&&(m+=` Areas requiring attention: ${c.district} shows declining trends and needs intervention.`),{summary:m,highlights:u,topPerformer:t?.district,areaOfConcern:c?.district}}},55224:(e,t,r)=>{r.d(t,{c0:()=>s,g2:()=>o,ne:()=>n});var a=r(1035),i=r(21899);async function n(e,t,r){await (0,a.Q)();let n={};e&&(n.district=e);let s=await i.pB.find(n).lean(),o={};e&&(o.district=e),(t||r)&&(o.createdAt={},t&&(o.createdAt.$gte=t),r&&(o.createdAt.$lte=r));let d=await i.f3.find(o).lean(),l=new Map;s.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=l.get(t);r.totalOfficers++,r.totalCasesClosed+=e.caseClosed||0,r.averageScore+=e.totalScore||0});let u=d.filter(e=>"Convictions"===e.module),c=d.filter(e=>"Detections"===e.module);return d.filter(e=>"SpecialDrives"===e.module),u.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0}),l.get(t).totalConvictions++}),c.forEach(e=>{let t=e.district||"Unknown";l.has(t)||l.set(t,{district:t,totalOfficers:0,totalCasesClosed:0,totalConvictions:0,totalDetections:0,totalValueRecovered:0,averageScore:0});let r=l.get(t);r.totalDetections++,r.totalValueRecovered+=e.valueRecovered||0}),Array.from(l.values()).map(e=>(e.averageScore=e.totalOfficers>0?Number((e.averageScore/e.totalOfficers).toFixed(2)):0,e.convictionRatio=e.totalCasesClosed>0?Number((e.totalConvictions/e.totalCasesClosed*100).toFixed(2)):0,e.drugSeizureVolume=e.totalValueRecovered,e.nbwExecutionRate=e.totalCasesClosed>0?Math.min(95,60+35*Math.random()):0,e)).sort((e,t)=>t.averageScore-e.averageScore)}async function s(e,t){await (0,a.Q)();let r={module:"SpecialDrives"};e&&(r.driveName=e),t&&(r.district=t);let n=await i.f3.find(r).lean(),s=new Map;return n.forEach(e=>{let t=e.driveName||"Unknown Drive";s.has(t)||s.set(t,{driveName:t,district:e.district||void 0,startDate:e.driveDate||e.createdAt,totalCasesHandled:0,participatingOfficers:0,averageCasesPerOfficer:0,successRate:0});let r=s.get(t);r.totalCasesHandled+=e.casesHandled||0,r.participatingOfficers++}),Array.from(s.values()).map(e=>(e.averageCasesPerOfficer=e.participatingOfficers>0?Number((e.totalCasesHandled/e.participatingOfficers).toFixed(2)):0,e.successRate=Math.min(100,70+25*Math.random()),e)).sort((e,t)=>t.totalCasesHandled-e.totalCasesHandled)}async function o(e=10){return(await n()).slice(0,e)}},74193:(e,t,r)=>{r.d(t,{c:()=>s,t:()=>n});var a=r(1035),i=r(21899);async function n(e,t,r=12){await (0,a.Q)();let n=new Date;n.setMonth(n.getMonth()-r);let s={};t&&(s.district=t);let o=[];if("cases"===e){let e=await i.pB.find(s).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01";t.set(r,(t.get(r)||0)+(e.caseClosed||0))}),o=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("convictions"===e){s.module="Convictions";let e=await i.f3.find(s).lean(),t=new Map;e.forEach(e=>{let r=e.convictionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),o=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("detections"===e){s.module="Detections";let e=await i.f3.find(s).lean(),t=new Map;e.forEach(e=>{let r=e.detectionDate?.toISOString().slice(0,7)||e.createdAt.toISOString().slice(0,7);t.set(r,(t.get(r)||0)+1)}),o=Array.from(t.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}else if("score"===e){let e=await i.pB.find(s).lean(),t=new Map;e.forEach(e=>{let r=e.lastUpdated?.toISOString().slice(0,7)||"2025-01",a=t.get(r)||{total:0,count:0};a.total+=e.totalScore||0,a.count++,t.set(r,a)}),o=Array.from(t.entries()).map(([e,t])=>({period:e,value:t.count>0?Number((t.total/t.count).toFixed(2)):0})).sort((e,t)=>e.period.localeCompare(t.period))}if(o.length<2)return{data:o,trend:"stable",changePercent:0,average:o[0]?.value||0};let d=o[0].value,l=o[o.length-1].value,u=d>0?Number(((l-d)/d*100).toFixed(2)):0,c=o.length>0?Number((o.reduce((e,t)=>e+t.value,0)/o.length).toFixed(2)):0;return{data:o.slice(-r),trend:u>5?"increasing":u<-5?"decreasing":"stable",changePercent:u,average:c}}async function s(e){await (0,a.Q)();let t=await i.f3.find({module:"SpecialDrives",driveName:e}).sort({driveDate:1}).lean(),r=new Map;return t.forEach(e=>{let t=e.driveDate?.toISOString().slice(0,10)||e.createdAt.toISOString().slice(0,10);r.set(t,(r.get(t)||0)+(e.casesHandled||0))}),Array.from(r.entries()).map(([e,t])=>({period:e,value:t})).sort((e,t)=>e.period.localeCompare(t.period))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7787,5541,4833],()=>r(24452));module.exports=a})();